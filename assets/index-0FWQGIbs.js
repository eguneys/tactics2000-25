var Da=Object.defineProperty;var Ia=(t,e,r)=>e in t?Da(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r;var $=(t,e,r)=>Ia(t,typeof e!="symbol"?e+"":e,r);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))n(o);new MutationObserver(o=>{for(const a of o)if(a.type==="childList")for(const c of a.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&n(c)}).observe(document,{childList:!0,subtree:!0});function r(o){const a={};return o.integrity&&(a.integrity=o.integrity),o.referrerPolicy&&(a.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?a.credentials="include":o.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function n(o){if(o.ep)return;o.ep=!0;const a=r(o);fetch(o.href,a)}})();const te={context:void 0,registry:void 0,effects:void 0,done:!1,getContextId(){return Zi(this.context.count)},getNextContextId(){return Zi(this.context.count++)}};function Zi(t){const e=String(t),r=e.length-1;return te.context.id+(r?String.fromCharCode(96+r):"")+e}function La(t){te.context=t}const Ua=(t,e)=>t===e,Ba=Symbol("solid-proxy"),za=Symbol("solid-track"),Fr={equals:Ua};let xo=Lo;const Je=1,xr=2,$o={owned:null,cleanups:null,context:null,owner:null},pn={};var se=null;let mn=null,ja=null,fe=null,Se=null,Qe=null,en=0;function Mr(t,e){const r=fe,n=se,o=t.length===0,a=e===void 0?n:e,c=o?$o:{owned:null,cleanups:null,context:a?a.context:null,owner:a},f=o?t:()=>t(()=>Ce(()=>dr(c)));se=c,fe=null;try{return it(f,!0)}finally{fe=r,se=n}}function ge(t,e){e=e?Object.assign({},Fr,e):Fr;const r={value:t,observers:null,observerSlots:null,comparator:e.equals||void 0},n=o=>(typeof o=="function"&&(o=o(r.value)),Io(r,o));return[Do.bind(r),n]}function eo(t,e,r){const n=tn(t,e,!0,Je);Xt(n)}function Xe(t,e,r){const n=tn(t,e,!1,Je);Xt(n)}function Ve(t,e,r){xo=Ja;const n=tn(t,e,!1,Je);n.user=!0,Qe?Qe.push(n):Xt(n)}function ke(t,e,r){r=r?Object.assign({},Fr,r):Fr;const n=tn(t,e,!0,0);return n.observers=null,n.observerSlots=null,n.comparator=r.equals||void 0,Xt(n),Do.bind(n)}function Ka(t){return t&&typeof t=="object"&&"then"in t}function Wa(t,e,r){let n,o,a;arguments.length===2&&typeof e=="object"||arguments.length===1?(n=!0,o=t,a={}):(n=t,o=e,a={});let c=null,f=pn,d=null,p=!1,w="initialValue"in a,g=typeof n=="function"&&ke(n);const S=new Set,[_,E]=(a.storage||ge)(a.initialValue),[k,F]=ge(void 0),[T,M]=ge(void 0,{equals:!1}),[P,N]=ge(w?"ready":"unresolved");te.context&&(d=te.getNextContextId(),a.ssrLoadFrom==="initial"?f=a.initialValue:te.load&&te.has(d)&&(f=te.load(d)));function O(B,D,C,X){return c===B&&(c=null,X!==void 0&&(w=!0),(B===f||D===f)&&a.onHydrated&&queueMicrotask(()=>a.onHydrated(X,{value:D})),f=pn,G(D,C)),D}function G(B,D){it(()=>{D===void 0&&E(()=>B),N(D!==void 0?"errored":w?"ready":"unresolved"),F(D);for(const C of S.keys())C.decrement();S.clear()},!1)}function I(){const B=Ya,D=_(),C=k();if(C!==void 0&&!c)throw C;return fe&&!fe.user&&B&&eo(()=>{T(),c&&(B.resolved||S.has(B)||(B.increment(),S.add(B)))}),D}function L(B=!0){if(B!==!1&&p)return;p=!1;const D=g?g():n;if(D==null||D===!1){O(c,Ce(_));return}const C=f!==pn?f:Ce(()=>o(D,{value:_(),refetching:B}));return Ka(C)?(c=C,"value"in C?(C.status==="success"?O(c,C.value,void 0,D):O(c,void 0,Pn(C.value),D),C):(p=!0,queueMicrotask(()=>p=!1),it(()=>{N(w?"refreshing":"pending"),M()},!1),C.then(X=>O(C,X,void 0,D),X=>O(C,void 0,Pn(X),D)))):(O(c,C,void 0,D),C)}return Object.defineProperties(I,{state:{get:()=>P()},error:{get:()=>k()},loading:{get(){const B=P();return B==="pending"||B==="refreshing"}},latest:{get(){if(!w)return I();const B=k();if(B&&!c)throw B;return _()}}}),g?eo(()=>L(!1)):L(!1),[I,{refetch:L,mutate:E}]}function $r(t){return it(t,!1)}function Ce(t){if(fe===null)return t();const e=fe;fe=null;try{return t()}finally{fe=e}}function Cn(t,e,r){const n=Array.isArray(t);let o;return a=>{let c;if(n){c=Array(t.length);for(let d=0;d<t.length;d++)c[d]=t[d]()}else c=t();const f=Ce(()=>e(c,o,a));return o=c,f}}function Ha(t){Ve(()=>Ce(t))}function Ga(t){return se===null||(se.cleanups===null?se.cleanups=[t]:se.cleanups.push(t)),t}function qa(t,e){const r=Symbol("context");return{id:r,Provider:Za(r),defaultValue:t}}function oi(t){let e;return se&&se.context&&(e=se.context[t.id])!==void 0?e:t.defaultValue}function Va(t){const e=ke(t),r=ke(()=>Tn(e()));return r.toArray=()=>{const n=r();return Array.isArray(n)?n:n!=null?[n]:[]},r}let Ya;function Do(){if(this.sources&&this.state)if(this.state===Je)Xt(this);else{const t=Se;Se=null,it(()=>Ir(this),!1),Se=t}if(fe){const t=this.observers?this.observers.length:0;fe.sources?(fe.sources.push(this),fe.sourceSlots.push(t)):(fe.sources=[this],fe.sourceSlots=[t]),this.observers?(this.observers.push(fe),this.observerSlots.push(fe.sources.length-1)):(this.observers=[fe],this.observerSlots=[fe.sources.length-1])}return this.value}function Io(t,e,r){let n=t.value;return(!t.comparator||!t.comparator(n,e))&&(t.value=e,t.observers&&t.observers.length&&it(()=>{for(let o=0;o<t.observers.length;o+=1){const a=t.observers[o],c=mn&&mn.running;c&&mn.disposed.has(a),(c?!a.tState:!a.state)&&(a.pure?Se.push(a):Qe.push(a),a.observers&&Uo(a)),c||(a.state=Je)}if(Se.length>1e6)throw Se=[],new Error},!1)),e}function Xt(t){if(!t.fn)return;dr(t);const e=en;Qa(t,t.value,e)}function Qa(t,e,r){let n;const o=se,a=fe;fe=se=t;try{n=t.fn(e)}catch(c){return t.pure&&(t.state=Je,t.owned&&t.owned.forEach(dr),t.owned=null),t.updatedAt=r+1,Bo(c)}finally{fe=a,se=o}(!t.updatedAt||t.updatedAt<=r)&&(t.updatedAt!=null&&"observers"in t?Io(t,n):t.value=n,t.updatedAt=r)}function tn(t,e,r,n=Je,o){const a={fn:t,state:n,updatedAt:null,owned:null,sources:null,sourceSlots:null,cleanups:null,value:e,owner:se,context:se?se.context:null,pure:r};return se===null||se!==$o&&(se.owned?se.owned.push(a):se.owned=[a]),a}function Dr(t){if(t.state===0)return;if(t.state===xr)return Ir(t);if(t.suspense&&Ce(t.suspense.inFallback))return t.suspense.effects.push(t);const e=[t];for(;(t=t.owner)&&(!t.updatedAt||t.updatedAt<en);)t.state&&e.push(t);for(let r=e.length-1;r>=0;r--)if(t=e[r],t.state===Je)Xt(t);else if(t.state===xr){const n=Se;Se=null,it(()=>Ir(t,e[0]),!1),Se=n}}function it(t,e){if(Se)return t();let r=!1;e||(Se=[]),Qe?r=!0:Qe=[],en++;try{const n=t();return Xa(r),n}catch(n){r||(Qe=null),Se=null,Bo(n)}}function Xa(t){if(Se&&(Lo(Se),Se=null),t)return;const e=Qe;Qe=null,e.length&&it(()=>xo(e),!1)}function Lo(t){for(let e=0;e<t.length;e++)Dr(t[e])}function Ja(t){let e,r=0;for(e=0;e<t.length;e++){const n=t[e];n.user?t[r++]=n:Dr(n)}if(te.context){if(te.count){te.effects||(te.effects=[]),te.effects.push(...t.slice(0,r));return}La()}for(te.effects&&(te.done||!te.count)&&(t=[...te.effects,...t],r+=te.effects.length,delete te.effects),e=0;e<r;e++)Dr(t[e])}function Ir(t,e){t.state=0;for(let r=0;r<t.sources.length;r+=1){const n=t.sources[r];if(n.sources){const o=n.state;o===Je?n!==e&&(!n.updatedAt||n.updatedAt<en)&&Dr(n):o===xr&&Ir(n,e)}}}function Uo(t){for(let e=0;e<t.observers.length;e+=1){const r=t.observers[e];r.state||(r.state=xr,r.pure?Se.push(r):Qe.push(r),r.observers&&Uo(r))}}function dr(t){let e;if(t.sources)for(;t.sources.length;){const r=t.sources.pop(),n=t.sourceSlots.pop(),o=r.observers;if(o&&o.length){const a=o.pop(),c=r.observerSlots.pop();n<o.length&&(a.sourceSlots[c]=n,o[n]=a,r.observerSlots[n]=c)}}if(t.tOwned){for(e=t.tOwned.length-1;e>=0;e--)dr(t.tOwned[e]);delete t.tOwned}if(t.owned){for(e=t.owned.length-1;e>=0;e--)dr(t.owned[e]);t.owned=null}if(t.cleanups){for(e=t.cleanups.length-1;e>=0;e--)t.cleanups[e]();t.cleanups=null}t.state=0}function Pn(t){return t instanceof Error?t:new Error(typeof t=="string"?t:"Unknown error",{cause:t})}function Bo(t,e=se){throw Pn(t)}function Tn(t){if(typeof t=="function"&&!t.length)return Tn(t());if(Array.isArray(t)){const e=[];for(let r=0;r<t.length;r++){const n=Tn(t[r]);Array.isArray(n)?e.push.apply(e,n):e.push(n)}return e}return t}function Za(t,e){return function(n){let o;return Xe(()=>o=Ce(()=>(se.context={...se.context,[t]:n.value},Va(()=>n.children))),void 0),o}}const el=Symbol("fallback");function to(t){for(let e=0;e<t.length;e++)t[e]()}function si(t,e,r={}){let n=[],o=[],a=[],c=0,f=e.length>1?[]:null;return Ga(()=>to(a)),()=>{let d=t()||[],p=d.length,w,g;return d[za],Ce(()=>{let _,E,k,F,T,M,P,N,O;if(p===0)c!==0&&(to(a),a=[],n=[],o=[],c=0,f&&(f=[])),r.fallback&&(n=[el],o[0]=Mr(G=>(a[0]=G,r.fallback())),c=1);else if(c===0){for(o=new Array(p),g=0;g<p;g++)n[g]=d[g],o[g]=Mr(S);c=p}else{for(k=new Array(p),F=new Array(p),f&&(T=new Array(p)),M=0,P=Math.min(c,p);M<P&&n[M]===d[M];M++);for(P=c-1,N=p-1;P>=M&&N>=M&&n[P]===d[N];P--,N--)k[N]=o[P],F[N]=a[P],f&&(T[N]=f[P]);for(_=new Map,E=new Array(N+1),g=N;g>=M;g--)O=d[g],w=_.get(O),E[g]=w===void 0?-1:w,_.set(O,g);for(w=M;w<=P;w++)O=n[w],g=_.get(O),g!==void 0&&g!==-1?(k[g]=o[w],F[g]=a[w],f&&(T[g]=f[w]),g=E[g],_.set(O,g)):a[w]();for(g=M;g<p;g++)g in k?(o[g]=k[g],a[g]=F[g],f&&(f[g]=T[g],f[g](g))):o[g]=Mr(S);o=o.slice(0,c=p),n=d.slice(0)}return o});function S(_){if(a[g]=_,f){const[E,k]=ge(g);return f[g]=k,e(d[g],E)}return e(d[g])}}}function Ee(t,e){return Ce(()=>t(e||{}))}let tl=0;function rl(){return te.context?te.getNextContextId():`cl-${tl++}`}const nl=t=>`Stale read from <${t}>.`;function ur(t){const e="fallback"in t&&{fallback:()=>t.fallback};return ke(si(()=>t.each,t.children,e||void 0))}function ai(t){const e=t.keyed,r=ke(()=>t.when,void 0,{equals:(n,o)=>e?n===o:!n==!o});return ke(()=>{const n=r();if(n){const o=t.children;return typeof o=="function"&&o.length>0?Ce(()=>o(e?n:()=>{if(!Ce(r))throw nl("Show");return t.when})):o}return t.fallback},void 0,void 0)}function il(t,e,r){let n=r.length,o=e.length,a=n,c=0,f=0,d=e[o-1].nextSibling,p=null;for(;c<o||f<a;){if(e[c]===r[f]){c++,f++;continue}for(;e[o-1]===r[a-1];)o--,a--;if(o===c){const w=a<n?f?r[f-1].nextSibling:r[a-f]:d;for(;f<a;)t.insertBefore(r[f++],w)}else if(a===f)for(;c<o;)(!p||!p.has(e[c]))&&e[c].remove(),c++;else if(e[c]===r[a-1]&&r[f]===e[o-1]){const w=e[--o].nextSibling;t.insertBefore(r[f++],e[c++].nextSibling),t.insertBefore(r[--a],w),e[o]=r[a]}else{if(!p){p=new Map;let g=f;for(;g<a;)p.set(r[g],g++)}const w=p.get(e[c]);if(w!=null)if(f<w&&w<a){let g=c,S=1,_;for(;++g<o&&g<a&&!((_=p.get(e[g]))==null||_!==w+S);)S++;if(S>w-f){const E=e[c];for(;f<w;)t.insertBefore(r[f++],E)}else t.replaceChild(r[f++],e[c++])}else c++;else e[c++].remove()}}}const ro="_$DX_DELEGATE";function ol(t,e,r,n={}){let o;return Mr(a=>{o=a,e===document?t():ae(e,t(),e.firstChild?null:void 0,r)},n.owner),()=>{o(),e.textContent=""}}function De(t,e,r){let n;const o=()=>{const c=document.createElement("template");return c.innerHTML=t,c.content.firstChild},a=()=>(n||(n=o())).cloneNode(!0);return a.cloneNode=a,a}function sl(t,e=window.document){const r=e[ro]||(e[ro]=new Set);for(let n=0,o=t.length;n<o;n++){const a=t[n];r.has(a)||(r.add(a),e.addEventListener(a,ll))}}function no(t,e,r){ci(t)||(r==null?t.removeAttribute(e):t.setAttribute(e,r))}function li(t,e){ci(t)||(e==null?t.removeAttribute("class"):t.className=e)}function al(t,e,r,n){if(Array.isArray(r)){const o=r[0];t.addEventListener(e,r[0]=a=>o.call(t,r[1],a))}else t.addEventListener(e,r,typeof r!="function"&&r)}function zo(t,e,r){return Ce(()=>t(e,r))}function ae(t,e,r,n){if(r!==void 0&&!n&&(n=[]),typeof e!="function")return Lr(t,e,n,r);Xe(o=>Lr(t,e(),o,r),n)}function ci(t){return!!te.context&&!te.done&&(!t||t.isConnected)}function ll(t){if(te.registry&&te.events&&te.events.find(([d,p])=>p===t))return;let e=t.target;const r=`$$${t.type}`,n=t.target,o=t.currentTarget,a=d=>Object.defineProperty(t,"target",{configurable:!0,value:d}),c=()=>{const d=e[r];if(d&&!e.disabled){const p=e[`${r}Data`];if(p!==void 0?d.call(e,p,t):d.call(e,t),t.cancelBubble)return}return e.host&&typeof e.host!="string"&&!e.host._$host&&e.contains(t.target)&&a(e.host),!0},f=()=>{for(;c()&&(e=e._$host||e.parentNode||e.host););};if(Object.defineProperty(t,"currentTarget",{configurable:!0,get(){return e||document}}),te.registry&&!te.done&&(te.done=_$HY.done=!0),t.composedPath){const d=t.composedPath();a(d[0]);for(let p=0;p<d.length-2&&(e=d[p],!!c());p++){if(e._$host){e=e._$host,f();break}if(e.parentNode===o)break}}else f();a(n)}function Lr(t,e,r,n,o){const a=ci(t);if(a){!r&&(r=[...t.childNodes]);let d=[];for(let p=0;p<r.length;p++){const w=r[p];w.nodeType===8&&w.data.slice(0,2)==="!$"?w.remove():d.push(w)}r=d}for(;typeof r=="function";)r=r();if(e===r)return r;const c=typeof e,f=n!==void 0;if(t=f&&r[0]&&r[0].parentNode||t,c==="string"||c==="number"){if(a||c==="number"&&(e=e.toString(),e===r))return r;if(f){let d=r[0];d&&d.nodeType===3?d.data!==e&&(d.data=e):d=document.createTextNode(e),r=Rt(t,r,n,d)}else r!==""&&typeof r=="string"?r=t.firstChild.data=e:r=t.textContent=e}else if(e==null||c==="boolean"){if(a)return r;r=Rt(t,r,n)}else{if(c==="function")return Xe(()=>{let d=e();for(;typeof d=="function";)d=d();r=Lr(t,d,r,n)}),()=>r;if(Array.isArray(e)){const d=[],p=r&&Array.isArray(r);if(Rn(d,e,r,o))return Xe(()=>r=Lr(t,d,r,n,!0)),()=>r;if(a){if(!d.length)return r;if(n===void 0)return r=[...t.childNodes];let w=d[0];if(w.parentNode!==t)return r;const g=[w];for(;(w=w.nextSibling)!==n;)g.push(w);return r=g}if(d.length===0){if(r=Rt(t,r,n),f)return r}else p?r.length===0?io(t,d,n):il(t,r,d):(r&&Rt(t),io(t,d));r=d}else if(e.nodeType){if(a&&e.parentNode)return r=f?[e]:e;if(Array.isArray(r)){if(f)return r=Rt(t,r,n,e);Rt(t,r,null,e)}else r==null||r===""||!t.firstChild?t.appendChild(e):t.replaceChild(e,t.firstChild);r=e}}return r}function Rn(t,e,r,n){let o=!1;for(let a=0,c=e.length;a<c;a++){let f=e[a],d=r&&r[t.length],p;if(!(f==null||f===!0||f===!1))if((p=typeof f)=="object"&&f.nodeType)t.push(f);else if(Array.isArray(f))o=Rn(t,f,d)||o;else if(p==="function")if(n){for(;typeof f=="function";)f=f();o=Rn(t,Array.isArray(f)?f:[f],Array.isArray(d)?d:[d])||o}else t.push(f),o=!0;else{const w=String(f);d&&d.nodeType===3&&d.data===w?t.push(d):t.push(document.createTextNode(w))}}return o}function io(t,e,r=null){for(let n=0,o=e.length;n<o;n++)t.insertBefore(e[n],r)}function Rt(t,e,r,n){if(r===void 0)return t.textContent="";const o=n||document.createTextNode("");if(e.length){let a=!1;for(let c=e.length-1;c>=0;c--){const f=e[c];if(o!==f){const d=f.parentNode===t;!a&&!c?d?t.replaceChild(o,f):t.insertBefore(o,r):d&&f.remove()}else a=!0}}else t.insertBefore(o,r);return[o]}const cl=""+new URL("hopefox-C_ibfsyU.wasm",import.meta.url).href,ul=["white","black"],Ur=["a","b","c","d","e","f","g","h"],Br=["1","2","3","4","5","6","7","8"],fl=[...Br].reverse(),ui=Array.prototype.concat(...Ur.map(t=>Br.map(e=>t+e))),xe=t=>ui[8*t[0]+t[1]],le=t=>[t.charCodeAt(0)-97,t.charCodeAt(1)-49],jo=ui.map(le);function hl(t){let e;const r=()=>(e===void 0&&(e=t()),e);return r.clear=()=>{e=void 0},r}const dl=()=>{let t;return{start(){t=performance.now()},cancel(){t=void 0},stop(){if(!t)return 0;const e=performance.now()-t;return t=void 0,e}}},fi=t=>t==="white"?"black":"white",pr=(t,e)=>{const r=t[0]-e[0],n=t[1]-e[1];return r*r+n*n},Mn=(t,e)=>t.role===e.role&&t.color===e.color,_r=t=>(e,r)=>[(r?e[0]:7-e[0])*t.width/8,(r?7-e[1]:e[1])*t.height/8],ze=(t,e)=>{t.style.transform=`translate(${e[0]}px,${e[1]}px)`},Ko=(t,e,r=1)=>{t.style.transform=`translate(${e[0]}px,${e[1]}px) scale(${r})`},hi=(t,e)=>{t.style.visibility=e?"visible":"hidden"},yt=t=>{var e;if(t.clientX||t.clientX===0)return[t.clientX,t.clientY];if(!((e=t.targetTouches)===null||e===void 0)&&e[0])return[t.targetTouches[0].clientX,t.targetTouches[0].clientY]},Wo=t=>t.button===2,Ye=(t,e)=>{const r=document.createElement(t);return e&&(r.className=e),r};function Ho(t,e,r){const n=le(t);return e||(n[0]=7-n[0],n[1]=7-n[1]),[r.left+r.width*n[0]/8+r.width/16,r.top+r.height*(7-n[1])/8+r.height/16]}const wt=(t,e)=>Math.abs(t-e),pl=t=>(e,r,n,o)=>wt(e,n)<2&&(t==="white"?o===r+1||r<=1&&o===r+2&&e===n:o===r-1||r>=6&&o===r-2&&e===n),Go=(t,e,r,n)=>{const o=wt(t,r),a=wt(e,n);return o===1&&a===2||o===2&&a===1},qo=(t,e,r,n)=>wt(t,r)===wt(e,n),Vo=(t,e,r,n)=>t===r||e===n,Yo=(t,e,r,n)=>qo(t,e,r,n)||Vo(t,e,r,n),ml=(t,e,r)=>(n,o,a,c)=>wt(n,a)<2&&wt(o,c)<2||r&&o===c&&o===(t==="white"?0:7)&&(n===4&&(a===2&&e.includes(0)||a===6&&e.includes(7))||e.includes(a));function gl(t,e){const r=e==="white"?"1":"8",n=[];for(const[o,a]of t)o[1]===r&&a.color===e&&a.role==="rook"&&n.push(le(o)[0]);return n}function Qo(t,e,r){const n=t.get(e);if(!n)return[];const o=le(e),a=n.role,c=a==="pawn"?pl(n.color):a==="knight"?Go:a==="bishop"?qo:a==="rook"?Vo:a==="queen"?Yo:ml(n.color,gl(t,n.color),r);return jo.filter(f=>(o[0]!==f[0]||o[1]!==f[1])&&c(o[0],o[1],f[0],f[1])).map(xe)}function Pe(t,...e){t&&setTimeout(()=>t(...e),1)}function wl(t){t.orientation=fi(t.orientation),t.animation.current=t.draggable.current=t.selected=void 0}function bl(t,e){for(const[r,n]of e)n?t.pieces.set(r,n):t.pieces.delete(r)}function vl(t,e){if(t.check=void 0,e===!0&&(e=t.turnColor),e)for(const[r,n]of t.pieces)n.role==="king"&&n.color===e&&(t.check=r)}function kl(t,e,r,n){lt(t),t.premovable.current=[e,r],Pe(t.premovable.events.set,e,r,n)}function at(t){t.premovable.current&&(t.premovable.current=void 0,Pe(t.premovable.events.unset))}function yl(t,e,r){at(t),t.predroppable.current={role:e,key:r},Pe(t.predroppable.events.set,e,r)}function lt(t){const e=t.predroppable;e.current&&(e.current=void 0,Pe(e.events.unset))}function _l(t,e,r){if(!t.autoCastle)return!1;const n=t.pieces.get(e);if(!n||n.role!=="king")return!1;const o=le(e),a=le(r);if(o[1]!==0&&o[1]!==7||o[1]!==a[1])return!1;o[0]===4&&!t.pieces.has(r)&&(a[0]===6?r=xe([7,a[1]]):a[0]===2&&(r=xe([0,a[1]])));const c=t.pieces.get(r);return!c||c.color!==n.color||c.role!=="rook"?!1:(t.pieces.delete(e),t.pieces.delete(r),o[0]<a[0]?(t.pieces.set(xe([6,a[1]]),n),t.pieces.set(xe([5,a[1]]),c)):(t.pieces.set(xe([2,a[1]]),n),t.pieces.set(xe([3,a[1]]),c)),!0)}function Xo(t,e,r){const n=t.pieces.get(e),o=t.pieces.get(r);if(e===r||!n)return!1;const a=o&&o.color!==n.color?o:void 0;return r===t.selected&&$e(t),Pe(t.events.move,e,r,a),_l(t,e,r)||(t.pieces.set(r,n),t.pieces.delete(e)),t.lastMove=[e,r],t.check=void 0,Pe(t.events.change),a||!0}function di(t,e,r,n){if(t.pieces.has(r))if(n)t.pieces.delete(r);else return!1;return Pe(t.events.dropNewPiece,e,r),t.pieces.set(r,e),t.lastMove=[r],t.check=void 0,Pe(t.events.change),t.movable.dests=void 0,t.turnColor=fi(t.turnColor),!0}function Jo(t,e,r){const n=Xo(t,e,r);return n&&(t.movable.dests=void 0,t.turnColor=fi(t.turnColor),t.animation.current=void 0),n}function Zo(t,e,r){if(pi(t,e,r)){const n=Jo(t,e,r);if(n){const o=t.hold.stop();$e(t);const a={premove:!1,ctrlKey:t.stats.ctrlKey,holdTime:o};return n!==!0&&(a.captured=n),Pe(t.movable.events.after,e,r,a),!0}}else if(Sl(t,e,r))return kl(t,e,r,{ctrlKey:t.stats.ctrlKey}),$e(t),!0;return $e(t),!1}function es(t,e,r,n){const o=t.pieces.get(e);o&&(El(t,e,r)||n)?(t.pieces.delete(e),di(t,o,r,n),Pe(t.movable.events.afterNewPiece,o.role,r,{premove:!1,predrop:!1})):o&&Al(t,e,r)?yl(t,o.role,r):(at(t),lt(t)),t.pieces.delete(e),$e(t)}function On(t,e,r){if(Pe(t.events.select,e),t.selected){if(t.selected===e&&!t.draggable.enabled){$e(t),t.hold.cancel();return}else if((t.selectable.enabled||r)&&t.selected!==e&&Zo(t,t.selected,e)){t.stats.dragged=!1;return}}(t.selectable.enabled||t.draggable.enabled)&&(rs(t,e)||mi(t,e))&&(ts(t,e),t.hold.start())}function ts(t,e){t.selected=e,mi(t,e)?t.premovable.customDests||(t.premovable.dests=Qo(t.pieces,e,t.premovable.castle)):t.premovable.dests=void 0}function $e(t){t.selected=void 0,t.premovable.dests=void 0,t.hold.cancel()}function rs(t,e){const r=t.pieces.get(e);return!!r&&(t.movable.color==="both"||t.movable.color===r.color&&t.turnColor===r.color)}const pi=(t,e,r)=>{var n,o;return e!==r&&rs(t,e)&&(t.movable.free||!!(!((o=(n=t.movable.dests)===null||n===void 0?void 0:n.get(e))===null||o===void 0)&&o.includes(r)))};function El(t,e,r){const n=t.pieces.get(e);return!!n&&(e===r||!t.pieces.has(r))&&(t.movable.color==="both"||t.movable.color===n.color&&t.turnColor===n.color)}function mi(t,e){const r=t.pieces.get(e);return!!r&&t.premovable.enabled&&t.movable.color===r.color&&t.turnColor!==r.color}function Sl(t,e,r){var n,o;const a=(o=(n=t.premovable.customDests)===null||n===void 0?void 0:n.get(e))!==null&&o!==void 0?o:Qo(t.pieces,e,t.premovable.castle);return e!==r&&mi(t,e)&&a.includes(r)}function Al(t,e,r){const n=t.pieces.get(e),o=t.pieces.get(r);return!!n&&(!o||o.color!==t.movable.color)&&t.predroppable.enabled&&(n.role!=="pawn"||r[1]!=="1"&&r[1]!=="8")&&t.movable.color===n.color&&t.turnColor!==n.color}function Cl(t,e){const r=t.pieces.get(e);return!!r&&t.draggable.enabled&&(t.movable.color==="both"||t.movable.color===r.color&&(t.turnColor===r.color||t.premovable.enabled))}function Pl(t){const e=t.premovable.current;if(!e)return!1;const r=e[0],n=e[1];let o=!1;if(pi(t,r,n)){const a=Jo(t,r,n);if(a){const c={premove:!0};a!==!0&&(c.captured=a),Pe(t.movable.events.after,r,n,c),o=!0}}return at(t),o}function Tl(t,e){const r=t.predroppable.current;let n=!1;if(!r)return!1;if(e(r)){const o={role:r.role,color:t.movable.color};di(t,o,r.key)&&(Pe(t.movable.events.afterNewPiece,r.role,r.key,{premove:!1,predrop:!0}),n=!0)}return lt(t),n}function gi(t){at(t),lt(t),$e(t)}function oo(t){t.movable.color=t.movable.dests=t.animation.current=void 0,gi(t)}function _t(t,e,r){let n=Math.floor(8*(t[0]-r.left)/r.width);e||(n=7-n);let o=7-Math.floor(8*(t[1]-r.top)/r.height);return e||(o=7-o),n>=0&&n<8&&o>=0&&o<8?xe([n,o]):void 0}function Rl(t,e,r,n){const o=le(t),a=jo.filter(p=>Yo(o[0],o[1],p[0],p[1])||Go(o[0],o[1],p[0],p[1])),f=a.map(p=>Ho(xe(p),r,n)).map(p=>pr(e,p)),[,d]=f.reduce((p,w,g)=>p[0]<w?p:[w,g],[f[0],0]);return xe(a[d])}const Te=t=>t.orientation==="white",ns="rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR",Ml={p:"pawn",r:"rook",n:"knight",b:"bishop",q:"queen",k:"king"},Ol={pawn:"p",rook:"r",knight:"n",bishop:"b",queen:"q",king:"k"};function is(t){t==="start"&&(t=ns);const e=new Map;let r=7,n=0;for(const o of t)switch(o){case" ":case"[":return e;case"/":if(--r,r<0)return e;n=0;break;case"~":{const a=e.get(xe([n-1,r]));a&&(a.promoted=!0);break}default:{const a=o.charCodeAt(0);if(a<57)n+=a-48;else{const c=o.toLowerCase();e.set(xe([n,r]),{role:Ml[c],color:o===c?"black":"white"}),++n}}}return e}function Nl(t){return fl.map(e=>Ur.map(r=>{const n=t.get(r+e);if(n){let o=Ol[n.role];return n.color==="white"&&(o=o.toUpperCase()),n.promoted&&(o+="~"),o}else return"1"}).join("")).join("/").replace(/1{2,}/g,e=>e.length.toString())}function os(t,e){e.animation&&(wi(t.animation,e.animation),(t.animation.duration||0)<70&&(t.animation.enabled=!1))}function ss(t,e){var r,n,o;if(!((r=e.movable)===null||r===void 0)&&r.dests&&(t.movable.dests=void 0),!((n=e.drawable)===null||n===void 0)&&n.autoShapes&&(t.drawable.autoShapes=[]),wi(t,e),e.fen&&(t.pieces=is(e.fen),t.drawable.shapes=((o=e.drawable)===null||o===void 0?void 0:o.shapes)||[]),"check"in e&&vl(t,e.check||!1),"lastMove"in e&&!e.lastMove?t.lastMove=void 0:e.lastMove&&(t.lastMove=e.lastMove),t.selected&&ts(t,t.selected),os(t,e),!t.movable.rookCastle&&t.movable.dests){const a=t.movable.color==="white"?"1":"8",c="e"+a,f=t.movable.dests.get(c),d=t.pieces.get(c);if(!f||!d||d.role!=="king")return;t.movable.dests.set(c,f.filter(p=>!(p==="a"+a&&f.includes("c"+a))&&!(p==="h"+a&&f.includes("g"+a))))}}function wi(t,e){for(const r in e)Object.prototype.hasOwnProperty.call(e,r)&&(Object.prototype.hasOwnProperty.call(t,r)&&so(t[r])&&so(e[r])?wi(t[r],e[r]):t[r]=e[r])}function so(t){if(typeof t!="object"||t===null)return!1;const e=Object.getPrototypeOf(t);return e===Object.prototype||e===null}const pt=(t,e)=>e.animation.enabled?$l(t,e):tt(t,e);function tt(t,e){const r=t(e);return e.dom.redraw(),r}const gn=(t,e)=>({key:t,pos:le(t),piece:e}),Fl=(t,e)=>e.sort((r,n)=>pr(t.pos,r.pos)-pr(t.pos,n.pos))[0];function xl(t,e){const r=new Map,n=[],o=new Map,a=[],c=[],f=new Map;let d,p,w;for(const[g,S]of t)f.set(g,gn(g,S));for(const g of ui)d=e.pieces.get(g),p=f.get(g),d?p?Mn(d,p.piece)||(a.push(p),c.push(gn(g,d))):c.push(gn(g,d)):p&&a.push(p);for(const g of c)p=Fl(g,a.filter(S=>Mn(g.piece,S.piece))),p&&(w=[p.pos[0]-g.pos[0],p.pos[1]-g.pos[1]],r.set(g.key,w.concat(w)),n.push(p.key));for(const g of a)n.includes(g.key)||o.set(g.key,g.piece);return{anims:r,fadings:o}}function as(t,e){const r=t.animation.current;if(r===void 0){t.dom.destroyed||t.dom.redrawNow();return}const n=1-(e-r.start)*r.frequency;if(n<=0)t.animation.current=void 0,t.dom.redrawNow();else{const o=Dl(n);for(const a of r.plan.anims.values())a[2]=a[0]*o,a[3]=a[1]*o;t.dom.redrawNow(!0),requestAnimationFrame((a=performance.now())=>as(t,a))}}function $l(t,e){const r=new Map(e.pieces),n=t(e),o=xl(r,e);if(o.anims.size||o.fadings.size){const a=e.animation.current&&e.animation.current.start;e.animation.current={start:performance.now(),frequency:1/e.animation.duration,plan:o},a||as(e,performance.now())}else e.dom.redraw();return n}const Dl=t=>t<.5?4*t*t*t:(t-1)*(2*t-2)*(2*t-2)+1,Il=["green","red","blue","yellow"];function Ll(t,e){if(e.touches&&e.touches.length>1)return;e.stopPropagation(),e.preventDefault(),e.ctrlKey?$e(t):gi(t);const r=yt(e),n=_t(r,Te(t),t.dom.bounds());n&&(t.drawable.current={orig:n,pos:r,brush:jl(e),snapToValidMove:t.drawable.defaultSnapToValidMove},ls(t))}function ls(t){requestAnimationFrame(()=>{const e=t.drawable.current;if(e){const r=_t(e.pos,Te(t),t.dom.bounds());r||(e.snapToValidMove=!1);const n=e.snapToValidMove?Rl(e.orig,e.pos,Te(t),t.dom.bounds()):r;n!==e.mouseSq&&(e.mouseSq=n,e.dest=n!==e.orig?n:void 0,t.dom.redrawNow()),ls(t)}})}function Ul(t,e){t.drawable.current&&(t.drawable.current.pos=yt(e))}function Bl(t){const e=t.drawable.current;e&&(e.mouseSq&&Kl(t.drawable,e),cs(t))}function cs(t){t.drawable.current&&(t.drawable.current=void 0,t.dom.redraw())}function zl(t){t.drawable.shapes.length&&(t.drawable.shapes=[],t.dom.redraw(),us(t.drawable))}function jl(t){var e;const r=(t.shiftKey||t.ctrlKey)&&Wo(t),n=t.altKey||t.metaKey||((e=t.getModifierState)===null||e===void 0?void 0:e.call(t,"AltGraph"));return Il[(r?1:0)+(n?2:0)]}function Kl(t,e){const r=o=>o.orig===e.orig&&o.dest===e.dest,n=t.shapes.find(r);n&&(t.shapes=t.shapes.filter(o=>!r(o))),(!n||n.brush!==e.brush)&&t.shapes.push({orig:e.orig,dest:e.dest,brush:e.brush}),us(t)}function us(t){t.onChange&&t.onChange(t.shapes)}function Wl(t,e){if(!(t.trustAllEvents||e.isTrusted)||e.buttons!==void 0&&e.buttons>1||e.touches&&e.touches.length>1)return;const r=t.dom.bounds(),n=yt(e),o=_t(n,Te(t),r);if(!o)return;const a=t.pieces.get(o),c=t.selected;if(!c&&t.drawable.enabled&&(t.drawable.eraseOnClick||!a||a.color!==t.turnColor)&&zl(t),e.cancelable!==!1&&(!e.touches||t.blockTouchScroll||a||c||Hl(t,n)))e.preventDefault();else if(e.touches)return;const f=!!t.premovable.current,d=!!t.predroppable.current;t.stats.ctrlKey=e.ctrlKey,t.selected&&pi(t,t.selected,o)?pt(g=>On(g,o),t):On(t,o);const p=t.selected===o,w=hs(t,o);if(a&&w&&p&&Cl(t,o)){t.draggable.current={orig:o,piece:a,origPos:n,pos:n,started:t.draggable.autoDistance&&t.stats.dragged,element:w,previouslySelected:c,originTarget:e.target,keyHasChanged:!1},w.cgDragging=!0,w.classList.add("dragging");const g=t.dom.elements.ghost;g&&(g.className=`ghost ${a.color} ${a.role}`,ze(g,_r(r)(le(o),Te(t))),hi(g,!0)),bi(t)}else f&&at(t),d&&lt(t);t.dom.redraw()}function Hl(t,e){const r=Te(t),n=t.dom.bounds(),o=Math.pow(n.width/8,2);for(const a of t.pieces.keys()){const c=Ho(a,r,n);if(pr(c,e)<=o)return!0}return!1}function Gl(t,e,r,n){const o="a0";t.pieces.set(o,e),t.dom.redraw();const a=yt(r);t.draggable.current={orig:o,piece:e,origPos:a,pos:a,started:!0,element:()=>hs(t,o),originTarget:r.target,newPiece:!0,force:!!n,keyHasChanged:!1},bi(t)}function bi(t){requestAnimationFrame(()=>{var e;const r=t.draggable.current;if(!r)return;!((e=t.animation.current)===null||e===void 0)&&e.plan.anims.has(r.orig)&&(t.animation.current=void 0);const n=t.pieces.get(r.orig);if(!n||!Mn(n,r.piece))zr(t);else if(!r.started&&pr(r.pos,r.origPos)>=Math.pow(t.draggable.distance,2)&&(r.started=!0),r.started){if(typeof r.element=="function"){const a=r.element();if(!a)return;a.cgDragging=!0,a.classList.add("dragging"),r.element=a}const o=t.dom.bounds();ze(r.element,[r.pos[0]-o.left-o.width/16,r.pos[1]-o.top-o.height/16]),r.keyHasChanged||(r.keyHasChanged=r.orig!==_t(r.pos,Te(t),o))}bi(t)})}function ql(t,e){t.draggable.current&&(!e.touches||e.touches.length<2)&&(t.draggable.current.pos=yt(e))}function Vl(t,e){const r=t.draggable.current;if(!r)return;if(e.type==="touchend"&&e.cancelable!==!1&&e.preventDefault(),e.type==="touchend"&&r.originTarget!==e.target&&!r.newPiece){t.draggable.current=void 0;return}at(t),lt(t);const n=yt(e)||r.pos,o=_t(n,Te(t),t.dom.bounds());o&&r.started&&r.orig!==o?r.newPiece?es(t,r.orig,o,r.force):(t.stats.ctrlKey=e.ctrlKey,Zo(t,r.orig,o)&&(t.stats.dragged=!0)):r.newPiece?t.pieces.delete(r.orig):t.draggable.deleteOnDropOff&&!o&&(t.pieces.delete(r.orig),Pe(t.events.change)),(r.orig===r.previouslySelected||r.keyHasChanged)&&(r.orig===o||!o)?$e(t):t.selectable.enabled||$e(t),fs(t),t.draggable.current=void 0,t.dom.redraw()}function zr(t){const e=t.draggable.current;e&&(e.newPiece&&t.pieces.delete(e.orig),t.draggable.current=void 0,$e(t),fs(t),t.dom.redraw())}function fs(t){const e=t.dom.elements;e.ghost&&hi(e.ghost,!1)}function hs(t,e){let r=t.dom.elements.board.firstChild;for(;r;){if(r.cgKey===e&&r.tagName==="PIECE")return r;r=r.nextSibling}}function Yl(t,e){t.exploding={stage:1,keys:e},t.dom.redraw(),setTimeout(()=>{ao(t,2),setTimeout(()=>ao(t,void 0),120)},120)}function ao(t,e){t.exploding&&(e?t.exploding.stage=e:t.exploding=void 0,t.dom.redraw())}function Ql(t,e){function r(){wl(t),e()}return{set(n){n.orientation&&n.orientation!==t.orientation&&r(),os(t,n),(n.fen?pt:tt)(o=>ss(o,n),t)},state:t,getFen:()=>Nl(t.pieces),toggleOrientation:r,setPieces(n){pt(o=>bl(o,n),t)},selectSquare(n,o){n?pt(a=>On(a,n,o),t):t.selected&&($e(t),t.dom.redraw())},move(n,o){pt(a=>Xo(a,n,o),t)},newPiece(n,o){pt(a=>di(a,n,o),t)},playPremove(){if(t.premovable.current){if(pt(Pl,t))return!0;t.dom.redraw()}return!1},playPredrop(n){if(t.predroppable.current){const o=Tl(t,n);return t.dom.redraw(),o}return!1},cancelPremove(){tt(at,t)},cancelPredrop(){tt(lt,t)},cancelMove(){tt(n=>{gi(n),zr(n)},t)},stop(){tt(n=>{oo(n),zr(n)},t)},explode(n){Yl(t,n)},setAutoShapes(n){tt(o=>o.drawable.autoShapes=n,t)},setShapes(n){tt(o=>o.drawable.shapes=n,t)},getKeyAtDomPos(n){return _t(n,Te(t),t.dom.bounds())},redrawAll:e,dragNewPiece(n,o,a){Gl(t,n,o,a)},destroy(){oo(t),t.dom.unbind&&t.dom.unbind(),t.dom.destroyed=!0}}}function Xl(){return{pieces:is(ns),orientation:"white",turnColor:"white",coordinates:!0,coordinatesOnSquares:!1,ranksPosition:"right",autoCastle:!0,viewOnly:!1,disableContextMenu:!1,addPieceZIndex:!1,blockTouchScroll:!1,pieceKey:!1,trustAllEvents:!1,highlight:{lastMove:!0,check:!0},animation:{enabled:!0,duration:200},movable:{free:!0,color:"both",showDests:!0,events:{},rookCastle:!0},premovable:{enabled:!0,showDests:!0,castle:!0,events:{}},predroppable:{enabled:!1,events:{}},draggable:{enabled:!0,distance:3,autoDistance:!0,showGhost:!0,deleteOnDropOff:!1},dropmode:{active:!1},selectable:{enabled:!0},stats:{dragged:!("ontouchstart"in window)},events:{},drawable:{enabled:!0,visible:!0,defaultSnapToValidMove:!0,eraseOnClick:!0,shapes:[],autoShapes:[],brushes:{green:{key:"g",color:"#15781B",opacity:1,lineWidth:10},red:{key:"r",color:"#882020",opacity:1,lineWidth:10},blue:{key:"b",color:"#003088",opacity:1,lineWidth:10},yellow:{key:"y",color:"#e68f00",opacity:1,lineWidth:10},paleBlue:{key:"pb",color:"#003088",opacity:.4,lineWidth:15},paleGreen:{key:"pg",color:"#15781B",opacity:.4,lineWidth:15},paleRed:{key:"pr",color:"#882020",opacity:.4,lineWidth:15},paleGrey:{key:"pgr",color:"#4a4a4a",opacity:.35,lineWidth:15},purple:{key:"purple",color:"#68217a",opacity:.65,lineWidth:10},pink:{key:"pink",color:"#ee2080",opacity:.5,lineWidth:10},white:{key:"white",color:"white",opacity:1,lineWidth:10}},prevSvgHash:""},hold:dl()}}const lo={hilitePrimary:{key:"hilitePrimary",color:"#3291ff",opacity:1,lineWidth:1},hiliteWhite:{key:"hiliteWhite",color:"#ffffff",opacity:1,lineWidth:1}};function Jl(){const t=pe("defs"),e=Ae(pe("filter"),{id:"cg-filter-blur"});return e.appendChild(Ae(pe("feGaussianBlur"),{stdDeviation:"0.019"})),t.appendChild(e),t}function Zl(t,e,r){var n;const o=t.drawable,a=o.current,c=a&&a.mouseSq?a:void 0,f=new Map,d=t.dom.bounds(),p=o.autoShapes.filter(_=>!_.piece);for(const _ of o.shapes.concat(p).concat(c?[c]:[])){if(!_.dest)continue;const E=(n=f.get(_.dest))!==null&&n!==void 0?n:new Set,k=Wr(Kr(le(_.orig),t.orientation),d),F=Wr(Kr(le(_.dest),t.orientation),d);E.add(Fn(k,F)),f.set(_.dest,E)}const w=o.shapes.concat(p).map(_=>({shape:_,current:!1,hash:co(_,Nn(_.dest,f),!1,d)}));c&&w.push({shape:c,current:!0,hash:co(c,Nn(c.dest,f),!0,d)});const g=w.map(_=>_.hash).join(";");if(g===t.drawable.prevSvgHash)return;t.drawable.prevSvgHash=g;const S=e.querySelector("defs");ec(o,w,S),tc(w,e.querySelector("g"),r.querySelector("g"),_=>ic(t,_,o.brushes,f,d))}function ec(t,e,r){var n;const o=new Map;let a;for(const d of e.filter(p=>p.shape.dest&&p.shape.brush))a=ds(t.brushes[d.shape.brush],d.shape.modifiers),!((n=d.shape.modifiers)===null||n===void 0)&&n.hilite&&o.set(jr(a).key,jr(a)),o.set(a.key,a);const c=new Set;let f=r.firstElementChild;for(;f;)c.add(f.getAttribute("cgKey")),f=f.nextElementSibling;for(const[d,p]of o.entries())c.has(d)||r.appendChild(ac(p))}function tc(t,e,r,n){const o=new Map;for(const a of t)o.set(a.hash,!1);for(const a of[e,r]){const c=[];let f=a.firstElementChild,d;for(;f;)d=f.getAttribute("cgHash"),o.has(d)?o.set(d,!0):c.push(f),f=f.nextElementSibling;for(const p of c)a.removeChild(p)}for(const a of t.filter(c=>!o.get(c.hash)))for(const c of n(a))c.isCustom?r.appendChild(c.el):e.appendChild(c.el)}function co({orig:t,dest:e,brush:r,piece:n,modifiers:o,customSvg:a,label:c},f,d,p){var w,g;return[p.width,p.height,d,t,e,r,f&&"-",n&&rc(n),o&&nc(o),a&&`custom-${uo(a.html)},${(g=(w=a.center)===null||w===void 0?void 0:w[0])!==null&&g!==void 0?g:"o"}`,c&&`label-${uo(c.text)}`].filter(S=>S).join(",")}function rc(t){return[t.color,t.role,t.scale].filter(e=>e).join(",")}function nc(t){return[t.lineWidth,t.hilite&&"*"].filter(e=>e).join(",")}function uo(t){let e=0;for(let r=0;r<t.length;r++)e=(e<<5)-e+t.charCodeAt(r)>>>0;return e.toString()}function ic(t,{shape:e,current:r,hash:n},o,a,c){var f,d;const p=Wr(Kr(le(e.orig),t.orientation),c),w=e.dest?Wr(Kr(le(e.dest),t.orientation),c):p,g=e.brush&&ds(o[e.brush],e.modifiers),S=a.get(e.dest),_=[];if(g){const E=Ae(pe("g"),{cgHash:n});_.push({el:E}),p[0]!==w[0]||p[1]!==w[1]?E.appendChild(sc(e,g,p,w,r,Nn(e.dest,a))):E.appendChild(oc(o[e.brush],p,r,c))}if(e.label){const E=e.label;(f=E.fill)!==null&&f!==void 0||(E.fill=e.brush&&o[e.brush].color);const k=e.brush?void 0:"tr";_.push({el:lc(E,n,p,w,S,k),isCustom:!0})}if(e.customSvg){const E=(d=e.customSvg.center)!==null&&d!==void 0?d:"orig",[k,F]=E==="label"?ms(p,w,S).map(M=>M-.5):E==="dest"?w:p,T=Ae(pe("g"),{transform:`translate(${k},${F})`,cgHash:n});T.innerHTML=`<svg width="1" height="1" viewBox="0 0 100 100">${e.customSvg.html}</svg>`,_.push({el:T,isCustom:!0})}return _}function oc(t,e,r,n){const o=cc(),a=(n.width+n.height)/(4*Math.max(n.width,n.height));return Ae(pe("circle"),{stroke:t.color,"stroke-width":o[r?0:1],fill:"none",opacity:ps(t,r),cx:e[0],cy:e[1],r:a-o[1]/2})}function jr(t){return["#ffffff","#fff","white"].includes(t.color)?lo.hilitePrimary:lo.hiliteWhite}function sc(t,e,r,n,o,a){var c;function f(w){var g;const S=fc(a&&!o),_=n[0]-r[0],E=n[1]-r[1],k=Math.atan2(E,_),F=Math.cos(k)*S,T=Math.sin(k)*S;return Ae(pe("line"),{stroke:w?jr(e).color:e.color,"stroke-width":uc(e,o)+(w?.04:0),"stroke-linecap":"round","marker-end":`url(#arrowhead-${w?jr(e).key:e.key})`,opacity:!((g=t.modifiers)===null||g===void 0)&&g.hilite?1:ps(e,o),x1:r[0],y1:r[1],x2:n[0]-F,y2:n[1]-T})}if(!(!((c=t.modifiers)===null||c===void 0)&&c.hilite))return f(!1);const d=pe("g"),p=Ae(pe("g"),{filter:"url(#cg-filter-blur)"});return p.appendChild(hc(r,n)),p.appendChild(f(!0)),d.appendChild(p),d.appendChild(f(!1)),d}function ac(t){const e=Ae(pe("marker"),{id:"arrowhead-"+t.key,orient:"auto",overflow:"visible",markerWidth:4,markerHeight:4,refX:t.key.startsWith("hilite")?1.86:2.05,refY:2});return e.appendChild(Ae(pe("path"),{d:"M0,0 V4 L3,2 Z",fill:t.color})),e.setAttribute("cgKey",t.key),e}function lc(t,e,r,n,o,a){var c;const d=.4*.75**t.text.length,p=ms(r,n,o),w=a==="tr"?.4:0,g=Ae(pe("g"),{transform:`translate(${p[0]+w},${p[1]-w})`,cgHash:e});g.appendChild(Ae(pe("circle"),{r:.4/2,"fill-opacity":a?1:.8,"stroke-opacity":a?1:.7,"stroke-width":.03,fill:(c=t.fill)!==null&&c!==void 0?c:"#666",stroke:"white"}));const S=Ae(pe("text"),{"font-size":d,"font-family":"Noto Sans","text-anchor":"middle",fill:"white",y:.13*.75**t.text.length});return S.innerHTML=t.text,g.appendChild(S),g}function Kr(t,e){return e==="white"?t:[7-t[0],7-t[1]]}function Nn(t,e){return(t&&e.has(t)&&e.get(t).size>1)===!0}function pe(t){return document.createElementNS("http://www.w3.org/2000/svg",t)}function Ae(t,e){for(const r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.setAttribute(r,e[r]);return t}function ds(t,e){return e?{color:t.color,opacity:Math.round(t.opacity*10)/10,lineWidth:Math.round(e.lineWidth||t.lineWidth),key:[t.key,e.lineWidth].filter(r=>r).join("")}:t}function cc(){return[3/64,4/64]}function uc(t,e){return(t.lineWidth||10)*(e?.85:1)/64}function ps(t,e){return(t.opacity||1)*(e?.9:1)}function fc(t){return(t?20:10)/64}function Wr(t,e){const r=Math.min(1,e.width/e.height),n=Math.min(1,e.height/e.width);return[(t[0]-3.5)*r,(3.5-t[1])*n]}function hc(t,e){const r={from:[Math.floor(Math.min(t[0],e[0])),Math.floor(Math.min(t[1],e[1]))],to:[Math.ceil(Math.max(t[0],e[0])),Math.ceil(Math.max(t[1],e[1]))]};return Ae(pe("rect"),{x:r.from[0],y:r.from[1],width:r.to[0]-r.from[0],height:r.to[1]-r.from[1],fill:"none",stroke:"none"})}function Fn(t,e,r=!0){const n=Math.atan2(e[1]-t[1],e[0]-t[0])+Math.PI;return r?(Math.round(n*8/Math.PI)+16)%16:n}function dc(t,e){return Math.sqrt([t[0]-e[0],t[1]-e[1]].reduce((r,n)=>r+n*n,0))}function ms(t,e,r){let n=dc(t,e);const o=Fn(t,e,!1);if(r&&(n-=33/64,r.size>1)){n-=10/64;const a=Fn(t,e);(r.has((a+1)%16)||r.has((a+15)%16))&&a&1&&(n-=.4)}return[t[0]-Math.cos(o)*n,t[1]-Math.sin(o)*n].map(a=>a+.5)}function pc(t,e){t.innerHTML="",t.classList.add("cg-wrap");for(const d of ul)t.classList.toggle("orientation-"+d,e.orientation===d);t.classList.toggle("manipulable",!e.viewOnly);const r=Ye("cg-container");t.appendChild(r);const n=Ye("cg-board");r.appendChild(n);let o,a,c;if(e.drawable.visible&&(o=Ae(pe("svg"),{class:"cg-shapes",viewBox:"-4 -4 8 8",preserveAspectRatio:"xMidYMid slice"}),o.appendChild(Jl()),o.appendChild(pe("g")),a=Ae(pe("svg"),{class:"cg-custom-svgs",viewBox:"-3.5 -3.5 8 8",preserveAspectRatio:"xMidYMid slice"}),a.appendChild(pe("g")),c=Ye("cg-auto-pieces"),r.appendChild(o),r.appendChild(a),r.appendChild(c)),e.coordinates){const d=e.orientation==="black"?" black":"",p=e.ranksPosition==="left"?" left":"";if(e.coordinatesOnSquares){const w=e.orientation==="white"?g=>g+1:g=>8-g;Ur.forEach((g,S)=>r.appendChild(wn(Br.map(_=>g+_),"squares rank"+w(S)+d+p)))}else r.appendChild(wn(Br,"ranks"+d+p)),r.appendChild(wn(Ur,"files"+d))}let f;return e.draggable.enabled&&e.draggable.showGhost&&(f=Ye("piece","ghost"),hi(f,!1),r.appendChild(f)),{board:n,container:r,wrap:t,ghost:f,svg:o,customSvg:a,autoPieces:c}}function wn(t,e){const r=Ye("coords",e);let n;for(const o of t)n=Ye("coord"),n.textContent=o,r.appendChild(n);return r}function mc(t,e){if(!t.dropmode.active)return;at(t),lt(t);const r=t.dropmode.piece;if(r){t.pieces.set("a0",r);const n=yt(e),o=n&&_t(n,Te(t),t.dom.bounds());o&&es(t,"a0",o)}t.dom.redraw()}function gc(t,e){const r=t.dom.elements.board;if("ResizeObserver"in window&&new ResizeObserver(e).observe(t.dom.elements.wrap),(t.disableContextMenu||t.drawable.enabled)&&r.addEventListener("contextmenu",o=>o.preventDefault()),t.viewOnly)return;const n=bc(t);r.addEventListener("touchstart",n,{passive:!1}),r.addEventListener("mousedown",n,{passive:!1})}function wc(t,e){const r=[];if("ResizeObserver"in window||r.push(sr(document.body,"chessground.resize",e)),!t.viewOnly){const n=fo(t,ql,Ul),o=fo(t,Vl,Bl);for(const c of["touchmove","mousemove"])r.push(sr(document,c,n));for(const c of["touchend","mouseup"])r.push(sr(document,c,o));const a=()=>t.dom.bounds.clear();r.push(sr(document,"scroll",a,{capture:!0,passive:!0})),r.push(sr(window,"resize",a,{passive:!0}))}return()=>r.forEach(n=>n())}function sr(t,e,r,n){return t.addEventListener(e,r,n),()=>t.removeEventListener(e,r,n)}const bc=t=>e=>{t.draggable.current?zr(t):t.drawable.current?cs(t):e.shiftKey||Wo(e)?t.drawable.enabled&&Ll(t,e):t.viewOnly||(t.dropmode.active?mc(t,e):Wl(t,e))},fo=(t,e,r)=>n=>{t.drawable.current?t.drawable.enabled&&r(t,n):t.viewOnly||e(t,n)};function vc(t){const e=Te(t),r=_r(t.dom.bounds()),n=t.dom.elements.board,o=t.pieces,a=t.animation.current,c=a?a.plan.anims:new Map,f=a?a.plan.fadings:new Map,d=t.draggable.current,p=yc(t),w=new Set,g=new Set,S=new Map,_=new Map;let E,k,F,T,M,P,N,O,G,I;for(k=n.firstChild;k;){if(E=k.cgKey,gs(k))if(F=o.get(E),M=c.get(E),P=f.get(E),T=k.cgPiece,k.cgDragging&&(!d||d.orig!==E)&&(k.classList.remove("dragging"),ze(k,r(le(E),e)),k.cgDragging=!1),!P&&k.cgFading&&(k.cgFading=!1,k.classList.remove("fading")),F){if(M&&k.cgAnimating&&T===ar(F)){const L=le(E);L[0]+=M[2],L[1]+=M[3],k.classList.add("anim"),ze(k,r(L,e))}else k.cgAnimating&&(k.cgAnimating=!1,k.classList.remove("anim"),ze(k,r(le(E),e)),t.addPieceZIndex&&(k.style.zIndex=bn(le(E),e)));T===ar(F)&&(!P||!k.cgFading)?w.add(E):P&&T===ar(P)?(k.classList.add("fading"),k.cgFading=!0):vn(S,T,k)}else vn(S,T,k);else if(ws(k)){const L=k.className;p.get(E)===L?g.add(E):vn(_,L,k)}k=k.nextSibling}for(const[L,B]of p)if(!g.has(L)){G=_.get(B),I=G&&G.pop();const D=r(le(L),e);if(I)I.cgKey=L,ze(I,D);else{const C=Ye("square",B);C.cgKey=L,ze(C,D),n.insertBefore(C,n.firstChild)}}for(const[L,B]of o)if(M=c.get(L),!w.has(L))if(N=S.get(ar(B)),O=N&&N.pop(),O){O.cgKey=L,O.cgFading&&(O.classList.remove("fading"),O.cgFading=!1);const D=le(L);t.addPieceZIndex&&(O.style.zIndex=bn(D,e)),M&&(O.cgAnimating=!0,O.classList.add("anim"),D[0]+=M[2],D[1]+=M[3]),ze(O,r(D,e))}else{const D=ar(B),C=Ye("piece",D),X=le(L);C.cgPiece=D,C.cgKey=L,M&&(C.cgAnimating=!0,X[0]+=M[2],X[1]+=M[3]),ze(C,r(X,e)),t.addPieceZIndex&&(C.style.zIndex=bn(X,e)),n.appendChild(C)}for(const L of S.values())po(t,L);for(const L of _.values())po(t,L)}function kc(t){const e=Te(t),r=_r(t.dom.bounds());let n=t.dom.elements.board.firstChild;for(;n;)(gs(n)&&!n.cgAnimating||ws(n))&&ze(n,r(le(n.cgKey),e)),n=n.nextSibling}function ho(t){var e,r;const n=t.dom.elements.wrap.getBoundingClientRect(),o=t.dom.elements.container,a=n.height/n.width,c=Math.floor(n.width*window.devicePixelRatio/8)*8/window.devicePixelRatio,f=c*a;o.style.width=c+"px",o.style.height=f+"px",t.dom.bounds.clear(),(e=t.addDimensionsCssVarsTo)===null||e===void 0||e.style.setProperty("---cg-width",c+"px"),(r=t.addDimensionsCssVarsTo)===null||r===void 0||r.style.setProperty("---cg-height",f+"px")}const gs=t=>t.tagName==="PIECE",ws=t=>t.tagName==="SQUARE";function po(t,e){for(const r of e)t.dom.elements.board.removeChild(r)}function bn(t,e){const n=t[1];return`${e?10-n:3+n}`}const ar=t=>`${t.color} ${t.role}`;function yc(t){var e,r,n;const o=new Map;if(t.lastMove&&t.highlight.lastMove)for(const f of t.lastMove)qe(o,f,"last-move");if(t.check&&t.highlight.check&&qe(o,t.check,"check"),t.selected&&(qe(o,t.selected,"selected"),t.movable.showDests)){const f=(e=t.movable.dests)===null||e===void 0?void 0:e.get(t.selected);if(f)for(const p of f)qe(o,p,"move-dest"+(t.pieces.has(p)?" oc":""));const d=(n=(r=t.premovable.customDests)===null||r===void 0?void 0:r.get(t.selected))!==null&&n!==void 0?n:t.premovable.dests;if(d)for(const p of d)qe(o,p,"premove-dest"+(t.pieces.has(p)?" oc":""))}const a=t.premovable.current;if(a)for(const f of a)qe(o,f,"current-premove");else t.predroppable.current&&qe(o,t.predroppable.current.key,"current-premove");const c=t.exploding;if(c)for(const f of c.keys)qe(o,f,"exploding"+c.stage);return t.highlight.custom&&t.highlight.custom.forEach((f,d)=>{qe(o,d,f)}),o}function qe(t,e,r){const n=t.get(e);n?t.set(e,`${n} ${r}`):t.set(e,r)}function vn(t,e,r){const n=t.get(e);n?n.push(r):t.set(e,[r])}function _c(t,e,r){const n=new Map,o=[];for(const f of t)n.set(f.hash,!1);let a=e.firstElementChild,c;for(;a;)c=a.getAttribute("cgHash"),n.has(c)?n.set(c,!0):o.push(a),a=a.nextElementSibling;for(const f of o)e.removeChild(f);for(const f of t)n.get(f.hash)||e.appendChild(r(f))}function Ec(t,e){const n=t.drawable.autoShapes.filter(o=>o.piece).map(o=>({shape:o,hash:Cc(o),current:!1}));_c(n,e,o=>Ac(t,o,t.dom.bounds()))}function Sc(t){var e;const r=Te(t),n=_r(t.dom.bounds());let o=(e=t.dom.elements.autoPieces)===null||e===void 0?void 0:e.firstChild;for(;o;)Ko(o,n(le(o.cgKey),r),o.cgScale),o=o.nextSibling}function Ac(t,{shape:e,hash:r},n){var o,a,c;const f=e.orig,d=(o=e.piece)===null||o===void 0?void 0:o.role,p=(a=e.piece)===null||a===void 0?void 0:a.color,w=(c=e.piece)===null||c===void 0?void 0:c.scale,g=Ye("piece",`${d} ${p}`);return g.setAttribute("cgHash",r),g.cgKey=f,g.cgScale=w,Ko(g,_r(n)(le(f),Te(t)),w),g}const Cc=t=>{var e,r,n;return[t.orig,(e=t.piece)===null||e===void 0?void 0:e.role,(r=t.piece)===null||r===void 0?void 0:r.color,(n=t.piece)===null||n===void 0?void 0:n.scale].join(",")};function Pc(t,e){const r=Xl();ss(r,e||{});function n(){const o="dom"in r?r.dom.unbind:void 0,a=pc(t,r),c=hl(()=>a.board.getBoundingClientRect()),f=w=>{vc(p),a.autoPieces&&Ec(p,a.autoPieces),!w&&a.svg&&Zl(p,a.svg,a.customSvg)},d=()=>{ho(p),kc(p),a.autoPieces&&Sc(p)},p=r;return p.dom={elements:a,bounds:c,redraw:Tc(f),redrawNow:f,unbind:o},p.drawable.prevSvgHash="",ho(p),f(!1),gc(p,d),o||(p.dom.unbind=wc(p,d)),p.events.insert&&p.events.insert(a),p}return Ql(n(),n)}function Tc(t){let e=!1;return()=>{e||(e=!0,requestAnimationFrame(()=>{t(),e=!1}))}}let bs=class{unwrap(e,r){const n=this._chain(o=>W.ok(e?e(o):o),o=>r?W.ok(r(o)):W.err(o));if(n.isErr)throw n.error;return n.value}map(e,r){return this._chain(n=>W.ok(e(n)),n=>W.err(r?r(n):n))}chain(e,r){return this._chain(e,r||(n=>W.err(n)))}},Rc=class extends bs{constructor(e){super(),this.value=void 0,this.isOk=!0,this.isErr=!1,this.value=e}_chain(e,r){return e(this.value)}},Mc=class extends bs{constructor(e){super(),this.error=void 0,this.isOk=!1,this.isErr=!0,this.error=e}_chain(e,r){return r(this.error)}};var W;(function(t){t.ok=function(e){return new Rc(e)},t.err=function(e){return new Mc(e||new Error)},t.all=function(e){if(Array.isArray(e)){const o=[];for(let a=0;a<e.length;a++){const c=e[a];if(c.isErr)return c;o.push(c.value)}return t.ok(o)}const r={},n=Object.keys(e);for(let o=0;o<n.length;o++){const a=e[n[o]];if(a.isErr)return a;r[n[o]]=a.value}return t.ok(r)}})(W||(W={}));const mo=t=>(t=t-(t>>>1&1431655765),t=(t&858993459)+(t>>>2&858993459),Math.imul(t+(t>>>4)&252645135,16843009)>>24),xn=t=>(t=t>>>8&16711935|(t&16711935)<<8,t>>>16&65535|(t&65535)<<16),go=t=>(t=t>>>1&1431655765|(t&1431655765)<<1,t=t>>>2&858993459|(t&858993459)<<2,t=t>>>4&252645135|(t&252645135)<<4,xn(t));let R=class Q{constructor(e,r){$(this,"lo");$(this,"hi");this.lo=e|0,this.hi=r|0}static fromSquare(e){return e>=32?new Q(0,1<<e-32):new Q(1<<e,0)}static fromRank(e){return new Q(255,0).shl64(8*e)}static fromFile(e){return new Q(16843009<<e,16843009<<e)}static empty(){return new Q(0,0)}static full(){return new Q(4294967295,4294967295)}static corners(){return new Q(129,2164260864)}static center(){return new Q(402653184,24)}static backranks(){return new Q(255,4278190080)}static backrank(e){return e==="white"?new Q(255,0):new Q(0,4278190080)}static lightSquares(){return new Q(1437226410,1437226410)}static darkSquares(){return new Q(2857740885,2857740885)}complement(){return new Q(~this.lo,~this.hi)}xor(e){return new Q(this.lo^e.lo,this.hi^e.hi)}union(e){return new Q(this.lo|e.lo,this.hi|e.hi)}intersect(e){return new Q(this.lo&e.lo,this.hi&e.hi)}diff(e){return new Q(this.lo&~e.lo,this.hi&~e.hi)}intersects(e){return this.intersect(e).nonEmpty()}isDisjoint(e){return this.intersect(e).isEmpty()}supersetOf(e){return e.diff(this).isEmpty()}subsetOf(e){return this.diff(e).isEmpty()}shr64(e){return e>=64?Q.empty():e>=32?new Q(this.hi>>>e-32,0):e>0?new Q(this.lo>>>e^this.hi<<32-e,this.hi>>>e):this}shl64(e){return e>=64?Q.empty():e>=32?new Q(0,this.lo<<e-32):e>0?new Q(this.lo<<e,this.hi<<e^this.lo>>>32-e):this}bswap64(){return new Q(xn(this.hi),xn(this.lo))}rbit64(){return new Q(go(this.hi),go(this.lo))}minus64(e){const r=this.lo-e.lo,n=(r&e.lo&1)+(e.lo>>>1)+(r>>>1)>>>31;return new Q(r,this.hi-(e.hi+n))}equals(e){return this.lo===e.lo&&this.hi===e.hi}size(){return mo(this.lo)+mo(this.hi)}isEmpty(){return this.lo===0&&this.hi===0}nonEmpty(){return this.lo!==0||this.hi!==0}has(e){return(e>=32?this.hi&1<<e-32:this.lo&1<<e)!==0}set(e,r){return r?this.with(e):this.without(e)}with(e){return e>=32?new Q(this.lo,this.hi|1<<e-32):new Q(this.lo|1<<e,this.hi)}without(e){return e>=32?new Q(this.lo,this.hi&~(1<<e-32)):new Q(this.lo&~(1<<e),this.hi)}toggle(e){return e>=32?new Q(this.lo,this.hi^1<<e-32):new Q(this.lo^1<<e,this.hi)}last(){if(this.hi!==0)return 63-Math.clz32(this.hi);if(this.lo!==0)return 31-Math.clz32(this.lo)}first(){if(this.lo!==0)return 31-Math.clz32(this.lo&-this.lo);if(this.hi!==0)return 63-Math.clz32(this.hi&-this.hi)}withoutFirst(){return this.lo!==0?new Q(this.lo&this.lo-1,this.hi):new Q(0,this.hi&this.hi-1)}moreThanOne(){return this.hi!==0&&this.lo!==0||(this.lo&this.lo-1)!==0||(this.hi&this.hi-1)!==0}singleSquare(){return this.moreThanOne()?void 0:this.last()}*[Symbol.iterator](){let e=this.lo,r=this.hi;for(;e!==0;){const n=31-Math.clz32(e&-e);e^=1<<n,yield n}for(;r!==0;){const n=31-Math.clz32(r&-r);r^=1<<n,yield 32+n}}*reversed(){let e=this.lo,r=this.hi;for(;r!==0;){const n=31-Math.clz32(r);r^=1<<n,yield 32+n}for(;e!==0;){const n=31-Math.clz32(e);e^=1<<n,yield n}}};const $n=["a","b","c","d","e","f","g","h"],vs=["1","2","3","4","5","6","7","8"],Qt=["white","black"],je=["pawn","knight","bishop","rook","queen","king"],Oc=["a","h"];let ks=class Or{constructor(){$(this,"occupied");$(this,"promoted");$(this,"white");$(this,"black");$(this,"pawn");$(this,"knight");$(this,"bishop");$(this,"rook");$(this,"queen");$(this,"king")}static default(){const e=new Or;return e.reset(),e}reset(){this.occupied=new R(65535,4294901760),this.promoted=R.empty(),this.white=new R(65535,0),this.black=new R(0,4294901760),this.pawn=new R(65280,16711680),this.knight=new R(66,1107296256),this.bishop=new R(36,603979776),this.rook=new R(129,2164260864),this.queen=new R(8,134217728),this.king=new R(16,268435456)}static empty(){const e=new Or;return e.clear(),e}clear(){this.occupied=R.empty(),this.promoted=R.empty();for(const e of Qt)this[e]=R.empty();for(const e of je)this[e]=R.empty()}clone(){const e=new Or;e.occupied=this.occupied,e.promoted=this.promoted;for(const r of Qt)e[r]=this[r];for(const r of je)e[r]=this[r];return e}getColor(e){if(this.white.has(e))return"white";if(this.black.has(e))return"black"}getRole(e){for(const r of je)if(this[r].has(e))return r}get(e){const r=this.getColor(e);if(!r)return;const n=this.getRole(e),o=this.promoted.has(e);return{color:r,role:n,promoted:o}}take(e){const r=this.get(e);return r&&(this.occupied=this.occupied.without(e),this[r.color]=this[r.color].without(e),this[r.role]=this[r.role].without(e),r.promoted&&(this.promoted=this.promoted.without(e))),r}set(e,r){const n=this.take(e);return this.occupied=this.occupied.with(e),this[r.color]=this[r.color].with(e),this[r.role]=this[r.role].with(e),r.promoted&&(this.promoted=this.promoted.with(e)),n}has(e){return this.occupied.has(e)}*[Symbol.iterator](){for(const e of this.occupied)yield[e,this.get(e)]}pieces(e,r){return this[e].intersect(this[r])}rooksAndQueens(){return this.rook.union(this.queen)}bishopsAndQueens(){return this.bishop.union(this.queen)}kingOf(e){return this.pieces(e,"king").singleSquare()}},Tr=class zt{constructor(){$(this,"pawn");$(this,"knight");$(this,"bishop");$(this,"rook");$(this,"queen");$(this,"king")}static empty(){const e=new zt;for(const r of je)e[r]=0;return e}static fromBoard(e,r){const n=new zt;for(const o of je)n[o]=e.pieces(r,o).size();return n}clone(){const e=new zt;for(const r of je)e[r]=this[r];return e}equals(e){return je.every(r=>this[r]===e[r])}add(e){const r=new zt;for(const n of je)r[n]=this[n]+e[n];return r}subtract(e){const r=new zt;for(const n of je)r[n]=this[n]-e[n];return r}nonEmpty(){return je.some(e=>this[e]>0)}isEmpty(){return!this.nonEmpty()}hasPawns(){return this.pawn>0}hasNonPawns(){return this.knight>0||this.bishop>0||this.rook>0||this.queen>0||this.king>0}size(){return this.pawn+this.knight+this.bishop+this.rook+this.queen+this.king}},Nc=class jt{constructor(e,r){$(this,"white");$(this,"black");this.white=e,this.black=r}static empty(){return new jt(Tr.empty(),Tr.empty())}static fromBoard(e){return new jt(Tr.fromBoard(e,"white"),Tr.fromBoard(e,"black"))}clone(){return new jt(this.white.clone(),this.black.clone())}equals(e){return this.white.equals(e.white)&&this.black.equals(e.black)}add(e){return new jt(this.white.add(e.white),this.black.add(e.black))}subtract(e){return new jt(this.white.subtract(e.white),this.black.subtract(e.black))}count(e){return this.white[e]+this.black[e]}size(){return this.white.size()+this.black.size()}isEmpty(){return this.white.isEmpty()&&this.black.isEmpty()}nonEmpty(){return!this.isEmpty()}hasPawns(){return this.white.hasPawns()||this.black.hasPawns()}hasNonPawns(){return this.white.hasNonPawns()||this.black.hasNonPawns()}},wo=class Dn{constructor(e,r){$(this,"white");$(this,"black");this.white=e,this.black=r}static default(){return new Dn(3,3)}clone(){return new Dn(this.white,this.black)}equals(e){return this.white===e.white&&this.black===e.black}};const V=t=>t!==void 0,ye=t=>t==="white"?"black":"white",bt=t=>t>>3,Ue=t=>t&7,In=(t,e)=>0<=t&&t<8&&0<=e&&e<8?t+8*e:void 0,bo=t=>{switch(t){case"pawn":return"p";case"knight":return"n";case"bishop":return"b";case"rook":return"r";case"queen":return"q";case"king":return"k"}};function Fc(t){switch(t.toLowerCase()){case"p":return"pawn";case"n":return"knight";case"b":return"bishop";case"r":return"rook";case"q":return"queen";case"k":return"king";default:return}}function xc(t){if(t.length===2)return In(t.charCodeAt(0)-97,t.charCodeAt(1)-49)}const $c=t=>$n[Ue(t)]+vs[bt(t)],vi=(t,e)=>t==="white"?e==="a"?2:6:e==="a"?58:62,ki=(t,e)=>t==="white"?e==="a"?3:5:e==="a"?59:61,Dc="rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR",Ic=Dc+" w KQkq -",Lc=Ic+" 0 1";var he;(function(t){t.Fen="ERR_FEN",t.Board="ERR_BOARD",t.Pockets="ERR_POCKETS",t.Turn="ERR_TURN",t.Castling="ERR_CASTLING",t.EpSquare="ERR_EP_SQUARE",t.RemainingChecks="ERR_REMAINING_CHECKS",t.Halfmoves="ERR_HALFMOVES",t.Fullmoves="ERR_FULLMOVES"})(he||(he={}));let be=class extends Error{};const Uc=(t,e,r)=>{let n=t.indexOf(e);for(;r-- >0&&n!==-1;)n=t.indexOf(e,n+e.length);return n},Wt=t=>/^\d{1,4}$/.test(t)?parseInt(t,10):void 0,ys=t=>{const e=Fc(t);return e&&{role:e,color:t.toLowerCase()===t?"black":"white"}},kn=t=>{const e=ks.empty();let r=7,n=0;for(let o=0;o<t.length;o++){const a=t[o];if(a==="/"&&n===8)n=0,r--;else{const c=parseInt(a,10);if(c>0)n+=c;else{if(n>=8||r<0)return W.err(new be(he.Board));const f=n+r*8,d=ys(a);if(!d)return W.err(new be(he.Board));t[o+1]==="~"&&(d.promoted=!0,o++),e.set(f,d),n++}}}return r!==0||n!==8?W.err(new be(he.Board)):W.ok(e)},vo=t=>{if(t.length>64)return W.err(new be(he.Pockets));const e=Nc.empty();for(const r of t){const n=ys(r);if(!n)return W.err(new be(he.Pockets));e[n.color][n.role]++}return W.ok(e)},Bc=(t,e)=>{let r=R.empty();if(e==="-")return W.ok(r);for(const n of e){const o=n.toLowerCase(),a=n===o?"black":"white",c=a==="white"?0:7;if("a"<=o&&o<="h")r=r.with(In(o.charCodeAt(0)-97,c));else if(o==="k"||o==="q"){const f=t[a].intersect(R.backrank(a)).intersect(t.rook.union(t.king)),d=o==="k"?f.last():f.first();r=r.with(V(d)&&t.rook.has(d)?d:In(o==="k"?7:0,c))}else return W.err(new be(he.Castling))}return Qt.some(n=>R.backrank(n).intersect(r).size()>2)?W.err(new be(he.Castling)):W.ok(r)},ko=t=>{const e=t.split("+");if(e.length===3&&e[0]===""){const r=Wt(e[1]),n=Wt(e[2]);return!V(r)||r>3||!V(n)||n>3?W.err(new be(he.RemainingChecks)):W.ok(new wo(3-r,3-n))}else if(e.length===2){const r=Wt(e[0]),n=Wt(e[1]);return!V(r)||r>3||!V(n)||n>3?W.err(new be(he.RemainingChecks)):W.ok(new wo(r,n))}else return W.err(new be(he.RemainingChecks))},yi=t=>{const e=t.split(/[\s_]+/),r=e.shift();let n,o=W.ok(void 0);if(r.endsWith("]")){const f=r.indexOf("[");if(f===-1)return W.err(new be(he.Fen));n=kn(r.slice(0,f)),o=vo(r.slice(f+1,-1))}else{const f=Uc(r,"/",7);f===-1?n=kn(r):(n=kn(r.slice(0,f)),o=vo(r.slice(f+1)))}let a;const c=e.shift();if(!V(c)||c==="w")a="white";else if(c==="b")a="black";else return W.err(new be(he.Turn));return n.chain(f=>{const d=e.shift(),p=V(d)?Bc(f,d):W.ok(R.empty()),w=e.shift();let g;if(V(w)&&w!=="-"&&(g=xc(w),!V(g)))return W.err(new be(he.EpSquare));let S=e.shift(),_;V(S)&&S.includes("+")&&(_=ko(S),S=e.shift());const E=V(S)?Wt(S):0;if(!V(E))return W.err(new be(he.Halfmoves));const k=e.shift(),F=V(k)?Wt(k):1;if(!V(F))return W.err(new be(he.Fullmoves));const T=e.shift();let M=W.ok(void 0);if(V(T)){if(V(_))return W.err(new be(he.RemainingChecks));M=ko(T)}else V(_)&&(M=_);return e.length>0?W.err(new be(he.Fen)):o.chain(P=>p.chain(N=>M.map(O=>({board:f,pockets:P,turn:a,castlingRights:N,remainingChecks:O,epSquare:g,halfmoves:E,fullmoves:Math.max(1,F)}))))})};var zc=De('<div class="is2d chessboard">');const jc=t=>{let e,r;return Ha(()=>{let n=t.color,o=t.dests,a={premovable:{enabled:!1},movable:{color:n,free:!1,dests:o,events:{after:t.onMoveAfter}},drawable:{onChange:t.onShapes}};r=Pc(e,a)}),Ve(()=>{let n,o;t.fen_uci?[n,o]=t.fen_uci:n=Lc;let a=[];o&&(a.push(o.slice(0,2)),a.push(o.slice(2,4)));let c=t.movable?t.color:void 0;r.set({fen:n,lastMove:a,turnColor:t.color,movable:{color:c,dests:t.dests}})}),Ve(()=>{let n=t.orientation??"white";r.set({orientation:n})}),Ve(()=>{let n=t.doPromotion;if(n){let o=r.state.pieces.get(n);r.setPieces(new Map([[n,{color:o.color,role:"queen",promoted:!0}]]))}}),Ve(()=>{t.shapes&&r.setAutoShapes(t.shapes)}),(()=>{var n=zc();return zo(o=>e=o,n),n})()},Kc=Symbol("store-raw"),Wc=Symbol("store-node"),Mt=Symbol("store-has"),Hc=Symbol("store-self");function mr(t){let e;return t!=null&&typeof t=="object"&&(t[Ba]||!(e=Object.getPrototypeOf(t))||e===Object.prototype||Array.isArray(t))}function Ln(t,e=new Set){let r,n,o,a;if(r=t!=null&&t[Kc])return r;if(!mr(t)||e.has(t))return t;if(Array.isArray(t)){Object.isFrozen(t)?t=t.slice(0):e.add(t);for(let c=0,f=t.length;c<f;c++)o=t[c],(n=Ln(o,e))!==o&&(t[c]=n)}else{Object.isFrozen(t)?t=Object.assign({},t):e.add(t);const c=Object.keys(t),f=Object.getOwnPropertyDescriptors(t);for(let d=0,p=c.length;d<p;d++)a=c[d],!f[a].get&&(o=t[a],(n=Ln(o,e))!==o&&(t[a]=n))}return t}function Gc(t,e){let r=t[e];return r||Object.defineProperty(t,e,{value:r=Object.create(null)}),r}function yo(t,e,r){if(t[e])return t[e];const[n,o]=ge(r,{equals:!1,internal:!0});return n.$=o,t[e]=n}function et(t,e,r,n=!1){if(!n&&t[e]===r)return;const o=t[e],a=t.length;r===void 0?(delete t[e],t[Mt]&&t[Mt][e]&&o!==void 0&&t[Mt][e].$()):(t[e]=r,t[Mt]&&t[Mt][e]&&o===void 0&&t[Mt][e].$());let c=Gc(t,Wc),f;if((f=yo(c,e,o))&&f.$(()=>r),Array.isArray(t)&&t.length!==a){for(let d=t.length;d<a;d++)(f=c[d])&&f.$();(f=yo(c,"length",a))&&f.$(t.length)}(f=c[Hc])&&f.$()}const Un=Symbol("store-root");function Kt(t,e,r,n,o){const a=e[r];if(t===a)return;const c=Array.isArray(t);if(r!==Un&&(!mr(t)||!mr(a)||c!==Array.isArray(a)||o&&t[o]!==a[o])){et(e,r,t);return}if(c){if(t.length&&a.length&&(!n||o&&t[0]&&t[0][o]!=null)){let p,w,g,S,_,E,k,F;for(g=0,S=Math.min(a.length,t.length);g<S&&(a[g]===t[g]||o&&a[g]&&t[g]&&a[g][o]===t[g][o]);g++)Kt(t[g],a,g,n,o);const T=new Array(t.length),M=new Map;for(S=a.length-1,_=t.length-1;S>=g&&_>=g&&(a[S]===t[_]||o&&a[g]&&t[g]&&a[S][o]===t[_][o]);S--,_--)T[_]=a[S];if(g>_||g>S){for(w=g;w<=_;w++)et(a,w,t[w]);for(;w<t.length;w++)et(a,w,T[w]),Kt(t[w],a,w,n,o);a.length>t.length&&et(a,"length",t.length);return}for(k=new Array(_+1),w=_;w>=g;w--)E=t[w],F=o&&E?E[o]:E,p=M.get(F),k[w]=p===void 0?-1:p,M.set(F,w);for(p=g;p<=S;p++)E=a[p],F=o&&E?E[o]:E,w=M.get(F),w!==void 0&&w!==-1&&(T[w]=a[p],w=k[w],M.set(F,w));for(w=g;w<t.length;w++)w in T?(et(a,w,T[w]),Kt(t[w],a,w,n,o)):et(a,w,t[w])}else for(let p=0,w=t.length;p<w;p++)Kt(t[p],a,p,n,o);a.length>t.length&&et(a,"length",t.length);return}const f=Object.keys(t);for(let p=0,w=f.length;p<w;p++)Kt(t[f[p]],a,f[p],n,o);const d=Object.keys(a);for(let p=0,w=d.length;p<w;p++)t[d[p]]===void 0&&et(a,d[p],void 0)}function qc(t,e={}){const{merge:r,key:n="id"}=e,o=Ln(t);return a=>{if(!mr(a)||!mr(o))return o;const c=Kt(o,{[Un]:a},Un,r,n);return c===void 0?a:c}}var Vc=t=>(typeof t.clear=="function"||(t.clear=()=>{let e;for(;e=t.key(0);)t.removeItem(e)}),t),Yc=["clear","getItem","getAll","setItem","removeItem","key","getLength"],Qc=t=>(t.withOptions=e=>Yc.reduce((r,n)=>(typeof t[n]=="function"&&(r[n]=(...o)=>(o[t[n].length-1]=e,t[n](...o))),r),{get length(){return t.length},withOptions:r=>t.withOptions(r)}),t),Xc={domain:"Domain",expires:"Expires",path:"Path",secure:"Secure",httpOnly:"HttpOnly",maxAge:"Max-Age",sameSite:"SameSite"};function Jc(t){if(!t)return"";const e=Object.entries(t).map(([r,n])=>{const o=Xc[r];if(o)return n instanceof Date?`${o}=${n.toUTCString()}`:typeof n=="boolean"?n?`${o}`:void 0:`${o}=${n}`}).filter(r=>!!r);return e.length!=0?`; ${e.join("; ")}`:""}function Zc(t,e){var n;const r=(n=t.match(`(^|;)\\s*${e}\\s*=\\s*([^;]+)`))==null?void 0:n.pop();return r!=null?decodeURIComponent(r):null}var lr=Qc(Vc({_read:()=>document.cookie,_write:(t,e,r)=>{document.cookie=`${t}=${e}${Jc(r)}`},getItem:(t,e)=>Zc(lr._read(e),t),setItem:(t,e,r)=>{lr._write(t,e.replace(/[\u00c0-\uffff\&;]/g,n=>encodeURIComponent(n)),r)},removeItem:(t,e)=>{lr._write(t,"deleted",{...e,expires:new Date(0)})},key:(t,e)=>{let r=null,n=0;return lr._read(e).replace(/(?:^|;)\s*(.+?)\s*=\s*[^;]+/g,(o,a)=>(!r&&a&&n++===t&&(r=a),"")),r},getLength:t=>{let e=0;return lr._read(t).replace(/(?:^|;)\s*.+?\s*=\s*[^;]+/g,r=>(e+=r?1:0,"")),e},get length(){return this.getLength()}}));function eu(t,e={}){var w;const r=e.storage||globalThis.localStorage,n=e.name||`storage-${rl()}`;if(!r)return[t[0],t[1],null];const o=e.storageOptions,a=e.serialize||JSON.stringify.bind(JSON),c=e.deserialize||JSON.parse.bind(JSON),f=r.getItem(n,o),d=typeof t[0]=="function"?g=>{try{const S=c(g);t[1](()=>S)}catch{}}:g=>{try{const S=c(g);t[1](qc(S))}catch{}};let p=!0;if(f instanceof Promise?f.then(g=>p&&g&&d(g)):f&&d(f),typeof((w=e.sync)==null?void 0:w[0])=="function"){const g=typeof t[0]=="function"?t[0]:()=>t[0];e.sync[0](S=>{S.key!==n||(S.url||globalThis.location.href)!==globalThis.location.href||S.newValue===a(Ce(g))||d(S.newValue)})}return[t[0],typeof t[0]=="function"?g=>{var E;const S=t[1](g),_=g!=null?a(S):g;return(E=e.sync)==null||E[1](n,_),_!=null?r.setItem(n,_,o):r.removeItem(n,o),p=!1,S}:(...g)=>{var _;t[1](...g);const S=a(Ce(()=>t[0]));(_=e.sync)==null||_[1](n,S),r.setItem(n,S,o),p=!1},f]}const Bn=(t,e,r)=>eu(ge(t),{name:`.hopefox2000.v0.${e}`}),Hr=(t,e)=>{let r=R.empty();for(const n of e){const o=t+n;0<=o&&o<64&&Math.abs(Ue(t)-Ue(o))<=2&&(r=r.with(o))}return r},ot=t=>{const e=[];for(let r=0;r<64;r++)e[r]=t(r);return e},tu=ot(t=>Hr(t,[-9,-8,-7,-1,1,7,8,9])),ru=ot(t=>Hr(t,[-17,-15,-10,-6,6,10,15,17])),nu={white:ot(t=>Hr(t,[7,9])),black:ot(t=>Hr(t,[-7,-9]))},Gr=t=>tu[t],qr=t=>ru[t],gr=(t,e)=>nu[t][e],zn=ot(t=>R.fromFile(Ue(t)).without(t)),jn=ot(t=>R.fromRank(bt(t)).without(t)),Kn=ot(t=>{const e=new R(134480385,2151686160),r=8*(bt(t)-Ue(t));return(r>=0?e.shl64(r):e.shr64(-r)).without(t)}),Wn=ot(t=>{const e=new R(270549120,16909320),r=8*(bt(t)+Ue(t)-7);return(r>=0?e.shl64(r):e.shr64(-r)).without(t)}),Hn=(t,e,r)=>{let n=r.intersect(e),o=n.bswap64();return n=n.minus64(t),o=o.minus64(t.bswap64()),n.xor(o.bswap64()).intersect(e)},iu=(t,e)=>Hn(R.fromSquare(t),zn[t],e),ou=(t,e)=>{const r=jn[t];let n=e.intersect(r),o=n.rbit64();return n=n.minus64(R.fromSquare(t)),o=o.minus64(R.fromSquare(63-t)),n.xor(o.rbit64()).intersect(r)},Gt=(t,e)=>{const r=R.fromSquare(t);return Hn(r,Kn[t],e).xor(Hn(r,Wn[t],e))},qt=(t,e)=>iu(t,e).xor(ou(t,e)),Gn=(t,e)=>Gt(t,e).xor(qt(t,e)),qn=(t,e)=>{const r=R.fromSquare(e);return jn[t].intersects(r)?jn[t].with(t):Wn[t].intersects(r)?Wn[t].with(t):Kn[t].intersects(r)?Kn[t].with(t):zn[t].intersects(r)?zn[t].with(t):R.empty()},Vt=(t,e)=>qn(t,e).intersect(R.full().shl64(t).xor(R.full().shl64(e))).withoutFirst();class su{constructor(e){$(this,"capacity");$(this,"cache");this.capacity=e,this.capacity=e,this.cache=new Map}get(e){if(!this.cache.has(e))return;const r=this.cache.get(e);return this.cache.delete(e),this.cache.set(e,r),r}put(e,r){if(this.cache.has(e))this.cache.delete(e);else if(this.cache.size>=this.capacity){const n=this.cache.keys().next().value;this.cache.delete(n)}this.cache.set(e,r)}}var rt;(function(t){t.Empty="ERR_EMPTY",t.OppositeCheck="ERR_OPPOSITE_CHECK",t.PawnsOnBackrank="ERR_PAWNS_ON_BACKRANK",t.Kings="ERR_KINGS",t.Variant="ERR_VARIANT"})(rt||(rt={}));let Ot=class extends Error{};const au=(t,e,r,n)=>r[e].intersect(qt(t,n).intersect(r.rooksAndQueens()).union(Gt(t,n).intersect(r.bishopsAndQueens())).union(qr(t).intersect(r.knight)).union(Gr(t).intersect(r.king)).union(gr(ye(e),t).intersect(r.pawn)));let _o=class cr{constructor(){$(this,"castlingRights");$(this,"rook");$(this,"path")}static default(){const e=new cr;return e.castlingRights=R.corners(),e.rook={white:{a:0,h:7},black:{a:56,h:63}},e.path={white:{a:new R(14,0),h:new R(96,0)},black:{a:new R(0,234881024),h:new R(0,1610612736)}},e}static empty(){const e=new cr;return e.castlingRights=R.empty(),e.rook={white:{a:void 0,h:void 0},black:{a:void 0,h:void 0}},e.path={white:{a:R.empty(),h:R.empty()},black:{a:R.empty(),h:R.empty()}},e}clone(){const e=new cr;return e.castlingRights=this.castlingRights,e.rook={white:{a:this.rook.white.a,h:this.rook.white.h},black:{a:this.rook.black.a,h:this.rook.black.h}},e.path={white:{a:this.path.white.a,h:this.path.white.h},black:{a:this.path.black.a,h:this.path.black.h}},e}add(e,r,n,o){const a=vi(e,r),c=ki(e,r);this.castlingRights=this.castlingRights.with(o),this.rook[e][r]=o,this.path[e][r]=Vt(o,c).with(c).union(Vt(n,a).with(a)).without(n).without(o)}static fromSetup(e){const r=cr.empty(),n=e.castlingRights.intersect(e.board.rook);for(const o of Qt){const a=R.backrank(o),c=e.board.kingOf(o);if(!V(c)||!a.has(c))continue;const f=n.intersect(e.board[o]).intersect(a),d=f.first();V(d)&&d<c&&r.add(o,"a",c,d);const p=f.last();V(p)&&c<p&&r.add(o,"h",c,p)}return r}discardRook(e){if(this.castlingRights.has(e)){this.castlingRights=this.castlingRights.without(e);for(const r of Qt)for(const n of Oc)this.rook[r][n]===e&&(this.rook[r][n]=void 0)}}discardColor(e){this.castlingRights=this.castlingRights.diff(R.backrank(e)),this.rook[e].a=void 0,this.rook[e].h=void 0}},lu=class{constructor(e){$(this,"rules");$(this,"board");$(this,"pockets");$(this,"turn");$(this,"castles");$(this,"epSquare");$(this,"remainingChecks");$(this,"halfmoves");$(this,"fullmoves");$(this,"c_cache",new su(64));this.rules=e}reset(){this.board=ks.default(),this.pockets=void 0,this.turn="white",this.castles=_o.default(),this.epSquare=void 0,this.remainingChecks=void 0,this.halfmoves=0,this.fullmoves=1}setupUnchecked(e){this.board=e.board.clone(),this.board.promoted=R.empty(),this.pockets=void 0,this.turn=e.turn,this.castles=_o.fromSetup(e),this.epSquare=cu(this,e.epSquare),this.remainingChecks=void 0,this.halfmoves=e.halfmoves,this.fullmoves=e.fullmoves}kingAttackers(e,r,n){return au(e,r,this.board,n)}playCaptureAt(e,r){this.halfmoves=0,r.role==="rook"&&this.castles.discardRook(e),this.pockets&&this.pockets[ye(r.color)][r.promoted?"pawn":r.role]++}ctx(){const e=this.isVariantEnd(),r=this.board.kingOf(this.turn);if(!V(r))return{king:r,blockers:R.empty(),checkers:R.empty(),variantEnd:e,mustCapture:!1};const n=qt(r,R.empty()).intersect(this.board.rooksAndQueens()).union(Gt(r,R.empty()).intersect(this.board.bishopsAndQueens())).intersect(this.board[ye(this.turn)]);let o=R.empty();for(const c of n){const f=Vt(r,c).intersect(this.board.occupied);f.moreThanOne()||(o=o.union(f))}const a=this.kingAttackers(r,ye(this.turn),this.board.occupied);return{king:r,blockers:o,checkers:a,variantEnd:e,mustCapture:!1}}clone(){var r,n;const e=new this.constructor;return e.board=this.board.clone(),e.pockets=(r=this.pockets)==null?void 0:r.clone(),e.turn=this.turn,e.castles=this.castles.clone(),e.epSquare=this.epSquare,e.remainingChecks=(n=this.remainingChecks)==null?void 0:n.clone(),e.halfmoves=this.halfmoves,e.fullmoves=this.fullmoves,e}validate(){if(this.board.occupied.isEmpty())return W.err(new Ot(rt.Empty));if(this.board.king.size()!==2)return W.err(new Ot(rt.Kings));if(!V(this.board.kingOf(this.turn)))return W.err(new Ot(rt.Kings));const e=this.board.kingOf(ye(this.turn));return V(e)?this.kingAttackers(e,this.turn,this.board.occupied).nonEmpty()?W.err(new Ot(rt.OppositeCheck)):R.backranks().intersects(this.board.pawn)?W.err(new Ot(rt.PawnsOnBackrank)):W.ok(void 0):W.err(new Ot(rt.Kings))}dropDests(e){return R.empty()}dests(e,r){let n=this.c_cache.get(e+"");if(n)return n;if(r=r||this.ctx(),r.variantEnd)return R.empty();const o=this.board.get(e);if(!o||o.color!==this.turn)return R.empty();let a,c;if(o.role==="pawn"){a=gr(this.turn,e).intersect(this.board[ye(this.turn)]);const f=this.turn==="white"?8:-8,d=e+f;if(0<=d&&d<64&&!this.board.occupied.has(d)){a=a.with(d);const p=this.turn==="white"?e<16:e>=48,w=d+f;p&&!this.board.occupied.has(w)&&(a=a.with(w))}V(this.epSquare)&&Eo(this,e,r)&&(c=R.fromSquare(this.epSquare))}else o.role==="bishop"?a=Gt(e,this.board.occupied):o.role==="knight"?a=qr(e):o.role==="rook"?a=qt(e,this.board.occupied):o.role==="queen"?a=Gn(e,this.board.occupied):a=Gr(e);if(a=a.diff(this.board[this.turn]),V(r.king)){if(o.role==="king"){const f=this.board.occupied.without(e);for(const d of a)this.kingAttackers(d,ye(this.turn),f).nonEmpty()&&(a=a.without(d));return a.union(Rr(this,"a",r)).union(Rr(this,"h",r))}if(r.checkers.nonEmpty()){const f=r.checkers.singleSquare();if(!V(f))return R.empty();a=a.intersect(Vt(f,r.king).with(f))}r.blockers.has(e)&&(a=a.intersect(qn(e,r.king)))}return c&&(a=a.union(c)),this.c_cache.put(e+"",a),a}pseudo_dests(e,r){if(r=r||this.ctx(),r.variantEnd)return R.empty();const n=this.board.get(e);if(!n||n.color!==this.turn)return R.empty();let o,a;if(n.role==="pawn"){o=gr(this.turn,e);const c=this.turn==="white"?8:-8,f=e+c;if(0<=f&&f<64&&!this.board.occupied.has(f)){o=o.with(f);const d=this.turn==="white"?e<16:e>=48,p=f+c;d&&!this.board.occupied.has(p)&&(o=o.with(p))}V(this.epSquare)&&Eo(this,e,r)&&(a=R.fromSquare(this.epSquare))}else n.role==="bishop"?o=Gt(e,this.board.occupied):n.role==="knight"?o=qr(e):n.role==="rook"?o=qt(e,this.board.occupied):n.role==="queen"?o=Gn(e,this.board.occupied):o=Gr(e);if(V(r.king)){if(n.role==="king"){this.board.occupied.without(e);for(const c of o);return o.union(Rr(this,"a",r)).union(Rr(this,"h",r))}if(r.checkers.nonEmpty()){const c=r.checkers.singleSquare();if(!V(c))return R.empty();o=o.intersect(Vt(c,r.king).with(c))}r.blockers.has(e)&&(o=o.intersect(qn(e,r.king)))}return a&&(o=o.union(a)),o}isVariantEnd(){return!1}variantOutcome(e){}hasInsufficientMaterial(e){return this.board[e].intersect(this.board.pawn.union(this.board.rooksAndQueens())).nonEmpty()?!1:this.board[e].intersects(this.board.knight)?this.board[e].size()<=2&&this.board[ye(e)].diff(this.board.king).diff(this.board.queen).isEmpty():this.board[e].intersects(this.board.bishop)?(!this.board.bishop.intersects(R.darkSquares())||!this.board.bishop.intersects(R.lightSquares()))&&this.board.pawn.isEmpty()&&this.board.knight.isEmpty():!0}toSetup(){var e,r;return{board:this.board.clone(),pockets:(e=this.pockets)==null?void 0:e.clone(),turn:this.turn,castlingRights:this.castles.castlingRights,epSquare:uu(this),remainingChecks:(r=this.remainingChecks)==null?void 0:r.clone(),halfmoves:Math.min(this.halfmoves,150),fullmoves:Math.min(Math.max(this.fullmoves,1),9999)}}isInsufficientMaterial(){return Qt.every(e=>this.hasInsufficientMaterial(e))}hasDests(e){e=e||this.ctx();for(const r of this.board[this.turn])if(this.dests(r,e).nonEmpty())return!0;return this.dropDests(e).nonEmpty()}isLegal(e,r){{if(e.promotion==="pawn"||e.promotion==="king"&&this.rules!=="antichess"||!!e.promotion!==(this.board.pawn.has(e.from)&&R.backranks().has(e.to)))return!1;const n=this.dests(e.from,r);return n.has(e.to)||n.has(fu(this,e).to)}}isCheck(){const e=this.board.kingOf(this.turn);return V(e)&&this.kingAttackers(e,ye(this.turn),this.board.occupied).nonEmpty()}isEnd(e){return(e?e.variantEnd:this.isVariantEnd())?!0:this.isInsufficientMaterial()||!this.hasDests(e)}isCheckmate(e){return e=e||this.ctx(),!e.variantEnd&&e.checkers.nonEmpty()&&!this.hasDests(e)}isStalemate(e){return e=e||this.ctx(),!e.variantEnd&&e.checkers.isEmpty()&&!this.hasDests(e)}outcome(e){const r=this.variantOutcome(e);return r||(e=e||this.ctx(),this.isCheckmate(e)?{winner:ye(this.turn)}:this.isInsufficientMaterial()||this.isStalemate(e)?{winner:void 0}:void 0)}allDests(e){e=e||this.ctx();const r=new Map;if(e.variantEnd)return r;for(const n of this.board[this.turn])r.set(n,this.dests(n,e));return r}play(e){const r=this.turn,n=this.epSquare,o=_s(this,e);this.epSquare=void 0,this.halfmoves+=1,r==="black"&&(this.fullmoves+=1),this.turn=ye(r);{const a=this.board.take(e.from);if(!a)return;let c;if(a.role==="pawn"){this.halfmoves=0,e.to===n&&(c=this.board.take(e.to+(r==="white"?-8:8)));const f=e.from-e.to;Math.abs(f)===16&&8<=e.from&&e.from<=55&&(this.epSquare=e.from+e.to>>1),e.promotion&&(a.role=e.promotion,a.promoted=!!this.pockets)}else if(a.role==="rook")this.castles.discardRook(e.from);else if(a.role==="king"){if(o){const f=this.castles.rook[r][o];if(V(f)){const d=this.board.take(f);this.board.set(vi(r,o),a),d&&this.board.set(ki(r,o),d)}}this.castles.discardColor(r)}if(!o){const f=this.board.set(e.to,a)||c;f&&this.playCaptureAt(e.to,f)}}this.remainingChecks&&this.isCheck()&&(this.remainingChecks[r]=Math.max(this.remainingChecks[r]-1,0))}},_i=class extends lu{constructor(){super("chess")}static default(){const e=new this;return e.reset(),e}static fromSetup(e){const r=new this;return r.setupUnchecked(e),r.validate().map(n=>r)}clone(){return super.clone()}};const cu=(t,e)=>{if(!V(e))return;const r=t.turn==="white"?5:2,n=t.turn==="white"?8:-8;if(bt(e)!==r||t.board.occupied.has(e+n))return;const o=e-n;if(!(!t.board.pawn.has(o)||!t.board[ye(t.turn)].has(o)))return e},uu=t=>{if(!V(t.epSquare))return;const e=t.ctx(),n=t.board.pieces(t.turn,"pawn").intersect(gr(ye(t.turn),t.epSquare));for(const o of n)if(t.dests(o,e).has(t.epSquare))return t.epSquare},Eo=(t,e,r)=>{if(!V(t.epSquare)||!gr(t.turn,e).has(t.epSquare))return!1;if(!V(r.king))return!0;const n=t.turn==="white"?8:-8,o=t.epSquare-n;return t.kingAttackers(r.king,ye(t.turn),t.board.occupied.toggle(e).toggle(o).with(t.epSquare)).without(o).isEmpty()},Rr=(t,e,r)=>{if(!V(r.king)||r.checkers.nonEmpty())return R.empty();const n=t.castles.rook[t.turn][e];if(!V(n)||t.castles.path[t.turn][e].intersects(t.board.occupied))return R.empty();const o=vi(t.turn,e),a=Vt(r.king,o),c=t.board.occupied.without(r.king);for(const p of a)if(t.kingAttackers(p,ye(t.turn),c).nonEmpty())return R.empty();const f=ki(t.turn,e),d=t.board.occupied.toggle(r.king).toggle(n).toggle(f);return t.kingAttackers(o,ye(t.turn),d).nonEmpty()?R.empty():R.fromSquare(n)},_s=(t,e)=>{const r=e.to-e.from;if(!(Math.abs(r)!==2&&!t.board[t.turn].has(e.to))&&t.board.king.has(e.from))return r>0?"h":"a"},fu=(t,e)=>{const r=_s(t,e);if(!r)return e;const n=t.castles.rook[t.turn][r];return{from:e.from,to:V(n)?n:e.to}},hu=(t,e)=>{let r="";{const n=t.board.getRole(e.from);if(!n)return"--";if(n==="king"&&(t.board[t.turn].has(e.to)||Math.abs(e.to-e.from)===2))r=e.to>e.from?"O-O":"O-O-O";else{const o=t.board.occupied.has(e.to)||n==="pawn"&&Ue(e.from)!==Ue(e.to);if(n!=="pawn"){r=bo(n).toUpperCase();let a;if(n==="king"?a=Gr(e.to).intersect(t.board.king):n==="queen"?a=Gn(e.to,t.board.occupied).intersect(t.board.queen):n==="rook"?a=qt(e.to,t.board.occupied).intersect(t.board.rook):n==="bishop"?a=Gt(e.to,t.board.occupied).intersect(t.board.bishop):a=qr(e.to).intersect(t.board.knight),a=a.intersect(t.board[t.turn]).without(e.from),a.nonEmpty()){const c=t.ctx();for(const f of a)t.dests(f,c).has(e.to)||(a=a.without(f));if(a.nonEmpty()){let f=!1,d=a.intersects(R.fromRank(bt(e.from)));a.intersects(R.fromFile(Ue(e.from)))?f=!0:d=!0,d&&(r+=$n[Ue(e.from)]),f&&(r+=vs[bt(e.from)])}}}else o&&(r=$n[Ue(e.from)]);o&&(r+="x"),r+=$c(e.to),e.promotion&&(r+="="+bo(e.promotion).toUpperCase())}}return r},du=(t,e)=>{var n;const r=hu(t,e);return t.play(e),(n=t.outcome())!=null&&n.winner?r+"#":t.isCheck()?r+"+":r},Es=(t,e)=>du(t.clone(),e),pu="modulepreload",mu=function(t,e){return new URL(t,e).href},So={},gu=function(e,r,n){let o=Promise.resolve();if(r&&r.length>0){const c=document.getElementsByTagName("link"),f=document.querySelector("meta[property=csp-nonce]"),d=(f==null?void 0:f.nonce)||(f==null?void 0:f.getAttribute("nonce"));o=Promise.allSettled(r.map(p=>{if(p=mu(p,n),p in So)return;So[p]=!0;const w=p.endsWith(".css"),g=w?'[rel="stylesheet"]':"";if(!!n)for(let E=c.length-1;E>=0;E--){const k=c[E];if(k.href===p&&(!w||k.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${p}"]${g}`))return;const _=document.createElement("link");if(_.rel=w?"stylesheet":pu,w||(_.as="script"),_.crossOrigin="",_.href=p,d&&_.setAttribute("nonce",d),document.head.appendChild(_),w)return new Promise((E,k)=>{_.addEventListener("load",E),_.addEventListener("error",()=>k(new Error(`Unable to preload CSS for ${p}`)))})}))}function a(c){const f=new Event("vite:preloadError",{cancelable:!0});if(f.payload=c,window.dispatchEvent(f),!f.defaultPrevented)throw c}return o.then(c=>{for(const f of c||[])f.status==="rejected"&&a(f.reason);return e().catch(a)})};var wu=(()=>{var t=import.meta.url;return async function(e={}){var r,n=e,o,a,c=new Promise((i,s)=>{o=i,a=s});["_get_fen","_get_pieces_bb","_get_turn","_is_checkmate","_pos_attacks","_get_at","_create_position","_delete_position","_make_move","_unmake_move","_get_legal_moves","_free_legal_moves","_init","_malloc","_free","setValue","getValue","stringToUTF8","UTF8ToString","_memory","___indirect_function_table","onRuntimeInitialized"].forEach(i=>{Object.getOwnPropertyDescriptor(c,i)||Object.defineProperty(c,i,{get:()=>oe("You are getting "+i+" on the Promise object, instead of the instance. Use .then() to get called back with the instance, see the MODULARIZE docs in src/settings.js"),set:()=>oe("You are setting "+i+" on the Promise object, instead of the instance. Use .then() to get called back with the instance, see the MODULARIZE docs in src/settings.js")})});var f=typeof window=="object",d=typeof WorkerGlobalScope<"u",p=typeof process=="object"&&typeof process.versions=="object"&&typeof process.versions.node=="string"&&process.type!="renderer",w=!f&&!p&&!d;if(p){const{createRequire:i}=await gu(async()=>{const{createRequire:l}=await Promise.resolve().then(()=>Sf);return{createRequire:l}},void 0,import.meta.url);let s=import.meta.url;s.startsWith("data:")&&(s="/");var g=i(s)}var S=Object.assign({},n),_="./this.program",E="";function k(i){return n.locateFile?n.locateFile(i,E):E+i}var F,T;if(p){if(typeof process>"u"||!process.release||process.release.name!=="node")throw new Error("not compiled for this environment (did you build to HTML and try to run it not on the web, or set ENVIRONMENT to something - like node - and run it someplace else - like on the web?)");var M=process.versions.node,P=M.split(".").slice(0,3);if(P=P[0]*1e4+P[1]*100+P[2].split("-")[0]*1,P<16e4)throw new Error("This emscripten-generated code requires node v16.0.0 (detected v"+M+")");var N=g("fs"),O=g("path");import.meta.url.startsWith("data:")||(E=O.dirname(g("url").fileURLToPath(import.meta.url))+"/"),T=i=>{i=Zt(i)?new URL(i):O.normalize(i);var s=N.readFileSync(i);return C(s.buffer),s},F=(i,s=!0)=>(i=Zt(i)?new URL(i):O.normalize(i),new Promise((l,h)=>{N.readFile(i,s?void 0:"utf8",(m,b)=>{m?h(m):l(s?b.buffer:b)})})),!n.thisProgram&&process.argv.length>1&&(_=process.argv[1].replace(/\\/g,"/")),process.argv.slice(2)}else if(w){if(typeof process=="object"&&typeof g=="function"||typeof window=="object"||typeof WorkerGlobalScope<"u")throw new Error("not compiled for this environment (did you build to HTML and try to run it not on the web, or set ENVIRONMENT to something - like node - and run it someplace else - like on the web?)")}else if(f||d){if(d?E=self.location.href:typeof document<"u"&&document.currentScript&&(E=document.currentScript.src),t&&(E=t),E.startsWith("blob:")?E="":E=E.substr(0,E.replace(/[?#].*/,"").lastIndexOf("/")+1),!(typeof window=="object"||typeof WorkerGlobalScope<"u"))throw new Error("not compiled for this environment (did you build to HTML and try to run it not on the web, or set ENVIRONMENT to something - like node - and run it someplace else - like on the web?)");d&&(T=i=>{var s=new XMLHttpRequest;return s.open("GET",i,!1),s.responseType="arraybuffer",s.send(null),new Uint8Array(s.response)}),F=i=>Zt(i)?new Promise((s,l)=>{var h=new XMLHttpRequest;h.open("GET",i,!0),h.responseType="arraybuffer",h.onload=()=>{if(h.status==200||h.status==0&&h.response){s(h.response);return}l(h.status)},h.onerror=l,h.send(null)}):fetch(i,{credentials:"same-origin"}).then(s=>s.ok?s.arrayBuffer():Promise.reject(new Error(s.status+" : "+s.url)))}else throw new Error("environment detection error");var G=n.print||console.log.bind(console),I=n.printErr||console.error.bind(console);Object.assign(n,S),S=null,Ma(),n.arguments&&n.arguments,ft("arguments","arguments_"),n.thisProgram&&(_=n.thisProgram),ft("thisProgram","thisProgram"),C(typeof n.memoryInitializerPrefixURL>"u","Module.memoryInitializerPrefixURL option was removed, use Module.locateFile instead"),C(typeof n.pthreadMainPrefixURL>"u","Module.pthreadMainPrefixURL option was removed, use Module.locateFile instead"),C(typeof n.cdInitializerPrefixURL>"u","Module.cdInitializerPrefixURL option was removed, use Module.locateFile instead"),C(typeof n.filePackagePrefixURL>"u","Module.filePackagePrefixURL option was removed, use Module.locateFile instead"),C(typeof n.read>"u","Module.read option was removed"),C(typeof n.readAsync>"u","Module.readAsync option was removed (modify readAsync in JS)"),C(typeof n.readBinary>"u","Module.readBinary option was removed (modify readBinary in JS)"),C(typeof n.setWindowTitle>"u","Module.setWindowTitle option was removed (modify emscripten_set_window_title in JS)"),C(typeof n.TOTAL_MEMORY>"u","Module.TOTAL_MEMORY has been renamed Module.INITIAL_MEMORY"),ft("asm","wasmExports"),ft("readAsync","readAsync"),ft("readBinary","readBinary"),ft("setWindowTitle","setWindowTitle"),C(!w,"shell environment detected but not enabled at build time.  Add `shell` to `-sENVIRONMENT` to enable.");var L=n.wasmBinary;ft("wasmBinary","wasmBinary"),typeof WebAssembly!="object"&&I("no native wasm support detected");var B,D=!1;function C(i,s){i||oe("Assertion failed"+(s?": "+s:""))}var X,He,Et,ie,K,Oe,St;function Fi(){var i=B.buffer;n.HEAP8=X=new Int8Array(i),n.HEAP16=Et=new Int16Array(i),n.HEAPU8=He=new Uint8Array(i),n.HEAPU16=new Uint16Array(i),n.HEAP32=ie=new Int32Array(i),n.HEAPU32=K=new Uint32Array(i),n.HEAPF32=Oe=new Float32Array(i),n.HEAPF64=St=new Float64Array(i)}C(!n.STACK_SIZE,"STACK_SIZE can no longer be set at runtime.  Use -sSTACK_SIZE at link time"),C(typeof Int32Array<"u"&&typeof Float64Array<"u"&&Int32Array.prototype.subarray!=null&&Int32Array.prototype.set!=null,"JS engine does not provide full typed array support"),C(!n.wasmMemory,"Use of `wasmMemory` detected.  Use -sIMPORTED_MEMORY to define wasmMemory externally"),C(!n.INITIAL_MEMORY,"Detected runtime INITIAL_MEMORY setting.  Use -sIMPORTED_MEMORY to define wasmMemory dynamically");function Is(){var i=dn();C((i&3)==0),i==0&&(i+=4),K[i>>2]=34821223,K[i+4>>2]=2310721022,K[0]=1668509029}function sn(){if(!D){var i=dn();i==0&&(i+=4);var s=K[i>>2],l=K[i+4>>2];(s!=34821223||l!=2310721022)&&oe(`Stack overflow! Stack cookie has been overwritten at ${tr(i)}, expected hex dwords 0x89BACDFE and 0x2135467, but received ${tr(l)} ${tr(s)}`),K[0]!=1668509029&&oe("Runtime error: The application has corrupted its heap memory area (address zero)!")}}var xi=[],$i=[],Di=[],Sr=!1;function Ls(){if(n.preRun)for(typeof n.preRun=="function"&&(n.preRun=[n.preRun]);n.preRun.length;)zs(n.preRun.shift());ln(xi)}function Us(){C(!Sr),Sr=!0,sn(),!n.noFSInit&&!u.initialized&&u.init(),u.ignorePermissions=!1,ln($i)}function Bs(){if(sn(),n.postRun)for(typeof n.postRun=="function"&&(n.postRun=[n.postRun]);n.postRun.length;)Ks(n.postRun.shift());ln(Di)}function zs(i){xi.unshift(i)}function js(i){$i.unshift(i)}function Ks(i){Di.unshift(i)}C(Math.imul,"This browser does not support Math.imul(), build with LEGACY_VM_SUPPORT or POLYFILL_OLD_MATH_FUNCTIONS to add in a polyfill"),C(Math.fround,"This browser does not support Math.fround(), build with LEGACY_VM_SUPPORT or POLYFILL_OLD_MATH_FUNCTIONS to add in a polyfill"),C(Math.clz32,"This browser does not support Math.clz32(), build with LEGACY_VM_SUPPORT or POLYFILL_OLD_MATH_FUNCTIONS to add in a polyfill"),C(Math.trunc,"This browser does not support Math.trunc(), build with LEGACY_VM_SUPPORT or POLYFILL_OLD_MATH_FUNCTIONS to add in a polyfill");var ct=0,ut=null,Jt=null,At={};function Ii(i){for(var s=i;;){if(!At[i])return i;i=s+Math.random()}}function an(i){var s;ct++,(s=n.monitorRunDependencies)==null||s.call(n,ct),i?(C(!At[i]),At[i]=1,ut===null&&typeof setInterval<"u"&&(ut=setInterval(()=>{if(D){clearInterval(ut),ut=null;return}var l=!1;for(var h in At)l||(l=!0,I("still waiting on run dependencies:")),I(`dependency: ${h}`);l&&I("(end of list)")},1e4))):I("warning: run dependency added without ID")}function Ar(i){var l;if(ct--,(l=n.monitorRunDependencies)==null||l.call(n,ct),i?(C(At[i]),delete At[i]):I("warning: run dependency removed without ID"),ct==0&&(ut!==null&&(clearInterval(ut),ut=null),Jt)){var s=Jt;Jt=null,s()}}function oe(i){var l;(l=n.onAbort)==null||l.call(n,i),i="Aborted("+i+")",I(i),D=!0;var s=new WebAssembly.RuntimeError(i);throw a(s),s}var Ws="data:application/octet-stream;base64,",Li=i=>i.startsWith(Ws),Zt=i=>i.startsWith("file://");function ce(i,s){return(...l)=>{C(Sr,`native function \`${i}\` called before runtime initialization`);var h=dt[i];return C(h,`exported native function \`${i}\` not found`),C(l.length<=s,`native function \`${i}\` called with ${l.length} args but expects ${s}`),h(...l)}}function Hs(){if(n.locateFile){var i="hopefox.wasm";return Li(i)?i:k(i)}return new URL("hopefox.wasm",import.meta.url).href}var er;function Ui(i){if(i==er&&L)return new Uint8Array(L);if(T)return T(i);throw"both async and sync fetching of the wasm failed"}function Gs(i){return L?Promise.resolve().then(()=>Ui(i)):F(i).then(s=>new Uint8Array(s),()=>Ui(i))}function Bi(i,s,l){return Gs(i).then(h=>WebAssembly.instantiate(h,s)).then(l,h=>{I(`failed to asynchronously prepare wasm: ${h}`),Zt(er)&&I(`warning: Loading from a file URI (${er}) is not supported in most browsers. See https://emscripten.org/docs/getting_started/FAQ.html#how-do-i-run-a-local-webserver-for-testing-why-does-my-program-stall-in-downloading-or-preparing`),oe(h)})}function qs(i,s,l,h){return!i&&typeof WebAssembly.instantiateStreaming=="function"&&!Li(s)&&!Zt(s)&&!p&&typeof fetch=="function"?fetch(s,{credentials:"same-origin"}).then(m=>{var b=WebAssembly.instantiateStreaming(m,l);return b.then(h,function(v){return I(`wasm streaming compile failed: ${v}`),I("falling back to ArrayBuffer instantiation"),Bi(s,l,h)})}):Bi(s,l,h)}function Vs(){return{env:Qi,wasi_snapshot_preview1:Qi}}function Ys(){function i(m,b){return dt=m.exports,B=dt.memory,C(B,"memory not found in wasm exports"),Fi(),js(dt.__wasm_call_ctors),Ar("wasm-instantiate"),dt}an("wasm-instantiate");var s=n;function l(m){C(n===s,"the Module object should not be replaced during async compilation - perhaps the order of HTML elements is wrong?"),s=null,i(m.instance)}var h=Vs();if(n.instantiateWasm)try{return n.instantiateWasm(h,i)}catch(m){I(`Module.instantiateWasm callback failed with error: ${m}`),a(m)}return er??(er=Hs()),qs(L,er,h,l).catch(a),{}}var Y,me;if((()=>{var i=new Int16Array(1),s=new Int8Array(i.buffer);if(i[0]=25459,s[0]!==115||s[1]!==99)throw"Runtime error: expected the system to be little-endian! (Run with -sSUPPORT_BIG_ENDIAN to bypass)"})(),n.ENVIRONMENT)throw new Error("Module.ENVIRONMENT has been deprecated. To force the environment, use the ENVIRONMENT compile-time option (for example, -sENVIRONMENT=web or -sENVIRONMENT=node)");function ft(i,s,l=!0){Object.getOwnPropertyDescriptor(n,i)||Object.defineProperty(n,i,{configurable:!0,get(){let h=l?" (the initial value can be provided on Module, but after startup the value is only looked for on a local variable of that name)":"";oe(`\`Module.${i}\` has been replaced by \`${s}\``+h)}})}function Qs(i){Object.getOwnPropertyDescriptor(n,i)&&oe(`\`Module.${i}\` was supplied but \`${i}\` not included in INCOMING_MODULE_JS_API`)}function zi(i){return i==="FS_createPath"||i==="FS_createDataFile"||i==="FS_createPreloadedFile"||i==="FS_unlink"||i==="addRunDependency"||i==="FS_createLazyFile"||i==="FS_createDevice"||i==="removeRunDependency"}function ji(i,s){typeof globalThis<"u"&&!Object.getOwnPropertyDescriptor(globalThis,i)&&Object.defineProperty(globalThis,i,{configurable:!0,get(){s()}})}function Ki(i,s){ji(i,()=>{Ge(`\`${i}\` is not longer defined by emscripten. ${s}`)})}Ki("buffer","Please use HEAP8.buffer or wasmMemory.buffer"),Ki("asm","Please use wasmExports instead");function Xs(i){ji(i,()=>{var s=`\`${i}\` is a library symbol and not included by default; add it to your library.js __deps or to DEFAULT_LIBRARY_FUNCS_TO_INCLUDE on the command line`,l=i;l.startsWith("_")||(l="$"+i),s+=` (e.g. -sDEFAULT_LIBRARY_FUNCS_TO_INCLUDE='${l}')`,zi(i)&&(s+=". Alternatively, forcing filesystem support (-sFORCE_FILESYSTEM) can export this for you"),Ge(s)}),Wi(i)}function Wi(i){Object.getOwnPropertyDescriptor(n,i)||Object.defineProperty(n,i,{configurable:!0,get(){var s=`'${i}' was not exported. add it to EXPORTED_RUNTIME_METHODS (see the Emscripten FAQ)`;zi(i)&&(s+=". Alternatively, forcing filesystem support (-sFORCE_FILESYSTEM) can export this for you"),oe(s)}})}var ln=i=>{for(;i.length>0;)i.shift()(n)};function Js(i,s="i8"){switch(s.endsWith("*")&&(s="*"),s){case"i1":return X[i];case"i8":return X[i];case"i16":return Et[i>>1];case"i32":return ie[i>>2];case"i64":oe("to do getValue(i64) use WASM_BIGINT");case"float":return Oe[i>>2];case"double":return St[i>>3];case"*":return K[i>>2];default:oe(`invalid type for getValue: ${s}`)}}n.getValue=Js,n.noExitRuntime;var tr=i=>(C(typeof i=="number"),i>>>=0,"0x"+i.toString(16).padStart(8,"0"));function Zs(i,s,l="i8"){switch(l.endsWith("*")&&(l="*"),l){case"i1":X[i]=s;break;case"i8":X[i]=s;break;case"i16":Et[i>>1]=s;break;case"i32":ie[i>>2]=s;break;case"i64":oe("to do setValue(i64) use WASM_BIGINT");case"float":Oe[i>>2]=s;break;case"double":St[i>>3]=s;break;case"*":K[i>>2]=s;break;default:oe(`invalid type for setValue: ${l}`)}}n.setValue=Zs;var Ge=i=>{Ge.shown||(Ge.shown={}),Ge.shown[i]||(Ge.shown[i]=1,p&&(i="warning: "+i),I(i))},Hi=typeof TextDecoder<"u"?new TextDecoder:void 0,Ct=(i,s=0,l=NaN)=>{for(var h=s+l,m=s;i[m]&&!(m>=h);)++m;if(m-s>16&&i.buffer&&Hi)return Hi.decode(i.subarray(s,m));for(var b="";s<m;){var v=i[s++];if(!(v&128)){b+=String.fromCharCode(v);continue}var y=i[s++]&63;if((v&224)==192){b+=String.fromCharCode((v&31)<<6|y);continue}var x=i[s++]&63;if((v&240)==224?v=(v&15)<<12|y<<6|x:((v&248)!=240&&Ge("Invalid UTF-8 leading byte "+tr(v)+" encountered when deserializing a UTF-8 string in wasm memory to a JS string!"),v=(v&7)<<18|y<<12|x<<6|i[s++]&63),v<65536)b+=String.fromCharCode(v);else{var q=v-65536;b+=String.fromCharCode(55296|q>>10,56320|q&1023)}}return b},Pt=(i,s)=>(C(typeof i=="number",`UTF8ToString expects a number (got ${typeof i})`),i?Ct(He,i,s):"");n.UTF8ToString=Pt;var ea=(i,s,l,h)=>oe(`Assertion failed: ${Pt(i)}, at: `+[s?Pt(s):"unknown filename",l,h?Pt(h):"unknown function"]);class ta{constructor(s){this.excPtr=s,this.ptr=s-24}set_type(s){K[this.ptr+4>>2]=s}get_type(){return K[this.ptr+4>>2]}set_destructor(s){K[this.ptr+8>>2]=s}get_destructor(){return K[this.ptr+8>>2]}set_caught(s){s=s?1:0,X[this.ptr+12]=s}get_caught(){return X[this.ptr+12]!=0}set_rethrown(s){s=s?1:0,X[this.ptr+13]=s}get_rethrown(){return X[this.ptr+13]!=0}init(s,l){this.set_adjusted_ptr(0),this.set_type(s),this.set_destructor(l)}set_adjusted_ptr(s){K[this.ptr+16>>2]=s}get_adjusted_ptr(){return K[this.ptr+16>>2]}}var ra=(i,s,l)=>{var h=new ta(i);h.init(s,l),C(!1,"Exception thrown, but exception catching is not enabled. Compile with -sNO_DISABLE_EXCEPTION_CATCHING or -sEXCEPTION_CATCHING_ALLOWED=[..] to catch.")},na=()=>oe("native code called abort()"),ia=(i,s,l)=>He.copyWithin(i,s,s+l),cn=(i,s,l,h)=>{if(C(typeof i=="string",`stringToUTF8Array expects a string (got ${typeof i})`),!(h>0))return 0;for(var m=l,b=l+h-1,v=0;v<i.length;++v){var y=i.charCodeAt(v);if(y>=55296&&y<=57343){var x=i.charCodeAt(++v);y=65536+((y&1023)<<10)|x&1023}if(y<=127){if(l>=b)break;s[l++]=y}else if(y<=2047){if(l+1>=b)break;s[l++]=192|y>>6,s[l++]=128|y&63}else if(y<=65535){if(l+2>=b)break;s[l++]=224|y>>12,s[l++]=128|y>>6&63,s[l++]=128|y&63}else{if(l+3>=b)break;y>1114111&&Ge("Invalid Unicode code point "+tr(y)+" encountered when serializing a JS string to a UTF-8 string in wasm memory! (Valid unicode code points should be in range 0-0x10FFFF)."),s[l++]=240|y>>18,s[l++]=128|y>>12&63,s[l++]=128|y>>6&63,s[l++]=128|y&63}}return s[l]=0,l-m},rr=(i,s,l)=>(C(typeof l=="number","stringToUTF8(str, outPtr, maxBytesToWrite) is missing the third parameter that specifies the length of the output buffer!"),cn(i,He,s,l));n.stringToUTF8=rr;var Cr=i=>{for(var s=0,l=0;l<i.length;++l){var h=i.charCodeAt(l);h<=127?s++:h<=2047?s+=2:h>=55296&&h<=57343?(s+=4,++l):s+=3}return s},oa=(i,s,l,h)=>{var m=new Date().getFullYear(),b=new Date(m,0,1),v=new Date(m,6,1),y=b.getTimezoneOffset(),x=v.getTimezoneOffset(),q=Math.max(y,x);K[i>>2]=q*60,ie[s>>2]=+(y!=x);var ee=U=>{var J=U>=0?"-":"+",ue=Math.abs(U),Ne=String(Math.floor(ue/60)).padStart(2,"0"),Re=String(ue%60).padStart(2,"0");return`UTC${J}${Ne}${Re}`},Z=ee(y),ne=ee(x);C(Z),C(ne),C(Cr(Z)<=16,`timezone name truncated to fit in TZNAME_MAX (${Z})`),C(Cr(ne)<=16,`timezone name truncated to fit in TZNAME_MAX (${ne})`),x<y?(rr(Z,l,17),rr(ne,h,17)):(rr(Z,h,17),rr(ne,l,17))},sa=()=>2147483648,aa=(i,s)=>(C(s,"alignment argument is required"),Math.ceil(i/s)*s),la=i=>{var s=B.buffer,l=(i-s.byteLength+65535)/65536|0;try{return B.grow(l),Fi(),1}catch(h){I(`growMemory: Attempted to grow heap from ${s.byteLength} bytes to ${i} bytes, but got error: ${h}`)}},ca=i=>{var s=He.length;i>>>=0,C(i>s);var l=sa();if(i>l)return I(`Cannot enlarge memory, requested ${i} bytes, but the limit is ${l} bytes!`),!1;for(var h=1;h<=4;h*=2){var m=s*(1+.2/h);m=Math.min(m,i+100663296);var b=Math.min(l,aa(Math.max(i,m),65536)),v=la(b);if(v)return!0}return I(`Failed to grow the heap from ${s} bytes to ${b} bytes, not enough memory!`),!1},un={},ua=()=>_||"./this.program",nr=()=>{if(!nr.strings){var i=(typeof navigator=="object"&&navigator.languages&&navigator.languages[0]||"C").replace("-","_")+".UTF-8",s={USER:"web_user",LOGNAME:"web_user",PATH:"/",PWD:"/",HOME:"/home/web_user",LANG:i,_:ua()};for(var l in un)un[l]===void 0?delete s[l]:s[l]=un[l];var h=[];for(var l in s)h.push(`${l}=${s[l]}`);nr.strings=h}return nr.strings},fa=(i,s)=>{for(var l=0;l<i.length;++l)C(i.charCodeAt(l)===(i.charCodeAt(l)&255)),X[s++]=i.charCodeAt(l);X[s]=0},ha=(i,s)=>{var l=0;return nr().forEach((h,m)=>{var b=s+l;K[i+m*4>>2]=b,fa(h,b),l+=h.length+1}),0},da=(i,s)=>{var l=nr();K[i>>2]=l.length;var h=0;return l.forEach(m=>h+=m.length+1),K[s>>2]=h,0},re={isAbs:i=>i.charAt(0)==="/",splitPath:i=>{var s=/^(\/?|)([\s\S]*?)((?:\.{1,2}|[^\/]+?|)(\.[^.\/]*|))(?:[\/]*)$/;return s.exec(i).slice(1)},normalizeArray:(i,s)=>{for(var l=0,h=i.length-1;h>=0;h--){var m=i[h];m==="."?i.splice(h,1):m===".."?(i.splice(h,1),l++):l&&(i.splice(h,1),l--)}if(s)for(;l;l--)i.unshift("..");return i},normalize:i=>{var s=re.isAbs(i),l=i.substr(-1)==="/";return i=re.normalizeArray(i.split("/").filter(h=>!!h),!s).join("/"),!i&&!s&&(i="."),i&&l&&(i+="/"),(s?"/":"")+i},dirname:i=>{var s=re.splitPath(i),l=s[0],h=s[1];return!l&&!h?".":(h&&(h=h.substr(0,h.length-1)),l+h)},basename:i=>{if(i==="/")return"/";i=re.normalize(i),i=i.replace(/\/$/,"");var s=i.lastIndexOf("/");return s===-1?i:i.substr(s+1)},join:(...i)=>re.normalize(i.join("/")),join2:(i,s)=>re.normalize(i+"/"+s)},pa=()=>{if(typeof crypto=="object"&&typeof crypto.getRandomValues=="function")return h=>crypto.getRandomValues(h);if(p)try{var i=g("crypto"),s=i.randomFillSync;if(s)return h=>i.randomFillSync(h);var l=i.randomBytes;return h=>(h.set(l(h.byteLength)),h)}catch{}oe("no cryptographic support found for randomDevice. consider polyfilling it if you want to use something insecure like Math.random(), e.g. put this in a --pre-js: var crypto = { getRandomValues: (array) => { for (var i = 0; i < array.length; i++) array[i] = (Math.random()*256)|0 } };")},Gi=i=>(Gi=pa())(i),Ze={resolve:(...i)=>{for(var s="",l=!1,h=i.length-1;h>=-1&&!l;h--){var m=h>=0?i[h]:u.cwd();if(typeof m!="string")throw new TypeError("Arguments to path.resolve must be strings");if(!m)return"";s=m+"/"+s,l=re.isAbs(m)}return s=re.normalizeArray(s.split("/").filter(b=>!!b),!l).join("/"),(l?"/":"")+s||"."},relative:(i,s)=>{i=Ze.resolve(i).substr(1),s=Ze.resolve(s).substr(1);function l(q){for(var ee=0;ee<q.length&&q[ee]==="";ee++);for(var Z=q.length-1;Z>=0&&q[Z]==="";Z--);return ee>Z?[]:q.slice(ee,Z-ee+1)}for(var h=l(i.split("/")),m=l(s.split("/")),b=Math.min(h.length,m.length),v=b,y=0;y<b;y++)if(h[y]!==m[y]){v=y;break}for(var x=[],y=v;y<h.length;y++)x.push("..");return x=x.concat(m.slice(v)),x.join("/")}},fn=[];function qi(i,s,l){var h=Cr(i)+1,m=new Array(h),b=cn(i,m,0,m.length);return m.length=b,m}var ma=()=>{if(!fn.length){var i=null;if(p){var s=256,l=Buffer.alloc(s),h=0,m=process.stdin.fd;try{h=N.readSync(m,l,0,s)}catch(b){if(b.toString().includes("EOF"))h=0;else throw b}h>0&&(i=l.slice(0,h).toString("utf-8"))}else typeof window<"u"&&typeof window.prompt=="function"&&(i=window.prompt("Input: "),i!==null&&(i+=`
`));if(!i)return null;fn=qi(i)}return fn.shift()},ht={ttys:[],init(){},shutdown(){},register(i,s){ht.ttys[i]={input:[],output:[],ops:s},u.registerDevice(i,ht.stream_ops)},stream_ops:{open(i){var s=ht.ttys[i.node.rdev];if(!s)throw new u.ErrnoError(43);i.tty=s,i.seekable=!1},close(i){i.tty.ops.fsync(i.tty)},fsync(i){i.tty.ops.fsync(i.tty)},read(i,s,l,h,m){if(!i.tty||!i.tty.ops.get_char)throw new u.ErrnoError(60);for(var b=0,v=0;v<h;v++){var y;try{y=i.tty.ops.get_char(i.tty)}catch{throw new u.ErrnoError(29)}if(y===void 0&&b===0)throw new u.ErrnoError(6);if(y==null)break;b++,s[l+v]=y}return b&&(i.node.timestamp=Date.now()),b},write(i,s,l,h,m){if(!i.tty||!i.tty.ops.put_char)throw new u.ErrnoError(60);try{for(var b=0;b<h;b++)i.tty.ops.put_char(i.tty,s[l+b])}catch{throw new u.ErrnoError(29)}return h&&(i.node.timestamp=Date.now()),b}},default_tty_ops:{get_char(i){return ma()},put_char(i,s){s===null||s===10?(G(Ct(i.output)),i.output=[]):s!=0&&i.output.push(s)},fsync(i){i.output&&i.output.length>0&&(G(Ct(i.output)),i.output=[])},ioctl_tcgets(i){return{c_iflag:25856,c_oflag:5,c_cflag:191,c_lflag:35387,c_cc:[3,28,127,21,4,0,1,0,17,19,26,0,18,15,23,22,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]}},ioctl_tcsets(i,s,l){return 0},ioctl_tiocgwinsz(i){return[24,80]}},default_tty1_ops:{put_char(i,s){s===null||s===10?(I(Ct(i.output)),i.output=[]):s!=0&&i.output.push(s)},fsync(i){i.output&&i.output.length>0&&(I(Ct(i.output)),i.output=[])}}},Vi=i=>{oe("internal error: mmapAlloc called but `emscripten_builtin_memalign` native symbol not exported")},z={ops_table:null,mount(i){return z.createNode(null,"/",16895,0)},createNode(i,s,l,h){if(u.isBlkdev(l)||u.isFIFO(l))throw new u.ErrnoError(63);z.ops_table||(z.ops_table={dir:{node:{getattr:z.node_ops.getattr,setattr:z.node_ops.setattr,lookup:z.node_ops.lookup,mknod:z.node_ops.mknod,rename:z.node_ops.rename,unlink:z.node_ops.unlink,rmdir:z.node_ops.rmdir,readdir:z.node_ops.readdir,symlink:z.node_ops.symlink},stream:{llseek:z.stream_ops.llseek}},file:{node:{getattr:z.node_ops.getattr,setattr:z.node_ops.setattr},stream:{llseek:z.stream_ops.llseek,read:z.stream_ops.read,write:z.stream_ops.write,allocate:z.stream_ops.allocate,mmap:z.stream_ops.mmap,msync:z.stream_ops.msync}},link:{node:{getattr:z.node_ops.getattr,setattr:z.node_ops.setattr,readlink:z.node_ops.readlink},stream:{}},chrdev:{node:{getattr:z.node_ops.getattr,setattr:z.node_ops.setattr},stream:u.chrdev_stream_ops}});var m=u.createNode(i,s,l,h);return u.isDir(m.mode)?(m.node_ops=z.ops_table.dir.node,m.stream_ops=z.ops_table.dir.stream,m.contents={}):u.isFile(m.mode)?(m.node_ops=z.ops_table.file.node,m.stream_ops=z.ops_table.file.stream,m.usedBytes=0,m.contents=null):u.isLink(m.mode)?(m.node_ops=z.ops_table.link.node,m.stream_ops=z.ops_table.link.stream):u.isChrdev(m.mode)&&(m.node_ops=z.ops_table.chrdev.node,m.stream_ops=z.ops_table.chrdev.stream),m.timestamp=Date.now(),i&&(i.contents[s]=m,i.timestamp=m.timestamp),m},getFileDataAsTypedArray(i){return i.contents?i.contents.subarray?i.contents.subarray(0,i.usedBytes):new Uint8Array(i.contents):new Uint8Array(0)},expandFileStorage(i,s){var l=i.contents?i.contents.length:0;if(!(l>=s)){var h=1024*1024;s=Math.max(s,l*(l<h?2:1.125)>>>0),l!=0&&(s=Math.max(s,256));var m=i.contents;i.contents=new Uint8Array(s),i.usedBytes>0&&i.contents.set(m.subarray(0,i.usedBytes),0)}},resizeFileStorage(i,s){if(i.usedBytes!=s)if(s==0)i.contents=null,i.usedBytes=0;else{var l=i.contents;i.contents=new Uint8Array(s),l&&i.contents.set(l.subarray(0,Math.min(s,i.usedBytes))),i.usedBytes=s}},node_ops:{getattr(i){var s={};return s.dev=u.isChrdev(i.mode)?i.id:1,s.ino=i.id,s.mode=i.mode,s.nlink=1,s.uid=0,s.gid=0,s.rdev=i.rdev,u.isDir(i.mode)?s.size=4096:u.isFile(i.mode)?s.size=i.usedBytes:u.isLink(i.mode)?s.size=i.link.length:s.size=0,s.atime=new Date(i.timestamp),s.mtime=new Date(i.timestamp),s.ctime=new Date(i.timestamp),s.blksize=4096,s.blocks=Math.ceil(s.size/s.blksize),s},setattr(i,s){s.mode!==void 0&&(i.mode=s.mode),s.timestamp!==void 0&&(i.timestamp=s.timestamp),s.size!==void 0&&z.resizeFileStorage(i,s.size)},lookup(i,s){throw new u.ErrnoError(44)},mknod(i,s,l,h){return z.createNode(i,s,l,h)},rename(i,s,l){if(u.isDir(i.mode)){var h;try{h=u.lookupNode(s,l)}catch{}if(h)for(var m in h.contents)throw new u.ErrnoError(55)}delete i.parent.contents[i.name],i.parent.timestamp=Date.now(),i.name=l,s.contents[l]=i,s.timestamp=i.parent.timestamp},unlink(i,s){delete i.contents[s],i.timestamp=Date.now()},rmdir(i,s){var l=u.lookupNode(i,s);for(var h in l.contents)throw new u.ErrnoError(55);delete i.contents[s],i.timestamp=Date.now()},readdir(i){var s=[".",".."];for(var l of Object.keys(i.contents))s.push(l);return s},symlink(i,s,l){var h=z.createNode(i,s,41471,0);return h.link=l,h},readlink(i){if(!u.isLink(i.mode))throw new u.ErrnoError(28);return i.link}},stream_ops:{read(i,s,l,h,m){var b=i.node.contents;if(m>=i.node.usedBytes)return 0;var v=Math.min(i.node.usedBytes-m,h);if(C(v>=0),v>8&&b.subarray)s.set(b.subarray(m,m+v),l);else for(var y=0;y<v;y++)s[l+y]=b[m+y];return v},write(i,s,l,h,m,b){if(C(!(s instanceof ArrayBuffer)),s.buffer===X.buffer&&(b=!1),!h)return 0;var v=i.node;if(v.timestamp=Date.now(),s.subarray&&(!v.contents||v.contents.subarray)){if(b)return C(m===0,"canOwn must imply no weird position inside the file"),v.contents=s.subarray(l,l+h),v.usedBytes=h,h;if(v.usedBytes===0&&m===0)return v.contents=s.slice(l,l+h),v.usedBytes=h,h;if(m+h<=v.usedBytes)return v.contents.set(s.subarray(l,l+h),m),h}if(z.expandFileStorage(v,m+h),v.contents.subarray&&s.subarray)v.contents.set(s.subarray(l,l+h),m);else for(var y=0;y<h;y++)v.contents[m+y]=s[l+y];return v.usedBytes=Math.max(v.usedBytes,m+h),h},llseek(i,s,l){var h=s;if(l===1?h+=i.position:l===2&&u.isFile(i.node.mode)&&(h+=i.node.usedBytes),h<0)throw new u.ErrnoError(28);return h},allocate(i,s,l){z.expandFileStorage(i.node,s+l),i.node.usedBytes=Math.max(i.node.usedBytes,s+l)},mmap(i,s,l,h,m){if(!u.isFile(i.node.mode))throw new u.ErrnoError(43);var b,v,y=i.node.contents;if(!(m&2)&&y&&y.buffer===X.buffer)v=!1,b=y.byteOffset;else{if(v=!0,b=Vi(),!b)throw new u.ErrnoError(48);y&&((l>0||l+s<y.length)&&(y.subarray?y=y.subarray(l,l+s):y=Array.prototype.slice.call(y,l,l+s)),X.set(y,b))}return{ptr:b,allocated:v}},msync(i,s,l,h,m){return z.stream_ops.write(i,s,0,h,l,!1),0}}},ga=(i,s,l,h)=>{var m=Ii(`al ${i}`);F(i).then(b=>{C(b,`Loading data file "${i}" failed (no arrayBuffer).`),s(new Uint8Array(b)),m&&Ar(m)},b=>{if(l)l();else throw`Loading data file "${i}" failed.`}),m&&an(m)},wa=(i,s,l,h,m,b)=>{u.createDataFile(i,s,l,h,m,b)},ba=n.preloadPlugins||[],va=(i,s,l,h)=>{typeof Browser<"u"&&Browser.init();var m=!1;return ba.forEach(b=>{m||b.canHandle(s)&&(b.handle(i,s,l,h),m=!0)}),m},ka=(i,s,l,h,m,b,v,y,x,q)=>{var ee=s?Ze.resolve(re.join2(i,s)):i,Z=Ii(`cp ${ee}`);function ne(U){function J(ue){q==null||q(),y||wa(i,s,ue,h,m,x),b==null||b(),Ar(Z)}va(U,ee,J,()=>{v==null||v(),Ar(Z)})||J(U)}an(Z),typeof l=="string"?ga(l,ne,v):ne(l)},ya=i=>{var s={r:0,"r+":2,w:577,"w+":578,a:1089,"a+":1090},l=s[i];if(typeof l>"u")throw new Error(`Unknown file open mode: ${i}`);return l},hn=(i,s)=>{var l=0;return i&&(l|=365),s&&(l|=146),l},_a=i=>Pt(Na(i)),Yi={EPERM:63,ENOENT:44,ESRCH:71,EINTR:27,EIO:29,ENXIO:60,E2BIG:1,ENOEXEC:45,EBADF:8,ECHILD:12,EAGAIN:6,EWOULDBLOCK:6,ENOMEM:48,EACCES:2,EFAULT:21,ENOTBLK:105,EBUSY:10,EEXIST:20,EXDEV:75,ENODEV:43,ENOTDIR:54,EISDIR:31,EINVAL:28,ENFILE:41,EMFILE:33,ENOTTY:59,ETXTBSY:74,EFBIG:22,ENOSPC:51,ESPIPE:70,EROFS:69,EMLINK:34,EPIPE:64,EDOM:18,ERANGE:68,ENOMSG:49,EIDRM:24,ECHRNG:106,EL2NSYNC:156,EL3HLT:107,EL3RST:108,ELNRNG:109,EUNATCH:110,ENOCSI:111,EL2HLT:112,EDEADLK:16,ENOLCK:46,EBADE:113,EBADR:114,EXFULL:115,ENOANO:104,EBADRQC:103,EBADSLT:102,EDEADLOCK:16,EBFONT:101,ENOSTR:100,ENODATA:116,ETIME:117,ENOSR:118,ENONET:119,ENOPKG:120,EREMOTE:121,ENOLINK:47,EADV:122,ESRMNT:123,ECOMM:124,EPROTO:65,EMULTIHOP:36,EDOTDOT:125,EBADMSG:9,ENOTUNIQ:126,EBADFD:127,EREMCHG:128,ELIBACC:129,ELIBBAD:130,ELIBSCN:131,ELIBMAX:132,ELIBEXEC:133,ENOSYS:52,ENOTEMPTY:55,ENAMETOOLONG:37,ELOOP:32,EOPNOTSUPP:138,EPFNOSUPPORT:139,ECONNRESET:15,ENOBUFS:42,EAFNOSUPPORT:5,EPROTOTYPE:67,ENOTSOCK:57,ENOPROTOOPT:50,ESHUTDOWN:140,ECONNREFUSED:14,EADDRINUSE:3,ECONNABORTED:13,ENETUNREACH:40,ENETDOWN:38,ETIMEDOUT:73,EHOSTDOWN:142,EHOSTUNREACH:23,EINPROGRESS:26,EALREADY:7,EDESTADDRREQ:17,EMSGSIZE:35,EPROTONOSUPPORT:66,ESOCKTNOSUPPORT:137,EADDRNOTAVAIL:4,ENETRESET:39,EISCONN:30,ENOTCONN:53,ETOOMANYREFS:141,EUSERS:136,EDQUOT:19,ESTALE:72,ENOTSUP:138,ENOMEDIUM:148,EILSEQ:25,EOVERFLOW:61,ECANCELED:11,ENOTRECOVERABLE:56,EOWNERDEAD:62,ESTRPIPE:135},u={root:null,mounts:[],devices:{},streams:[],nextInode:1,nameTable:null,currentPath:"/",initialized:!1,ignorePermissions:!0,ErrnoError:class extends Error{constructor(s){super(Sr?_a(s):"");$(this,"name","ErrnoError");this.errno=s;for(var l in Yi)if(Yi[l]===s){this.code=l;break}}},filesystems:null,syncFSRequests:0,readFiles:{},FSStream:class{constructor(){$(this,"shared",{})}get object(){return this.node}set object(i){this.node=i}get isRead(){return(this.flags&2097155)!==1}get isWrite(){return(this.flags&2097155)!==0}get isAppend(){return this.flags&1024}get flags(){return this.shared.flags}set flags(i){this.shared.flags=i}get position(){return this.shared.position}set position(i){this.shared.position=i}},FSNode:class{constructor(i,s,l,h){$(this,"node_ops",{});$(this,"stream_ops",{});$(this,"readMode",365);$(this,"writeMode",146);$(this,"mounted",null);i||(i=this),this.parent=i,this.mount=i.mount,this.id=u.nextInode++,this.name=s,this.mode=l,this.rdev=h}get read(){return(this.mode&this.readMode)===this.readMode}set read(i){i?this.mode|=this.readMode:this.mode&=~this.readMode}get write(){return(this.mode&this.writeMode)===this.writeMode}set write(i){i?this.mode|=this.writeMode:this.mode&=~this.writeMode}get isFolder(){return u.isDir(this.mode)}get isDevice(){return u.isChrdev(this.mode)}},lookupPath(i,s={}){if(i=Ze.resolve(i),!i)return{path:"",node:null};var l={follow_mount:!0,recurse_count:0};if(s=Object.assign(l,s),s.recurse_count>8)throw new u.ErrnoError(32);for(var h=i.split("/").filter(Z=>!!Z),m=u.root,b="/",v=0;v<h.length;v++){var y=v===h.length-1;if(y&&s.parent)break;if(m=u.lookupNode(m,h[v]),b=re.join2(b,h[v]),u.isMountpoint(m)&&(!y||y&&s.follow_mount)&&(m=m.mounted.root),!y||s.follow)for(var x=0;u.isLink(m.mode);){var q=u.readlink(b);b=Ze.resolve(re.dirname(b),q);var ee=u.lookupPath(b,{recurse_count:s.recurse_count+1});if(m=ee.node,x++>40)throw new u.ErrnoError(32)}}return{path:b,node:m}},getPath(i){for(var s;;){if(u.isRoot(i)){var l=i.mount.mountpoint;return s?l[l.length-1]!=="/"?`${l}/${s}`:l+s:l}s=s?`${i.name}/${s}`:i.name,i=i.parent}},hashName(i,s){for(var l=0,h=0;h<s.length;h++)l=(l<<5)-l+s.charCodeAt(h)|0;return(i+l>>>0)%u.nameTable.length},hashAddNode(i){var s=u.hashName(i.parent.id,i.name);i.name_next=u.nameTable[s],u.nameTable[s]=i},hashRemoveNode(i){var s=u.hashName(i.parent.id,i.name);if(u.nameTable[s]===i)u.nameTable[s]=i.name_next;else for(var l=u.nameTable[s];l;){if(l.name_next===i){l.name_next=i.name_next;break}l=l.name_next}},lookupNode(i,s){var l=u.mayLookup(i);if(l)throw new u.ErrnoError(l);for(var h=u.hashName(i.id,s),m=u.nameTable[h];m;m=m.name_next){var b=m.name;if(m.parent.id===i.id&&b===s)return m}return u.lookup(i,s)},createNode(i,s,l,h){C(typeof i=="object");var m=new u.FSNode(i,s,l,h);return u.hashAddNode(m),m},destroyNode(i){u.hashRemoveNode(i)},isRoot(i){return i===i.parent},isMountpoint(i){return!!i.mounted},isFile(i){return(i&61440)===32768},isDir(i){return(i&61440)===16384},isLink(i){return(i&61440)===40960},isChrdev(i){return(i&61440)===8192},isBlkdev(i){return(i&61440)===24576},isFIFO(i){return(i&61440)===4096},isSocket(i){return(i&49152)===49152},flagsToPermissionString(i){var s=["r","w","rw"][i&3];return i&512&&(s+="w"),s},nodePermissions(i,s){return u.ignorePermissions?0:s.includes("r")&&!(i.mode&292)||s.includes("w")&&!(i.mode&146)||s.includes("x")&&!(i.mode&73)?2:0},mayLookup(i){if(!u.isDir(i.mode))return 54;var s=u.nodePermissions(i,"x");return s||(i.node_ops.lookup?0:2)},mayCreate(i,s){try{var l=u.lookupNode(i,s);return 20}catch{}return u.nodePermissions(i,"wx")},mayDelete(i,s,l){var h;try{h=u.lookupNode(i,s)}catch(b){return b.errno}var m=u.nodePermissions(i,"wx");if(m)return m;if(l){if(!u.isDir(h.mode))return 54;if(u.isRoot(h)||u.getPath(h)===u.cwd())return 10}else if(u.isDir(h.mode))return 31;return 0},mayOpen(i,s){return i?u.isLink(i.mode)?32:u.isDir(i.mode)&&(u.flagsToPermissionString(s)!=="r"||s&512)?31:u.nodePermissions(i,u.flagsToPermissionString(s)):44},MAX_OPEN_FDS:4096,nextfd(){for(var i=0;i<=u.MAX_OPEN_FDS;i++)if(!u.streams[i])return i;throw new u.ErrnoError(33)},getStreamChecked(i){var s=u.getStream(i);if(!s)throw new u.ErrnoError(8);return s},getStream:i=>u.streams[i],createStream(i,s=-1){return C(s>=-1),i=Object.assign(new u.FSStream,i),s==-1&&(s=u.nextfd()),i.fd=s,u.streams[s]=i,i},closeStream(i){u.streams[i]=null},dupStream(i,s=-1){var h,m;var l=u.createStream(i,s);return(m=(h=l.stream_ops)==null?void 0:h.dup)==null||m.call(h,l),l},chrdev_stream_ops:{open(i){var l,h;var s=u.getDevice(i.node.rdev);i.stream_ops=s.stream_ops,(h=(l=i.stream_ops).open)==null||h.call(l,i)},llseek(){throw new u.ErrnoError(70)}},major:i=>i>>8,minor:i=>i&255,makedev:(i,s)=>i<<8|s,registerDevice(i,s){u.devices[i]={stream_ops:s}},getDevice:i=>u.devices[i],getMounts(i){for(var s=[],l=[i];l.length;){var h=l.pop();s.push(h),l.push(...h.mounts)}return s},syncfs(i,s){typeof i=="function"&&(s=i,i=!1),u.syncFSRequests++,u.syncFSRequests>1&&I(`warning: ${u.syncFSRequests} FS.syncfs operations in flight at once, probably just doing extra work`);var l=u.getMounts(u.root.mount),h=0;function m(v){return C(u.syncFSRequests>0),u.syncFSRequests--,s(v)}function b(v){if(v)return b.errored?void 0:(b.errored=!0,m(v));++h>=l.length&&m(null)}l.forEach(v=>{if(!v.type.syncfs)return b(null);v.type.syncfs(v,i,b)})},mount(i,s,l){if(typeof i=="string")throw i;var h=l==="/",m=!l,b;if(h&&u.root)throw new u.ErrnoError(10);if(!h&&!m){var v=u.lookupPath(l,{follow_mount:!1});if(l=v.path,b=v.node,u.isMountpoint(b))throw new u.ErrnoError(10);if(!u.isDir(b.mode))throw new u.ErrnoError(54)}var y={type:i,opts:s,mountpoint:l,mounts:[]},x=i.mount(y);return x.mount=y,y.root=x,h?u.root=x:b&&(b.mounted=y,b.mount&&b.mount.mounts.push(y)),x},unmount(i){var s=u.lookupPath(i,{follow_mount:!1});if(!u.isMountpoint(s.node))throw new u.ErrnoError(28);var l=s.node,h=l.mounted,m=u.getMounts(h);Object.keys(u.nameTable).forEach(v=>{for(var y=u.nameTable[v];y;){var x=y.name_next;m.includes(y.mount)&&u.destroyNode(y),y=x}}),l.mounted=null;var b=l.mount.mounts.indexOf(h);C(b!==-1),l.mount.mounts.splice(b,1)},lookup(i,s){return i.node_ops.lookup(i,s)},mknod(i,s,l){var h=u.lookupPath(i,{parent:!0}),m=h.node,b=re.basename(i);if(!b||b==="."||b==="..")throw new u.ErrnoError(28);var v=u.mayCreate(m,b);if(v)throw new u.ErrnoError(v);if(!m.node_ops.mknod)throw new u.ErrnoError(63);return m.node_ops.mknod(m,b,s,l)},statfs(i){var s={bsize:4096,frsize:4096,blocks:1e6,bfree:5e5,bavail:5e5,files:u.nextInode,ffree:u.nextInode-1,fsid:42,flags:2,namelen:255},l=u.lookupPath(i,{follow:!0}).node;return l!=null&&l.node_ops.statfs&&Object.assign(s,l.node_ops.statfs(l.mount.opts.root)),s},create(i,s=438){return s&=4095,s|=32768,u.mknod(i,s,0)},mkdir(i,s=511){return s&=1023,s|=16384,u.mknod(i,s,0)},mkdirTree(i,s){for(var l=i.split("/"),h="",m=0;m<l.length;++m)if(l[m]){h+="/"+l[m];try{u.mkdir(h,s)}catch(b){if(b.errno!=20)throw b}}},mkdev(i,s,l){return typeof l>"u"&&(l=s,s=438),s|=8192,u.mknod(i,s,l)},symlink(i,s){if(!Ze.resolve(i))throw new u.ErrnoError(44);var l=u.lookupPath(s,{parent:!0}),h=l.node;if(!h)throw new u.ErrnoError(44);var m=re.basename(s),b=u.mayCreate(h,m);if(b)throw new u.ErrnoError(b);if(!h.node_ops.symlink)throw new u.ErrnoError(63);return h.node_ops.symlink(h,m,i)},rename(i,s){var l=re.dirname(i),h=re.dirname(s),m=re.basename(i),b=re.basename(s),v,y,x;if(v=u.lookupPath(i,{parent:!0}),y=v.node,v=u.lookupPath(s,{parent:!0}),x=v.node,!y||!x)throw new u.ErrnoError(44);if(y.mount!==x.mount)throw new u.ErrnoError(75);var q=u.lookupNode(y,m),ee=Ze.relative(i,h);if(ee.charAt(0)!==".")throw new u.ErrnoError(28);if(ee=Ze.relative(s,l),ee.charAt(0)!==".")throw new u.ErrnoError(55);var Z;try{Z=u.lookupNode(x,b)}catch{}if(q!==Z){var ne=u.isDir(q.mode),U=u.mayDelete(y,m,ne);if(U)throw new u.ErrnoError(U);if(U=Z?u.mayDelete(x,b,ne):u.mayCreate(x,b),U)throw new u.ErrnoError(U);if(!y.node_ops.rename)throw new u.ErrnoError(63);if(u.isMountpoint(q)||Z&&u.isMountpoint(Z))throw new u.ErrnoError(10);if(x!==y&&(U=u.nodePermissions(y,"w"),U))throw new u.ErrnoError(U);u.hashRemoveNode(q);try{y.node_ops.rename(q,x,b),q.parent=x}catch(J){throw J}finally{u.hashAddNode(q)}}},rmdir(i){var s=u.lookupPath(i,{parent:!0}),l=s.node,h=re.basename(i),m=u.lookupNode(l,h),b=u.mayDelete(l,h,!0);if(b)throw new u.ErrnoError(b);if(!l.node_ops.rmdir)throw new u.ErrnoError(63);if(u.isMountpoint(m))throw new u.ErrnoError(10);l.node_ops.rmdir(l,h),u.destroyNode(m)},readdir(i){var s=u.lookupPath(i,{follow:!0}),l=s.node;if(!l.node_ops.readdir)throw new u.ErrnoError(54);return l.node_ops.readdir(l)},unlink(i){var s=u.lookupPath(i,{parent:!0}),l=s.node;if(!l)throw new u.ErrnoError(44);var h=re.basename(i),m=u.lookupNode(l,h),b=u.mayDelete(l,h,!1);if(b)throw new u.ErrnoError(b);if(!l.node_ops.unlink)throw new u.ErrnoError(63);if(u.isMountpoint(m))throw new u.ErrnoError(10);l.node_ops.unlink(l,h),u.destroyNode(m)},readlink(i){var s=u.lookupPath(i),l=s.node;if(!l)throw new u.ErrnoError(44);if(!l.node_ops.readlink)throw new u.ErrnoError(28);return l.node_ops.readlink(l)},stat(i,s){var l=u.lookupPath(i,{follow:!s}),h=l.node;if(!h)throw new u.ErrnoError(44);if(!h.node_ops.getattr)throw new u.ErrnoError(63);return h.node_ops.getattr(h)},lstat(i){return u.stat(i,!0)},chmod(i,s,l){var h;if(typeof i=="string"){var m=u.lookupPath(i,{follow:!l});h=m.node}else h=i;if(!h.node_ops.setattr)throw new u.ErrnoError(63);h.node_ops.setattr(h,{mode:s&4095|h.mode&-4096,timestamp:Date.now()})},lchmod(i,s){u.chmod(i,s,!0)},fchmod(i,s){var l=u.getStreamChecked(i);u.chmod(l.node,s)},chown(i,s,l,h){var m;if(typeof i=="string"){var b=u.lookupPath(i,{follow:!h});m=b.node}else m=i;if(!m.node_ops.setattr)throw new u.ErrnoError(63);m.node_ops.setattr(m,{timestamp:Date.now()})},lchown(i,s,l){u.chown(i,s,l,!0)},fchown(i,s,l){var h=u.getStreamChecked(i);u.chown(h.node,s,l)},truncate(i,s){if(s<0)throw new u.ErrnoError(28);var l;if(typeof i=="string"){var h=u.lookupPath(i,{follow:!0});l=h.node}else l=i;if(!l.node_ops.setattr)throw new u.ErrnoError(63);if(u.isDir(l.mode))throw new u.ErrnoError(31);if(!u.isFile(l.mode))throw new u.ErrnoError(28);var m=u.nodePermissions(l,"w");if(m)throw new u.ErrnoError(m);l.node_ops.setattr(l,{size:s,timestamp:Date.now()})},ftruncate(i,s){var l=u.getStreamChecked(i);if(!(l.flags&2097155))throw new u.ErrnoError(28);u.truncate(l.node,s)},utime(i,s,l){var h=u.lookupPath(i,{follow:!0}),m=h.node;m.node_ops.setattr(m,{timestamp:Math.max(s,l)})},open(i,s,l=438){if(i==="")throw new u.ErrnoError(44);s=typeof s=="string"?ya(s):s,s&64?l=l&4095|32768:l=0;var h;if(typeof i=="object")h=i;else{i=re.normalize(i);try{var m=u.lookupPath(i,{follow:!(s&131072)});h=m.node}catch{}}var b=!1;if(s&64)if(h){if(s&128)throw new u.ErrnoError(20)}else h=u.mknod(i,l,0),b=!0;if(!h)throw new u.ErrnoError(44);if(u.isChrdev(h.mode)&&(s&=-513),s&65536&&!u.isDir(h.mode))throw new u.ErrnoError(54);if(!b){var v=u.mayOpen(h,s);if(v)throw new u.ErrnoError(v)}s&512&&!b&&u.truncate(h,0),s&=-131713;var y=u.createStream({node:h,path:u.getPath(h),flags:s,seekable:!0,position:0,stream_ops:h.stream_ops,ungotten:[],error:!1});return y.stream_ops.open&&y.stream_ops.open(y),n.logReadFiles&&!(s&1)&&(i in u.readFiles||(u.readFiles[i]=1)),y},close(i){if(u.isClosed(i))throw new u.ErrnoError(8);i.getdents&&(i.getdents=null);try{i.stream_ops.close&&i.stream_ops.close(i)}catch(s){throw s}finally{u.closeStream(i.fd)}i.fd=null},isClosed(i){return i.fd===null},llseek(i,s,l){if(u.isClosed(i))throw new u.ErrnoError(8);if(!i.seekable||!i.stream_ops.llseek)throw new u.ErrnoError(70);if(l!=0&&l!=1&&l!=2)throw new u.ErrnoError(28);return i.position=i.stream_ops.llseek(i,s,l),i.ungotten=[],i.position},read(i,s,l,h,m){if(C(l>=0),h<0||m<0)throw new u.ErrnoError(28);if(u.isClosed(i))throw new u.ErrnoError(8);if((i.flags&2097155)===1)throw new u.ErrnoError(8);if(u.isDir(i.node.mode))throw new u.ErrnoError(31);if(!i.stream_ops.read)throw new u.ErrnoError(28);var b=typeof m<"u";if(!b)m=i.position;else if(!i.seekable)throw new u.ErrnoError(70);var v=i.stream_ops.read(i,s,l,h,m);return b||(i.position+=v),v},write(i,s,l,h,m,b){if(C(l>=0),h<0||m<0)throw new u.ErrnoError(28);if(u.isClosed(i))throw new u.ErrnoError(8);if(!(i.flags&2097155))throw new u.ErrnoError(8);if(u.isDir(i.node.mode))throw new u.ErrnoError(31);if(!i.stream_ops.write)throw new u.ErrnoError(28);i.seekable&&i.flags&1024&&u.llseek(i,0,2);var v=typeof m<"u";if(!v)m=i.position;else if(!i.seekable)throw new u.ErrnoError(70);var y=i.stream_ops.write(i,s,l,h,m,b);return v||(i.position+=y),y},allocate(i,s,l){if(u.isClosed(i))throw new u.ErrnoError(8);if(s<0||l<=0)throw new u.ErrnoError(28);if(!(i.flags&2097155))throw new u.ErrnoError(8);if(!u.isFile(i.node.mode)&&!u.isDir(i.node.mode))throw new u.ErrnoError(43);if(!i.stream_ops.allocate)throw new u.ErrnoError(138);i.stream_ops.allocate(i,s,l)},mmap(i,s,l,h,m){if(h&2&&!(m&2)&&(i.flags&2097155)!==2)throw new u.ErrnoError(2);if((i.flags&2097155)===1)throw new u.ErrnoError(2);if(!i.stream_ops.mmap)throw new u.ErrnoError(43);if(!s)throw new u.ErrnoError(28);return i.stream_ops.mmap(i,s,l,h,m)},msync(i,s,l,h,m){return C(l>=0),i.stream_ops.msync?i.stream_ops.msync(i,s,l,h,m):0},ioctl(i,s,l){if(!i.stream_ops.ioctl)throw new u.ErrnoError(59);return i.stream_ops.ioctl(i,s,l)},readFile(i,s={}){if(s.flags=s.flags||0,s.encoding=s.encoding||"binary",s.encoding!=="utf8"&&s.encoding!=="binary")throw new Error(`Invalid encoding type "${s.encoding}"`);var l,h=u.open(i,s.flags),m=u.stat(i),b=m.size,v=new Uint8Array(b);return u.read(h,v,0,b,0),s.encoding==="utf8"?l=Ct(v):s.encoding==="binary"&&(l=v),u.close(h),l},writeFile(i,s,l={}){l.flags=l.flags||577;var h=u.open(i,l.flags,l.mode);if(typeof s=="string"){var m=new Uint8Array(Cr(s)+1),b=cn(s,m,0,m.length);u.write(h,m,0,b,void 0,l.canOwn)}else if(ArrayBuffer.isView(s))u.write(h,s,0,s.byteLength,void 0,l.canOwn);else throw new Error("Unsupported data type");u.close(h)},cwd:()=>u.currentPath,chdir(i){var s=u.lookupPath(i,{follow:!0});if(s.node===null)throw new u.ErrnoError(44);if(!u.isDir(s.node.mode))throw new u.ErrnoError(54);var l=u.nodePermissions(s.node,"x");if(l)throw new u.ErrnoError(l);u.currentPath=s.path},createDefaultDirectories(){u.mkdir("/tmp"),u.mkdir("/home"),u.mkdir("/home/web_user")},createDefaultDevices(){u.mkdir("/dev"),u.registerDevice(u.makedev(1,3),{read:()=>0,write:(h,m,b,v,y)=>v,llseek:()=>0}),u.mkdev("/dev/null",u.makedev(1,3)),ht.register(u.makedev(5,0),ht.default_tty_ops),ht.register(u.makedev(6,0),ht.default_tty1_ops),u.mkdev("/dev/tty",u.makedev(5,0)),u.mkdev("/dev/tty1",u.makedev(6,0));var i=new Uint8Array(1024),s=0,l=()=>(s===0&&(s=Gi(i).byteLength),i[--s]);u.createDevice("/dev","random",l),u.createDevice("/dev","urandom",l),u.mkdir("/dev/shm"),u.mkdir("/dev/shm/tmp")},createSpecialDirectories(){u.mkdir("/proc");var i=u.mkdir("/proc/self");u.mkdir("/proc/self/fd"),u.mount({mount(){var s=u.createNode(i,"fd",16895,73);return s.node_ops={lookup(l,h){var m=+h,b=u.getStreamChecked(m),v={parent:null,mount:{mountpoint:"fake"},node_ops:{readlink:()=>b.path}};return v.parent=v,v}},s}},{},"/proc/self/fd")},createStandardStreams(i,s,l){i?u.createDevice("/dev","stdin",i):u.symlink("/dev/tty","/dev/stdin"),s?u.createDevice("/dev","stdout",null,s):u.symlink("/dev/tty","/dev/stdout"),l?u.createDevice("/dev","stderr",null,l):u.symlink("/dev/tty1","/dev/stderr");var h=u.open("/dev/stdin",0),m=u.open("/dev/stdout",1),b=u.open("/dev/stderr",1);C(h.fd===0,`invalid handle for stdin (${h.fd})`),C(m.fd===1,`invalid handle for stdout (${m.fd})`),C(b.fd===2,`invalid handle for stderr (${b.fd})`)},staticInit(){u.nameTable=new Array(4096),u.mount(z,{},"/"),u.createDefaultDirectories(),u.createDefaultDevices(),u.createSpecialDirectories(),u.filesystems={MEMFS:z}},init(i,s,l){C(!u.initialized,"FS.init was previously called. If you want to initialize later with custom parameters, remove any earlier calls (note that one is automatically added to the generated code)"),u.initialized=!0,i??(i=n.stdin),s??(s=n.stdout),l??(l=n.stderr),u.createStandardStreams(i,s,l)},quit(){u.initialized=!1,Oa(0);for(var i=0;i<u.streams.length;i++){var s=u.streams[i];s&&u.close(s)}},findObject(i,s){var l=u.analyzePath(i,s);return l.exists?l.object:null},analyzePath(i,s){try{var l=u.lookupPath(i,{follow:!s});i=l.path}catch{}var h={isRoot:!1,exists:!1,error:0,name:null,path:null,object:null,parentExists:!1,parentPath:null,parentObject:null};try{var l=u.lookupPath(i,{parent:!0});h.parentExists=!0,h.parentPath=l.path,h.parentObject=l.node,h.name=re.basename(i),l=u.lookupPath(i,{follow:!s}),h.exists=!0,h.path=l.path,h.object=l.node,h.name=l.node.name,h.isRoot=l.path==="/"}catch(m){h.error=m.errno}return h},createPath(i,s,l,h){i=typeof i=="string"?i:u.getPath(i);for(var m=s.split("/").reverse();m.length;){var b=m.pop();if(b){var v=re.join2(i,b);try{u.mkdir(v)}catch{}i=v}}return v},createFile(i,s,l,h,m){var b=re.join2(typeof i=="string"?i:u.getPath(i),s),v=hn(h,m);return u.create(b,v)},createDataFile(i,s,l,h,m,b){var v=s;i&&(i=typeof i=="string"?i:u.getPath(i),v=s?re.join2(i,s):i);var y=hn(h,m),x=u.create(v,y);if(l){if(typeof l=="string"){for(var q=new Array(l.length),ee=0,Z=l.length;ee<Z;++ee)q[ee]=l.charCodeAt(ee);l=q}u.chmod(x,y|146);var ne=u.open(x,577);u.write(ne,l,0,l.length,0,b),u.close(ne),u.chmod(x,y)}},createDevice(i,s,l,h){var y;var m=re.join2(typeof i=="string"?i:u.getPath(i),s),b=hn(!!l,!!h);(y=u.createDevice).major??(y.major=64);var v=u.makedev(u.createDevice.major++,0);return u.registerDevice(v,{open(x){x.seekable=!1},close(x){var q;(q=h==null?void 0:h.buffer)!=null&&q.length&&h(10)},read(x,q,ee,Z,ne){for(var U=0,J=0;J<Z;J++){var ue;try{ue=l()}catch{throw new u.ErrnoError(29)}if(ue===void 0&&U===0)throw new u.ErrnoError(6);if(ue==null)break;U++,q[ee+J]=ue}return U&&(x.node.timestamp=Date.now()),U},write(x,q,ee,Z,ne){for(var U=0;U<Z;U++)try{h(q[ee+U])}catch{throw new u.ErrnoError(29)}return Z&&(x.node.timestamp=Date.now()),U}}),u.mkdev(m,b,v)},forceLoadFile(i){if(i.isDevice||i.isFolder||i.link||i.contents)return!0;if(typeof XMLHttpRequest<"u")throw new Error("Lazy loading should have been performed (contents set) in createLazyFile, but it was not. Lazy loading only works in web workers. Use --embed-file or --preload-file in emcc on the main thread.");try{i.contents=T(i.url),i.usedBytes=i.contents.length}catch{throw new u.ErrnoError(29)}},createLazyFile(i,s,l,h,m){class b{constructor(){$(this,"lengthKnown",!1);$(this,"chunks",[])}get(U){if(!(U>this.length-1||U<0)){var J=U%this.chunkSize,ue=U/this.chunkSize|0;return this.getter(ue)[J]}}setDataGetter(U){this.getter=U}cacheLength(){var U=new XMLHttpRequest;if(U.open("HEAD",l,!1),U.send(null),!(U.status>=200&&U.status<300||U.status===304))throw new Error("Couldn't load "+l+". Status: "+U.status);var J=Number(U.getResponseHeader("Content-length")),ue,Ne=(ue=U.getResponseHeader("Accept-Ranges"))&&ue==="bytes",Re=(ue=U.getResponseHeader("Content-Encoding"))&&ue==="gzip",Fe=1024*1024;Ne||(Fe=J);var Ie=(Be,Tt)=>{if(Be>Tt)throw new Error("invalid range ("+Be+", "+Tt+") or no bytes requested!");if(Tt>J-1)throw new Error("only "+J+" bytes available! programmer error!");var we=new XMLHttpRequest;if(we.open("GET",l,!1),J!==Fe&&we.setRequestHeader("Range","bytes="+Be+"-"+Tt),we.responseType="arraybuffer",we.overrideMimeType&&we.overrideMimeType("text/plain; charset=x-user-defined"),we.send(null),!(we.status>=200&&we.status<300||we.status===304))throw new Error("Couldn't load "+l+". Status: "+we.status);return we.response!==void 0?new Uint8Array(we.response||[]):qi(we.responseText||"")},or=this;or.setDataGetter(Be=>{var Tt=Be*Fe,we=(Be+1)*Fe-1;if(we=Math.min(we,J-1),typeof or.chunks[Be]>"u"&&(or.chunks[Be]=Ie(Tt,we)),typeof or.chunks[Be]>"u")throw new Error("doXHR failed!");return or.chunks[Be]}),(Re||!J)&&(Fe=J=1,J=this.getter(0).length,Fe=J,G("LazyFiles on gzip forces download of the whole file when length is accessed")),this._length=J,this._chunkSize=Fe,this.lengthKnown=!0}get length(){return this.lengthKnown||this.cacheLength(),this._length}get chunkSize(){return this.lengthKnown||this.cacheLength(),this._chunkSize}}if(typeof XMLHttpRequest<"u"){if(!d)throw"Cannot do synchronous binary XHRs outside webworkers in modern browsers. Use --embed-file or --preload-file in emcc";var v=new b,y={isDevice:!1,contents:v}}else var y={isDevice:!1,url:l};var x=u.createFile(i,s,y,h,m);y.contents?x.contents=y.contents:y.url&&(x.contents=null,x.url=y.url),Object.defineProperties(x,{usedBytes:{get:function(){return this.contents.length}}});var q={},ee=Object.keys(x.stream_ops);ee.forEach(ne=>{var U=x.stream_ops[ne];q[ne]=(...J)=>(u.forceLoadFile(x),U(...J))});function Z(ne,U,J,ue,Ne){var Re=ne.node.contents;if(Ne>=Re.length)return 0;var Fe=Math.min(Re.length-Ne,ue);if(C(Fe>=0),Re.slice)for(var Ie=0;Ie<Fe;Ie++)U[J+Ie]=Re[Ne+Ie];else for(var Ie=0;Ie<Fe;Ie++)U[J+Ie]=Re.get(Ne+Ie);return Fe}return q.read=(ne,U,J,ue,Ne)=>(u.forceLoadFile(x),Z(ne,U,J,ue,Ne)),q.mmap=(ne,U,J,ue,Ne)=>{u.forceLoadFile(x);var Re=Vi();if(!Re)throw new u.ErrnoError(48);return Z(ne,X,Re,U,J),{ptr:Re,allocated:!0}},x.stream_ops=q,x},absolutePath(){oe("FS.absolutePath has been removed; use PATH_FS.resolve instead")},createFolder(){oe("FS.createFolder has been removed; use FS.mkdir instead")},createLink(){oe("FS.createLink has been removed; use FS.symlink instead")},joinPath(){oe("FS.joinPath has been removed; use PATH.join instead")},mmapAlloc(){oe("FS.mmapAlloc has been replaced by the top level function mmapAlloc")},standardizePath(){oe("FS.standardizePath has been removed; use PATH.normalize instead")}},ir={DEFAULT_POLLMASK:5,calculateAt(i,s,l){if(re.isAbs(s))return s;var h;if(i===-100)h=u.cwd();else{var m=ir.getStreamFromFD(i);h=m.path}if(s.length==0){if(!l)throw new u.ErrnoError(44);return h}return re.join2(h,s)},doStat(i,s,l){var h=i(s);ie[l>>2]=h.dev,ie[l+4>>2]=h.mode,K[l+8>>2]=h.nlink,ie[l+12>>2]=h.uid,ie[l+16>>2]=h.gid,ie[l+20>>2]=h.rdev,me=[h.size>>>0,(Y=h.size,+Math.abs(Y)>=1?Y>0?+Math.floor(Y/4294967296)>>>0:~~+Math.ceil((Y-+(~~Y>>>0))/4294967296)>>>0:0)],ie[l+24>>2]=me[0],ie[l+28>>2]=me[1],ie[l+32>>2]=4096,ie[l+36>>2]=h.blocks;var m=h.atime.getTime(),b=h.mtime.getTime(),v=h.ctime.getTime();return me=[Math.floor(m/1e3)>>>0,(Y=Math.floor(m/1e3),+Math.abs(Y)>=1?Y>0?+Math.floor(Y/4294967296)>>>0:~~+Math.ceil((Y-+(~~Y>>>0))/4294967296)>>>0:0)],ie[l+40>>2]=me[0],ie[l+44>>2]=me[1],K[l+48>>2]=m%1e3*1e3*1e3,me=[Math.floor(b/1e3)>>>0,(Y=Math.floor(b/1e3),+Math.abs(Y)>=1?Y>0?+Math.floor(Y/4294967296)>>>0:~~+Math.ceil((Y-+(~~Y>>>0))/4294967296)>>>0:0)],ie[l+56>>2]=me[0],ie[l+60>>2]=me[1],K[l+64>>2]=b%1e3*1e3*1e3,me=[Math.floor(v/1e3)>>>0,(Y=Math.floor(v/1e3),+Math.abs(Y)>=1?Y>0?+Math.floor(Y/4294967296)>>>0:~~+Math.ceil((Y-+(~~Y>>>0))/4294967296)>>>0:0)],ie[l+72>>2]=me[0],ie[l+76>>2]=me[1],K[l+80>>2]=v%1e3*1e3*1e3,me=[h.ino>>>0,(Y=h.ino,+Math.abs(Y)>=1?Y>0?+Math.floor(Y/4294967296)>>>0:~~+Math.ceil((Y-+(~~Y>>>0))/4294967296)>>>0:0)],ie[l+88>>2]=me[0],ie[l+92>>2]=me[1],0},doMsync(i,s,l,h,m){if(!u.isFile(s.node.mode))throw new u.ErrnoError(43);if(h&2)return 0;var b=He.slice(i,i+l);u.msync(s,b,m,l,h)},getStreamFromFD(i){var s=u.getStreamChecked(i);return s},varargs:void 0,getStr(i){var s=Pt(i);return s}};function Ea(i){try{var s=ir.getStreamFromFD(i);return u.close(s),0}catch(l){if(typeof u>"u"||l.name!=="ErrnoError")throw l;return l.errno}}var Sa=(i,s,l,h)=>{for(var m=0,b=0;b<l;b++){var v=K[s>>2],y=K[s+4>>2];s+=8;var x=u.read(i,X,v,y,h);if(x<0)return-1;if(m+=x,x<y)break}return m};function Aa(i,s,l,h){try{var m=ir.getStreamFromFD(i),b=Sa(m,s,l);return K[h>>2]=b,0}catch(v){if(typeof u>"u"||v.name!=="ErrnoError")throw v;return v.errno}}var Ca=(i,s)=>(C(i==i>>>0||i==(i|0)),C(s===(s|0)),s+2097152>>>0<4194305-!!i?(i>>>0)+s*4294967296:NaN);function Pa(i,s,l,h,m){var b=Ca(s,l);try{if(isNaN(b))return 61;var v=ir.getStreamFromFD(i);return u.llseek(v,b,h),me=[v.position>>>0,(Y=v.position,+Math.abs(Y)>=1?Y>0?+Math.floor(Y/4294967296)>>>0:~~+Math.ceil((Y-+(~~Y>>>0))/4294967296)>>>0:0)],ie[m>>2]=me[0],ie[m+4>>2]=me[1],v.getdents&&b===0&&h===0&&(v.getdents=null),0}catch(y){if(typeof u>"u"||y.name!=="ErrnoError")throw y;return y.errno}}var Ta=(i,s,l,h)=>{for(var m=0,b=0;b<l;b++){var v=K[s>>2],y=K[s+4>>2];s+=8;var x=u.write(i,X,v,y,h);if(x<0)return-1;if(m+=x,x<y)break}return m};function Ra(i,s,l,h){try{var m=ir.getStreamFromFD(i),b=Ta(m,s,l);return K[h>>2]=b,0}catch(v){if(typeof u>"u"||v.name!=="ErrnoError")throw v;return v.errno}}u.createPreloadedFile=ka,u.staticInit();function Ma(){Qs("fetchSettings")}var Qi={__assert_fail:ea,__cxa_throw:ra,_abort_js:na,_emscripten_memcpy_js:ia,_tzset_js:oa,emscripten_resize_heap:ca,environ_get:ha,environ_sizes_get:da,fd_close:Ea,fd_read:Aa,fd_seek:Pa,fd_write:Ra},dt=Ys();n._create_position=ce("create_position",1),n._delete_position=ce("delete_position",1),n._make_move=ce("make_move",2),n._unmake_move=ce("unmake_move",2),n._get_legal_moves=ce("get_legal_moves",2),n._malloc=ce("malloc",1),n._free_legal_moves=ce("free_legal_moves",1),n._free=ce("free",1),n._pos_attacks=ce("pos_attacks",3),n._get_pieces_bb=ce("get_pieces_bb",4),n._get_turn=ce("get_turn",1),n._get_at=ce("get_at",2),n._get_fen=ce("get_fen",1),n._is_checkmate=ce("is_checkmate",1),n._init=ce("init",0);var Oa=ce("fflush",1),Na=ce("strerror",1),Xi=()=>(Xi=dt.emscripten_stack_init)(),dn=()=>(dn=dt.emscripten_stack_get_end)();n.dynCall_viijii=ce("dynCall_viijii",7),n.dynCall_jiji=ce("dynCall_jiji",5),n.dynCall_iiiiij=ce("dynCall_iiiiij",7),n.dynCall_iiiiijj=ce("dynCall_iiiiijj",9),n.dynCall_iiiiiijj=ce("dynCall_iiiiiijj",10);var Fa=["writeI53ToI64","writeI53ToI64Clamped","writeI53ToI64Signaling","writeI53ToU64Clamped","writeI53ToU64Signaling","readI53FromI64","readI53FromU64","convertI32PairToI53","convertU32PairToI53","stackAlloc","getTempRet0","setTempRet0","exitJS","inetPton4","inetNtop4","inetPton6","inetNtop6","readSockaddr","writeSockaddr","emscriptenLog","readEmAsmArgs","jstoi_q","listenOnce","autoResumeAudioContext","dynCallLegacy","getDynCaller","dynCall","handleException","keepRuntimeAlive","runtimeKeepalivePush","runtimeKeepalivePop","callUserCallback","maybeExit","asmjsMangle","HandleAllocator","getNativeTypeSize","STACK_SIZE","STACK_ALIGN","POINTER_SIZE","ASSERTIONS","getCFunc","ccall","cwrap","uleb128Encode","sigToWasmTypes","generateFuncType","convertJsFunctionToWasm","getEmptyTableSlot","updateTableMap","getFunctionAddress","addFunction","removeFunction","reallyNegative","unSign","strLen","reSign","formatString","intArrayToString","AsciiToString","UTF16ToString","stringToUTF16","lengthBytesUTF16","UTF32ToString","stringToUTF32","lengthBytesUTF32","stringToNewUTF8","stringToUTF8OnStack","writeArrayToMemory","registerKeyEventCallback","maybeCStringToJsString","findEventTarget","getBoundingClientRect","fillMouseEventData","registerMouseEventCallback","registerWheelEventCallback","registerUiEventCallback","registerFocusEventCallback","fillDeviceOrientationEventData","registerDeviceOrientationEventCallback","fillDeviceMotionEventData","registerDeviceMotionEventCallback","screenOrientation","fillOrientationChangeEventData","registerOrientationChangeEventCallback","fillFullscreenChangeEventData","registerFullscreenChangeEventCallback","JSEvents_requestFullscreen","JSEvents_resizeCanvasForFullscreen","registerRestoreOldStyle","hideEverythingExceptGivenElement","restoreHiddenElements","setLetterbox","softFullscreenResizeWebGLRenderTarget","doRequestFullscreen","fillPointerlockChangeEventData","registerPointerlockChangeEventCallback","registerPointerlockErrorEventCallback","requestPointerLock","fillVisibilityChangeEventData","registerVisibilityChangeEventCallback","registerTouchEventCallback","fillGamepadEventData","registerGamepadEventCallback","registerBeforeUnloadEventCallback","fillBatteryEventData","battery","registerBatteryEventCallback","setCanvasElementSize","getCanvasElementSize","jsStackTrace","getCallstack","convertPCtoSourceLocation","checkWasiClock","wasiRightsToMuslOFlags","wasiOFlagsToMuslOFlags","safeSetTimeout","setImmediateWrapped","safeRequestAnimationFrame","clearImmediateWrapped","polyfillSetImmediate","registerPostMainLoop","registerPreMainLoop","getPromise","makePromise","idsToPromises","makePromiseCallback","findMatchingCatch","Browser_asyncPrepareDataCounter","isLeapYear","ydayFromDate","arraySum","addDays","getSocketFromFD","getSocketAddress","FS_unlink","FS_mkdirTree","_setNetworkCallback","heapObjectForWebGLType","toTypedArrayIndex","webgl_enable_ANGLE_instanced_arrays","webgl_enable_OES_vertex_array_object","webgl_enable_WEBGL_draw_buffers","webgl_enable_WEBGL_multi_draw","webgl_enable_EXT_polygon_offset_clamp","webgl_enable_EXT_clip_control","webgl_enable_WEBGL_polygon_mode","emscriptenWebGLGet","computeUnpackAlignedImageSize","colorChannelsInGlTextureFormat","emscriptenWebGLGetTexPixelData","emscriptenWebGLGetUniform","webglGetUniformLocation","webglPrepareUniformLocationsBeforeFirstUse","webglGetLeftBracePos","emscriptenWebGLGetVertexAttrib","__glGetActiveAttribOrUniform","writeGLArray","registerWebGlEventCallback","runAndAbortIfError","ALLOC_NORMAL","ALLOC_STACK","allocate","writeStringToMemory","writeAsciiToMemory","setErrNo","demangle","stackTrace"];Fa.forEach(Xs);var xa=["run","addOnPreRun","addOnInit","addOnPreMain","addOnExit","addOnPostRun","addRunDependency","removeRunDependency","out","err","callMain","abort","wasmMemory","wasmExports","writeStackCookie","checkStackCookie","convertI32PairToI53Checked","stackSave","stackRestore","ptrToString","zeroMemory","getHeapMax","growMemory","ENV","ERRNO_CODES","strError","DNS","Protocols","Sockets","timers","warnOnce","readEmAsmArgsArray","jstoi_s","getExecutableName","asyncLoad","alignMemory","mmapAlloc","wasmTable","noExitRuntime","freeTableIndexes","functionsInTableMap","setValue","getValue","PATH","PATH_FS","UTF8Decoder","UTF8ArrayToString","UTF8ToString","stringToUTF8Array","stringToUTF8","lengthBytesUTF8","intArrayFromString","stringToAscii","UTF16Decoder","JSEvents","specialHTMLTargets","findCanvasEventTarget","currentFullscreenStrategy","restoreOldWindowedStyle","UNWIND_CACHE","ExitStatus","getEnvStrings","doReadv","doWritev","initRandomFill","randomFill","promiseMap","uncaughtExceptionCount","exceptionLast","exceptionCaught","ExceptionInfo","Browser","getPreloadedImageData__data","wget","MONTH_DAYS_REGULAR","MONTH_DAYS_LEAP","MONTH_DAYS_REGULAR_CUMULATIVE","MONTH_DAYS_LEAP_CUMULATIVE","SYSCALLS","preloadPlugins","FS_createPreloadedFile","FS_modeStringToFlags","FS_getMode","FS_stdin_getChar_buffer","FS_stdin_getChar","FS_createPath","FS_createDevice","FS_readFile","FS","FS_createDataFile","FS_createLazyFile","MEMFS","TTY","PIPEFS","SOCKFS","tempFixedLengthArray","miniTempWebGLFloatBuffers","miniTempWebGLIntBuffers","GL","AL","GLUT","EGL","GLEW","IDBStore","SDL","SDL_gfx","allocateUTF8","allocateUTF8OnStack","print","printErr"];xa.forEach(Wi);var Pr;Jt=function i(){Pr||Ji(),Pr||(Jt=i)};function $a(){Xi(),Is()}function Ji(){if(ct>0||($a(),Ls(),ct>0))return;function i(){var s;Pr||(Pr=!0,n.calledRun=!0,!D&&(Us(),o(n),(s=n.onRuntimeInitialized)==null||s.call(n),C(!n._main,'compiled without a main, but one is present. if you added it from JS, use Module["onRuntimeInitialized"]'),Bs()))}n.setStatus?(n.setStatus("Running..."),setTimeout(()=>{setTimeout(()=>n.setStatus(""),1),i()},1)):i(),sn()}if(n.preInit)for(typeof n.preInit=="function"&&(n.preInit=[n.preInit]);n.preInit.length>0;)n.preInit.pop()();Ji(),r=c;for(const i of Object.keys(n))i in e||Object.defineProperty(e,i,{configurable:!0,get(){oe(`Access to module property ('${i}') is no longer possible via the module constructor argument; Instead, use the result of the module constructor.`)}});return r}})();const bu=0,Ei=1,rn=2,Si=3,Ai=4,Ci=5,Pi=6,vu=0,yn=Ei,Nt=rn,Ft=Si,xt=Ai,$t=Ci,_n=Pi,En=Ei+8,Dt=rn+8,It=Si+8,Lt=Ai+8,Ut=Ci+8,Sn=Pi+8,ku=16384;function yu(t){switch(t){case Ei:return"pawn";case rn:return"knight";case Si:return"bishop";case Ai:return"rook";case Ci:return"queen";case Pi:return"king"}throw"No Piece Type"}function Er(t){let e=t&63,r=t>>6&63,o=(t&49152)===ku?yu((t>>12&3)+rn):void 0;return{from:r,to:e,promotion:o}}class Ti{constructor(e){$(this,"m");this.m=e}static async make(e){let r=await wu({locateFile:e});return r._init(),new Ti(r)}create_position(e){return this.m._create_position(this.stringToWasm(e))}delete_position(e){this.m._delete_position(e)}unmake_move(e,r){this.m._unmake_move(e,r)}make_move(e,r){this.m._make_move(e,r)}pos_turn(e){return this.m._get_turn(e)===bu?"white":"black"}get_legal_moves(e){const r=this.m._malloc(4);let n=this.m._get_legal_moves(e,r);const o=this.m.getValue(r,"i32");let a=[];for(let c=0;c<o;c++){const f=this.m.getValue(n+c*4,"i32");a.push(f)}return this.m._free(r),this.m._free(n),a}attacks(e,r,n){const o=this.m._malloc(8);this.m._attacks(e,r,n.lo,n.hi,o);const a=this.m.getValue(o,"i32"),c=this.m.getValue(o+4,"i32");return this.m._free(o),new R(a,c)}pos_attacks(e,r){const n=this.m._malloc(8);this.m._pos_attacks(e,r,n);const o=this.m.getValue(n,"i32"),a=this.m.getValue(n+4,"i32");return this.m._free(n),new R(o,a)}get_pieces_bb(e,r){const n=this.m._malloc(8),o=this.m._malloc(4*r.length);for(let f=0;f<r.length;f++)this.m.setValue(o+f*4,r[f],"i32");this.m._get_pieces_bb(e,o,r.length,n);const a=this.m.getValue(n,"i32"),c=this.m.getValue(n+4,"i32");return this.m._free(n),this.m._free(o),new R(a,c)}get_at(e,r){let n=this.m._get_at(e,r);if(n!==vu)return n}is_checkmate(e){return this.m._is_checkmate(e)}get_pos_read_fen(e){let r=this.wasmToStringAndFree(this.m._get_fen(e));return _i.fromSetup(yi(r).unwrap()).unwrap()}make_san(e,r){let n=this.get_pos_read_fen(e);return Es(n,Er(r))}stringToWasm(e){let r=this.m;const n=e.length+1,o=r._malloc(n);return r.stringToUTF8(e,o,n),o}wasmToStringAndFree(e){return this.m.UTF8ToString(e)}}function _u(t,e,r){var c;let o=(c=Ss(t,e,r).children[0])==null?void 0:c.m[0];if(!o)return;let a=_i.fromSetup(yi(t).unwrap()).unwrap();return As(o,a)}function Ao(t,e){let{from:r,to:n}=Er(e),o={};for(let a of Object.keys(t))o[a]=t[a],Ke(a,"white").length>0&&(t[a]===r?o[a]=n:t[a]===n&&(o[a]=-o[a]));return o}function Nr(t,e,r,n,o,a){if(t.rule[0]==="E"){let w=n;r.length>0&&(a.make_move(e,r[r.length-1]),w=Ao(n,r[r.length-1]));let g=t.rule.slice(1).trim(),S=!1;for(let E of a.get_legal_moves(e)){let k=[w];if(g){let F=Co(g,w,e,E,o,a);if(F===void 0||F.length===0)continue;k=F}for(let F of t.children){if(k.length===0)break;k=k.filter(T=>!Nr(F,e,[...r,E],T,o,a))}t.children.length===0&&k.length>0&&(t.m.push({ms:[...r,E],ctx:w}),S=!0),k.length===0&&(t.m.push({ms:[...r,E],ctx:w}),S=!0)}let _=[n];return S||(_=void 0),r.length>0&&a.unmake_move(e,r[r.length-1]),_}if(t.rule[0]==="A"){let w=n;r.length>0&&(a.make_move(e,r[r.length-1]),w=Ao(n,r[r.length-1])),t.rule.slice(1).trim();let g=!0;for(let _ of a.get_legal_moves(e)){let E=[w];for(let k of t.children){if(E.length===0)break;E=E.filter(F=>!Nr(k,e,[...r,_],F,o,a))}if(E.length>0){g=!1;break}}let S=[n];return g?t.m.push(...S.map(_=>({ms:r,ctx:_}))):S=void 0,r.length>0&&a.unmake_move(e,r[r.length-1]),S}let c=t.rule[0]==="\\"?t.rule.slice(1):t.rule,f=r[r.length-1],d=Co(c,n,e,f,o,a);if(d===void 0||d.length===0)return;let p=d;if(t.children.length===0)return t.m.push({ms:r,ctx:n}),p;for(let w of t.children){if(p.length===0)break;p=p.filter(g=>!Nr(w,e,r,g,o,a))}if(p.length===0)return r.length>0&&t.m.push({ms:r,ctx:n}),[n]}function Ss(t,e,r){let n=r.create_position(t),o=Eu(e);return o.children.length===0||(Nr(o,n,[],{},r.pos_turn(n),r),r.delete_position(n)),o}function Eu(t){let e=t.trim().split(`
`),r={depth:-1,rule:".",children:[],p_m:[],m:[],n:[],long:!1,no_c:!1};const n=[r];for(let o=0;o<e.length;o++){let a=e[o],c=a.trim();if(!c)continue;const f=a.search(/\S/);let d=!1,p=!1;c[c.length-1]==="5"&&(p=!0,c=c.slice(0,-1).trim()),c[c.length-1]==="P"&&(d=!0,c=c.slice(0,-1).trim());let w={depth:f,rule:c,children:[],p_m:[],m:[],long:p,no_c:d};for(;n.length>f+1;)n.pop();n[n.length-1].children.push(w),n.push(w)}return r}function As(t,e){return e=e.clone(),t.ms.map(n=>{let o=Er(n),a=Es(e,o);return e.play(o),a}).join(" ")}function Cs(t,e){let r="",n=" ".repeat(t.depth+1),o=t.long?150:1,a=t.no_c?t.p_m:t.m,c=a.slice(0,o).map(f=>As(f,e)).join(", ");return a.length>1&&(c+=".."+a.length),r+=" "+t.rule+" <"+(c??"?")+`>
`,t.children.map((f,d)=>{d===t.children.length-1?r+=n+"":d===0?r+=n+"":r+=n+" ",r+=Cs(f,e)}).join(""),r}function Su(t,e,r,n,o,a){if(t===".")return[e];let c=[],[f,...d]=t.split(" "),p=Cu(f,e,r,n,o,a);if(!p)return;let[w,g]=p;for(let S of g){let _=d.reduce((E,k)=>E.flatMap(F=>Au(k,w,F,r,n,o,a)??[]),[S]);!_||_.length===0||c.push(..._)}return c}function Co(t,e,r,n,o,a){let c=[e],f=t.split(",");for(let d of f){let p=[];for(let w of c){let g=Su(d.trim(),w,r,n,o,a);g!==void 0&&p.push(...g)}c=p}return c}function Au(t,e,r,n,o,a,c){var M;let f=(M=t.match(/^"(\w*)$/))==null?void 0:M[1],d=t.match(/\=([a-h][1-8])$/),p=t.match(/\=([pqrnbkPQRNBKmjuaglMJUAGL]'?)$/),w=t.match(/\+([a-h][1-8])$/),g=t.match(/\+([pqrnbkPQRNBKmjuaglMJUAGL]'?)$/),S=t.match(/^([pqrnbkPQRNBKmjuaglMJUAGL]'?)\/([pqrnbkPQRNBKmjuaglMJUAGL]'?)$/),_=t.match(/^([pqrnbkPQRNBKmjuaglMJUAGL]'?)\+([pqrnbkPQRNBKmjuaglMJUAGL]'?)$/);if(f)return f!==c.make_san(n,o)?void 0:[r];if(t.match(/#/)){c.make_move(n,o);let P=c.is_checkmate(n);return c.unmake_move(n,o),P?[r]:void 0}let E=[];if(r[e]===void 0||r[e]<0)return;c.get_at(n,r[e]);let{from:k,to:F}=Er(o);c.get_at(n,k);let T=c.get_at(n,F);if(_){let[P,N,O]=_,G=r[N]?R.fromSquare(r[N]):c.get_pieces_bb(n,Ke(N,a)),I=r[O]?R.fromSquare(r[O]):c.get_pieces_bb(n,Ke(O,a));for(let L of G){let B=c.pos_attacks(n,L).intersect(I).singleSquare();c.make_move(n,o);let D=c.pos_attacks(n,L).intersect(I).singleSquare();B===void 0&&D!==void 0&&E.push({...r,[N]:L,[O]:D}),c.unmake_move(n,o)}return E}if(S){let[P,N,O]=S,G=r[N]?R.fromSquare(r[N]):c.get_pieces_bb(n,Ke(N,a)),I=r[O]?R.fromSquare(r[O]):c.get_pieces_bb(n,Ke(O,a));for(let L of G){let B=c.pos_attacks(n,L).intersect(I).singleSquare();c.make_move(n,o);let D=c.pos_attacks(n,L).intersect(I).singleSquare();B!==void 0&&D===void 0&&E.push({...r,[N]:L,[O]:B}),c.unmake_move(n,o)}}if(p){let[P,N]=p;if(!T)return;if(r[N]!==void 0)return r[N]!==F?void 0:[r];if(!Ke(N,a).find(I=>I===T))return;let G={...r,[N]:F};E.push(G)}if(d){let[P,N]=d;if(r[N]!==void 0)return r[N]!==F?void 0:[r];let O={...r,[N]:F};E.push(O)}if(w){let[P,N]=w;c.make_move(n,o);let O=r[e];O===k&&(O=F);let G=c.pos_attacks(n,O);if(r[N]!==void 0){if(!G.has(r[N])){c.unmake_move(n,o);return}let I={...r};E.push(I)}else for(let I of G){let L={...r,[N]:I};E.push(L)}c.unmake_move(n,o)}if(g){let[P,N]=g;c.make_move(n,o);let O=r[e];O===k&&(O=F);let G=c.pos_attacks(n,O);if(r[N]!==void 0&&!G.has(r[N])){c.unmake_move(n,o);return}let I=c.get_pieces_bb(n,Ke(N,a));for(let L of G.intersect(I)){let B={...r,[N]:L};E.push(B)}c.unmake_move(n,o)}return E}function Cu(t,e,r,n,o,a){var E,k,F,T,M;let c=(E=t.match(/^"(\w*)$/))==null?void 0:E[1],f=(k=t.match(/^=([pqrnbkPQRNBKmjuaglMJUAGL]'?)$/))==null?void 0:k[1],d=(F=t.match(/^([pqrnbkPQRNBKmjuaglMJUAGL]'?)=$/))==null?void 0:F[1],p=(T=t.match(/^([pqrnbkPQRNBKmjuaglMJUAGL]'?)$/))==null?void 0:T[1],w=(M=t.match(/^=([a-h][1-8])$/))==null?void 0:M[1],g=[],{from:S,to:_}=Er(n);if(c)return c!==a.make_san(r,n)?void 0:[c,[e]];if(w){let P=w;if(e[P]!==void 0){if(e[P]===S||e[P]!==_)return;let O={...e};return delete O[P],[P,[O]]}let N={...e};return g.push(N),[P,g]}if(f){let P=f;if(e[P]!==void 0){if(e[P]===S||e[P]!==_)return;let G={...e};return delete G[P],[P,[G]]}if(!a.get_pieces_bb(r,Ke(P,o)).has(_))return;let O={...e};return g.push(O),[P,g]}if(d){let P=d;if(e[P]!==void 0)return e[P]!==S?void 0:[P,[e]];if(!a.get_pieces_bb(r,Ke(P,o)).has(S))return;let O={...e,[P]:S};return g.push(O),[P,g]}if(p){let P=p;if(e[P]!==void 0)return e[P]===S||e[P]===_||e[P]<0?void 0:[P,[e]];let N=a.get_pieces_bb(r,Ke(P,o));N.set(S,!1),N.set(_,!1);for(let O of N){let G={...e,[P]:O};g.push(G)}return[P,g]}}function Ke(t,e){let r=t[0];switch(r.toLowerCase()===r==(e==="white")?r=r.toUpperCase():r=r.toLowerCase(),r[0]){case"Q":return[$t];case"R":return[xt];case"B":return[Ft];case"N":return[Nt];case"K":return[_n];case"P":return[yn];case"M":return[Nt,Ft];case"J":return[xt,$t];case"U":return[Nt,Ft,xt,$t];case"L":return[$t,xt,Ft,Nt,_n];case"G":return[$t,xt,Ft,Nt,yn];case"A":return[yn,_n,$t,xt,Ft,Nt];case"q":return[Ut];case"r":return[Lt];case"b":return[It];case"n":return[Dt];case"k":return[Sn];case"p":return[En];case"m":return[Dt,It];case"j":return[Lt,Ut];case"u":return[Dt,It,Lt,Ut];case"l":return[Ut,Lt,It,Dt,Sn];case"g":return[Ut,Lt,It,Dt,En];case"a":return[En,Sn,Ut,Lt,It,Dt];default:return[]}}const Ps=t=>{let e=Object.keys(t.has_tags).length,r={...t.has_tags};return e>0&&(r.has_tag=!0,e===1?r.single_tag=!0:r.many_tags=!0),r[`id_${t.id}`]=!0,r},Pu=t=>{let e={...t.tags,...Ps(t)};if(t.rules){[...new Set(t.rules.flatMap(Tu))].forEach(a=>e[a]=!0);let n=[],o=t.rules.filter(a=>a.solve===void 0||a.solve>=0);if(o.length>0){let a=o[0];a.solve===void 0?(n.push("matched"),n.push(`matched_${a.rule.name}`)):n.push("unmatched")}n.forEach(a=>e[a]=!0)}return e},Tu=t=>t.solve===void 0?(t.rule.rule.includes("."),["solved",`solved_${t.rule.name}`]):t.solve>=0?["failed",`failed_${t.rule.name}`]:[""];class Ts{unwrap(e,r){const n=this._chain(o=>H.ok(e?e(o):o),o=>r?H.ok(r(o)):H.err(o));if(n.isErr)throw n.error;return n.value}map(e,r){return this._chain(n=>H.ok(e(n)),n=>H.err(r?r(n):n))}chain(e,r){return this._chain(e,r||(n=>H.err(n)))}}class Ru extends Ts{constructor(e){super(),this.value=void 0,this.isOk=!0,this.isErr=!1,this.value=e}_chain(e,r){return e(this.value)}}class Mu extends Ts{constructor(e){super(),this.error=void 0,this.isOk=!1,this.isErr=!0,this.error=e}_chain(e,r){return r(this.error)}}var H;(function(t){t.ok=function(e){return new Ru(e)},t.err=function(e){return new Mu(e||new Error)},t.all=function(e){if(Array.isArray(e)){const o=[];for(let a=0;a<e.length;a++){const c=e[a];if(c.isErr)return c;o.push(c.value)}return t.ok(o)}const r={},n=Object.keys(e);for(let o=0;o<n.length;o++){const a=e[n[o]];if(a.isErr)return a;r[n[o]]=a.value}return t.ok(r)}})(H||(H={}));const Po=t=>(t=t-(t>>>1&1431655765),t=(t&858993459)+(t>>>2&858993459),Math.imul(t+(t>>>4)&252645135,16843009)>>24),Vn=t=>(t=t>>>8&16711935|(t&16711935)<<8,t>>>16&65535|(t&65535)<<16),To=t=>(t=t>>>1&1431655765|(t&1431655765)<<1,t=t>>>2&858993459|(t&858993459)<<2,t=t>>>4&252645135|(t&252645135)<<4,Vn(t));class A{constructor(e,r){this.lo=e|0,this.hi=r|0}static fromSquare(e){return e>=32?new A(0,1<<e-32):new A(1<<e,0)}static fromRank(e){return new A(255,0).shl64(8*e)}static fromFile(e){return new A(16843009<<e,16843009<<e)}static empty(){return new A(0,0)}static full(){return new A(4294967295,4294967295)}static corners(){return new A(129,2164260864)}static center(){return new A(402653184,24)}static backranks(){return new A(255,4278190080)}static backrank(e){return e==="white"?new A(255,0):new A(0,4278190080)}static lightSquares(){return new A(1437226410,1437226410)}static darkSquares(){return new A(2857740885,2857740885)}complement(){return new A(~this.lo,~this.hi)}xor(e){return new A(this.lo^e.lo,this.hi^e.hi)}union(e){return new A(this.lo|e.lo,this.hi|e.hi)}intersect(e){return new A(this.lo&e.lo,this.hi&e.hi)}diff(e){return new A(this.lo&~e.lo,this.hi&~e.hi)}intersects(e){return this.intersect(e).nonEmpty()}isDisjoint(e){return this.intersect(e).isEmpty()}supersetOf(e){return e.diff(this).isEmpty()}subsetOf(e){return this.diff(e).isEmpty()}shr64(e){return e>=64?A.empty():e>=32?new A(this.hi>>>e-32,0):e>0?new A(this.lo>>>e^this.hi<<32-e,this.hi>>>e):this}shl64(e){return e>=64?A.empty():e>=32?new A(0,this.lo<<e-32):e>0?new A(this.lo<<e,this.hi<<e^this.lo>>>32-e):this}bswap64(){return new A(Vn(this.hi),Vn(this.lo))}rbit64(){return new A(To(this.hi),To(this.lo))}minus64(e){const r=this.lo-e.lo,n=(r&e.lo&1)+(e.lo>>>1)+(r>>>1)>>>31;return new A(r,this.hi-(e.hi+n))}equals(e){return this.lo===e.lo&&this.hi===e.hi}size(){return Po(this.lo)+Po(this.hi)}isEmpty(){return this.lo===0&&this.hi===0}nonEmpty(){return this.lo!==0||this.hi!==0}has(e){return(e>=32?this.hi&1<<e-32:this.lo&1<<e)!==0}set(e,r){return r?this.with(e):this.without(e)}with(e){return e>=32?new A(this.lo,this.hi|1<<e-32):new A(this.lo|1<<e,this.hi)}without(e){return e>=32?new A(this.lo,this.hi&~(1<<e-32)):new A(this.lo&~(1<<e),this.hi)}toggle(e){return e>=32?new A(this.lo,this.hi^1<<e-32):new A(this.lo^1<<e,this.hi)}last(){if(this.hi!==0)return 63-Math.clz32(this.hi);if(this.lo!==0)return 31-Math.clz32(this.lo)}first(){if(this.lo!==0)return 31-Math.clz32(this.lo&-this.lo);if(this.hi!==0)return 63-Math.clz32(this.hi&-this.hi)}withoutFirst(){return this.lo!==0?new A(this.lo&this.lo-1,this.hi):new A(0,this.hi&this.hi-1)}moreThanOne(){return this.hi!==0&&this.lo!==0||(this.lo&this.lo-1)!==0||(this.hi&this.hi-1)!==0}singleSquare(){return this.moreThanOne()?void 0:this.last()}*[Symbol.iterator](){let e=this.lo,r=this.hi;for(;e!==0;){const n=31-Math.clz32(e&-e);e^=1<<n,yield n}for(;r!==0;){const n=31-Math.clz32(r&-r);r^=1<<n,yield 32+n}}*reversed(){let e=this.lo,r=this.hi;for(;r!==0;){const n=31-Math.clz32(r);r^=1<<n,yield 32+n}for(;e!==0;){const n=31-Math.clz32(e);e^=1<<n,yield n}}}const Vr=["a","b","c","d","e","f","g","h"],Rs=["1","2","3","4","5","6","7","8"],vt=["white","black"],Le=["pawn","knight","bishop","rook","queen","king"],Ou=["a","h"],Yr=t=>"role"in t;class Yt{constructor(){}static default(){const e=new Yt;return e.reset(),e}reset(){this.occupied=new A(65535,4294901760),this.promoted=A.empty(),this.white=new A(65535,0),this.black=new A(0,4294901760),this.pawn=new A(65280,16711680),this.knight=new A(66,1107296256),this.bishop=new A(36,603979776),this.rook=new A(129,2164260864),this.queen=new A(8,134217728),this.king=new A(16,268435456)}static empty(){const e=new Yt;return e.clear(),e}clear(){this.occupied=A.empty(),this.promoted=A.empty();for(const e of vt)this[e]=A.empty();for(const e of Le)this[e]=A.empty()}clone(){const e=new Yt;e.occupied=this.occupied,e.promoted=this.promoted;for(const r of vt)e[r]=this[r];for(const r of Le)e[r]=this[r];return e}getColor(e){if(this.white.has(e))return"white";if(this.black.has(e))return"black"}getRole(e){for(const r of Le)if(this[r].has(e))return r}get(e){const r=this.getColor(e);if(!r)return;const n=this.getRole(e),o=this.promoted.has(e);return{color:r,role:n,promoted:o}}take(e){const r=this.get(e);return r&&(this.occupied=this.occupied.without(e),this[r.color]=this[r.color].without(e),this[r.role]=this[r.role].without(e),r.promoted&&(this.promoted=this.promoted.without(e))),r}set(e,r){const n=this.take(e);return this.occupied=this.occupied.with(e),this[r.color]=this[r.color].with(e),this[r.role]=this[r.role].with(e),r.promoted&&(this.promoted=this.promoted.with(e)),n}has(e){return this.occupied.has(e)}*[Symbol.iterator](){for(const e of this.occupied)yield[e,this.get(e)]}pieces(e,r){return this[e].intersect(this[r])}rooksAndQueens(){return this.rook.union(this.queen)}bishopsAndQueens(){return this.bishop.union(this.queen)}kingOf(e){return this.pieces(e,"king").singleSquare()}}class We{constructor(){}static empty(){const e=new We;for(const r of Le)e[r]=0;return e}static fromBoard(e,r){const n=new We;for(const o of Le)n[o]=e.pieces(r,o).size();return n}clone(){const e=new We;for(const r of Le)e[r]=this[r];return e}equals(e){return Le.every(r=>this[r]===e[r])}add(e){const r=new We;for(const n of Le)r[n]=this[n]+e[n];return r}subtract(e){const r=new We;for(const n of Le)r[n]=this[n]-e[n];return r}nonEmpty(){return Le.some(e=>this[e]>0)}isEmpty(){return!this.nonEmpty()}hasPawns(){return this.pawn>0}hasNonPawns(){return this.knight>0||this.bishop>0||this.rook>0||this.queen>0||this.king>0}size(){return this.pawn+this.knight+this.bishop+this.rook+this.queen+this.king}}class mt{constructor(e,r){this.white=e,this.black=r}static empty(){return new mt(We.empty(),We.empty())}static fromBoard(e){return new mt(We.fromBoard(e,"white"),We.fromBoard(e,"black"))}clone(){return new mt(this.white.clone(),this.black.clone())}equals(e){return this.white.equals(e.white)&&this.black.equals(e.black)}add(e){return new mt(this.white.add(e.white),this.black.add(e.black))}subtract(e){return new mt(this.white.subtract(e.white),this.black.subtract(e.black))}count(e){return this.white[e]+this.black[e]}size(){return this.white.size()+this.black.size()}isEmpty(){return this.white.isEmpty()&&this.black.isEmpty()}nonEmpty(){return!this.isEmpty()}hasPawns(){return this.white.hasPawns()||this.black.hasPawns()}hasNonPawns(){return this.white.hasNonPawns()||this.black.hasNonPawns()}}class wr{constructor(e,r){this.white=e,this.black=r}static default(){return new wr(3,3)}clone(){return new wr(this.white,this.black)}equals(e){return this.white===e.white&&this.black===e.black}}const j=t=>t!==void 0,_e=t=>t==="white"?"black":"white",kt=t=>t>>3,Me=t=>t&7,Yn=(t,e)=>0<=t&&t<8&&0<=e&&e<8?t+8*e:void 0,fr=t=>{switch(t){case"pawn":return"p";case"knight":return"n";case"bishop":return"b";case"rook":return"r";case"queen":return"q";case"king":return"k"}};function Qn(t){switch(t.toLowerCase()){case"p":return"pawn";case"n":return"knight";case"b":return"bishop";case"r":return"rook";case"q":return"queen";case"k":return"king";default:return}}function hr(t){if(t.length===2)return Yn(t.charCodeAt(0)-97,t.charCodeAt(1)-49)}const br=t=>Vr[Me(t)]+Rs[kt(t)],Ms=t=>{if(t[1]==="@"&&t.length===4){const e=Qn(t[0]),r=hr(t.slice(2));if(e&&j(r))return{role:e,to:r}}else if(t.length===4||t.length===5){const e=hr(t.slice(0,2)),r=hr(t.slice(2,4));let n;if(t.length===5&&(n=Qn(t[4]),!n))return;if(j(e)&&j(r))return{from:e,to:r,promotion:n}}},Ri=(t,e)=>t==="white"?e==="a"?2:6:e==="a"?58:62,Mi=(t,e)=>t==="white"?e==="a"?3:5:e==="a"?59:61,Nu="rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR",Fu=Nu+" w KQkq -",Os=Fu+" 0 1";var de;(function(t){t.Fen="ERR_FEN",t.Board="ERR_BOARD",t.Pockets="ERR_POCKETS",t.Turn="ERR_TURN",t.Castling="ERR_CASTLING",t.EpSquare="ERR_EP_SQUARE",t.RemainingChecks="ERR_REMAINING_CHECKS",t.Halfmoves="ERR_HALFMOVES",t.Fullmoves="ERR_FULLMOVES"})(de||(de={}));class ve extends Error{}const xu=(t,e,r)=>{let n=t.indexOf(e);for(;r-- >0&&n!==-1;)n=t.indexOf(e,n+e.length);return n},Ht=t=>/^\d{1,4}$/.test(t)?parseInt(t,10):void 0,Ns=t=>{const e=Qn(t);return e&&{role:e,color:t.toLowerCase()===t?"black":"white"}},An=t=>{const e=Yt.empty();let r=7,n=0;for(let o=0;o<t.length;o++){const a=t[o];if(a==="/"&&n===8)n=0,r--;else{const c=parseInt(a,10);if(c>0)n+=c;else{if(n>=8||r<0)return H.err(new ve(de.Board));const f=n+r*8,d=Ns(a);if(!d)return H.err(new ve(de.Board));t[o+1]==="~"&&(d.promoted=!0,o++),e.set(f,d),n++}}}return r!==0||n!==8?H.err(new ve(de.Board)):H.ok(e)},Ro=t=>{if(t.length>64)return H.err(new ve(de.Pockets));const e=mt.empty();for(const r of t){const n=Ns(r);if(!n)return H.err(new ve(de.Pockets));e[n.color][n.role]++}return H.ok(e)},$u=(t,e)=>{let r=A.empty();if(e==="-")return H.ok(r);for(const n of e){const o=n.toLowerCase(),a=n===o?"black":"white",c=a==="white"?0:7;if("a"<=o&&o<="h")r=r.with(Yn(o.charCodeAt(0)-97,c));else if(o==="k"||o==="q"){const f=t[a].intersect(A.backrank(a)).intersect(t.rook.union(t.king)),d=o==="k"?f.last():f.first();r=r.with(j(d)&&t.rook.has(d)?d:Yn(o==="k"?7:0,c))}else return H.err(new ve(de.Castling))}return vt.some(n=>A.backrank(n).intersect(r).size()>2)?H.err(new ve(de.Castling)):H.ok(r)},Mo=t=>{const e=t.split("+");if(e.length===3&&e[0]===""){const r=Ht(e[1]),n=Ht(e[2]);return!j(r)||r>3||!j(n)||n>3?H.err(new ve(de.RemainingChecks)):H.ok(new wr(3-r,3-n))}else if(e.length===2){const r=Ht(e[0]),n=Ht(e[1]);return!j(r)||r>3||!j(n)||n>3?H.err(new ve(de.RemainingChecks)):H.ok(new wr(r,n))}else return H.err(new ve(de.RemainingChecks))},Xn=t=>{const e=t.split(/[\s_]+/),r=e.shift();let n,o=H.ok(void 0);if(r.endsWith("]")){const f=r.indexOf("[");if(f===-1)return H.err(new ve(de.Fen));n=An(r.slice(0,f)),o=Ro(r.slice(f+1,-1))}else{const f=xu(r,"/",7);f===-1?n=An(r):(n=An(r.slice(0,f)),o=Ro(r.slice(f+1)))}let a;const c=e.shift();if(!j(c)||c==="w")a="white";else if(c==="b")a="black";else return H.err(new ve(de.Turn));return n.chain(f=>{const d=e.shift(),p=j(d)?$u(f,d):H.ok(A.empty()),w=e.shift();let g;if(j(w)&&w!=="-"&&(g=hr(w),!j(g)))return H.err(new ve(de.EpSquare));let S=e.shift(),_;j(S)&&S.includes("+")&&(_=Mo(S),S=e.shift());const E=j(S)?Ht(S):0;if(!j(E))return H.err(new ve(de.Halfmoves));const k=e.shift(),F=j(k)?Ht(k):1;if(!j(F))return H.err(new ve(de.Fullmoves));const T=e.shift();let M=H.ok(void 0);if(j(T)){if(j(_))return H.err(new ve(de.RemainingChecks));M=Mo(T)}else j(_)&&(M=_);return e.length>0?H.err(new ve(de.Fen)):o.chain(P=>p.chain(N=>M.map(O=>({board:f,pockets:P,turn:a,castlingRights:N,remainingChecks:O,epSquare:g,halfmoves:E,fullmoves:Math.max(1,F)}))))})},Du=t=>{let e=fr(t.role);return t.color==="white"&&(e=e.toUpperCase()),t.promoted&&(e+="~"),e},Iu=t=>{let e="",r=0;for(let n=7;n>=0;n--)for(let o=0;o<8;o++){const a=o+n*8,c=t.get(a);c?(r>0&&(e+=r,r=0),e+=Du(c)):r++,o===7&&(r>0&&(e+=r,r=0),n!==0&&(e+="/"))}return e},Oo=t=>Le.map(e=>fr(e).repeat(t[e])).join(""),Lu=t=>Oo(t.white).toUpperCase()+Oo(t.black),Uu=(t,e)=>{let r="";for(const n of vt){const o=A.backrank(n);let a=t.kingOf(n);j(a)&&!o.has(a)&&(a=void 0);const c=t.pieces(n,"rook").intersect(o);for(const f of e.intersect(o).reversed())if(f===c.first()&&j(a)&&f<a)r+=n==="white"?"Q":"q";else if(f===c.last()&&j(a)&&a<f)r+=n==="white"?"K":"k";else{const d=Vr[Me(f)];r+=n==="white"?d.toUpperCase():d}}return r||"-"},Bu=t=>`${t.white}+${t.black}`,Fs=(t,e)=>[Iu(t.board)+(t.pockets?`[${Lu(t.pockets)}]`:""),t.turn[0],Uu(t.board,t.castlingRights),j(t.epSquare)?br(t.epSquare):"-",...t.remainingChecks?[Bu(t.remainingChecks)]:[],Math.max(0,Math.min(t.halfmoves,9999)),Math.max(1,Math.min(t.fullmoves,9999))].join(" "),Qr=(t,e)=>{let r=A.empty();for(const n of e){const o=t+n;0<=o&&o<64&&Math.abs(Me(t)-Me(o))<=2&&(r=r.with(o))}return r},st=t=>{const e=[];for(let r=0;r<64;r++)e[r]=t(r);return e},zu=st(t=>Qr(t,[-9,-8,-7,-1,1,7,8,9])),ju=st(t=>Qr(t,[-17,-15,-10,-6,6,10,15,17])),Ku={white:st(t=>Qr(t,[7,9])),black:st(t=>Qr(t,[-7,-9]))},Oi=t=>zu[t],Ni=t=>ju[t],nn=(t,e)=>Ku[t][e],Jn=st(t=>A.fromFile(Me(t)).without(t)),Zn=st(t=>A.fromRank(kt(t)).without(t)),ei=st(t=>{const e=new A(134480385,2151686160),r=8*(kt(t)-Me(t));return(r>=0?e.shl64(r):e.shr64(-r)).without(t)}),ti=st(t=>{const e=new A(270549120,16909320),r=8*(kt(t)+Me(t)-7);return(r>=0?e.shl64(r):e.shr64(-r)).without(t)}),ri=(t,e,r)=>{let n=r.intersect(e),o=n.bswap64();return n=n.minus64(t),o=o.minus64(t.bswap64()),n.xor(o.bswap64()).intersect(e)},Wu=(t,e)=>ri(A.fromSquare(t),Jn[t],e),Hu=(t,e)=>{const r=Zn[t];let n=e.intersect(r),o=n.rbit64();return n=n.minus64(A.fromSquare(t)),o=o.minus64(A.fromSquare(63-t)),n.xor(o.rbit64()).intersect(r)},vr=(t,e)=>{const r=A.fromSquare(t);return ri(r,ei[t],e).xor(ri(r,ti[t],e))},kr=(t,e)=>Wu(t,e).xor(Hu(t,e)),xs=(t,e)=>vr(t,e).xor(kr(t,e)),$s=(t,e)=>{const r=A.fromSquare(e);return Zn[t].intersects(r)?Zn[t].with(t):ti[t].intersects(r)?ti[t].with(t):ei[t].intersects(r)?ei[t].with(t):Jn[t].intersects(r)?Jn[t].with(t):A.empty()},yr=(t,e)=>$s(t,e).intersect(A.full().shl64(t).xor(A.full().shl64(e))).withoutFirst();var nt;(function(t){t.Empty="ERR_EMPTY",t.OppositeCheck="ERR_OPPOSITE_CHECK",t.PawnsOnBackrank="ERR_PAWNS_ON_BACKRANK",t.Kings="ERR_KINGS",t.Variant="ERR_VARIANT"})(nt||(nt={}));class Bt extends Error{}const Gu=(t,e,r,n)=>r[e].intersect(kr(t,n).intersect(r.rooksAndQueens()).union(vr(t,n).intersect(r.bishopsAndQueens())).union(Ni(t).intersect(r.knight)).union(Oi(t).intersect(r.king)).union(nn(_e(e),t).intersect(r.pawn)));class gt{constructor(){}static default(){const e=new gt;return e.castlingRights=A.corners(),e.rook={white:{a:0,h:7},black:{a:56,h:63}},e.path={white:{a:new A(14,0),h:new A(96,0)},black:{a:new A(0,234881024),h:new A(0,1610612736)}},e}static empty(){const e=new gt;return e.castlingRights=A.empty(),e.rook={white:{a:void 0,h:void 0},black:{a:void 0,h:void 0}},e.path={white:{a:A.empty(),h:A.empty()},black:{a:A.empty(),h:A.empty()}},e}clone(){const e=new gt;return e.castlingRights=this.castlingRights,e.rook={white:{a:this.rook.white.a,h:this.rook.white.h},black:{a:this.rook.black.a,h:this.rook.black.h}},e.path={white:{a:this.path.white.a,h:this.path.white.h},black:{a:this.path.black.a,h:this.path.black.h}},e}add(e,r,n,o){const a=Ri(e,r),c=Mi(e,r);this.castlingRights=this.castlingRights.with(o),this.rook[e][r]=o,this.path[e][r]=yr(o,c).with(c).union(yr(n,a).with(a)).without(n).without(o)}static fromSetup(e){const r=gt.empty(),n=e.castlingRights.intersect(e.board.rook);for(const o of vt){const a=A.backrank(o),c=e.board.kingOf(o);if(!j(c)||!a.has(c))continue;const f=n.intersect(e.board[o]).intersect(a),d=f.first();j(d)&&d<c&&r.add(o,"a",c,d);const p=f.last();j(p)&&c<p&&r.add(o,"h",c,p)}return r}discardRook(e){if(this.castlingRights.has(e)){this.castlingRights=this.castlingRights.without(e);for(const r of vt)for(const n of Ou)this.rook[r][n]===e&&(this.rook[r][n]=void 0)}}discardColor(e){this.castlingRights=this.castlingRights.diff(A.backrank(e)),this.rook[e].a=void 0,this.rook[e].h=void 0}}class qu{constructor(e){this.rules=e}reset(){this.board=Yt.default(),this.pockets=void 0,this.turn="white",this.castles=gt.default(),this.epSquare=void 0,this.remainingChecks=void 0,this.halfmoves=0,this.fullmoves=1}setupUnchecked(e){this.board=e.board.clone(),this.board.promoted=A.empty(),this.pockets=void 0,this.turn=e.turn,this.castles=gt.fromSetup(e),this.epSquare=Vu(this,e.epSquare),this.remainingChecks=void 0,this.halfmoves=e.halfmoves,this.fullmoves=e.fullmoves}kingAttackers(e,r,n){return Gu(e,r,this.board,n)}playCaptureAt(e,r){this.halfmoves=0,r.role==="rook"&&this.castles.discardRook(e),this.pockets&&this.pockets[_e(r.color)][r.promoted?"pawn":r.role]++}ctx(){const e=this.isVariantEnd(),r=this.board.kingOf(this.turn);if(!j(r))return{king:r,blockers:A.empty(),checkers:A.empty(),variantEnd:e,mustCapture:!1};const n=kr(r,A.empty()).intersect(this.board.rooksAndQueens()).union(vr(r,A.empty()).intersect(this.board.bishopsAndQueens())).intersect(this.board[_e(this.turn)]);let o=A.empty();for(const c of n){const f=yr(r,c).intersect(this.board.occupied);f.moreThanOne()||(o=o.union(f))}const a=this.kingAttackers(r,_e(this.turn),this.board.occupied);return{king:r,blockers:o,checkers:a,variantEnd:e,mustCapture:!1}}clone(){var e,r;const n=new this.constructor;return n.board=this.board.clone(),n.pockets=(e=this.pockets)===null||e===void 0?void 0:e.clone(),n.turn=this.turn,n.castles=this.castles.clone(),n.epSquare=this.epSquare,n.remainingChecks=(r=this.remainingChecks)===null||r===void 0?void 0:r.clone(),n.halfmoves=this.halfmoves,n.fullmoves=this.fullmoves,n}validate(){if(this.board.occupied.isEmpty())return H.err(new Bt(nt.Empty));if(this.board.king.size()!==2)return H.err(new Bt(nt.Kings));if(!j(this.board.kingOf(this.turn)))return H.err(new Bt(nt.Kings));const e=this.board.kingOf(_e(this.turn));return j(e)?this.kingAttackers(e,this.turn,this.board.occupied).nonEmpty()?H.err(new Bt(nt.OppositeCheck)):A.backranks().intersects(this.board.pawn)?H.err(new Bt(nt.PawnsOnBackrank)):H.ok(void 0):H.err(new Bt(nt.Kings))}dropDests(e){return A.empty()}dests(e,r){if(r=r||this.ctx(),r.variantEnd)return A.empty();const n=this.board.get(e);if(!n||n.color!==this.turn)return A.empty();let o,a;if(n.role==="pawn"){o=nn(this.turn,e).intersect(this.board[_e(this.turn)]);const c=this.turn==="white"?8:-8,f=e+c;if(0<=f&&f<64&&!this.board.occupied.has(f)){o=o.with(f);const d=this.turn==="white"?e<16:e>=48,p=f+c;d&&!this.board.occupied.has(p)&&(o=o.with(p))}j(this.epSquare)&&Qu(this,e,r)&&(a=A.fromSquare(this.epSquare))}else n.role==="bishop"?o=vr(e,this.board.occupied):n.role==="knight"?o=Ni(e):n.role==="rook"?o=kr(e,this.board.occupied):n.role==="queen"?o=xs(e,this.board.occupied):o=Oi(e);if(o=o.diff(this.board[this.turn]),j(r.king)){if(n.role==="king"){const c=this.board.occupied.without(e);for(const f of o)this.kingAttackers(f,_e(this.turn),c).nonEmpty()&&(o=o.without(f));return o.union(No(this,"a",r)).union(No(this,"h",r))}if(r.checkers.nonEmpty()){const c=r.checkers.singleSquare();if(!j(c))return A.empty();o=o.intersect(yr(c,r.king).with(c))}r.blockers.has(e)&&(o=o.intersect($s(e,r.king)))}return a&&(o=o.union(a)),o}isVariantEnd(){return!1}variantOutcome(e){}hasInsufficientMaterial(e){return this.board[e].intersect(this.board.pawn.union(this.board.rooksAndQueens())).nonEmpty()?!1:this.board[e].intersects(this.board.knight)?this.board[e].size()<=2&&this.board[_e(e)].diff(this.board.king).diff(this.board.queen).isEmpty():this.board[e].intersects(this.board.bishop)?(!this.board.bishop.intersects(A.darkSquares())||!this.board.bishop.intersects(A.lightSquares()))&&this.board.pawn.isEmpty()&&this.board.knight.isEmpty():!0}toSetup(){var e,r;return{board:this.board.clone(),pockets:(e=this.pockets)===null||e===void 0?void 0:e.clone(),turn:this.turn,castlingRights:this.castles.castlingRights,epSquare:Yu(this),remainingChecks:(r=this.remainingChecks)===null||r===void 0?void 0:r.clone(),halfmoves:Math.min(this.halfmoves,150),fullmoves:Math.min(Math.max(this.fullmoves,1),9999)}}isInsufficientMaterial(){return vt.every(e=>this.hasInsufficientMaterial(e))}hasDests(e){e=e||this.ctx();for(const r of this.board[this.turn])if(this.dests(r,e).nonEmpty())return!0;return this.dropDests(e).nonEmpty()}isLegal(e,r){if(Yr(e))return!this.pockets||this.pockets[this.turn][e.role]<=0||e.role==="pawn"&&A.backranks().has(e.to)?!1:this.dropDests(r).has(e.to);{if(e.promotion==="pawn"||e.promotion==="king"&&this.rules!=="antichess"||!!e.promotion!==(this.board.pawn.has(e.from)&&A.backranks().has(e.to)))return!1;const n=this.dests(e.from,r);return n.has(e.to)||n.has(Xu(this,e).to)}}isCheck(){const e=this.board.kingOf(this.turn);return j(e)&&this.kingAttackers(e,_e(this.turn),this.board.occupied).nonEmpty()}isEnd(e){return(e?e.variantEnd:this.isVariantEnd())?!0:this.isInsufficientMaterial()||!this.hasDests(e)}isCheckmate(e){return e=e||this.ctx(),!e.variantEnd&&e.checkers.nonEmpty()&&!this.hasDests(e)}isStalemate(e){return e=e||this.ctx(),!e.variantEnd&&e.checkers.isEmpty()&&!this.hasDests(e)}outcome(e){const r=this.variantOutcome(e);return r||(e=e||this.ctx(),this.isCheckmate(e)?{winner:_e(this.turn)}:this.isInsufficientMaterial()||this.isStalemate(e)?{winner:void 0}:void 0)}allDests(e){e=e||this.ctx();const r=new Map;if(e.variantEnd)return r;for(const n of this.board[this.turn])r.set(n,this.dests(n,e));return r}play(e){const r=this.turn,n=this.epSquare,o=Ds(this,e);if(this.epSquare=void 0,this.halfmoves+=1,r==="black"&&(this.fullmoves+=1),this.turn=_e(r),Yr(e))this.board.set(e.to,{role:e.role,color:r}),this.pockets&&this.pockets[r][e.role]--,e.role==="pawn"&&(this.halfmoves=0);else{const a=this.board.take(e.from);if(!a)return;let c;if(a.role==="pawn"){this.halfmoves=0,e.to===n&&(c=this.board.take(e.to+(r==="white"?-8:8)));const f=e.from-e.to;Math.abs(f)===16&&8<=e.from&&e.from<=55&&(this.epSquare=e.from+e.to>>1),e.promotion&&(a.role=e.promotion,a.promoted=!!this.pockets)}else if(a.role==="rook")this.castles.discardRook(e.from);else if(a.role==="king"){if(o){const f=this.castles.rook[r][o];if(j(f)){const d=this.board.take(f);this.board.set(Ri(r,o),a),d&&this.board.set(Mi(r,o),d)}}this.castles.discardColor(r)}if(!o){const f=this.board.set(e.to,a)||c;f&&this.playCaptureAt(e.to,f)}}this.remainingChecks&&this.isCheck()&&(this.remainingChecks[r]=Math.max(this.remainingChecks[r]-1,0))}}class ni extends qu{constructor(){super("chess")}static default(){const e=new this;return e.reset(),e}static fromSetup(e){const r=new this;return r.setupUnchecked(e),r.validate().map(n=>r)}clone(){return super.clone()}}const Vu=(t,e)=>{if(!j(e))return;const r=t.turn==="white"?5:2,n=t.turn==="white"?8:-8;if(kt(e)!==r||t.board.occupied.has(e+n))return;const o=e-n;if(!(!t.board.pawn.has(o)||!t.board[_e(t.turn)].has(o)))return e},Yu=t=>{if(!j(t.epSquare))return;const e=t.ctx(),n=t.board.pieces(t.turn,"pawn").intersect(nn(_e(t.turn),t.epSquare));for(const o of n)if(t.dests(o,e).has(t.epSquare))return t.epSquare},Qu=(t,e,r)=>{if(!j(t.epSquare)||!nn(t.turn,e).has(t.epSquare))return!1;if(!j(r.king))return!0;const n=t.turn==="white"?8:-8,o=t.epSquare-n;return t.kingAttackers(r.king,_e(t.turn),t.board.occupied.toggle(e).toggle(o).with(t.epSquare)).without(o).isEmpty()},No=(t,e,r)=>{if(!j(r.king)||r.checkers.nonEmpty())return A.empty();const n=t.castles.rook[t.turn][e];if(!j(n)||t.castles.path[t.turn][e].intersects(t.board.occupied))return A.empty();const o=Ri(t.turn,e),a=yr(r.king,o),c=t.board.occupied.without(r.king);for(const p of a)if(t.kingAttackers(p,_e(t.turn),c).nonEmpty())return A.empty();const f=Mi(t.turn,e),d=t.board.occupied.toggle(r.king).toggle(n).toggle(f);return t.kingAttackers(o,_e(t.turn),d).nonEmpty()?A.empty():A.fromSquare(n)},Ds=(t,e)=>{if(Yr(e))return;const r=e.to-e.from;if(!(Math.abs(r)!==2&&!t.board[t.turn].has(e.to))&&t.board.king.has(e.from))return r>0?"h":"a"},Xu=(t,e)=>{const r=Ds(t,e);if(!r)return e;const n=t.castles.rook[t.turn][r];return{from:e.from,to:j(n)?n:e.to}},Ju=(t,e)=>{const r=new Map,n=t.ctx();for(const[o,a]of t.allDests(n))if(a.nonEmpty()){const c=Array.from(a,br);o===n.king&&Me(o)===4&&(a.has(0)?c.push("c1"):a.has(56)&&c.push("c8"),a.has(7)?c.push("g1"):a.has(63)&&c.push("g8")),r.set(br(o),c)}return r},Zu=(t,e)=>{let r="";if(Yr(e))e.role!=="pawn"&&(r=fr(e.role).toUpperCase()),r+="@"+br(e.to);else{const n=t.board.getRole(e.from);if(!n)return"--";if(n==="king"&&(t.board[t.turn].has(e.to)||Math.abs(e.to-e.from)===2))r=e.to>e.from?"O-O":"O-O-O";else{const o=t.board.occupied.has(e.to)||n==="pawn"&&Me(e.from)!==Me(e.to);if(n!=="pawn"){r=fr(n).toUpperCase();let a;if(n==="king"?a=Oi(e.to).intersect(t.board.king):n==="queen"?a=xs(e.to,t.board.occupied).intersect(t.board.queen):n==="rook"?a=kr(e.to,t.board.occupied).intersect(t.board.rook):n==="bishop"?a=vr(e.to,t.board.occupied).intersect(t.board.bishop):a=Ni(e.to).intersect(t.board.knight),a=a.intersect(t.board[t.turn]).without(e.from),a.nonEmpty()){const c=t.ctx();for(const f of a)t.dests(f,c).has(e.to)||(a=a.without(f));if(a.nonEmpty()){let f=!1,d=a.intersects(A.fromRank(kt(e.from)));a.intersects(A.fromFile(Me(e.from)))?f=!0:d=!0,d&&(r+=Vr[Me(e.from)]),f&&(r+=Rs[kt(e.from)])}}}else o&&(r=Vr[Me(e.from)]);o&&(r+="x"),r+=br(e.to),e.promotion&&(r+="="+fr(e.promotion).toUpperCase())}}return r},ef=(t,e)=>{var r;const n=Zu(t,e);return t.play(e),!((r=t.outcome())===null||r===void 0)&&r.winner?n+"#":t.isCheck()?n+"+":n},tf=(t,e)=>ef(t.clone(),e);function rf(t,e){let r=Xn(t).unwrap(),n=ni.fromSetup(r).unwrap(),o=Ms(e);return n.play(o),Fs(n.toSetup())}const Jr=class Jr{constructor(){$(this,"_add_uci");$(this,"_promotion");$(this,"_position");$(this,"m_fen");$(this,"m_dests");$(this,"m_color");$(this,"_last_move");$(this,"_on_wheel");$(this,"set_on_wheel",e=>{this._on_wheel[1](e)});$(this,"on_play_uci",e=>{let r=rf(this.fen,e);this.on_set_fen_uci(r,e)});$(this,"on_set_fen_uci",(e,r)=>{$r(()=>{this.add_uci=void 0,this.last_move=r,this.position=ni.fromSetup(Xn(e).unwrap()).unwrap()})});$(this,"reset_move_after",()=>{this.position=this.position});$(this,"on_move_after",(e,r)=>{let n=this.position.board.get(hr(e)),o=e+r;n.role==="pawn"&&(r[1]==="8"&&this.turnColor==="white"||r[1]==="1"&&this.turnColor==="black")&&(o+="q");let a=Ms(o),c=tf(this.position,a);this.position.play(a),$r(()=>{this.last_move=o,this.position=this.position,o.length===5&&(this.promotion=r),this.add_uci=[o,c]})});this._on_wheel=ge(void 0,{equals:!1}),this._last_move=ge(void 0,{equals:!1}),this._add_uci=ge(void 0,{equals:!1}),this._promotion=ge(void 0,{equals:!1}),this._position=ge(ni.fromSetup(Xn(Os).unwrap()).unwrap(),{equals:!1}),this.m_dests=ke(()=>Ju(this.position)),this.m_fen=ke(()=>Fs(this.position.toSetup())),this.m_color=ke(()=>this.position.turn)}get position(){return this._position[0]()}set position(e){this._position[1](e)}get turnColor(){return this.m_color()}get promotion(){return this._promotion[0]()}set promotion(e){this._promotion[1](e)}get add_uci(){return this._add_uci[0]()}set add_uci(e){this._add_uci[1](e)}get last_move(){return this._last_move[0]()}set last_move(e){this._last_move[1](e)}get on_wheel(){return this._on_wheel[0]()}get fen_uci(){let e=this.fen,r=this.last_move;return[e,r]}get fen(){return this.m_fen()}get dests(){return this.m_dests()}};$(Jr,"init",()=>new Jr);let ii=Jr;function nf(t){let e=0;return r=>{e+=r.deltaY*(r.deltaMode?40:1),Math.abs(e)>=4?(t(r,!0),e=0):t(r,!1)}}function of(t){return new Worker(""+new URL("worker2-IjAXR_Lv.js",import.meta.url).href,{type:"module",name:t==null?void 0:t.name})}const on=qa(),sf=t=>{let e=new of;const[r,n]=ge(),[o,a]=ge(),[c,f]=ge();e.onmessage=k=>{switch(k.data==="ready"&&(d=!0,g()),k.data.t){case"progress":n(k.data.d);break;case"puzzles":let{all:F,filtered:T}=k.data.d;$r(()=>{f(F),a(T)});break}};let d=!1,p,w=[];function g(){d&&e.postMessage({t:"filter",d:{filter:p,rules:w}})}let E={get progress(){return r()},get puzzles(){return o()},get all(){return c()},filter:k=>{p=k,g()},rules:k=>{w=k,g()}};return Ee(on.Provider,{value:E,get children(){return[" ",ke(()=>t.children)," "]}})};function af(t,e,r=!1){let n,o=0;return function(...a){const c=this;n&&clearTimeout(n),n=void 0;const f=performance.now()-o;o=performance.now(),r&&f>e?t.apply(c,a):n=setTimeout(()=>{n=void 0,t.apply(c,a)},e)}}var lf=De("<div class=header>"),cf=De("<div class=app-wrap><div class=board-wrap><div class=board></div><div class=tree></div></div><div class=editor-wrap></div><div class=puzzles-wrap>"),uf=De("<div>"),ff=De("<div class=progress> <!>/<!> "),hf=De('<div class=puzzles><div class=filter><input type=text placeholder="Filter y_filter _!_ n_filter"><span>/10000 Positions</span></div><div class=list></div><div class=info><button>Toggle Solved</button><button>Toggle Id</button><button>Toggle Failed'),df=De("<div><span class=id><a target=_blank></a></span><span class=has-tags></span><span class=tags>"),Fo=De("<span class=tag>"),pf=De("<div class=rule-list><div class=scroll-wrap></div><div class=tools><div class=rule>+ New rule</div><div class=rule>- Delete rule"),mf=De("<div class=text-wrap><textarea class=editor-input title=rules rows=13 cols=21></textarea><div class=ascii><textarea>"),gf=De("<div><span class=name></span><span class=stats>f <!> / s "),wf=De("<span>");function bf(){return Ee(sf,{get children(){return Ee(vf,{})}})}function vf(){const[t,e]=ge(void 0),[r,n]=ge(0),o=ke(()=>{let f=t();return f?f.sans:[]});Ve(()=>{let f=t(),d=r();f?a.on_set_fen_uci(f.move_fens[d+1]):a.on_set_fen_uci(Os)}),Ve(Cn(t,()=>{n(-1)}));const a=new ii,c=nf((f,d)=>{if(!d)return;const p=f.target;if(p.tagName!=="PIECE"&&p.tagName!=="SQUARE"&&p.tagName!=="CG-BOARD")return;f.preventDefault();let w=Math.sign(f.deltaY),g=t();w>0?g&&n(Math.min(g.move_fens.length-2,r()+1)):n(Math.max(-1,r()-1))});return[lf(),(()=>{var f=cf(),d=f.firstChild,p=d.firstChild,w=p.nextSibling,g=d.nextSibling,S=g.nextSibling;return al(p,"wheel",c),ae(p,Ee(jc,{onShapes:()=>{},movable:!0,get doPromotion(){return a.promotion},get onMoveAfter(){return a.on_move_after},get fen_uci(){return a.fen_uci},get color(){return a.turnColor},get dests(){return a.dests}})),ae(w,Ee(ur,{get each(){return o()},children:(_,E)=>(()=>{var k=uf();return k.$$click=()=>n(E),ae(k,_),Xe(()=>li(k,"san"+(r()===E()?" active":""))),k})()})),ae(g,Ee(_f,{get fen(){return a.fen_uci[0]}})),ae(S,Ee(yf,{on_selected_puzzle:e})),ae(f,Ee(kf,{}),null),f})()]}const kf=()=>{const t=oi(on);return Ee(ai,{get when(){return t.progress},children:e=>(()=>{var r=ff(),n=r.firstChild,o=n.nextSibling,a=o.nextSibling,c=a.nextSibling;return c.nextSibling,ae(r,()=>e()[0],o),ae(r,()=>e()[1],c),r})()})},Zr=class Zr{constructor(e){this.puzzle=e}get id(){return this.puzzle.id}get fen(){return this.puzzle.fen}get tags(){return this.puzzle.tags}get has_tags(){return Ps(this.puzzle)}get all_tags(){return Pu(this.puzzle)}};$(Zr,"create",e=>new Zr(e));let Xr=Zr;const yf=t=>{let e=oi(on);const r=ke(si(()=>e.puzzles,Xr.create)),[n,o]=Bn(void 0,"filter"),[a,c]=Bn(void 0,"id_selected"),f=ke(()=>r().find(k=>k.id===a()));let d=n();const p=()=>{let k=n();if(!k)return;let F=f();F&&(d?(o(d),d=void 0):(d=k,o(`id_${F.id} `)))},w=()=>{let k=n();k&&(k.includes("solved")?k=k.replace("solved",""):k=k.trim()+" solved",o(k))};let g=n();const S=()=>{let k=n();k&&(k.includes("failed")?(k=g,g=void 0):(g=k,k="failed"),o(k))};Ve(Cn(f,k=>{var F;k?t.on_selected_puzzle(k.puzzle):(r()[0]&&c((F=r()[0])==null?void 0:F.id),t.on_selected_puzzle(void 0))})),Ve(Cn(n,k=>{e.filter(k)}));let _;const E=af(k=>{o(k)},1100);return(()=>{var k=hf(),F=k.firstChild,T=F.firstChild,M=T.nextSibling,P=M.firstChild,N=F.nextSibling,O=N.nextSibling,G=O.firstChild,I=G.nextSibling,L=I.nextSibling;return zo(B=>_=B,T),T.$$input=()=>E(_.value),no(T,"spellcheck",!1),ae(M,()=>r().length,P),ae(N,Ee(ai,{get when(){return r()},children:B=>Ee(ur,{get each(){return B().slice(0,1e3)},children:D=>(()=>{var C=df(),X=C.firstChild,He=X.firstChild,Et=X.nextSibling,ie=Et.nextSibling;return C.$$click=()=>c(D.id),ae(He,()=>D.id),ae(Et,Ee(ur,{get each(){return Object.keys(D.has_tags).filter(K=>!K.includes("id_"))},children:K=>(()=>{var Oe=Fo();return ae(Oe,K),Oe})()})),ae(ie,Ee(ur,{get each(){return Object.keys(D.all_tags)},children:K=>(()=>{var Oe=Fo();return ae(Oe,K),Oe})()})),Xe(K=>{var Oe="puzzle"+(D.id===a()?" active":""),St=`https://lichess.org/training/${D.id}`;return Oe!==K.e&&li(C,K.e=Oe),St!==K.t&&no(He,"href",K.t=St),K},{e:void 0,t:void 0}),C})()})})),G.$$click=w,I.$$click=p,L.$$click=S,Xe(()=>T.value=n()),k})()};function _f(t){let e=oi(on);const r=ke(si(()=>e.all,Xr.create)),n=T=>r().filter(M=>M.all_tags[`failed_${T}`]).length,o=T=>r().filter(M=>M.all_tags[`solved_${T}`]).length;function a(){let T=1,M=`rule${T}`,P=c();for(;P.find(N=>N.name===M);)M=`rule${T++}`;return{name:M,rule:"",z:P.length}}const[c,f]=Bn([{name:"rule1",rule:"",z:0}],"rule-list"),[d,p]=ge(0);e.rules(c());const w=ke(()=>c()[d()]),g=T=>{if(T.key==="Escape"){let M=T.target.value,P=w(),N={name:P.name,rule:M,z:P.z},O=c(),G=O.findIndex(I=>I.name===P.name);O.splice(G,1,N),f([...O]),e.rules([N])}},S=()=>{$r(()=>{f([a(),...c()]),p(0)})},_=()=>{let T=c();if(T.length===1)return;let M=T.splice(d(),1);f([...T]),e.rules(M.map(P=>({name:P.name,rule:"",z:-1})))};let[E]=Wa(()=>Ti.make(()=>cl)),k=ke(()=>{let T=E(),M=w().rule;if(t.fen&&T)try{return _u(t.fen,M,T)}catch(P){return"Error"+P}});const F=ke(()=>{let T=w();if(!T||!t.fen)return;let M=E();if(!M)return;let P=_i.fromSetup(yi(t.fen).unwrap()).unwrap();return Cs(Ss(t.fen,T.rule,M),P)});return[(()=>{var T=pf(),M=T.firstChild,P=M.nextSibling,N=P.firstChild,O=N.nextSibling;return ae(M,Ee(ur,{get each(){return c()},children:(G,I)=>(()=>{var L=gf(),B=L.firstChild,D=B.nextSibling,C=D.firstChild,X=C.nextSibling;return X.nextSibling,L.$$click=()=>p(I()),ae(B,()=>G.name),ae(D,()=>n(G.name),X),ae(D,()=>o(G.name),null),Xe(()=>li(L,"rule"+(I()===d()?" active":""))),L})()})),N.$$click=S,O.$$click=_,T})(),(()=>{var T=mf(),M=T.firstChild,P=M.nextSibling,N=P.firstChild;return M.$$keydown=g,N.disabled=!0,ae(N,F),ae(P,Ee(ai,{get when(){return k()},children:O=>(()=>{var G=wf();return ae(G,O),G})()}),null),Xe(()=>{var O;return M.value=((O=w())==null?void 0:O.rule)??"Select a rule"}),T})()]}sl(["click","input","keydown"]);const Ef=document.getElementById("root");ol(()=>Ee(bf,{}),Ef);const Sf=Object.freeze(Object.defineProperty({__proto__:null},Symbol.toStringTag,{value:"Module"}));
