var Ba=Object.defineProperty;var za=(t,e,r)=>e in t?Ba(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r;var $=(t,e,r)=>za(t,typeof e!="symbol"?e+"":e,r);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))n(o);new MutationObserver(o=>{for(const s of o)if(s.type==="childList")for(const c of s.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&n(c)}).observe(document,{childList:!0,subtree:!0});function r(o){const s={};return o.integrity&&(s.integrity=o.integrity),o.referrerPolicy&&(s.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?s.credentials="include":o.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function n(o){if(o.ep)return;o.ep=!0;const s=r(o);fetch(o.href,s)}})();const te={context:void 0,registry:void 0,effects:void 0,done:!1,getContextId(){return to(this.context.count)},getNextContextId(){return to(this.context.count++)}};function to(t){const e=String(t),r=e.length-1;return te.context.id+(r?String.fromCharCode(96+r):"")+e}function ja(t){te.context=t}const Ka=(t,e)=>t===e,Wa=Symbol("solid-proxy"),Ha=Symbol("solid-track"),$r={equals:Ka};let Do=Bo;const et=1,xr=2,Lo={owned:null,cleanups:null,context:null,owner:null},pn={};var ae=null;let mn=null,Ga=null,fe=null,Se=null,Je=null,en=0;function Or(t,e){const r=fe,n=ae,o=t.length===0,s=e===void 0?n:e,c=o?Lo:{owned:null,cleanups:null,context:s?s.context:null,owner:s},f=o?t:()=>t(()=>Ce(()=>mr(c)));ae=c,fe=null;try{return st(f,!0)}finally{fe=r,ae=n}}function ge(t,e){e=e?Object.assign({},$r,e):$r;const r={value:t,observers:null,observerSlots:null,comparator:e.equals||void 0},n=o=>(typeof o=="function"&&(o=o(r.value)),Uo(r,o));return[Io.bind(r),n]}function ro(t,e,r){const n=tn(t,e,!0,et);Jt(n)}function Ze(t,e,r){const n=tn(t,e,!1,et);Jt(n)}function Qe(t,e,r){Do=rl;const n=tn(t,e,!1,et);n.user=!0,Je?Je.push(n):Jt(n)}function ve(t,e,r){r=r?Object.assign({},$r,r):$r;const n=tn(t,e,!0,0);return n.observers=null,n.observerSlots=null,n.comparator=r.equals||void 0,Jt(n),Io.bind(n)}function qa(t){return t&&typeof t=="object"&&"then"in t}function Va(t,e,r){let n,o,s;arguments.length===2&&typeof e=="object"||arguments.length===1?(n=!0,o=t,s={}):(n=t,o=e,s={});let c=null,f=pn,d=null,p=!1,w="initialValue"in s,g=typeof n=="function"&&ve(n);const _=new Set,[S,C]=(s.storage||ge)(s.initialValue),[v,B]=ge(void 0),[P,R]=ge(void 0,{equals:!1}),[I,O]=ge(w?"ready":"unresolved");te.context&&(d=te.getNextContextId(),s.ssrLoadFrom==="initial"?f=s.initialValue:te.load&&te.has(d)&&(f=te.load(d)));function T(L,F,E,q){return c===L&&(c=null,q!==void 0&&(w=!0),(L===f||F===f)&&s.onHydrated&&queueMicrotask(()=>s.onHydrated(q,{value:F})),f=pn,x(F,E)),F}function x(L,F){st(()=>{F===void 0&&C(()=>L),O(F!==void 0?"errored":w?"ready":"unresolved"),B(F);for(const E of _.keys())E.decrement();_.clear()},!1)}function U(){const L=Za,F=S(),E=v();if(E!==void 0&&!c)throw E;return fe&&!fe.user&&L&&ro(()=>{P(),c&&(L.resolved||_.has(L)||(L.increment(),_.add(L)))}),F}function D(L=!0){if(L!==!1&&p)return;p=!1;const F=g?g():n;if(F==null||F===!1){T(c,Ce(S));return}const E=f!==pn?f:Ce(()=>o(F,{value:S(),refetching:L}));return qa(E)?(c=E,"value"in E?(E.status==="success"?T(c,E.value,void 0,F):T(c,void 0,Pn(E.value),F),E):(p=!0,queueMicrotask(()=>p=!1),st(()=>{O(w?"refreshing":"pending"),R()},!1),E.then(q=>T(E,q,void 0,F),q=>T(E,void 0,Pn(q),F)))):(T(c,E,void 0,F),E)}return Object.defineProperties(U,{state:{get:()=>I()},error:{get:()=>v()},loading:{get(){const L=I();return L==="pending"||L==="refreshing"}},latest:{get(){if(!w)return U();const L=v();if(L&&!c)throw L;return S()}}}),g?ro(()=>D(!1)):D(!1),[U,{refetch:D,mutate:C}]}function pr(t){return st(t,!1)}function Ce(t){if(fe===null)return t();const e=fe;fe=null;try{return t()}finally{fe=e}}function Cn(t,e,r){const n=Array.isArray(t);let o;return s=>{let c;if(n){c=Array(t.length);for(let d=0;d<t.length;d++)c[d]=t[d]()}else c=t();const f=Ce(()=>e(c,o,s));return o=c,f}}function Ya(t){Qe(()=>Ce(t))}function Qa(t){return ae===null||(ae.cleanups===null?ae.cleanups=[t]:ae.cleanups.push(t)),t}function Xa(t,e){const r=Symbol("context");return{id:r,Provider:nl(r),defaultValue:t}}function ai(t){let e;return ae&&ae.context&&(e=ae.context[t.id])!==void 0?e:t.defaultValue}function Ja(t){const e=ve(t),r=ve(()=>Tn(e()));return r.toArray=()=>{const n=r();return Array.isArray(n)?n:n!=null?[n]:[]},r}let Za;function Io(){if(this.sources&&this.state)if(this.state===et)Jt(this);else{const t=Se;Se=null,st(()=>Lr(this),!1),Se=t}if(fe){const t=this.observers?this.observers.length:0;fe.sources?(fe.sources.push(this),fe.sourceSlots.push(t)):(fe.sources=[this],fe.sourceSlots=[t]),this.observers?(this.observers.push(fe),this.observerSlots.push(fe.sources.length-1)):(this.observers=[fe],this.observerSlots=[fe.sources.length-1])}return this.value}function Uo(t,e,r){let n=t.value;return(!t.comparator||!t.comparator(n,e))&&(t.value=e,t.observers&&t.observers.length&&st(()=>{for(let o=0;o<t.observers.length;o+=1){const s=t.observers[o],c=mn&&mn.running;c&&mn.disposed.has(s),(c?!s.tState:!s.state)&&(s.pure?Se.push(s):Je.push(s),s.observers&&zo(s)),c||(s.state=et)}if(Se.length>1e6)throw Se=[],new Error},!1)),e}function Jt(t){if(!t.fn)return;mr(t);const e=en;el(t,t.value,e)}function el(t,e,r){let n;const o=ae,s=fe;fe=ae=t;try{n=t.fn(e)}catch(c){return t.pure&&(t.state=et,t.owned&&t.owned.forEach(mr),t.owned=null),t.updatedAt=r+1,jo(c)}finally{fe=s,ae=o}(!t.updatedAt||t.updatedAt<=r)&&(t.updatedAt!=null&&"observers"in t?Uo(t,n):t.value=n,t.updatedAt=r)}function tn(t,e,r,n=et,o){const s={fn:t,state:n,updatedAt:null,owned:null,sources:null,sourceSlots:null,cleanups:null,value:e,owner:ae,context:ae?ae.context:null,pure:r};return ae===null||ae!==Lo&&(ae.owned?ae.owned.push(s):ae.owned=[s]),s}function Dr(t){if(t.state===0)return;if(t.state===xr)return Lr(t);if(t.suspense&&Ce(t.suspense.inFallback))return t.suspense.effects.push(t);const e=[t];for(;(t=t.owner)&&(!t.updatedAt||t.updatedAt<en);)t.state&&e.push(t);for(let r=e.length-1;r>=0;r--)if(t=e[r],t.state===et)Jt(t);else if(t.state===xr){const n=Se;Se=null,st(()=>Lr(t,e[0]),!1),Se=n}}function st(t,e){if(Se)return t();let r=!1;e||(Se=[]),Je?r=!0:Je=[],en++;try{const n=t();return tl(r),n}catch(n){r||(Je=null),Se=null,jo(n)}}function tl(t){if(Se&&(Bo(Se),Se=null),t)return;const e=Je;Je=null,e.length&&st(()=>Do(e),!1)}function Bo(t){for(let e=0;e<t.length;e++)Dr(t[e])}function rl(t){let e,r=0;for(e=0;e<t.length;e++){const n=t[e];n.user?t[r++]=n:Dr(n)}if(te.context){if(te.count){te.effects||(te.effects=[]),te.effects.push(...t.slice(0,r));return}ja()}for(te.effects&&(te.done||!te.count)&&(t=[...te.effects,...t],r+=te.effects.length,delete te.effects),e=0;e<r;e++)Dr(t[e])}function Lr(t,e){t.state=0;for(let r=0;r<t.sources.length;r+=1){const n=t.sources[r];if(n.sources){const o=n.state;o===et?n!==e&&(!n.updatedAt||n.updatedAt<en)&&Dr(n):o===xr&&Lr(n,e)}}}function zo(t){for(let e=0;e<t.observers.length;e+=1){const r=t.observers[e];r.state||(r.state=xr,r.pure?Se.push(r):Je.push(r),r.observers&&zo(r))}}function mr(t){let e;if(t.sources)for(;t.sources.length;){const r=t.sources.pop(),n=t.sourceSlots.pop(),o=r.observers;if(o&&o.length){const s=o.pop(),c=r.observerSlots.pop();n<o.length&&(s.sourceSlots[c]=n,o[n]=s,r.observerSlots[n]=c)}}if(t.tOwned){for(e=t.tOwned.length-1;e>=0;e--)mr(t.tOwned[e]);delete t.tOwned}if(t.owned){for(e=t.owned.length-1;e>=0;e--)mr(t.owned[e]);t.owned=null}if(t.cleanups){for(e=t.cleanups.length-1;e>=0;e--)t.cleanups[e]();t.cleanups=null}t.state=0}function Pn(t){return t instanceof Error?t:new Error(typeof t=="string"?t:"Unknown error",{cause:t})}function jo(t,e=ae){throw Pn(t)}function Tn(t){if(typeof t=="function"&&!t.length)return Tn(t());if(Array.isArray(t)){const e=[];for(let r=0;r<t.length;r++){const n=Tn(t[r]);Array.isArray(n)?e.push.apply(e,n):e.push(n)}return e}return t}function nl(t,e){return function(n){let o;return Ze(()=>o=Ce(()=>(ae.context={...ae.context,[t]:n.value},Ja(()=>n.children))),void 0),o}}const il=Symbol("fallback");function no(t){for(let e=0;e<t.length;e++)t[e]()}function li(t,e,r={}){let n=[],o=[],s=[],c=0,f=e.length>1?[]:null;return Qa(()=>no(s)),()=>{let d=t()||[],p=d.length,w,g;return d[Ha],Ce(()=>{let S,C,v,B,P,R,I,O,T;if(p===0)c!==0&&(no(s),s=[],n=[],o=[],c=0,f&&(f=[])),r.fallback&&(n=[il],o[0]=Or(x=>(s[0]=x,r.fallback())),c=1);else if(c===0){for(o=new Array(p),g=0;g<p;g++)n[g]=d[g],o[g]=Or(_);c=p}else{for(v=new Array(p),B=new Array(p),f&&(P=new Array(p)),R=0,I=Math.min(c,p);R<I&&n[R]===d[R];R++);for(I=c-1,O=p-1;I>=R&&O>=R&&n[I]===d[O];I--,O--)v[O]=o[I],B[O]=s[I],f&&(P[O]=f[I]);for(S=new Map,C=new Array(O+1),g=O;g>=R;g--)T=d[g],w=S.get(T),C[g]=w===void 0?-1:w,S.set(T,g);for(w=R;w<=I;w++)T=n[w],g=S.get(T),g!==void 0&&g!==-1?(v[g]=o[w],B[g]=s[w],f&&(P[g]=f[w]),g=C[g],S.set(T,g)):s[w]();for(g=R;g<p;g++)g in v?(o[g]=v[g],s[g]=B[g],f&&(f[g]=P[g],f[g](g))):o[g]=Or(_);o=o.slice(0,c=p),n=d.slice(0)}return o});function _(S){if(s[g]=S,f){const[C,v]=ge(g);return f[g]=v,e(d[g],C)}return e(d[g])}}}function Ee(t,e){return Ce(()=>t(e||{}))}let ol=0;function sl(){return te.context?te.getNextContextId():`cl-${ol++}`}const al=t=>`Stale read from <${t}>.`;function fr(t){const e="fallback"in t&&{fallback:()=>t.fallback};return ve(li(()=>t.each,t.children,e||void 0))}function ci(t){const e=t.keyed,r=ve(()=>t.when,void 0,{equals:(n,o)=>e?n===o:!n==!o});return ve(()=>{const n=r();if(n){const o=t.children;return typeof o=="function"&&o.length>0?Ce(()=>o(e?n:()=>{if(!Ce(r))throw al("Show");return t.when})):o}return t.fallback},void 0,void 0)}function ll(t,e,r){let n=r.length,o=e.length,s=n,c=0,f=0,d=e[o-1].nextSibling,p=null;for(;c<o||f<s;){if(e[c]===r[f]){c++,f++;continue}for(;e[o-1]===r[s-1];)o--,s--;if(o===c){const w=s<n?f?r[f-1].nextSibling:r[s-f]:d;for(;f<s;)t.insertBefore(r[f++],w)}else if(s===f)for(;c<o;)(!p||!p.has(e[c]))&&e[c].remove(),c++;else if(e[c]===r[s-1]&&r[f]===e[o-1]){const w=e[--o].nextSibling;t.insertBefore(r[f++],e[c++].nextSibling),t.insertBefore(r[--s],w),e[o]=r[s]}else{if(!p){p=new Map;let g=f;for(;g<s;)p.set(r[g],g++)}const w=p.get(e[c]);if(w!=null)if(f<w&&w<s){let g=c,_=1,S;for(;++g<o&&g<s&&!((S=p.get(e[g]))==null||S!==w+_);)_++;if(_>w-f){const C=e[c];for(;f<w;)t.insertBefore(r[f++],C)}else t.replaceChild(r[f++],e[c++])}else c++;else e[c++].remove()}}}const io="_$DX_DELEGATE";function cl(t,e,r,n={}){let o;return Or(s=>{o=s,e===document?t():le(e,t(),e.firstChild?null:void 0,r)},n.owner),()=>{o(),e.textContent=""}}function Le(t,e,r){let n;const o=()=>{const c=document.createElement("template");return c.innerHTML=t,c.content.firstChild},s=()=>(n||(n=o())).cloneNode(!0);return s.cloneNode=s,s}function ul(t,e=window.document){const r=e[io]||(e[io]=new Set);for(let n=0,o=t.length;n<o;n++){const s=t[n];r.has(s)||(r.add(s),e.addEventListener(s,hl))}}function oo(t,e,r){fi(t)||(r==null?t.removeAttribute(e):t.setAttribute(e,r))}function ui(t,e){fi(t)||(e==null?t.removeAttribute("class"):t.className=e)}function fl(t,e,r,n){if(Array.isArray(r)){const o=r[0];t.addEventListener(e,r[0]=s=>o.call(t,r[1],s))}else t.addEventListener(e,r,typeof r!="function"&&r)}function Ko(t,e,r){return Ce(()=>t(e,r))}function le(t,e,r,n){if(r!==void 0&&!n&&(n=[]),typeof e!="function")return Ir(t,e,n,r);Ze(o=>Ir(t,e(),o,r),n)}function fi(t){return!!te.context&&!te.done&&(!t||t.isConnected)}function hl(t){if(te.registry&&te.events&&te.events.find(([d,p])=>p===t))return;let e=t.target;const r=`$$${t.type}`,n=t.target,o=t.currentTarget,s=d=>Object.defineProperty(t,"target",{configurable:!0,value:d}),c=()=>{const d=e[r];if(d&&!e.disabled){const p=e[`${r}Data`];if(p!==void 0?d.call(e,p,t):d.call(e,t),t.cancelBubble)return}return e.host&&typeof e.host!="string"&&!e.host._$host&&e.contains(t.target)&&s(e.host),!0},f=()=>{for(;c()&&(e=e._$host||e.parentNode||e.host););};if(Object.defineProperty(t,"currentTarget",{configurable:!0,get(){return e||document}}),te.registry&&!te.done&&(te.done=_$HY.done=!0),t.composedPath){const d=t.composedPath();s(d[0]);for(let p=0;p<d.length-2&&(e=d[p],!!c());p++){if(e._$host){e=e._$host,f();break}if(e.parentNode===o)break}}else f();s(n)}function Ir(t,e,r,n,o){const s=fi(t);if(s){!r&&(r=[...t.childNodes]);let d=[];for(let p=0;p<r.length;p++){const w=r[p];w.nodeType===8&&w.data.slice(0,2)==="!$"?w.remove():d.push(w)}r=d}for(;typeof r=="function";)r=r();if(e===r)return r;const c=typeof e,f=n!==void 0;if(t=f&&r[0]&&r[0].parentNode||t,c==="string"||c==="number"){if(s||c==="number"&&(e=e.toString(),e===r))return r;if(f){let d=r[0];d&&d.nodeType===3?d.data!==e&&(d.data=e):d=document.createTextNode(e),r=Mt(t,r,n,d)}else r!==""&&typeof r=="string"?r=t.firstChild.data=e:r=t.textContent=e}else if(e==null||c==="boolean"){if(s)return r;r=Mt(t,r,n)}else{if(c==="function")return Ze(()=>{let d=e();for(;typeof d=="function";)d=d();r=Ir(t,d,r,n)}),()=>r;if(Array.isArray(e)){const d=[],p=r&&Array.isArray(r);if(Rn(d,e,r,o))return Ze(()=>r=Ir(t,d,r,n,!0)),()=>r;if(s){if(!d.length)return r;if(n===void 0)return r=[...t.childNodes];let w=d[0];if(w.parentNode!==t)return r;const g=[w];for(;(w=w.nextSibling)!==n;)g.push(w);return r=g}if(d.length===0){if(r=Mt(t,r,n),f)return r}else p?r.length===0?so(t,d,n):ll(t,r,d):(r&&Mt(t),so(t,d));r=d}else if(e.nodeType){if(s&&e.parentNode)return r=f?[e]:e;if(Array.isArray(r)){if(f)return r=Mt(t,r,n,e);Mt(t,r,null,e)}else r==null||r===""||!t.firstChild?t.appendChild(e):t.replaceChild(e,t.firstChild);r=e}}return r}function Rn(t,e,r,n){let o=!1;for(let s=0,c=e.length;s<c;s++){let f=e[s],d=r&&r[t.length],p;if(!(f==null||f===!0||f===!1))if((p=typeof f)=="object"&&f.nodeType)t.push(f);else if(Array.isArray(f))o=Rn(t,f,d)||o;else if(p==="function")if(n){for(;typeof f=="function";)f=f();o=Rn(t,Array.isArray(f)?f:[f],Array.isArray(d)?d:[d])||o}else t.push(f),o=!0;else{const w=String(f);d&&d.nodeType===3&&d.data===w?t.push(d):t.push(document.createTextNode(w))}}return o}function so(t,e,r=null){for(let n=0,o=e.length;n<o;n++)t.insertBefore(e[n],r)}function Mt(t,e,r,n){if(r===void 0)return t.textContent="";const o=n||document.createTextNode("");if(e.length){let s=!1;for(let c=e.length-1;c>=0;c--){const f=e[c];if(o!==f){const d=f.parentNode===t;!s&&!c?d?t.replaceChild(o,f):t.insertBefore(o,r):d&&f.remove()}else s=!0}}else t.insertBefore(o,r);return[o]}const dl=""+new URL("hopefox-LFTqDWdf.wasm",import.meta.url).href,pl=["white","black"],Ur=["a","b","c","d","e","f","g","h"],Br=["1","2","3","4","5","6","7","8"],ml=[...Br].reverse(),hi=Array.prototype.concat(...Ur.map(t=>Br.map(e=>t+e))),xe=t=>hi[8*t[0]+t[1]],ce=t=>[t.charCodeAt(0)-97,t.charCodeAt(1)-49],Wo=hi.map(ce);function gl(t){let e;const r=()=>(e===void 0&&(e=t()),e);return r.clear=()=>{e=void 0},r}const wl=()=>{let t;return{start(){t=performance.now()},cancel(){t=void 0},stop(){if(!t)return 0;const e=performance.now()-t;return t=void 0,e}}},di=t=>t==="white"?"black":"white",gr=(t,e)=>{const r=t[0]-e[0],n=t[1]-e[1];return r*r+n*n},Mn=(t,e)=>t.role===e.role&&t.color===e.color,Sr=t=>(e,r)=>[(r?e[0]:7-e[0])*t.width/8,(r?7-e[1]:e[1])*t.height/8],Ke=(t,e)=>{t.style.transform=`translate(${e[0]}px,${e[1]}px)`},Ho=(t,e,r=1)=>{t.style.transform=`translate(${e[0]}px,${e[1]}px) scale(${r})`},pi=(t,e)=>{t.style.visibility=e?"visible":"hidden"},Et=t=>{var e;if(t.clientX||t.clientX===0)return[t.clientX,t.clientY];if(!((e=t.targetTouches)===null||e===void 0)&&e[0])return[t.targetTouches[0].clientX,t.targetTouches[0].clientY]},Go=t=>t.button===2,Xe=(t,e)=>{const r=document.createElement(t);return e&&(r.className=e),r};function qo(t,e,r){const n=ce(t);return e||(n[0]=7-n[0],n[1]=7-n[1]),[r.left+r.width*n[0]/8+r.width/16,r.top+r.height*(7-n[1])/8+r.height/16]}const kt=(t,e)=>Math.abs(t-e),bl=t=>(e,r,n,o)=>kt(e,n)<2&&(t==="white"?o===r+1||r<=1&&o===r+2&&e===n:o===r-1||r>=6&&o===r-2&&e===n),Vo=(t,e,r,n)=>{const o=kt(t,r),s=kt(e,n);return o===1&&s===2||o===2&&s===1},Yo=(t,e,r,n)=>kt(t,r)===kt(e,n),Qo=(t,e,r,n)=>t===r||e===n,Xo=(t,e,r,n)=>Yo(t,e,r,n)||Qo(t,e,r,n),kl=(t,e,r)=>(n,o,s,c)=>kt(n,s)<2&&kt(o,c)<2||r&&o===c&&o===(t==="white"?0:7)&&(n===4&&(s===2&&e.includes(0)||s===6&&e.includes(7))||e.includes(s));function vl(t,e){const r=e==="white"?"1":"8",n=[];for(const[o,s]of t)o[1]===r&&s.color===e&&s.role==="rook"&&n.push(ce(o)[0]);return n}function Jo(t,e,r){const n=t.get(e);if(!n)return[];const o=ce(e),s=n.role,c=s==="pawn"?bl(n.color):s==="knight"?Vo:s==="bishop"?Yo:s==="rook"?Qo:s==="queen"?Xo:kl(n.color,vl(t,n.color),r);return Wo.filter(f=>(o[0]!==f[0]||o[1]!==f[1])&&c(o[0],o[1],f[0],f[1])).map(xe)}function Pe(t,...e){t&&setTimeout(()=>t(...e),1)}function yl(t){t.orientation=di(t.orientation),t.animation.current=t.draggable.current=t.selected=void 0}function _l(t,e){for(const[r,n]of e)n?t.pieces.set(r,n):t.pieces.delete(r)}function El(t,e){if(t.check=void 0,e===!0&&(e=t.turnColor),e)for(const[r,n]of t.pieces)n.role==="king"&&n.color===e&&(t.check=r)}function Sl(t,e,r,n){ut(t),t.premovable.current=[e,r],Pe(t.premovable.events.set,e,r,n)}function ct(t){t.premovable.current&&(t.premovable.current=void 0,Pe(t.premovable.events.unset))}function Al(t,e,r){ct(t),t.predroppable.current={role:e,key:r},Pe(t.predroppable.events.set,e,r)}function ut(t){const e=t.predroppable;e.current&&(e.current=void 0,Pe(e.events.unset))}function Cl(t,e,r){if(!t.autoCastle)return!1;const n=t.pieces.get(e);if(!n||n.role!=="king")return!1;const o=ce(e),s=ce(r);if(o[1]!==0&&o[1]!==7||o[1]!==s[1])return!1;o[0]===4&&!t.pieces.has(r)&&(s[0]===6?r=xe([7,s[1]]):s[0]===2&&(r=xe([0,s[1]])));const c=t.pieces.get(r);return!c||c.color!==n.color||c.role!=="rook"?!1:(t.pieces.delete(e),t.pieces.delete(r),o[0]<s[0]?(t.pieces.set(xe([6,s[1]]),n),t.pieces.set(xe([5,s[1]]),c)):(t.pieces.set(xe([2,s[1]]),n),t.pieces.set(xe([3,s[1]]),c)),!0)}function Zo(t,e,r){const n=t.pieces.get(e),o=t.pieces.get(r);if(e===r||!n)return!1;const s=o&&o.color!==n.color?o:void 0;return r===t.selected&&De(t),Pe(t.events.move,e,r,s),Cl(t,e,r)||(t.pieces.set(r,n),t.pieces.delete(e)),t.lastMove=[e,r],t.check=void 0,Pe(t.events.change),s||!0}function mi(t,e,r,n){if(t.pieces.has(r))if(n)t.pieces.delete(r);else return!1;return Pe(t.events.dropNewPiece,e,r),t.pieces.set(r,e),t.lastMove=[r],t.check=void 0,Pe(t.events.change),t.movable.dests=void 0,t.turnColor=di(t.turnColor),!0}function es(t,e,r){const n=Zo(t,e,r);return n&&(t.movable.dests=void 0,t.turnColor=di(t.turnColor),t.animation.current=void 0),n}function ts(t,e,r){if(gi(t,e,r)){const n=es(t,e,r);if(n){const o=t.hold.stop();De(t);const s={premove:!1,ctrlKey:t.stats.ctrlKey,holdTime:o};return n!==!0&&(s.captured=n),Pe(t.movable.events.after,e,r,s),!0}}else if(Tl(t,e,r))return Sl(t,e,r,{ctrlKey:t.stats.ctrlKey}),De(t),!0;return De(t),!1}function rs(t,e,r,n){const o=t.pieces.get(e);o&&(Pl(t,e,r)||n)?(t.pieces.delete(e),mi(t,o,r,n),Pe(t.movable.events.afterNewPiece,o.role,r,{premove:!1,predrop:!1})):o&&Rl(t,e,r)?Al(t,o.role,r):(ct(t),ut(t)),t.pieces.delete(e),De(t)}function On(t,e,r){if(Pe(t.events.select,e),t.selected){if(t.selected===e&&!t.draggable.enabled){De(t),t.hold.cancel();return}else if((t.selectable.enabled||r)&&t.selected!==e&&ts(t,t.selected,e)){t.stats.dragged=!1;return}}(t.selectable.enabled||t.draggable.enabled)&&(is(t,e)||wi(t,e))&&(ns(t,e),t.hold.start())}function ns(t,e){t.selected=e,wi(t,e)?t.premovable.customDests||(t.premovable.dests=Jo(t.pieces,e,t.premovable.castle)):t.premovable.dests=void 0}function De(t){t.selected=void 0,t.premovable.dests=void 0,t.hold.cancel()}function is(t,e){const r=t.pieces.get(e);return!!r&&(t.movable.color==="both"||t.movable.color===r.color&&t.turnColor===r.color)}const gi=(t,e,r)=>{var n,o;return e!==r&&is(t,e)&&(t.movable.free||!!(!((o=(n=t.movable.dests)===null||n===void 0?void 0:n.get(e))===null||o===void 0)&&o.includes(r)))};function Pl(t,e,r){const n=t.pieces.get(e);return!!n&&(e===r||!t.pieces.has(r))&&(t.movable.color==="both"||t.movable.color===n.color&&t.turnColor===n.color)}function wi(t,e){const r=t.pieces.get(e);return!!r&&t.premovable.enabled&&t.movable.color===r.color&&t.turnColor!==r.color}function Tl(t,e,r){var n,o;const s=(o=(n=t.premovable.customDests)===null||n===void 0?void 0:n.get(e))!==null&&o!==void 0?o:Jo(t.pieces,e,t.premovable.castle);return e!==r&&wi(t,e)&&s.includes(r)}function Rl(t,e,r){const n=t.pieces.get(e),o=t.pieces.get(r);return!!n&&(!o||o.color!==t.movable.color)&&t.predroppable.enabled&&(n.role!=="pawn"||r[1]!=="1"&&r[1]!=="8")&&t.movable.color===n.color&&t.turnColor!==n.color}function Ml(t,e){const r=t.pieces.get(e);return!!r&&t.draggable.enabled&&(t.movable.color==="both"||t.movable.color===r.color&&(t.turnColor===r.color||t.premovable.enabled))}function Ol(t){const e=t.premovable.current;if(!e)return!1;const r=e[0],n=e[1];let o=!1;if(gi(t,r,n)){const s=es(t,r,n);if(s){const c={premove:!0};s!==!0&&(c.captured=s),Pe(t.movable.events.after,r,n,c),o=!0}}return ct(t),o}function Nl(t,e){const r=t.predroppable.current;let n=!1;if(!r)return!1;if(e(r)){const o={role:r.role,color:t.movable.color};mi(t,o,r.key)&&(Pe(t.movable.events.afterNewPiece,r.role,r.key,{premove:!1,predrop:!0}),n=!0)}return ut(t),n}function bi(t){ct(t),ut(t),De(t)}function ao(t){t.movable.color=t.movable.dests=t.animation.current=void 0,bi(t)}function St(t,e,r){let n=Math.floor(8*(t[0]-r.left)/r.width);e||(n=7-n);let o=7-Math.floor(8*(t[1]-r.top)/r.height);return e||(o=7-o),n>=0&&n<8&&o>=0&&o<8?xe([n,o]):void 0}function Fl(t,e,r,n){const o=ce(t),s=Wo.filter(p=>Xo(o[0],o[1],p[0],p[1])||Vo(o[0],o[1],p[0],p[1])),f=s.map(p=>qo(xe(p),r,n)).map(p=>gr(e,p)),[,d]=f.reduce((p,w,g)=>p[0]<w?p:[w,g],[f[0],0]);return xe(s[d])}const Te=t=>t.orientation==="white",os="rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR",$l={p:"pawn",r:"rook",n:"knight",b:"bishop",q:"queen",k:"king"},xl={pawn:"p",rook:"r",knight:"n",bishop:"b",queen:"q",king:"k"};function ss(t){t==="start"&&(t=os);const e=new Map;let r=7,n=0;for(const o of t)switch(o){case" ":case"[":return e;case"/":if(--r,r<0)return e;n=0;break;case"~":{const s=e.get(xe([n-1,r]));s&&(s.promoted=!0);break}default:{const s=o.charCodeAt(0);if(s<57)n+=s-48;else{const c=o.toLowerCase();e.set(xe([n,r]),{role:$l[c],color:o===c?"black":"white"}),++n}}}return e}function Dl(t){return ml.map(e=>Ur.map(r=>{const n=t.get(r+e);if(n){let o=xl[n.role];return n.color==="white"&&(o=o.toUpperCase()),n.promoted&&(o+="~"),o}else return"1"}).join("")).join("/").replace(/1{2,}/g,e=>e.length.toString())}function as(t,e){e.animation&&(ki(t.animation,e.animation),(t.animation.duration||0)<70&&(t.animation.enabled=!1))}function ls(t,e){var r,n,o;if(!((r=e.movable)===null||r===void 0)&&r.dests&&(t.movable.dests=void 0),!((n=e.drawable)===null||n===void 0)&&n.autoShapes&&(t.drawable.autoShapes=[]),ki(t,e),e.fen&&(t.pieces=ss(e.fen),t.drawable.shapes=((o=e.drawable)===null||o===void 0?void 0:o.shapes)||[]),"check"in e&&El(t,e.check||!1),"lastMove"in e&&!e.lastMove?t.lastMove=void 0:e.lastMove&&(t.lastMove=e.lastMove),t.selected&&ns(t,t.selected),as(t,e),!t.movable.rookCastle&&t.movable.dests){const s=t.movable.color==="white"?"1":"8",c="e"+s,f=t.movable.dests.get(c),d=t.pieces.get(c);if(!f||!d||d.role!=="king")return;t.movable.dests.set(c,f.filter(p=>!(p==="a"+s&&f.includes("c"+s))&&!(p==="h"+s&&f.includes("g"+s))))}}function ki(t,e){for(const r in e)Object.prototype.hasOwnProperty.call(e,r)&&(Object.prototype.hasOwnProperty.call(t,r)&&lo(t[r])&&lo(e[r])?ki(t[r],e[r]):t[r]=e[r])}function lo(t){if(typeof t!="object"||t===null)return!1;const e=Object.getPrototypeOf(t);return e===Object.prototype||e===null}const gt=(t,e)=>e.animation.enabled?Ul(t,e):nt(t,e);function nt(t,e){const r=t(e);return e.dom.redraw(),r}const gn=(t,e)=>({key:t,pos:ce(t),piece:e}),Ll=(t,e)=>e.sort((r,n)=>gr(t.pos,r.pos)-gr(t.pos,n.pos))[0];function Il(t,e){const r=new Map,n=[],o=new Map,s=[],c=[],f=new Map;let d,p,w;for(const[g,_]of t)f.set(g,gn(g,_));for(const g of hi)d=e.pieces.get(g),p=f.get(g),d?p?Mn(d,p.piece)||(s.push(p),c.push(gn(g,d))):c.push(gn(g,d)):p&&s.push(p);for(const g of c)p=Ll(g,s.filter(_=>Mn(g.piece,_.piece))),p&&(w=[p.pos[0]-g.pos[0],p.pos[1]-g.pos[1]],r.set(g.key,w.concat(w)),n.push(p.key));for(const g of s)n.includes(g.key)||o.set(g.key,g.piece);return{anims:r,fadings:o}}function cs(t,e){const r=t.animation.current;if(r===void 0){t.dom.destroyed||t.dom.redrawNow();return}const n=1-(e-r.start)*r.frequency;if(n<=0)t.animation.current=void 0,t.dom.redrawNow();else{const o=Bl(n);for(const s of r.plan.anims.values())s[2]=s[0]*o,s[3]=s[1]*o;t.dom.redrawNow(!0),requestAnimationFrame((s=performance.now())=>cs(t,s))}}function Ul(t,e){const r=new Map(e.pieces),n=t(e),o=Il(r,e);if(o.anims.size||o.fadings.size){const s=e.animation.current&&e.animation.current.start;e.animation.current={start:performance.now(),frequency:1/e.animation.duration,plan:o},s||cs(e,performance.now())}else e.dom.redraw();return n}const Bl=t=>t<.5?4*t*t*t:(t-1)*(2*t-2)*(2*t-2)+1,zl=["green","red","blue","yellow"];function jl(t,e){if(e.touches&&e.touches.length>1)return;e.stopPropagation(),e.preventDefault(),e.ctrlKey?De(t):bi(t);const r=Et(e),n=St(r,Te(t),t.dom.bounds());n&&(t.drawable.current={orig:n,pos:r,brush:Gl(e),snapToValidMove:t.drawable.defaultSnapToValidMove},us(t))}function us(t){requestAnimationFrame(()=>{const e=t.drawable.current;if(e){const r=St(e.pos,Te(t),t.dom.bounds());r||(e.snapToValidMove=!1);const n=e.snapToValidMove?Fl(e.orig,e.pos,Te(t),t.dom.bounds()):r;n!==e.mouseSq&&(e.mouseSq=n,e.dest=n!==e.orig?n:void 0,t.dom.redrawNow()),us(t)}})}function Kl(t,e){t.drawable.current&&(t.drawable.current.pos=Et(e))}function Wl(t){const e=t.drawable.current;e&&(e.mouseSq&&ql(t.drawable,e),fs(t))}function fs(t){t.drawable.current&&(t.drawable.current=void 0,t.dom.redraw())}function Hl(t){t.drawable.shapes.length&&(t.drawable.shapes=[],t.dom.redraw(),hs(t.drawable))}function Gl(t){var e;const r=(t.shiftKey||t.ctrlKey)&&Go(t),n=t.altKey||t.metaKey||((e=t.getModifierState)===null||e===void 0?void 0:e.call(t,"AltGraph"));return zl[(r?1:0)+(n?2:0)]}function ql(t,e){const r=o=>o.orig===e.orig&&o.dest===e.dest,n=t.shapes.find(r);n&&(t.shapes=t.shapes.filter(o=>!r(o))),(!n||n.brush!==e.brush)&&t.shapes.push({orig:e.orig,dest:e.dest,brush:e.brush}),hs(t)}function hs(t){t.onChange&&t.onChange(t.shapes)}function Vl(t,e){if(!(t.trustAllEvents||e.isTrusted)||e.buttons!==void 0&&e.buttons>1||e.touches&&e.touches.length>1)return;const r=t.dom.bounds(),n=Et(e),o=St(n,Te(t),r);if(!o)return;const s=t.pieces.get(o),c=t.selected;if(!c&&t.drawable.enabled&&(t.drawable.eraseOnClick||!s||s.color!==t.turnColor)&&Hl(t),e.cancelable!==!1&&(!e.touches||t.blockTouchScroll||s||c||Yl(t,n)))e.preventDefault();else if(e.touches)return;const f=!!t.premovable.current,d=!!t.predroppable.current;t.stats.ctrlKey=e.ctrlKey,t.selected&&gi(t,t.selected,o)?gt(g=>On(g,o),t):On(t,o);const p=t.selected===o,w=ps(t,o);if(s&&w&&p&&Ml(t,o)){t.draggable.current={orig:o,piece:s,origPos:n,pos:n,started:t.draggable.autoDistance&&t.stats.dragged,element:w,previouslySelected:c,originTarget:e.target,keyHasChanged:!1},w.cgDragging=!0,w.classList.add("dragging");const g=t.dom.elements.ghost;g&&(g.className=`ghost ${s.color} ${s.role}`,Ke(g,Sr(r)(ce(o),Te(t))),pi(g,!0)),vi(t)}else f&&ct(t),d&&ut(t);t.dom.redraw()}function Yl(t,e){const r=Te(t),n=t.dom.bounds(),o=Math.pow(n.width/8,2);for(const s of t.pieces.keys()){const c=qo(s,r,n);if(gr(c,e)<=o)return!0}return!1}function Ql(t,e,r,n){const o="a0";t.pieces.set(o,e),t.dom.redraw();const s=Et(r);t.draggable.current={orig:o,piece:e,origPos:s,pos:s,started:!0,element:()=>ps(t,o),originTarget:r.target,newPiece:!0,force:!!n,keyHasChanged:!1},vi(t)}function vi(t){requestAnimationFrame(()=>{var e;const r=t.draggable.current;if(!r)return;!((e=t.animation.current)===null||e===void 0)&&e.plan.anims.has(r.orig)&&(t.animation.current=void 0);const n=t.pieces.get(r.orig);if(!n||!Mn(n,r.piece))zr(t);else if(!r.started&&gr(r.pos,r.origPos)>=Math.pow(t.draggable.distance,2)&&(r.started=!0),r.started){if(typeof r.element=="function"){const s=r.element();if(!s)return;s.cgDragging=!0,s.classList.add("dragging"),r.element=s}const o=t.dom.bounds();Ke(r.element,[r.pos[0]-o.left-o.width/16,r.pos[1]-o.top-o.height/16]),r.keyHasChanged||(r.keyHasChanged=r.orig!==St(r.pos,Te(t),o))}vi(t)})}function Xl(t,e){t.draggable.current&&(!e.touches||e.touches.length<2)&&(t.draggable.current.pos=Et(e))}function Jl(t,e){const r=t.draggable.current;if(!r)return;if(e.type==="touchend"&&e.cancelable!==!1&&e.preventDefault(),e.type==="touchend"&&r.originTarget!==e.target&&!r.newPiece){t.draggable.current=void 0;return}ct(t),ut(t);const n=Et(e)||r.pos,o=St(n,Te(t),t.dom.bounds());o&&r.started&&r.orig!==o?r.newPiece?rs(t,r.orig,o,r.force):(t.stats.ctrlKey=e.ctrlKey,ts(t,r.orig,o)&&(t.stats.dragged=!0)):r.newPiece?t.pieces.delete(r.orig):t.draggable.deleteOnDropOff&&!o&&(t.pieces.delete(r.orig),Pe(t.events.change)),(r.orig===r.previouslySelected||r.keyHasChanged)&&(r.orig===o||!o)?De(t):t.selectable.enabled||De(t),ds(t),t.draggable.current=void 0,t.dom.redraw()}function zr(t){const e=t.draggable.current;e&&(e.newPiece&&t.pieces.delete(e.orig),t.draggable.current=void 0,De(t),ds(t),t.dom.redraw())}function ds(t){const e=t.dom.elements;e.ghost&&pi(e.ghost,!1)}function ps(t,e){let r=t.dom.elements.board.firstChild;for(;r;){if(r.cgKey===e&&r.tagName==="PIECE")return r;r=r.nextSibling}}function Zl(t,e){t.exploding={stage:1,keys:e},t.dom.redraw(),setTimeout(()=>{co(t,2),setTimeout(()=>co(t,void 0),120)},120)}function co(t,e){t.exploding&&(e?t.exploding.stage=e:t.exploding=void 0,t.dom.redraw())}function ec(t,e){function r(){yl(t),e()}return{set(n){n.orientation&&n.orientation!==t.orientation&&r(),as(t,n),(n.fen?gt:nt)(o=>ls(o,n),t)},state:t,getFen:()=>Dl(t.pieces),toggleOrientation:r,setPieces(n){gt(o=>_l(o,n),t)},selectSquare(n,o){n?gt(s=>On(s,n,o),t):t.selected&&(De(t),t.dom.redraw())},move(n,o){gt(s=>Zo(s,n,o),t)},newPiece(n,o){gt(s=>mi(s,n,o),t)},playPremove(){if(t.premovable.current){if(gt(Ol,t))return!0;t.dom.redraw()}return!1},playPredrop(n){if(t.predroppable.current){const o=Nl(t,n);return t.dom.redraw(),o}return!1},cancelPremove(){nt(ct,t)},cancelPredrop(){nt(ut,t)},cancelMove(){nt(n=>{bi(n),zr(n)},t)},stop(){nt(n=>{ao(n),zr(n)},t)},explode(n){Zl(t,n)},setAutoShapes(n){nt(o=>o.drawable.autoShapes=n,t)},setShapes(n){nt(o=>o.drawable.shapes=n,t)},getKeyAtDomPos(n){return St(n,Te(t),t.dom.bounds())},redrawAll:e,dragNewPiece(n,o,s){Ql(t,n,o,s)},destroy(){ao(t),t.dom.unbind&&t.dom.unbind(),t.dom.destroyed=!0}}}function tc(){return{pieces:ss(os),orientation:"white",turnColor:"white",coordinates:!0,coordinatesOnSquares:!1,ranksPosition:"right",autoCastle:!0,viewOnly:!1,disableContextMenu:!1,addPieceZIndex:!1,blockTouchScroll:!1,pieceKey:!1,trustAllEvents:!1,highlight:{lastMove:!0,check:!0},animation:{enabled:!0,duration:200},movable:{free:!0,color:"both",showDests:!0,events:{},rookCastle:!0},premovable:{enabled:!0,showDests:!0,castle:!0,events:{}},predroppable:{enabled:!1,events:{}},draggable:{enabled:!0,distance:3,autoDistance:!0,showGhost:!0,deleteOnDropOff:!1},dropmode:{active:!1},selectable:{enabled:!0},stats:{dragged:!("ontouchstart"in window)},events:{},drawable:{enabled:!0,visible:!0,defaultSnapToValidMove:!0,eraseOnClick:!0,shapes:[],autoShapes:[],brushes:{green:{key:"g",color:"#15781B",opacity:1,lineWidth:10},red:{key:"r",color:"#882020",opacity:1,lineWidth:10},blue:{key:"b",color:"#003088",opacity:1,lineWidth:10},yellow:{key:"y",color:"#e68f00",opacity:1,lineWidth:10},paleBlue:{key:"pb",color:"#003088",opacity:.4,lineWidth:15},paleGreen:{key:"pg",color:"#15781B",opacity:.4,lineWidth:15},paleRed:{key:"pr",color:"#882020",opacity:.4,lineWidth:15},paleGrey:{key:"pgr",color:"#4a4a4a",opacity:.35,lineWidth:15},purple:{key:"purple",color:"#68217a",opacity:.65,lineWidth:10},pink:{key:"pink",color:"#ee2080",opacity:.5,lineWidth:10},white:{key:"white",color:"white",opacity:1,lineWidth:10}},prevSvgHash:""},hold:wl()}}const uo={hilitePrimary:{key:"hilitePrimary",color:"#3291ff",opacity:1,lineWidth:1},hiliteWhite:{key:"hiliteWhite",color:"#ffffff",opacity:1,lineWidth:1}};function rc(){const t=pe("defs"),e=Ae(pe("filter"),{id:"cg-filter-blur"});return e.appendChild(Ae(pe("feGaussianBlur"),{stdDeviation:"0.019"})),t.appendChild(e),t}function nc(t,e,r){var n;const o=t.drawable,s=o.current,c=s&&s.mouseSq?s:void 0,f=new Map,d=t.dom.bounds(),p=o.autoShapes.filter(S=>!S.piece);for(const S of o.shapes.concat(p).concat(c?[c]:[])){if(!S.dest)continue;const C=(n=f.get(S.dest))!==null&&n!==void 0?n:new Set,v=Wr(Kr(ce(S.orig),t.orientation),d),B=Wr(Kr(ce(S.dest),t.orientation),d);C.add(Fn(v,B)),f.set(S.dest,C)}const w=o.shapes.concat(p).map(S=>({shape:S,current:!1,hash:fo(S,Nn(S.dest,f),!1,d)}));c&&w.push({shape:c,current:!0,hash:fo(c,Nn(c.dest,f),!0,d)});const g=w.map(S=>S.hash).join(";");if(g===t.drawable.prevSvgHash)return;t.drawable.prevSvgHash=g;const _=e.querySelector("defs");ic(o,w,_),oc(w,e.querySelector("g"),r.querySelector("g"),S=>lc(t,S,o.brushes,f,d))}function ic(t,e,r){var n;const o=new Map;let s;for(const d of e.filter(p=>p.shape.dest&&p.shape.brush))s=ms(t.brushes[d.shape.brush],d.shape.modifiers),!((n=d.shape.modifiers)===null||n===void 0)&&n.hilite&&o.set(jr(s).key,jr(s)),o.set(s.key,s);const c=new Set;let f=r.firstElementChild;for(;f;)c.add(f.getAttribute("cgKey")),f=f.nextElementSibling;for(const[d,p]of o.entries())c.has(d)||r.appendChild(fc(p))}function oc(t,e,r,n){const o=new Map;for(const s of t)o.set(s.hash,!1);for(const s of[e,r]){const c=[];let f=s.firstElementChild,d;for(;f;)d=f.getAttribute("cgHash"),o.has(d)?o.set(d,!0):c.push(f),f=f.nextElementSibling;for(const p of c)s.removeChild(p)}for(const s of t.filter(c=>!o.get(c.hash)))for(const c of n(s))c.isCustom?r.appendChild(c.el):e.appendChild(c.el)}function fo({orig:t,dest:e,brush:r,piece:n,modifiers:o,customSvg:s,label:c},f,d,p){var w,g;return[p.width,p.height,d,t,e,r,f&&"-",n&&sc(n),o&&ac(o),s&&`custom-${ho(s.html)},${(g=(w=s.center)===null||w===void 0?void 0:w[0])!==null&&g!==void 0?g:"o"}`,c&&`label-${ho(c.text)}`].filter(_=>_).join(",")}function sc(t){return[t.color,t.role,t.scale].filter(e=>e).join(",")}function ac(t){return[t.lineWidth,t.hilite&&"*"].filter(e=>e).join(",")}function ho(t){let e=0;for(let r=0;r<t.length;r++)e=(e<<5)-e+t.charCodeAt(r)>>>0;return e.toString()}function lc(t,{shape:e,current:r,hash:n},o,s,c){var f,d;const p=Wr(Kr(ce(e.orig),t.orientation),c),w=e.dest?Wr(Kr(ce(e.dest),t.orientation),c):p,g=e.brush&&ms(o[e.brush],e.modifiers),_=s.get(e.dest),S=[];if(g){const C=Ae(pe("g"),{cgHash:n});S.push({el:C}),p[0]!==w[0]||p[1]!==w[1]?C.appendChild(uc(e,g,p,w,r,Nn(e.dest,s))):C.appendChild(cc(o[e.brush],p,r,c))}if(e.label){const C=e.label;(f=C.fill)!==null&&f!==void 0||(C.fill=e.brush&&o[e.brush].color);const v=e.brush?void 0:"tr";S.push({el:hc(C,n,p,w,_,v),isCustom:!0})}if(e.customSvg){const C=(d=e.customSvg.center)!==null&&d!==void 0?d:"orig",[v,B]=C==="label"?ws(p,w,_).map(R=>R-.5):C==="dest"?w:p,P=Ae(pe("g"),{transform:`translate(${v},${B})`,cgHash:n});P.innerHTML=`<svg width="1" height="1" viewBox="0 0 100 100">${e.customSvg.html}</svg>`,S.push({el:P,isCustom:!0})}return S}function cc(t,e,r,n){const o=dc(),s=(n.width+n.height)/(4*Math.max(n.width,n.height));return Ae(pe("circle"),{stroke:t.color,"stroke-width":o[r?0:1],fill:"none",opacity:gs(t,r),cx:e[0],cy:e[1],r:s-o[1]/2})}function jr(t){return["#ffffff","#fff","white"].includes(t.color)?uo.hilitePrimary:uo.hiliteWhite}function uc(t,e,r,n,o,s){var c;function f(w){var g;const _=mc(s&&!o),S=n[0]-r[0],C=n[1]-r[1],v=Math.atan2(C,S),B=Math.cos(v)*_,P=Math.sin(v)*_;return Ae(pe("line"),{stroke:w?jr(e).color:e.color,"stroke-width":pc(e,o)+(w?.04:0),"stroke-linecap":"round","marker-end":`url(#arrowhead-${w?jr(e).key:e.key})`,opacity:!((g=t.modifiers)===null||g===void 0)&&g.hilite?1:gs(e,o),x1:r[0],y1:r[1],x2:n[0]-B,y2:n[1]-P})}if(!(!((c=t.modifiers)===null||c===void 0)&&c.hilite))return f(!1);const d=pe("g"),p=Ae(pe("g"),{filter:"url(#cg-filter-blur)"});return p.appendChild(gc(r,n)),p.appendChild(f(!0)),d.appendChild(p),d.appendChild(f(!1)),d}function fc(t){const e=Ae(pe("marker"),{id:"arrowhead-"+t.key,orient:"auto",overflow:"visible",markerWidth:4,markerHeight:4,refX:t.key.startsWith("hilite")?1.86:2.05,refY:2});return e.appendChild(Ae(pe("path"),{d:"M0,0 V4 L3,2 Z",fill:t.color})),e.setAttribute("cgKey",t.key),e}function hc(t,e,r,n,o,s){var c;const d=.4*.75**t.text.length,p=ws(r,n,o),w=s==="tr"?.4:0,g=Ae(pe("g"),{transform:`translate(${p[0]+w},${p[1]-w})`,cgHash:e});g.appendChild(Ae(pe("circle"),{r:.4/2,"fill-opacity":s?1:.8,"stroke-opacity":s?1:.7,"stroke-width":.03,fill:(c=t.fill)!==null&&c!==void 0?c:"#666",stroke:"white"}));const _=Ae(pe("text"),{"font-size":d,"font-family":"Noto Sans","text-anchor":"middle",fill:"white",y:.13*.75**t.text.length});return _.innerHTML=t.text,g.appendChild(_),g}function Kr(t,e){return e==="white"?t:[7-t[0],7-t[1]]}function Nn(t,e){return(t&&e.has(t)&&e.get(t).size>1)===!0}function pe(t){return document.createElementNS("http://www.w3.org/2000/svg",t)}function Ae(t,e){for(const r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.setAttribute(r,e[r]);return t}function ms(t,e){return e?{color:t.color,opacity:Math.round(t.opacity*10)/10,lineWidth:Math.round(e.lineWidth||t.lineWidth),key:[t.key,e.lineWidth].filter(r=>r).join("")}:t}function dc(){return[3/64,4/64]}function pc(t,e){return(t.lineWidth||10)*(e?.85:1)/64}function gs(t,e){return(t.opacity||1)*(e?.9:1)}function mc(t){return(t?20:10)/64}function Wr(t,e){const r=Math.min(1,e.width/e.height),n=Math.min(1,e.height/e.width);return[(t[0]-3.5)*r,(3.5-t[1])*n]}function gc(t,e){const r={from:[Math.floor(Math.min(t[0],e[0])),Math.floor(Math.min(t[1],e[1]))],to:[Math.ceil(Math.max(t[0],e[0])),Math.ceil(Math.max(t[1],e[1]))]};return Ae(pe("rect"),{x:r.from[0],y:r.from[1],width:r.to[0]-r.from[0],height:r.to[1]-r.from[1],fill:"none",stroke:"none"})}function Fn(t,e,r=!0){const n=Math.atan2(e[1]-t[1],e[0]-t[0])+Math.PI;return r?(Math.round(n*8/Math.PI)+16)%16:n}function wc(t,e){return Math.sqrt([t[0]-e[0],t[1]-e[1]].reduce((r,n)=>r+n*n,0))}function ws(t,e,r){let n=wc(t,e);const o=Fn(t,e,!1);if(r&&(n-=33/64,r.size>1)){n-=10/64;const s=Fn(t,e);(r.has((s+1)%16)||r.has((s+15)%16))&&s&1&&(n-=.4)}return[t[0]-Math.cos(o)*n,t[1]-Math.sin(o)*n].map(s=>s+.5)}function bc(t,e){t.innerHTML="",t.classList.add("cg-wrap");for(const d of pl)t.classList.toggle("orientation-"+d,e.orientation===d);t.classList.toggle("manipulable",!e.viewOnly);const r=Xe("cg-container");t.appendChild(r);const n=Xe("cg-board");r.appendChild(n);let o,s,c;if(e.drawable.visible&&(o=Ae(pe("svg"),{class:"cg-shapes",viewBox:"-4 -4 8 8",preserveAspectRatio:"xMidYMid slice"}),o.appendChild(rc()),o.appendChild(pe("g")),s=Ae(pe("svg"),{class:"cg-custom-svgs",viewBox:"-3.5 -3.5 8 8",preserveAspectRatio:"xMidYMid slice"}),s.appendChild(pe("g")),c=Xe("cg-auto-pieces"),r.appendChild(o),r.appendChild(s),r.appendChild(c)),e.coordinates){const d=e.orientation==="black"?" black":"",p=e.ranksPosition==="left"?" left":"";if(e.coordinatesOnSquares){const w=e.orientation==="white"?g=>g+1:g=>8-g;Ur.forEach((g,_)=>r.appendChild(wn(Br.map(S=>g+S),"squares rank"+w(_)+d+p)))}else r.appendChild(wn(Br,"ranks"+d+p)),r.appendChild(wn(Ur,"files"+d))}let f;return e.draggable.enabled&&e.draggable.showGhost&&(f=Xe("piece","ghost"),pi(f,!1),r.appendChild(f)),{board:n,container:r,wrap:t,ghost:f,svg:o,customSvg:s,autoPieces:c}}function wn(t,e){const r=Xe("coords",e);let n;for(const o of t)n=Xe("coord"),n.textContent=o,r.appendChild(n);return r}function kc(t,e){if(!t.dropmode.active)return;ct(t),ut(t);const r=t.dropmode.piece;if(r){t.pieces.set("a0",r);const n=Et(e),o=n&&St(n,Te(t),t.dom.bounds());o&&rs(t,"a0",o)}t.dom.redraw()}function vc(t,e){const r=t.dom.elements.board;if("ResizeObserver"in window&&new ResizeObserver(e).observe(t.dom.elements.wrap),(t.disableContextMenu||t.drawable.enabled)&&r.addEventListener("contextmenu",o=>o.preventDefault()),t.viewOnly)return;const n=_c(t);r.addEventListener("touchstart",n,{passive:!1}),r.addEventListener("mousedown",n,{passive:!1})}function yc(t,e){const r=[];if("ResizeObserver"in window||r.push(ar(document.body,"chessground.resize",e)),!t.viewOnly){const n=po(t,Xl,Kl),o=po(t,Jl,Wl);for(const c of["touchmove","mousemove"])r.push(ar(document,c,n));for(const c of["touchend","mouseup"])r.push(ar(document,c,o));const s=()=>t.dom.bounds.clear();r.push(ar(document,"scroll",s,{capture:!0,passive:!0})),r.push(ar(window,"resize",s,{passive:!0}))}return()=>r.forEach(n=>n())}function ar(t,e,r,n){return t.addEventListener(e,r,n),()=>t.removeEventListener(e,r,n)}const _c=t=>e=>{t.draggable.current?zr(t):t.drawable.current?fs(t):e.shiftKey||Go(e)?t.drawable.enabled&&jl(t,e):t.viewOnly||(t.dropmode.active?kc(t,e):Vl(t,e))},po=(t,e,r)=>n=>{t.drawable.current?t.drawable.enabled&&r(t,n):t.viewOnly||e(t,n)};function Ec(t){const e=Te(t),r=Sr(t.dom.bounds()),n=t.dom.elements.board,o=t.pieces,s=t.animation.current,c=s?s.plan.anims:new Map,f=s?s.plan.fadings:new Map,d=t.draggable.current,p=Ac(t),w=new Set,g=new Set,_=new Map,S=new Map;let C,v,B,P,R,I,O,T,x,U;for(v=n.firstChild;v;){if(C=v.cgKey,bs(v))if(B=o.get(C),R=c.get(C),I=f.get(C),P=v.cgPiece,v.cgDragging&&(!d||d.orig!==C)&&(v.classList.remove("dragging"),Ke(v,r(ce(C),e)),v.cgDragging=!1),!I&&v.cgFading&&(v.cgFading=!1,v.classList.remove("fading")),B){if(R&&v.cgAnimating&&P===lr(B)){const D=ce(C);D[0]+=R[2],D[1]+=R[3],v.classList.add("anim"),Ke(v,r(D,e))}else v.cgAnimating&&(v.cgAnimating=!1,v.classList.remove("anim"),Ke(v,r(ce(C),e)),t.addPieceZIndex&&(v.style.zIndex=bn(ce(C),e)));P===lr(B)&&(!I||!v.cgFading)?w.add(C):I&&P===lr(I)?(v.classList.add("fading"),v.cgFading=!0):kn(_,P,v)}else kn(_,P,v);else if(ks(v)){const D=v.className;p.get(C)===D?g.add(C):kn(S,D,v)}v=v.nextSibling}for(const[D,L]of p)if(!g.has(D)){x=S.get(L),U=x&&x.pop();const F=r(ce(D),e);if(U)U.cgKey=D,Ke(U,F);else{const E=Xe("square",L);E.cgKey=D,Ke(E,F),n.insertBefore(E,n.firstChild)}}for(const[D,L]of o)if(R=c.get(D),!w.has(D))if(O=_.get(lr(L)),T=O&&O.pop(),T){T.cgKey=D,T.cgFading&&(T.classList.remove("fading"),T.cgFading=!1);const F=ce(D);t.addPieceZIndex&&(T.style.zIndex=bn(F,e)),R&&(T.cgAnimating=!0,T.classList.add("anim"),F[0]+=R[2],F[1]+=R[3]),Ke(T,r(F,e))}else{const F=lr(L),E=Xe("piece",F),q=ce(D);E.cgPiece=F,E.cgKey=D,R&&(E.cgAnimating=!0,q[0]+=R[2],q[1]+=R[3]),Ke(E,r(q,e)),t.addPieceZIndex&&(E.style.zIndex=bn(q,e)),n.appendChild(E)}for(const D of _.values())go(t,D);for(const D of S.values())go(t,D)}function Sc(t){const e=Te(t),r=Sr(t.dom.bounds());let n=t.dom.elements.board.firstChild;for(;n;)(bs(n)&&!n.cgAnimating||ks(n))&&Ke(n,r(ce(n.cgKey),e)),n=n.nextSibling}function mo(t){var e,r;const n=t.dom.elements.wrap.getBoundingClientRect(),o=t.dom.elements.container,s=n.height/n.width,c=Math.floor(n.width*window.devicePixelRatio/8)*8/window.devicePixelRatio,f=c*s;o.style.width=c+"px",o.style.height=f+"px",t.dom.bounds.clear(),(e=t.addDimensionsCssVarsTo)===null||e===void 0||e.style.setProperty("---cg-width",c+"px"),(r=t.addDimensionsCssVarsTo)===null||r===void 0||r.style.setProperty("---cg-height",f+"px")}const bs=t=>t.tagName==="PIECE",ks=t=>t.tagName==="SQUARE";function go(t,e){for(const r of e)t.dom.elements.board.removeChild(r)}function bn(t,e){const n=t[1];return`${e?10-n:3+n}`}const lr=t=>`${t.color} ${t.role}`;function Ac(t){var e,r,n;const o=new Map;if(t.lastMove&&t.highlight.lastMove)for(const f of t.lastMove)Ve(o,f,"last-move");if(t.check&&t.highlight.check&&Ve(o,t.check,"check"),t.selected&&(Ve(o,t.selected,"selected"),t.movable.showDests)){const f=(e=t.movable.dests)===null||e===void 0?void 0:e.get(t.selected);if(f)for(const p of f)Ve(o,p,"move-dest"+(t.pieces.has(p)?" oc":""));const d=(n=(r=t.premovable.customDests)===null||r===void 0?void 0:r.get(t.selected))!==null&&n!==void 0?n:t.premovable.dests;if(d)for(const p of d)Ve(o,p,"premove-dest"+(t.pieces.has(p)?" oc":""))}const s=t.premovable.current;if(s)for(const f of s)Ve(o,f,"current-premove");else t.predroppable.current&&Ve(o,t.predroppable.current.key,"current-premove");const c=t.exploding;if(c)for(const f of c.keys)Ve(o,f,"exploding"+c.stage);return t.highlight.custom&&t.highlight.custom.forEach((f,d)=>{Ve(o,d,f)}),o}function Ve(t,e,r){const n=t.get(e);n?t.set(e,`${n} ${r}`):t.set(e,r)}function kn(t,e,r){const n=t.get(e);n?n.push(r):t.set(e,[r])}function Cc(t,e,r){const n=new Map,o=[];for(const f of t)n.set(f.hash,!1);let s=e.firstElementChild,c;for(;s;)c=s.getAttribute("cgHash"),n.has(c)?n.set(c,!0):o.push(s),s=s.nextElementSibling;for(const f of o)e.removeChild(f);for(const f of t)n.get(f.hash)||e.appendChild(r(f))}function Pc(t,e){const n=t.drawable.autoShapes.filter(o=>o.piece).map(o=>({shape:o,hash:Mc(o),current:!1}));Cc(n,e,o=>Rc(t,o,t.dom.bounds()))}function Tc(t){var e;const r=Te(t),n=Sr(t.dom.bounds());let o=(e=t.dom.elements.autoPieces)===null||e===void 0?void 0:e.firstChild;for(;o;)Ho(o,n(ce(o.cgKey),r),o.cgScale),o=o.nextSibling}function Rc(t,{shape:e,hash:r},n){var o,s,c;const f=e.orig,d=(o=e.piece)===null||o===void 0?void 0:o.role,p=(s=e.piece)===null||s===void 0?void 0:s.color,w=(c=e.piece)===null||c===void 0?void 0:c.scale,g=Xe("piece",`${d} ${p}`);return g.setAttribute("cgHash",r),g.cgKey=f,g.cgScale=w,Ho(g,Sr(n)(ce(f),Te(t)),w),g}const Mc=t=>{var e,r,n;return[t.orig,(e=t.piece)===null||e===void 0?void 0:e.role,(r=t.piece)===null||r===void 0?void 0:r.color,(n=t.piece)===null||n===void 0?void 0:n.scale].join(",")};function Oc(t,e){const r=tc();ls(r,e||{});function n(){const o="dom"in r?r.dom.unbind:void 0,s=bc(t,r),c=gl(()=>s.board.getBoundingClientRect()),f=w=>{Ec(p),s.autoPieces&&Pc(p,s.autoPieces),!w&&s.svg&&nc(p,s.svg,s.customSvg)},d=()=>{mo(p),Sc(p),s.autoPieces&&Tc(p)},p=r;return p.dom={elements:s,bounds:c,redraw:Nc(f),redrawNow:f,unbind:o},p.drawable.prevSvgHash="",mo(p),f(!1),vc(p,d),o||(p.dom.unbind=yc(p,d)),p.events.insert&&p.events.insert(s),p}return ec(n(),n)}function Nc(t){let e=!1;return()=>{e||(e=!0,requestAnimationFrame(()=>{t(),e=!1}))}}let vs=class{unwrap(e,r){const n=this._chain(o=>H.ok(e?e(o):o),o=>r?H.ok(r(o)):H.err(o));if(n.isErr)throw n.error;return n.value}map(e,r){return this._chain(n=>H.ok(e(n)),n=>H.err(r?r(n):n))}chain(e,r){return this._chain(e,r||(n=>H.err(n)))}},Fc=class extends vs{constructor(e){super(),this.value=void 0,this.isOk=!0,this.isErr=!1,this.value=e}_chain(e,r){return e(this.value)}},$c=class extends vs{constructor(e){super(),this.error=void 0,this.isOk=!1,this.isErr=!0,this.error=e}_chain(e,r){return r(this.error)}};var H;(function(t){t.ok=function(e){return new Fc(e)},t.err=function(e){return new $c(e||new Error)},t.all=function(e){if(Array.isArray(e)){const o=[];for(let s=0;s<e.length;s++){const c=e[s];if(c.isErr)return c;o.push(c.value)}return t.ok(o)}const r={},n=Object.keys(e);for(let o=0;o<n.length;o++){const s=e[n[o]];if(s.isErr)return s;r[n[o]]=s.value}return t.ok(r)}})(H||(H={}));const wo=t=>(t=t-(t>>>1&1431655765),t=(t&858993459)+(t>>>2&858993459),Math.imul(t+(t>>>4)&252645135,16843009)>>24),$n=t=>(t=t>>>8&16711935|(t&16711935)<<8,t>>>16&65535|(t&65535)<<16),bo=t=>(t=t>>>1&1431655765|(t&1431655765)<<1,t=t>>>2&858993459|(t&858993459)<<2,t=t>>>4&252645135|(t&252645135)<<4,$n(t));let M=class X{constructor(e,r){$(this,"lo");$(this,"hi");this.lo=e|0,this.hi=r|0}static fromSquare(e){return e>=32?new X(0,1<<e-32):new X(1<<e,0)}static fromRank(e){return new X(255,0).shl64(8*e)}static fromFile(e){return new X(16843009<<e,16843009<<e)}static empty(){return new X(0,0)}static full(){return new X(4294967295,4294967295)}static corners(){return new X(129,2164260864)}static center(){return new X(402653184,24)}static backranks(){return new X(255,4278190080)}static backrank(e){return e==="white"?new X(255,0):new X(0,4278190080)}static lightSquares(){return new X(1437226410,1437226410)}static darkSquares(){return new X(2857740885,2857740885)}complement(){return new X(~this.lo,~this.hi)}xor(e){return new X(this.lo^e.lo,this.hi^e.hi)}union(e){return new X(this.lo|e.lo,this.hi|e.hi)}intersect(e){return new X(this.lo&e.lo,this.hi&e.hi)}diff(e){return new X(this.lo&~e.lo,this.hi&~e.hi)}intersects(e){return this.intersect(e).nonEmpty()}isDisjoint(e){return this.intersect(e).isEmpty()}supersetOf(e){return e.diff(this).isEmpty()}subsetOf(e){return this.diff(e).isEmpty()}shr64(e){return e>=64?X.empty():e>=32?new X(this.hi>>>e-32,0):e>0?new X(this.lo>>>e^this.hi<<32-e,this.hi>>>e):this}shl64(e){return e>=64?X.empty():e>=32?new X(0,this.lo<<e-32):e>0?new X(this.lo<<e,this.hi<<e^this.lo>>>32-e):this}bswap64(){return new X($n(this.hi),$n(this.lo))}rbit64(){return new X(bo(this.hi),bo(this.lo))}minus64(e){const r=this.lo-e.lo,n=(r&e.lo&1)+(e.lo>>>1)+(r>>>1)>>>31;return new X(r,this.hi-(e.hi+n))}equals(e){return this.lo===e.lo&&this.hi===e.hi}size(){return wo(this.lo)+wo(this.hi)}isEmpty(){return this.lo===0&&this.hi===0}nonEmpty(){return this.lo!==0||this.hi!==0}has(e){return(e>=32?this.hi&1<<e-32:this.lo&1<<e)!==0}set(e,r){return r?this.with(e):this.without(e)}with(e){return e>=32?new X(this.lo,this.hi|1<<e-32):new X(this.lo|1<<e,this.hi)}without(e){return e>=32?new X(this.lo,this.hi&~(1<<e-32)):new X(this.lo&~(1<<e),this.hi)}toggle(e){return e>=32?new X(this.lo,this.hi^1<<e-32):new X(this.lo^1<<e,this.hi)}last(){if(this.hi!==0)return 63-Math.clz32(this.hi);if(this.lo!==0)return 31-Math.clz32(this.lo)}first(){if(this.lo!==0)return 31-Math.clz32(this.lo&-this.lo);if(this.hi!==0)return 63-Math.clz32(this.hi&-this.hi)}withoutFirst(){return this.lo!==0?new X(this.lo&this.lo-1,this.hi):new X(0,this.hi&this.hi-1)}moreThanOne(){return this.hi!==0&&this.lo!==0||(this.lo&this.lo-1)!==0||(this.hi&this.hi-1)!==0}singleSquare(){return this.moreThanOne()?void 0:this.last()}*[Symbol.iterator](){let e=this.lo,r=this.hi;for(;e!==0;){const n=31-Math.clz32(e&-e);e^=1<<n,yield n}for(;r!==0;){const n=31-Math.clz32(r&-r);r^=1<<n,yield 32+n}}*reversed(){let e=this.lo,r=this.hi;for(;r!==0;){const n=31-Math.clz32(r);r^=1<<n,yield 32+n}for(;e!==0;){const n=31-Math.clz32(e);e^=1<<n,yield n}}};const xn=["a","b","c","d","e","f","g","h"],ys=["1","2","3","4","5","6","7","8"],Xt=["white","black"],We=["pawn","knight","bishop","rook","queen","king"],xc=["a","h"];let _s=class Nr{constructor(){$(this,"occupied");$(this,"promoted");$(this,"white");$(this,"black");$(this,"pawn");$(this,"knight");$(this,"bishop");$(this,"rook");$(this,"queen");$(this,"king")}static default(){const e=new Nr;return e.reset(),e}reset(){this.occupied=new M(65535,4294901760),this.promoted=M.empty(),this.white=new M(65535,0),this.black=new M(0,4294901760),this.pawn=new M(65280,16711680),this.knight=new M(66,1107296256),this.bishop=new M(36,603979776),this.rook=new M(129,2164260864),this.queen=new M(8,134217728),this.king=new M(16,268435456)}static empty(){const e=new Nr;return e.clear(),e}clear(){this.occupied=M.empty(),this.promoted=M.empty();for(const e of Xt)this[e]=M.empty();for(const e of We)this[e]=M.empty()}clone(){const e=new Nr;e.occupied=this.occupied,e.promoted=this.promoted;for(const r of Xt)e[r]=this[r];for(const r of We)e[r]=this[r];return e}getColor(e){if(this.white.has(e))return"white";if(this.black.has(e))return"black"}getRole(e){for(const r of We)if(this[r].has(e))return r}get(e){const r=this.getColor(e);if(!r)return;const n=this.getRole(e),o=this.promoted.has(e);return{color:r,role:n,promoted:o}}take(e){const r=this.get(e);return r&&(this.occupied=this.occupied.without(e),this[r.color]=this[r.color].without(e),this[r.role]=this[r.role].without(e),r.promoted&&(this.promoted=this.promoted.without(e))),r}set(e,r){const n=this.take(e);return this.occupied=this.occupied.with(e),this[r.color]=this[r.color].with(e),this[r.role]=this[r.role].with(e),r.promoted&&(this.promoted=this.promoted.with(e)),n}has(e){return this.occupied.has(e)}*[Symbol.iterator](){for(const e of this.occupied)yield[e,this.get(e)]}pieces(e,r){return this[e].intersect(this[r])}rooksAndQueens(){return this.rook.union(this.queen)}bishopsAndQueens(){return this.bishop.union(this.queen)}kingOf(e){return this.pieces(e,"king").singleSquare()}},Rr=class jt{constructor(){$(this,"pawn");$(this,"knight");$(this,"bishop");$(this,"rook");$(this,"queen");$(this,"king")}static empty(){const e=new jt;for(const r of We)e[r]=0;return e}static fromBoard(e,r){const n=new jt;for(const o of We)n[o]=e.pieces(r,o).size();return n}clone(){const e=new jt;for(const r of We)e[r]=this[r];return e}equals(e){return We.every(r=>this[r]===e[r])}add(e){const r=new jt;for(const n of We)r[n]=this[n]+e[n];return r}subtract(e){const r=new jt;for(const n of We)r[n]=this[n]-e[n];return r}nonEmpty(){return We.some(e=>this[e]>0)}isEmpty(){return!this.nonEmpty()}hasPawns(){return this.pawn>0}hasNonPawns(){return this.knight>0||this.bishop>0||this.rook>0||this.queen>0||this.king>0}size(){return this.pawn+this.knight+this.bishop+this.rook+this.queen+this.king}},Dc=class Kt{constructor(e,r){$(this,"white");$(this,"black");this.white=e,this.black=r}static empty(){return new Kt(Rr.empty(),Rr.empty())}static fromBoard(e){return new Kt(Rr.fromBoard(e,"white"),Rr.fromBoard(e,"black"))}clone(){return new Kt(this.white.clone(),this.black.clone())}equals(e){return this.white.equals(e.white)&&this.black.equals(e.black)}add(e){return new Kt(this.white.add(e.white),this.black.add(e.black))}subtract(e){return new Kt(this.white.subtract(e.white),this.black.subtract(e.black))}count(e){return this.white[e]+this.black[e]}size(){return this.white.size()+this.black.size()}isEmpty(){return this.white.isEmpty()&&this.black.isEmpty()}nonEmpty(){return!this.isEmpty()}hasPawns(){return this.white.hasPawns()||this.black.hasPawns()}hasNonPawns(){return this.white.hasNonPawns()||this.black.hasNonPawns()}},ko=class Dn{constructor(e,r){$(this,"white");$(this,"black");this.white=e,this.black=r}static default(){return new Dn(3,3)}clone(){return new Dn(this.white,this.black)}equals(e){return this.white===e.white&&this.black===e.black}};const Y=t=>t!==void 0,ye=t=>t==="white"?"black":"white",vt=t=>t>>3,ze=t=>t&7,Ln=(t,e)=>0<=t&&t<8&&0<=e&&e<8?t+8*e:void 0,vo=t=>{switch(t){case"pawn":return"p";case"knight":return"n";case"bishop":return"b";case"rook":return"r";case"queen":return"q";case"king":return"k"}};function Lc(t){switch(t.toLowerCase()){case"p":return"pawn";case"n":return"knight";case"b":return"bishop";case"r":return"rook";case"q":return"queen";case"k":return"king";default:return}}function Ic(t){if(t.length===2)return Ln(t.charCodeAt(0)-97,t.charCodeAt(1)-49)}const Uc=t=>xn[ze(t)]+ys[vt(t)],yi=(t,e)=>t==="white"?e==="a"?2:6:e==="a"?58:62,_i=(t,e)=>t==="white"?e==="a"?3:5:e==="a"?59:61,Bc="rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR",zc=Bc+" w KQkq -",jc=zc+" 0 1";var he;(function(t){t.Fen="ERR_FEN",t.Board="ERR_BOARD",t.Pockets="ERR_POCKETS",t.Turn="ERR_TURN",t.Castling="ERR_CASTLING",t.EpSquare="ERR_EP_SQUARE",t.RemainingChecks="ERR_REMAINING_CHECKS",t.Halfmoves="ERR_HALFMOVES",t.Fullmoves="ERR_FULLMOVES"})(he||(he={}));let be=class extends Error{};const Kc=(t,e,r)=>{let n=t.indexOf(e);for(;r-- >0&&n!==-1;)n=t.indexOf(e,n+e.length);return n},Ht=t=>/^\d{1,4}$/.test(t)?parseInt(t,10):void 0,Es=t=>{const e=Lc(t);return e&&{role:e,color:t.toLowerCase()===t?"black":"white"}},vn=t=>{const e=_s.empty();let r=7,n=0;for(let o=0;o<t.length;o++){const s=t[o];if(s==="/"&&n===8)n=0,r--;else{const c=parseInt(s,10);if(c>0)n+=c;else{if(n>=8||r<0)return H.err(new be(he.Board));const f=n+r*8,d=Es(s);if(!d)return H.err(new be(he.Board));t[o+1]==="~"&&(d.promoted=!0,o++),e.set(f,d),n++}}}return r!==0||n!==8?H.err(new be(he.Board)):H.ok(e)},yo=t=>{if(t.length>64)return H.err(new be(he.Pockets));const e=Dc.empty();for(const r of t){const n=Es(r);if(!n)return H.err(new be(he.Pockets));e[n.color][n.role]++}return H.ok(e)},Wc=(t,e)=>{let r=M.empty();if(e==="-")return H.ok(r);for(const n of e){const o=n.toLowerCase(),s=n===o?"black":"white",c=s==="white"?0:7;if("a"<=o&&o<="h")r=r.with(Ln(o.charCodeAt(0)-97,c));else if(o==="k"||o==="q"){const f=t[s].intersect(M.backrank(s)).intersect(t.rook.union(t.king)),d=o==="k"?f.last():f.first();r=r.with(Y(d)&&t.rook.has(d)?d:Ln(o==="k"?7:0,c))}else return H.err(new be(he.Castling))}return Xt.some(n=>M.backrank(n).intersect(r).size()>2)?H.err(new be(he.Castling)):H.ok(r)},_o=t=>{const e=t.split("+");if(e.length===3&&e[0]===""){const r=Ht(e[1]),n=Ht(e[2]);return!Y(r)||r>3||!Y(n)||n>3?H.err(new be(he.RemainingChecks)):H.ok(new ko(3-r,3-n))}else if(e.length===2){const r=Ht(e[0]),n=Ht(e[1]);return!Y(r)||r>3||!Y(n)||n>3?H.err(new be(he.RemainingChecks)):H.ok(new ko(r,n))}else return H.err(new be(he.RemainingChecks))},Ei=t=>{const e=t.split(/[\s_]+/),r=e.shift();let n,o=H.ok(void 0);if(r.endsWith("]")){const f=r.indexOf("[");if(f===-1)return H.err(new be(he.Fen));n=vn(r.slice(0,f)),o=yo(r.slice(f+1,-1))}else{const f=Kc(r,"/",7);f===-1?n=vn(r):(n=vn(r.slice(0,f)),o=yo(r.slice(f+1)))}let s;const c=e.shift();if(!Y(c)||c==="w")s="white";else if(c==="b")s="black";else return H.err(new be(he.Turn));return n.chain(f=>{const d=e.shift(),p=Y(d)?Wc(f,d):H.ok(M.empty()),w=e.shift();let g;if(Y(w)&&w!=="-"&&(g=Ic(w),!Y(g)))return H.err(new be(he.EpSquare));let _=e.shift(),S;Y(_)&&_.includes("+")&&(S=_o(_),_=e.shift());const C=Y(_)?Ht(_):0;if(!Y(C))return H.err(new be(he.Halfmoves));const v=e.shift(),B=Y(v)?Ht(v):1;if(!Y(B))return H.err(new be(he.Fullmoves));const P=e.shift();let R=H.ok(void 0);if(Y(P)){if(Y(S))return H.err(new be(he.RemainingChecks));R=_o(P)}else Y(S)&&(R=S);return e.length>0?H.err(new be(he.Fen)):o.chain(I=>p.chain(O=>R.map(T=>({board:f,pockets:I,turn:s,castlingRights:O,remainingChecks:T,epSquare:g,halfmoves:C,fullmoves:Math.max(1,B)}))))})};var Hc=Le('<div class="is2d chessboard">');const Gc=t=>{let e,r;return Ya(()=>{let n=t.color,o=t.dests,s={premovable:{enabled:!1},movable:{color:n,free:!1,dests:o,events:{after:t.onMoveAfter}},drawable:{onChange:t.onShapes}};r=Oc(e,s)}),Qe(()=>{let n,o;t.fen_uci?[n,o]=t.fen_uci:n=jc;let s=[];o&&(s.push(o.slice(0,2)),s.push(o.slice(2,4)));let c=t.movable?t.color:void 0;r.set({fen:n,lastMove:s,turnColor:t.color,movable:{color:c,dests:t.dests}})}),Qe(()=>{let n=t.orientation??"white";r.set({orientation:n})}),Qe(()=>{let n=t.doPromotion;if(n){let o=r.state.pieces.get(n);r.setPieces(new Map([[n,{color:o.color,role:"queen",promoted:!0}]]))}}),Qe(()=>{t.shapes&&r.setAutoShapes(t.shapes)}),(()=>{var n=Hc();return Ko(o=>e=o,n),n})()},qc=Symbol("store-raw"),Vc=Symbol("store-node"),Ot=Symbol("store-has"),Yc=Symbol("store-self");function wr(t){let e;return t!=null&&typeof t=="object"&&(t[Wa]||!(e=Object.getPrototypeOf(t))||e===Object.prototype||Array.isArray(t))}function In(t,e=new Set){let r,n,o,s;if(r=t!=null&&t[qc])return r;if(!wr(t)||e.has(t))return t;if(Array.isArray(t)){Object.isFrozen(t)?t=t.slice(0):e.add(t);for(let c=0,f=t.length;c<f;c++)o=t[c],(n=In(o,e))!==o&&(t[c]=n)}else{Object.isFrozen(t)?t=Object.assign({},t):e.add(t);const c=Object.keys(t),f=Object.getOwnPropertyDescriptors(t);for(let d=0,p=c.length;d<p;d++)s=c[d],!f[s].get&&(o=t[s],(n=In(o,e))!==o&&(t[s]=n))}return t}function Qc(t,e){let r=t[e];return r||Object.defineProperty(t,e,{value:r=Object.create(null)}),r}function Eo(t,e,r){if(t[e])return t[e];const[n,o]=ge(r,{equals:!1,internal:!0});return n.$=o,t[e]=n}function rt(t,e,r,n=!1){if(!n&&t[e]===r)return;const o=t[e],s=t.length;r===void 0?(delete t[e],t[Ot]&&t[Ot][e]&&o!==void 0&&t[Ot][e].$()):(t[e]=r,t[Ot]&&t[Ot][e]&&o===void 0&&t[Ot][e].$());let c=Qc(t,Vc),f;if((f=Eo(c,e,o))&&f.$(()=>r),Array.isArray(t)&&t.length!==s){for(let d=t.length;d<s;d++)(f=c[d])&&f.$();(f=Eo(c,"length",s))&&f.$(t.length)}(f=c[Yc])&&f.$()}const Un=Symbol("store-root");function Wt(t,e,r,n,o){const s=e[r];if(t===s)return;const c=Array.isArray(t);if(r!==Un&&(!wr(t)||!wr(s)||c!==Array.isArray(s)||o&&t[o]!==s[o])){rt(e,r,t);return}if(c){if(t.length&&s.length&&(!n||o&&t[0]&&t[0][o]!=null)){let p,w,g,_,S,C,v,B;for(g=0,_=Math.min(s.length,t.length);g<_&&(s[g]===t[g]||o&&s[g]&&t[g]&&s[g][o]===t[g][o]);g++)Wt(t[g],s,g,n,o);const P=new Array(t.length),R=new Map;for(_=s.length-1,S=t.length-1;_>=g&&S>=g&&(s[_]===t[S]||o&&s[g]&&t[g]&&s[_][o]===t[S][o]);_--,S--)P[S]=s[_];if(g>S||g>_){for(w=g;w<=S;w++)rt(s,w,t[w]);for(;w<t.length;w++)rt(s,w,P[w]),Wt(t[w],s,w,n,o);s.length>t.length&&rt(s,"length",t.length);return}for(v=new Array(S+1),w=S;w>=g;w--)C=t[w],B=o&&C?C[o]:C,p=R.get(B),v[w]=p===void 0?-1:p,R.set(B,w);for(p=g;p<=_;p++)C=s[p],B=o&&C?C[o]:C,w=R.get(B),w!==void 0&&w!==-1&&(P[w]=s[p],w=v[w],R.set(B,w));for(w=g;w<t.length;w++)w in P?(rt(s,w,P[w]),Wt(t[w],s,w,n,o)):rt(s,w,t[w])}else for(let p=0,w=t.length;p<w;p++)Wt(t[p],s,p,n,o);s.length>t.length&&rt(s,"length",t.length);return}const f=Object.keys(t);for(let p=0,w=f.length;p<w;p++)Wt(t[f[p]],s,f[p],n,o);const d=Object.keys(s);for(let p=0,w=d.length;p<w;p++)t[d[p]]===void 0&&rt(s,d[p],void 0)}function Xc(t,e={}){const{merge:r,key:n="id"}=e,o=In(t);return s=>{if(!wr(s)||!wr(o))return o;const c=Wt(o,{[Un]:s},Un,r,n);return c===void 0?s:c}}var Jc=t=>(typeof t.clear=="function"||(t.clear=()=>{let e;for(;e=t.key(0);)t.removeItem(e)}),t),Zc=["clear","getItem","getAll","setItem","removeItem","key","getLength"],eu=t=>(t.withOptions=e=>Zc.reduce((r,n)=>(typeof t[n]=="function"&&(r[n]=(...o)=>(o[t[n].length-1]=e,t[n](...o))),r),{get length(){return t.length},withOptions:r=>t.withOptions(r)}),t),tu={domain:"Domain",expires:"Expires",path:"Path",secure:"Secure",httpOnly:"HttpOnly",maxAge:"Max-Age",sameSite:"SameSite"};function ru(t){if(!t)return"";const e=Object.entries(t).map(([r,n])=>{const o=tu[r];if(o)return n instanceof Date?`${o}=${n.toUTCString()}`:typeof n=="boolean"?n?`${o}`:void 0:`${o}=${n}`}).filter(r=>!!r);return e.length!=0?`; ${e.join("; ")}`:""}function nu(t,e){var n;const r=(n=t.match(`(^|;)\\s*${e}\\s*=\\s*([^;]+)`))==null?void 0:n.pop();return r!=null?decodeURIComponent(r):null}var cr=eu(Jc({_read:()=>document.cookie,_write:(t,e,r)=>{document.cookie=`${t}=${e}${ru(r)}`},getItem:(t,e)=>nu(cr._read(e),t),setItem:(t,e,r)=>{cr._write(t,e.replace(/[\u00c0-\uffff\&;]/g,n=>encodeURIComponent(n)),r)},removeItem:(t,e)=>{cr._write(t,"deleted",{...e,expires:new Date(0)})},key:(t,e)=>{let r=null,n=0;return cr._read(e).replace(/(?:^|;)\s*(.+?)\s*=\s*[^;]+/g,(o,s)=>(!r&&s&&n++===t&&(r=s),"")),r},getLength:t=>{let e=0;return cr._read(t).replace(/(?:^|;)\s*.+?\s*=\s*[^;]+/g,r=>(e+=r?1:0,"")),e},get length(){return this.getLength()}}));function iu(t,e={}){var w;const r=e.storage||globalThis.localStorage,n=e.name||`storage-${sl()}`;if(!r)return[t[0],t[1],null];const o=e.storageOptions,s=e.serialize||JSON.stringify.bind(JSON),c=e.deserialize||JSON.parse.bind(JSON),f=r.getItem(n,o),d=typeof t[0]=="function"?g=>{try{const _=c(g);t[1](()=>_)}catch{}}:g=>{try{const _=c(g);t[1](Xc(_))}catch{}};let p=!0;if(f instanceof Promise?f.then(g=>p&&g&&d(g)):f&&d(f),typeof((w=e.sync)==null?void 0:w[0])=="function"){const g=typeof t[0]=="function"?t[0]:()=>t[0];e.sync[0](_=>{_.key!==n||(_.url||globalThis.location.href)!==globalThis.location.href||_.newValue===s(Ce(g))||d(_.newValue)})}return[t[0],typeof t[0]=="function"?g=>{var C;const _=t[1](g),S=g!=null?s(_):g;return(C=e.sync)==null||C[1](n,S),S!=null?r.setItem(n,S,o):r.removeItem(n,o),p=!1,_}:(...g)=>{var S;t[1](...g);const _=s(Ce(()=>t[0]));(S=e.sync)==null||S[1](n,_),r.setItem(n,_,o),p=!1},f]}const Bn=(t,e,r)=>iu(ge(t),{name:`.hopefox2000.v0.${e}`}),Hr=(t,e)=>{let r=M.empty();for(const n of e){const o=t+n;0<=o&&o<64&&Math.abs(ze(t)-ze(o))<=2&&(r=r.with(o))}return r},at=t=>{const e=[];for(let r=0;r<64;r++)e[r]=t(r);return e},ou=at(t=>Hr(t,[-9,-8,-7,-1,1,7,8,9])),su=at(t=>Hr(t,[-17,-15,-10,-6,6,10,15,17])),au={white:at(t=>Hr(t,[7,9])),black:at(t=>Hr(t,[-7,-9]))},Gr=t=>ou[t],qr=t=>su[t],br=(t,e)=>au[t][e],zn=at(t=>M.fromFile(ze(t)).without(t)),jn=at(t=>M.fromRank(vt(t)).without(t)),Kn=at(t=>{const e=new M(134480385,2151686160),r=8*(vt(t)-ze(t));return(r>=0?e.shl64(r):e.shr64(-r)).without(t)}),Wn=at(t=>{const e=new M(270549120,16909320),r=8*(vt(t)+ze(t)-7);return(r>=0?e.shl64(r):e.shr64(-r)).without(t)}),Hn=(t,e,r)=>{let n=r.intersect(e),o=n.bswap64();return n=n.minus64(t),o=o.minus64(t.bswap64()),n.xor(o.bswap64()).intersect(e)},lu=(t,e)=>Hn(M.fromSquare(t),zn[t],e),cu=(t,e)=>{const r=jn[t];let n=e.intersect(r),o=n.rbit64();return n=n.minus64(M.fromSquare(t)),o=o.minus64(M.fromSquare(63-t)),n.xor(o.rbit64()).intersect(r)},qt=(t,e)=>{const r=M.fromSquare(t);return Hn(r,Kn[t],e).xor(Hn(r,Wn[t],e))},Vt=(t,e)=>lu(t,e).xor(cu(t,e)),Gn=(t,e)=>qt(t,e).xor(Vt(t,e)),qn=(t,e)=>{const r=M.fromSquare(e);return jn[t].intersects(r)?jn[t].with(t):Wn[t].intersects(r)?Wn[t].with(t):Kn[t].intersects(r)?Kn[t].with(t):zn[t].intersects(r)?zn[t].with(t):M.empty()},Yt=(t,e)=>qn(t,e).intersect(M.full().shl64(t).xor(M.full().shl64(e))).withoutFirst();class uu{constructor(e){$(this,"capacity");$(this,"cache");this.capacity=e,this.capacity=e,this.cache=new Map}get(e){if(!this.cache.has(e))return;const r=this.cache.get(e);return this.cache.delete(e),this.cache.set(e,r),r}put(e,r){if(this.cache.has(e))this.cache.delete(e);else if(this.cache.size>=this.capacity){const n=this.cache.keys().next().value;this.cache.delete(n)}this.cache.set(e,r)}}var it;(function(t){t.Empty="ERR_EMPTY",t.OppositeCheck="ERR_OPPOSITE_CHECK",t.PawnsOnBackrank="ERR_PAWNS_ON_BACKRANK",t.Kings="ERR_KINGS",t.Variant="ERR_VARIANT"})(it||(it={}));let Nt=class extends Error{};const fu=(t,e,r,n)=>r[e].intersect(Vt(t,n).intersect(r.rooksAndQueens()).union(qt(t,n).intersect(r.bishopsAndQueens())).union(qr(t).intersect(r.knight)).union(Gr(t).intersect(r.king)).union(br(ye(e),t).intersect(r.pawn)));let So=class ur{constructor(){$(this,"castlingRights");$(this,"rook");$(this,"path")}static default(){const e=new ur;return e.castlingRights=M.corners(),e.rook={white:{a:0,h:7},black:{a:56,h:63}},e.path={white:{a:new M(14,0),h:new M(96,0)},black:{a:new M(0,234881024),h:new M(0,1610612736)}},e}static empty(){const e=new ur;return e.castlingRights=M.empty(),e.rook={white:{a:void 0,h:void 0},black:{a:void 0,h:void 0}},e.path={white:{a:M.empty(),h:M.empty()},black:{a:M.empty(),h:M.empty()}},e}clone(){const e=new ur;return e.castlingRights=this.castlingRights,e.rook={white:{a:this.rook.white.a,h:this.rook.white.h},black:{a:this.rook.black.a,h:this.rook.black.h}},e.path={white:{a:this.path.white.a,h:this.path.white.h},black:{a:this.path.black.a,h:this.path.black.h}},e}add(e,r,n,o){const s=yi(e,r),c=_i(e,r);this.castlingRights=this.castlingRights.with(o),this.rook[e][r]=o,this.path[e][r]=Yt(o,c).with(c).union(Yt(n,s).with(s)).without(n).without(o)}static fromSetup(e){const r=ur.empty(),n=e.castlingRights.intersect(e.board.rook);for(const o of Xt){const s=M.backrank(o),c=e.board.kingOf(o);if(!Y(c)||!s.has(c))continue;const f=n.intersect(e.board[o]).intersect(s),d=f.first();Y(d)&&d<c&&r.add(o,"a",c,d);const p=f.last();Y(p)&&c<p&&r.add(o,"h",c,p)}return r}discardRook(e){if(this.castlingRights.has(e)){this.castlingRights=this.castlingRights.without(e);for(const r of Xt)for(const n of xc)this.rook[r][n]===e&&(this.rook[r][n]=void 0)}}discardColor(e){this.castlingRights=this.castlingRights.diff(M.backrank(e)),this.rook[e].a=void 0,this.rook[e].h=void 0}},hu=class{constructor(e){$(this,"rules");$(this,"board");$(this,"pockets");$(this,"turn");$(this,"castles");$(this,"epSquare");$(this,"remainingChecks");$(this,"halfmoves");$(this,"fullmoves");$(this,"c_cache",new uu(64));this.rules=e}reset(){this.board=_s.default(),this.pockets=void 0,this.turn="white",this.castles=So.default(),this.epSquare=void 0,this.remainingChecks=void 0,this.halfmoves=0,this.fullmoves=1}setupUnchecked(e){this.board=e.board.clone(),this.board.promoted=M.empty(),this.pockets=void 0,this.turn=e.turn,this.castles=So.fromSetup(e),this.epSquare=du(this,e.epSquare),this.remainingChecks=void 0,this.halfmoves=e.halfmoves,this.fullmoves=e.fullmoves}kingAttackers(e,r,n){return fu(e,r,this.board,n)}playCaptureAt(e,r){this.halfmoves=0,r.role==="rook"&&this.castles.discardRook(e),this.pockets&&this.pockets[ye(r.color)][r.promoted?"pawn":r.role]++}ctx(){const e=this.isVariantEnd(),r=this.board.kingOf(this.turn);if(!Y(r))return{king:r,blockers:M.empty(),checkers:M.empty(),variantEnd:e,mustCapture:!1};const n=Vt(r,M.empty()).intersect(this.board.rooksAndQueens()).union(qt(r,M.empty()).intersect(this.board.bishopsAndQueens())).intersect(this.board[ye(this.turn)]);let o=M.empty();for(const c of n){const f=Yt(r,c).intersect(this.board.occupied);f.moreThanOne()||(o=o.union(f))}const s=this.kingAttackers(r,ye(this.turn),this.board.occupied);return{king:r,blockers:o,checkers:s,variantEnd:e,mustCapture:!1}}clone(){var r,n;const e=new this.constructor;return e.board=this.board.clone(),e.pockets=(r=this.pockets)==null?void 0:r.clone(),e.turn=this.turn,e.castles=this.castles.clone(),e.epSquare=this.epSquare,e.remainingChecks=(n=this.remainingChecks)==null?void 0:n.clone(),e.halfmoves=this.halfmoves,e.fullmoves=this.fullmoves,e}validate(){if(this.board.occupied.isEmpty())return H.err(new Nt(it.Empty));if(this.board.king.size()!==2)return H.err(new Nt(it.Kings));if(!Y(this.board.kingOf(this.turn)))return H.err(new Nt(it.Kings));const e=this.board.kingOf(ye(this.turn));return Y(e)?this.kingAttackers(e,this.turn,this.board.occupied).nonEmpty()?H.err(new Nt(it.OppositeCheck)):M.backranks().intersects(this.board.pawn)?H.err(new Nt(it.PawnsOnBackrank)):H.ok(void 0):H.err(new Nt(it.Kings))}dropDests(e){return M.empty()}dests(e,r){let n=this.c_cache.get(e+"");if(n)return n;if(r=r||this.ctx(),r.variantEnd)return M.empty();const o=this.board.get(e);if(!o||o.color!==this.turn)return M.empty();let s,c;if(o.role==="pawn"){s=br(this.turn,e).intersect(this.board[ye(this.turn)]);const f=this.turn==="white"?8:-8,d=e+f;if(0<=d&&d<64&&!this.board.occupied.has(d)){s=s.with(d);const p=this.turn==="white"?e<16:e>=48,w=d+f;p&&!this.board.occupied.has(w)&&(s=s.with(w))}Y(this.epSquare)&&Ao(this,e,r)&&(c=M.fromSquare(this.epSquare))}else o.role==="bishop"?s=qt(e,this.board.occupied):o.role==="knight"?s=qr(e):o.role==="rook"?s=Vt(e,this.board.occupied):o.role==="queen"?s=Gn(e,this.board.occupied):s=Gr(e);if(s=s.diff(this.board[this.turn]),Y(r.king)){if(o.role==="king"){const f=this.board.occupied.without(e);for(const d of s)this.kingAttackers(d,ye(this.turn),f).nonEmpty()&&(s=s.without(d));return s.union(Mr(this,"a",r)).union(Mr(this,"h",r))}if(r.checkers.nonEmpty()){const f=r.checkers.singleSquare();if(!Y(f))return M.empty();s=s.intersect(Yt(f,r.king).with(f))}r.blockers.has(e)&&(s=s.intersect(qn(e,r.king)))}return c&&(s=s.union(c)),this.c_cache.put(e+"",s),s}pseudo_dests(e,r){if(r=r||this.ctx(),r.variantEnd)return M.empty();const n=this.board.get(e);if(!n||n.color!==this.turn)return M.empty();let o,s;if(n.role==="pawn"){o=br(this.turn,e);const c=this.turn==="white"?8:-8,f=e+c;if(0<=f&&f<64&&!this.board.occupied.has(f)){o=o.with(f);const d=this.turn==="white"?e<16:e>=48,p=f+c;d&&!this.board.occupied.has(p)&&(o=o.with(p))}Y(this.epSquare)&&Ao(this,e,r)&&(s=M.fromSquare(this.epSquare))}else n.role==="bishop"?o=qt(e,this.board.occupied):n.role==="knight"?o=qr(e):n.role==="rook"?o=Vt(e,this.board.occupied):n.role==="queen"?o=Gn(e,this.board.occupied):o=Gr(e);if(Y(r.king)){if(n.role==="king"){this.board.occupied.without(e);for(const c of o);return o.union(Mr(this,"a",r)).union(Mr(this,"h",r))}if(r.checkers.nonEmpty()){const c=r.checkers.singleSquare();if(!Y(c))return M.empty();o=o.intersect(Yt(c,r.king).with(c))}r.blockers.has(e)&&(o=o.intersect(qn(e,r.king)))}return s&&(o=o.union(s)),o}isVariantEnd(){return!1}variantOutcome(e){}hasInsufficientMaterial(e){return this.board[e].intersect(this.board.pawn.union(this.board.rooksAndQueens())).nonEmpty()?!1:this.board[e].intersects(this.board.knight)?this.board[e].size()<=2&&this.board[ye(e)].diff(this.board.king).diff(this.board.queen).isEmpty():this.board[e].intersects(this.board.bishop)?(!this.board.bishop.intersects(M.darkSquares())||!this.board.bishop.intersects(M.lightSquares()))&&this.board.pawn.isEmpty()&&this.board.knight.isEmpty():!0}toSetup(){var e,r;return{board:this.board.clone(),pockets:(e=this.pockets)==null?void 0:e.clone(),turn:this.turn,castlingRights:this.castles.castlingRights,epSquare:pu(this),remainingChecks:(r=this.remainingChecks)==null?void 0:r.clone(),halfmoves:Math.min(this.halfmoves,150),fullmoves:Math.min(Math.max(this.fullmoves,1),9999)}}isInsufficientMaterial(){return Xt.every(e=>this.hasInsufficientMaterial(e))}hasDests(e){e=e||this.ctx();for(const r of this.board[this.turn])if(this.dests(r,e).nonEmpty())return!0;return this.dropDests(e).nonEmpty()}isLegal(e,r){{if(e.promotion==="pawn"||e.promotion==="king"&&this.rules!=="antichess"||!!e.promotion!==(this.board.pawn.has(e.from)&&M.backranks().has(e.to)))return!1;const n=this.dests(e.from,r);return n.has(e.to)||n.has(mu(this,e).to)}}isCheck(){const e=this.board.kingOf(this.turn);return Y(e)&&this.kingAttackers(e,ye(this.turn),this.board.occupied).nonEmpty()}isEnd(e){return(e?e.variantEnd:this.isVariantEnd())?!0:this.isInsufficientMaterial()||!this.hasDests(e)}isCheckmate(e){return e=e||this.ctx(),!e.variantEnd&&e.checkers.nonEmpty()&&!this.hasDests(e)}isStalemate(e){return e=e||this.ctx(),!e.variantEnd&&e.checkers.isEmpty()&&!this.hasDests(e)}outcome(e){const r=this.variantOutcome(e);return r||(e=e||this.ctx(),this.isCheckmate(e)?{winner:ye(this.turn)}:this.isInsufficientMaterial()||this.isStalemate(e)?{winner:void 0}:void 0)}allDests(e){e=e||this.ctx();const r=new Map;if(e.variantEnd)return r;for(const n of this.board[this.turn])r.set(n,this.dests(n,e));return r}play(e){const r=this.turn,n=this.epSquare,o=Ss(this,e);this.epSquare=void 0,this.halfmoves+=1,r==="black"&&(this.fullmoves+=1),this.turn=ye(r);{const s=this.board.take(e.from);if(!s)return;let c;if(s.role==="pawn"){this.halfmoves=0,e.to===n&&(c=this.board.take(e.to+(r==="white"?-8:8)));const f=e.from-e.to;Math.abs(f)===16&&8<=e.from&&e.from<=55&&(this.epSquare=e.from+e.to>>1),e.promotion&&(s.role=e.promotion,s.promoted=!!this.pockets)}else if(s.role==="rook")this.castles.discardRook(e.from);else if(s.role==="king"){if(o){const f=this.castles.rook[r][o];if(Y(f)){const d=this.board.take(f);this.board.set(yi(r,o),s),d&&this.board.set(_i(r,o),d)}}this.castles.discardColor(r)}if(!o){const f=this.board.set(e.to,s)||c;f&&this.playCaptureAt(e.to,f)}}this.remainingChecks&&this.isCheck()&&(this.remainingChecks[r]=Math.max(this.remainingChecks[r]-1,0))}},Si=class extends hu{constructor(){super("chess")}static default(){const e=new this;return e.reset(),e}static fromSetup(e){const r=new this;return r.setupUnchecked(e),r.validate().map(n=>r)}clone(){return super.clone()}};const du=(t,e)=>{if(!Y(e))return;const r=t.turn==="white"?5:2,n=t.turn==="white"?8:-8;if(vt(e)!==r||t.board.occupied.has(e+n))return;const o=e-n;if(!(!t.board.pawn.has(o)||!t.board[ye(t.turn)].has(o)))return e},pu=t=>{if(!Y(t.epSquare))return;const e=t.ctx(),n=t.board.pieces(t.turn,"pawn").intersect(br(ye(t.turn),t.epSquare));for(const o of n)if(t.dests(o,e).has(t.epSquare))return t.epSquare},Ao=(t,e,r)=>{if(!Y(t.epSquare)||!br(t.turn,e).has(t.epSquare))return!1;if(!Y(r.king))return!0;const n=t.turn==="white"?8:-8,o=t.epSquare-n;return t.kingAttackers(r.king,ye(t.turn),t.board.occupied.toggle(e).toggle(o).with(t.epSquare)).without(o).isEmpty()},Mr=(t,e,r)=>{if(!Y(r.king)||r.checkers.nonEmpty())return M.empty();const n=t.castles.rook[t.turn][e];if(!Y(n)||t.castles.path[t.turn][e].intersects(t.board.occupied))return M.empty();const o=yi(t.turn,e),s=Yt(r.king,o),c=t.board.occupied.without(r.king);for(const p of s)if(t.kingAttackers(p,ye(t.turn),c).nonEmpty())return M.empty();const f=_i(t.turn,e),d=t.board.occupied.toggle(r.king).toggle(n).toggle(f);return t.kingAttackers(o,ye(t.turn),d).nonEmpty()?M.empty():M.fromSquare(n)},Ss=(t,e)=>{const r=e.to-e.from;if(!(Math.abs(r)!==2&&!t.board[t.turn].has(e.to))&&t.board.king.has(e.from))return r>0?"h":"a"},mu=(t,e)=>{const r=Ss(t,e);if(!r)return e;const n=t.castles.rook[t.turn][r];return{from:e.from,to:Y(n)?n:e.to}},gu=(t,e)=>{let r="";{const n=t.board.getRole(e.from);if(!n)return"--";if(n==="king"&&(t.board[t.turn].has(e.to)||Math.abs(e.to-e.from)===2))r=e.to>e.from?"O-O":"O-O-O";else{const o=t.board.occupied.has(e.to)||n==="pawn"&&ze(e.from)!==ze(e.to);if(n!=="pawn"){r=vo(n).toUpperCase();let s;if(n==="king"?s=Gr(e.to).intersect(t.board.king):n==="queen"?s=Gn(e.to,t.board.occupied).intersect(t.board.queen):n==="rook"?s=Vt(e.to,t.board.occupied).intersect(t.board.rook):n==="bishop"?s=qt(e.to,t.board.occupied).intersect(t.board.bishop):s=qr(e.to).intersect(t.board.knight),s=s.intersect(t.board[t.turn]).without(e.from),s.nonEmpty()){const c=t.ctx();for(const f of s)t.dests(f,c).has(e.to)||(s=s.without(f));if(s.nonEmpty()){let f=!1,d=s.intersects(M.fromRank(vt(e.from)));s.intersects(M.fromFile(ze(e.from)))?f=!0:d=!0,d&&(r+=xn[ze(e.from)]),f&&(r+=ys[vt(e.from)])}}}else o&&(r=xn[ze(e.from)]);o&&(r+="x"),r+=Uc(e.to),e.promotion&&(r+="="+vo(e.promotion).toUpperCase())}}return r},wu=(t,e)=>{var n;const r=gu(t,e);return t.play(e),(n=t.outcome())!=null&&n.winner?r+"#":t.isCheck()?r+"+":r},As=(t,e)=>wu(t.clone(),e),bu="modulepreload",ku=function(t,e){return new URL(t,e).href},Co={},vu=function(e,r,n){let o=Promise.resolve();if(r&&r.length>0){const c=document.getElementsByTagName("link"),f=document.querySelector("meta[property=csp-nonce]"),d=(f==null?void 0:f.nonce)||(f==null?void 0:f.getAttribute("nonce"));o=Promise.allSettled(r.map(p=>{if(p=ku(p,n),p in Co)return;Co[p]=!0;const w=p.endsWith(".css"),g=w?'[rel="stylesheet"]':"";if(!!n)for(let C=c.length-1;C>=0;C--){const v=c[C];if(v.href===p&&(!w||v.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${p}"]${g}`))return;const S=document.createElement("link");if(S.rel=w?"stylesheet":bu,w||(S.as="script"),S.crossOrigin="",S.href=p,d&&S.setAttribute("nonce",d),document.head.appendChild(S),w)return new Promise((C,v)=>{S.addEventListener("load",C),S.addEventListener("error",()=>v(new Error(`Unable to preload CSS for ${p}`)))})}))}function s(c){const f=new Event("vite:preloadError",{cancelable:!0});if(f.payload=c,window.dispatchEvent(f),!f.defaultPrevented)throw c}return o.then(c=>{for(const f of c||[])f.status==="rejected"&&s(f.reason);return e().catch(s)})};var yu=(()=>{var t=import.meta.url;return async function(e={}){var r,n=e,o,s,c=new Promise((i,a)=>{o=i,s=a});["_get_attacks","_get_occupied","_get_pieces_color_bb","_get_fen","_get_pieces_bb","_get_turn","_is_checkmate","_pos_attacks_to","_pos_attacks","_get_at","_create_position","_delete_position","_make_move","_unmake_move","_get_legal_moves","_free_legal_moves","_init","_malloc","_free","setValue","getValue","stringToUTF8","UTF8ToString","_memory","___indirect_function_table","onRuntimeInitialized"].forEach(i=>{Object.getOwnPropertyDescriptor(c,i)||Object.defineProperty(c,i,{get:()=>se("You are getting "+i+" on the Promise object, instead of the instance. Use .then() to get called back with the instance, see the MODULARIZE docs in src/settings.js"),set:()=>se("You are setting "+i+" on the Promise object, instead of the instance. Use .then() to get called back with the instance, see the MODULARIZE docs in src/settings.js")})});var f=typeof window=="object",d=typeof WorkerGlobalScope<"u",p=typeof process=="object"&&typeof process.versions=="object"&&typeof process.versions.node=="string"&&process.type!="renderer",w=!f&&!p&&!d;if(p){const{createRequire:i}=await vu(async()=>{const{createRequire:l}=await Promise.resolve().then(()=>Mf);return{createRequire:l}},void 0,import.meta.url);let a=import.meta.url;a.startsWith("data:")&&(a="/");var g=i(a)}var _=Object.assign({},n),S="./this.program",C="";function v(i){return n.locateFile?n.locateFile(i,C):C+i}var B,P;if(p){if(typeof process>"u"||!process.release||process.release.name!=="node")throw new Error("not compiled for this environment (did you build to HTML and try to run it not on the web, or set ENVIRONMENT to something - like node - and run it someplace else - like on the web?)");var R=process.versions.node,I=R.split(".").slice(0,3);if(I=I[0]*1e4+I[1]*100+I[2].split("-")[0]*1,I<16e4)throw new Error("This emscripten-generated code requires node v16.0.0 (detected v"+R+")");var O=g("fs"),T=g("path");import.meta.url.startsWith("data:")||(C=T.dirname(g("url").fileURLToPath(import.meta.url))+"/"),P=i=>{i=er(i)?new URL(i):T.normalize(i);var a=O.readFileSync(i);return E(a.buffer),a},B=(i,a=!0)=>(i=er(i)?new URL(i):T.normalize(i),new Promise((l,h)=>{O.readFile(i,a?void 0:"utf8",(m,b)=>{m?h(m):l(a?b.buffer:b)})})),!n.thisProgram&&process.argv.length>1&&(S=process.argv[1].replace(/\\/g,"/")),process.argv.slice(2)}else if(w){if(typeof process=="object"&&typeof g=="function"||typeof window=="object"||typeof WorkerGlobalScope<"u")throw new Error("not compiled for this environment (did you build to HTML and try to run it not on the web, or set ENVIRONMENT to something - like node - and run it someplace else - like on the web?)")}else if(f||d){if(d?C=self.location.href:typeof document<"u"&&document.currentScript&&(C=document.currentScript.src),t&&(C=t),C.startsWith("blob:")?C="":C=C.substr(0,C.replace(/[?#].*/,"").lastIndexOf("/")+1),!(typeof window=="object"||typeof WorkerGlobalScope<"u"))throw new Error("not compiled for this environment (did you build to HTML and try to run it not on the web, or set ENVIRONMENT to something - like node - and run it someplace else - like on the web?)");d&&(P=i=>{var a=new XMLHttpRequest;return a.open("GET",i,!1),a.responseType="arraybuffer",a.send(null),new Uint8Array(a.response)}),B=i=>er(i)?new Promise((a,l)=>{var h=new XMLHttpRequest;h.open("GET",i,!0),h.responseType="arraybuffer",h.onload=()=>{if(h.status==200||h.status==0&&h.response){a(h.response);return}l(h.status)},h.onerror=l,h.send(null)}):fetch(i,{credentials:"same-origin"}).then(a=>a.ok?a.arrayBuffer():Promise.reject(new Error(a.status+" : "+a.url)))}else throw new Error("environment detection error");var x=n.print||console.log.bind(console),U=n.printErr||console.error.bind(console);Object.assign(n,_),_=null,$a(),n.arguments&&n.arguments,dt("arguments","arguments_"),n.thisProgram&&(S=n.thisProgram),dt("thisProgram","thisProgram"),E(typeof n.memoryInitializerPrefixURL>"u","Module.memoryInitializerPrefixURL option was removed, use Module.locateFile instead"),E(typeof n.pthreadMainPrefixURL>"u","Module.pthreadMainPrefixURL option was removed, use Module.locateFile instead"),E(typeof n.cdInitializerPrefixURL>"u","Module.cdInitializerPrefixURL option was removed, use Module.locateFile instead"),E(typeof n.filePackagePrefixURL>"u","Module.filePackagePrefixURL option was removed, use Module.locateFile instead"),E(typeof n.read>"u","Module.read option was removed"),E(typeof n.readAsync>"u","Module.readAsync option was removed (modify readAsync in JS)"),E(typeof n.readBinary>"u","Module.readBinary option was removed (modify readBinary in JS)"),E(typeof n.setWindowTitle>"u","Module.setWindowTitle option was removed (modify emscripten_set_window_title in JS)"),E(typeof n.TOTAL_MEMORY>"u","Module.TOTAL_MEMORY has been renamed Module.INITIAL_MEMORY"),dt("asm","wasmExports"),dt("readAsync","readAsync"),dt("readBinary","readBinary"),dt("setWindowTitle","setWindowTitle"),E(!w,"shell environment detected but not enabled at build time.  Add `shell` to `-sENVIRONMENT` to enable.");var D=n.wasmBinary;dt("wasmBinary","wasmBinary"),typeof WebAssembly!="object"&&U("no native wasm support detected");var L,F=!1;function E(i,a){i||se("Assertion failed"+(a?": "+a:""))}var q,Ie,Ge,oe,W,Oe,At;function xi(){var i=L.buffer;n.HEAP8=q=new Int8Array(i),n.HEAP16=Ge=new Int16Array(i),n.HEAPU8=Ie=new Uint8Array(i),n.HEAPU16=new Uint16Array(i),n.HEAP32=oe=new Int32Array(i),n.HEAPU32=W=new Uint32Array(i),n.HEAPF32=Oe=new Float32Array(i),n.HEAPF64=At=new Float64Array(i)}E(!n.STACK_SIZE,"STACK_SIZE can no longer be set at runtime.  Use -sSTACK_SIZE at link time"),E(typeof Int32Array<"u"&&typeof Float64Array<"u"&&Int32Array.prototype.subarray!=null&&Int32Array.prototype.set!=null,"JS engine does not provide full typed array support"),E(!n.wasmMemory,"Use of `wasmMemory` detected.  Use -sIMPORTED_MEMORY to define wasmMemory externally"),E(!n.INITIAL_MEMORY,"Detected runtime INITIAL_MEMORY setting.  Use -sIMPORTED_MEMORY to define wasmMemory dynamically");function zs(){var i=dn();E((i&3)==0),i==0&&(i+=4),W[i>>2]=34821223,W[i+4>>2]=2310721022,W[0]=1668509029}function sn(){if(!F){var i=dn();i==0&&(i+=4);var a=W[i>>2],l=W[i+4>>2];(a!=34821223||l!=2310721022)&&se(`Stack overflow! Stack cookie has been overwritten at ${rr(i)}, expected hex dwords 0x89BACDFE and 0x2135467, but received ${rr(l)} ${rr(a)}`),W[0]!=1668509029&&se("Runtime error: The application has corrupted its heap memory area (address zero)!")}}var Di=[],Li=[],Ii=[],Ar=!1;function js(){if(n.preRun)for(typeof n.preRun=="function"&&(n.preRun=[n.preRun]);n.preRun.length;)Hs(n.preRun.shift());ln(Di)}function Ks(){E(!Ar),Ar=!0,sn(),!n.noFSInit&&!u.initialized&&u.init(),u.ignorePermissions=!1,ln(Li)}function Ws(){if(sn(),n.postRun)for(typeof n.postRun=="function"&&(n.postRun=[n.postRun]);n.postRun.length;)qs(n.postRun.shift());ln(Ii)}function Hs(i){Di.unshift(i)}function Gs(i){Li.unshift(i)}function qs(i){Ii.unshift(i)}E(Math.imul,"This browser does not support Math.imul(), build with LEGACY_VM_SUPPORT or POLYFILL_OLD_MATH_FUNCTIONS to add in a polyfill"),E(Math.fround,"This browser does not support Math.fround(), build with LEGACY_VM_SUPPORT or POLYFILL_OLD_MATH_FUNCTIONS to add in a polyfill"),E(Math.clz32,"This browser does not support Math.clz32(), build with LEGACY_VM_SUPPORT or POLYFILL_OLD_MATH_FUNCTIONS to add in a polyfill"),E(Math.trunc,"This browser does not support Math.trunc(), build with LEGACY_VM_SUPPORT or POLYFILL_OLD_MATH_FUNCTIONS to add in a polyfill");var ft=0,ht=null,Zt=null,Ct={};function Ui(i){for(var a=i;;){if(!Ct[i])return i;i=a+Math.random()}}function an(i){var a;ft++,(a=n.monitorRunDependencies)==null||a.call(n,ft),i?(E(!Ct[i]),Ct[i]=1,ht===null&&typeof setInterval<"u"&&(ht=setInterval(()=>{if(F){clearInterval(ht),ht=null;return}var l=!1;for(var h in Ct)l||(l=!0,U("still waiting on run dependencies:")),U(`dependency: ${h}`);l&&U("(end of list)")},1e4))):U("warning: run dependency added without ID")}function Cr(i){var l;if(ft--,(l=n.monitorRunDependencies)==null||l.call(n,ft),i?(E(Ct[i]),delete Ct[i]):U("warning: run dependency removed without ID"),ft==0&&(ht!==null&&(clearInterval(ht),ht=null),Zt)){var a=Zt;Zt=null,a()}}function se(i){var l;(l=n.onAbort)==null||l.call(n,i),i="Aborted("+i+")",U(i),F=!0;var a=new WebAssembly.RuntimeError(i);throw s(a),a}var Vs="data:application/octet-stream;base64,",Bi=i=>i.startsWith(Vs),er=i=>i.startsWith("file://");function ne(i,a){return(...l)=>{E(Ar,`native function \`${i}\` called before runtime initialization`);var h=mt[i];return E(h,`exported native function \`${i}\` not found`),E(l.length<=a,`native function \`${i}\` called with ${l.length} args but expects ${a}`),h(...l)}}function Ys(){if(n.locateFile){var i="hopefox.wasm";return Bi(i)?i:v(i)}return new URL("hopefox.wasm",import.meta.url).href}var tr;function zi(i){if(i==tr&&D)return new Uint8Array(D);if(P)return P(i);throw"both async and sync fetching of the wasm failed"}function Qs(i){return D?Promise.resolve().then(()=>zi(i)):B(i).then(a=>new Uint8Array(a),()=>zi(i))}function ji(i,a,l){return Qs(i).then(h=>WebAssembly.instantiate(h,a)).then(l,h=>{U(`failed to asynchronously prepare wasm: ${h}`),er(tr)&&U(`warning: Loading from a file URI (${tr}) is not supported in most browsers. See https://emscripten.org/docs/getting_started/FAQ.html#how-do-i-run-a-local-webserver-for-testing-why-does-my-program-stall-in-downloading-or-preparing`),se(h)})}function Xs(i,a,l,h){return!i&&typeof WebAssembly.instantiateStreaming=="function"&&!Bi(a)&&!er(a)&&!p&&typeof fetch=="function"?fetch(a,{credentials:"same-origin"}).then(m=>{var b=WebAssembly.instantiateStreaming(m,l);return b.then(h,function(k){return U(`wasm streaming compile failed: ${k}`),U("falling back to ArrayBuffer instantiation"),ji(a,l,h)})}):ji(a,l,h)}function Js(){return{env:Ji,wasi_snapshot_preview1:Ji}}function Zs(){function i(m,b){return mt=m.exports,L=mt.memory,E(L,"memory not found in wasm exports"),xi(),Gs(mt.__wasm_call_ctors),Cr("wasm-instantiate"),mt}an("wasm-instantiate");var a=n;function l(m){E(n===a,"the Module object should not be replaced during async compilation - perhaps the order of HTML elements is wrong?"),a=null,i(m.instance)}var h=Js();if(n.instantiateWasm)try{return n.instantiateWasm(h,i)}catch(m){U(`Module.instantiateWasm callback failed with error: ${m}`),s(m)}return tr??(tr=Ys()),Xs(D,tr,h,l).catch(s),{}}var Q,me;if((()=>{var i=new Int16Array(1),a=new Int8Array(i.buffer);if(i[0]=25459,a[0]!==115||a[1]!==99)throw"Runtime error: expected the system to be little-endian! (Run with -sSUPPORT_BIG_ENDIAN to bypass)"})(),n.ENVIRONMENT)throw new Error("Module.ENVIRONMENT has been deprecated. To force the environment, use the ENVIRONMENT compile-time option (for example, -sENVIRONMENT=web or -sENVIRONMENT=node)");function dt(i,a,l=!0){Object.getOwnPropertyDescriptor(n,i)||Object.defineProperty(n,i,{configurable:!0,get(){let h=l?" (the initial value can be provided on Module, but after startup the value is only looked for on a local variable of that name)":"";se(`\`Module.${i}\` has been replaced by \`${a}\``+h)}})}function ea(i){Object.getOwnPropertyDescriptor(n,i)&&se(`\`Module.${i}\` was supplied but \`${i}\` not included in INCOMING_MODULE_JS_API`)}function Ki(i){return i==="FS_createPath"||i==="FS_createDataFile"||i==="FS_createPreloadedFile"||i==="FS_unlink"||i==="addRunDependency"||i==="FS_createLazyFile"||i==="FS_createDevice"||i==="removeRunDependency"}function Wi(i,a){typeof globalThis<"u"&&!Object.getOwnPropertyDescriptor(globalThis,i)&&Object.defineProperty(globalThis,i,{configurable:!0,get(){a()}})}function Hi(i,a){Wi(i,()=>{qe(`\`${i}\` is not longer defined by emscripten. ${a}`)})}Hi("buffer","Please use HEAP8.buffer or wasmMemory.buffer"),Hi("asm","Please use wasmExports instead");function ta(i){Wi(i,()=>{var a=`\`${i}\` is a library symbol and not included by default; add it to your library.js __deps or to DEFAULT_LIBRARY_FUNCS_TO_INCLUDE on the command line`,l=i;l.startsWith("_")||(l="$"+i),a+=` (e.g. -sDEFAULT_LIBRARY_FUNCS_TO_INCLUDE='${l}')`,Ki(i)&&(a+=". Alternatively, forcing filesystem support (-sFORCE_FILESYSTEM) can export this for you"),qe(a)}),Gi(i)}function Gi(i){Object.getOwnPropertyDescriptor(n,i)||Object.defineProperty(n,i,{configurable:!0,get(){var a=`'${i}' was not exported. add it to EXPORTED_RUNTIME_METHODS (see the Emscripten FAQ)`;Ki(i)&&(a+=". Alternatively, forcing filesystem support (-sFORCE_FILESYSTEM) can export this for you"),se(a)}})}var ln=i=>{for(;i.length>0;)i.shift()(n)};function ra(i,a="i8"){switch(a.endsWith("*")&&(a="*"),a){case"i1":return q[i];case"i8":return q[i];case"i16":return Ge[i>>1];case"i32":return oe[i>>2];case"i64":se("to do getValue(i64) use WASM_BIGINT");case"float":return Oe[i>>2];case"double":return At[i>>3];case"*":return W[i>>2];default:se(`invalid type for getValue: ${a}`)}}n.getValue=ra,n.noExitRuntime;var rr=i=>(E(typeof i=="number"),i>>>=0,"0x"+i.toString(16).padStart(8,"0"));function na(i,a,l="i8"){switch(l.endsWith("*")&&(l="*"),l){case"i1":q[i]=a;break;case"i8":q[i]=a;break;case"i16":Ge[i>>1]=a;break;case"i32":oe[i>>2]=a;break;case"i64":se("to do setValue(i64) use WASM_BIGINT");case"float":Oe[i>>2]=a;break;case"double":At[i>>3]=a;break;case"*":W[i>>2]=a;break;default:se(`invalid type for setValue: ${l}`)}}n.setValue=na;var qe=i=>{qe.shown||(qe.shown={}),qe.shown[i]||(qe.shown[i]=1,p&&(i="warning: "+i),U(i))},qi=typeof TextDecoder<"u"?new TextDecoder:void 0,Pt=(i,a=0,l=NaN)=>{for(var h=a+l,m=a;i[m]&&!(m>=h);)++m;if(m-a>16&&i.buffer&&qi)return qi.decode(i.subarray(a,m));for(var b="";a<m;){var k=i[a++];if(!(k&128)){b+=String.fromCharCode(k);continue}var y=i[a++]&63;if((k&224)==192){b+=String.fromCharCode((k&31)<<6|y);continue}var N=i[a++]&63;if((k&240)==224?k=(k&15)<<12|y<<6|N:((k&248)!=240&&qe("Invalid UTF-8 leading byte "+rr(k)+" encountered when deserializing a UTF-8 string in wasm memory to a JS string!"),k=(k&7)<<18|y<<12|N<<6|i[a++]&63),k<65536)b+=String.fromCharCode(k);else{var V=k-65536;b+=String.fromCharCode(55296|V>>10,56320|V&1023)}}return b},Tt=(i,a)=>(E(typeof i=="number",`UTF8ToString expects a number (got ${typeof i})`),i?Pt(Ie,i,a):"");n.UTF8ToString=Tt;var ia=(i,a,l,h)=>se(`Assertion failed: ${Tt(i)}, at: `+[a?Tt(a):"unknown filename",l,h?Tt(h):"unknown function"]);class oa{constructor(a){this.excPtr=a,this.ptr=a-24}set_type(a){W[this.ptr+4>>2]=a}get_type(){return W[this.ptr+4>>2]}set_destructor(a){W[this.ptr+8>>2]=a}get_destructor(){return W[this.ptr+8>>2]}set_caught(a){a=a?1:0,q[this.ptr+12]=a}get_caught(){return q[this.ptr+12]!=0}set_rethrown(a){a=a?1:0,q[this.ptr+13]=a}get_rethrown(){return q[this.ptr+13]!=0}init(a,l){this.set_adjusted_ptr(0),this.set_type(a),this.set_destructor(l)}set_adjusted_ptr(a){W[this.ptr+16>>2]=a}get_adjusted_ptr(){return W[this.ptr+16>>2]}}var sa=(i,a,l)=>{var h=new oa(i);h.init(a,l),E(!1,"Exception thrown, but exception catching is not enabled. Compile with -sNO_DISABLE_EXCEPTION_CATCHING or -sEXCEPTION_CATCHING_ALLOWED=[..] to catch.")},aa=()=>se("native code called abort()"),la=(i,a,l)=>Ie.copyWithin(i,a,a+l),cn=(i,a,l,h)=>{if(E(typeof i=="string",`stringToUTF8Array expects a string (got ${typeof i})`),!(h>0))return 0;for(var m=l,b=l+h-1,k=0;k<i.length;++k){var y=i.charCodeAt(k);if(y>=55296&&y<=57343){var N=i.charCodeAt(++k);y=65536+((y&1023)<<10)|N&1023}if(y<=127){if(l>=b)break;a[l++]=y}else if(y<=2047){if(l+1>=b)break;a[l++]=192|y>>6,a[l++]=128|y&63}else if(y<=65535){if(l+2>=b)break;a[l++]=224|y>>12,a[l++]=128|y>>6&63,a[l++]=128|y&63}else{if(l+3>=b)break;y>1114111&&qe("Invalid Unicode code point "+rr(y)+" encountered when serializing a JS string to a UTF-8 string in wasm memory! (Valid unicode code points should be in range 0-0x10FFFF)."),a[l++]=240|y>>18,a[l++]=128|y>>12&63,a[l++]=128|y>>6&63,a[l++]=128|y&63}}return a[l]=0,l-m},nr=(i,a,l)=>(E(typeof l=="number","stringToUTF8(str, outPtr, maxBytesToWrite) is missing the third parameter that specifies the length of the output buffer!"),cn(i,Ie,a,l));n.stringToUTF8=nr;var Pr=i=>{for(var a=0,l=0;l<i.length;++l){var h=i.charCodeAt(l);h<=127?a++:h<=2047?a+=2:h>=55296&&h<=57343?(a+=4,++l):a+=3}return a},ca=(i,a,l,h)=>{var m=new Date().getFullYear(),b=new Date(m,0,1),k=new Date(m,6,1),y=b.getTimezoneOffset(),N=k.getTimezoneOffset(),V=Math.max(y,N);W[i>>2]=V*60,oe[a>>2]=+(y!=N);var ee=z=>{var J=z>=0?"-":"+",ue=Math.abs(z),Ne=String(Math.floor(ue/60)).padStart(2,"0"),Re=String(ue%60).padStart(2,"0");return`UTC${J}${Ne}${Re}`},Z=ee(y),ie=ee(N);E(Z),E(ie),E(Pr(Z)<=16,`timezone name truncated to fit in TZNAME_MAX (${Z})`),E(Pr(ie)<=16,`timezone name truncated to fit in TZNAME_MAX (${ie})`),N<y?(nr(Z,l,17),nr(ie,h,17)):(nr(Z,h,17),nr(ie,l,17))},ua=()=>2147483648,fa=(i,a)=>(E(a,"alignment argument is required"),Math.ceil(i/a)*a),ha=i=>{var a=L.buffer,l=(i-a.byteLength+65535)/65536|0;try{return L.grow(l),xi(),1}catch(h){U(`growMemory: Attempted to grow heap from ${a.byteLength} bytes to ${i} bytes, but got error: ${h}`)}},da=i=>{var a=Ie.length;i>>>=0,E(i>a);var l=ua();if(i>l)return U(`Cannot enlarge memory, requested ${i} bytes, but the limit is ${l} bytes!`),!1;for(var h=1;h<=4;h*=2){var m=a*(1+.2/h);m=Math.min(m,i+100663296);var b=Math.min(l,fa(Math.max(i,m),65536)),k=ha(b);if(k)return!0}return U(`Failed to grow the heap from ${a} bytes to ${b} bytes, not enough memory!`),!1},un={},pa=()=>S||"./this.program",ir=()=>{if(!ir.strings){var i=(typeof navigator=="object"&&navigator.languages&&navigator.languages[0]||"C").replace("-","_")+".UTF-8",a={USER:"web_user",LOGNAME:"web_user",PATH:"/",PWD:"/",HOME:"/home/web_user",LANG:i,_:pa()};for(var l in un)un[l]===void 0?delete a[l]:a[l]=un[l];var h=[];for(var l in a)h.push(`${l}=${a[l]}`);ir.strings=h}return ir.strings},ma=(i,a)=>{for(var l=0;l<i.length;++l)E(i.charCodeAt(l)===(i.charCodeAt(l)&255)),q[a++]=i.charCodeAt(l);q[a]=0},ga=(i,a)=>{var l=0;return ir().forEach((h,m)=>{var b=a+l;W[i+m*4>>2]=b,ma(h,b),l+=h.length+1}),0},wa=(i,a)=>{var l=ir();W[i>>2]=l.length;var h=0;return l.forEach(m=>h+=m.length+1),W[a>>2]=h,0},re={isAbs:i=>i.charAt(0)==="/",splitPath:i=>{var a=/^(\/?|)([\s\S]*?)((?:\.{1,2}|[^\/]+?|)(\.[^.\/]*|))(?:[\/]*)$/;return a.exec(i).slice(1)},normalizeArray:(i,a)=>{for(var l=0,h=i.length-1;h>=0;h--){var m=i[h];m==="."?i.splice(h,1):m===".."?(i.splice(h,1),l++):l&&(i.splice(h,1),l--)}if(a)for(;l;l--)i.unshift("..");return i},normalize:i=>{var a=re.isAbs(i),l=i.substr(-1)==="/";return i=re.normalizeArray(i.split("/").filter(h=>!!h),!a).join("/"),!i&&!a&&(i="."),i&&l&&(i+="/"),(a?"/":"")+i},dirname:i=>{var a=re.splitPath(i),l=a[0],h=a[1];return!l&&!h?".":(h&&(h=h.substr(0,h.length-1)),l+h)},basename:i=>{if(i==="/")return"/";i=re.normalize(i),i=i.replace(/\/$/,"");var a=i.lastIndexOf("/");return a===-1?i:i.substr(a+1)},join:(...i)=>re.normalize(i.join("/")),join2:(i,a)=>re.normalize(i+"/"+a)},ba=()=>{if(typeof crypto=="object"&&typeof crypto.getRandomValues=="function")return h=>crypto.getRandomValues(h);if(p)try{var i=g("crypto"),a=i.randomFillSync;if(a)return h=>i.randomFillSync(h);var l=i.randomBytes;return h=>(h.set(l(h.byteLength)),h)}catch{}se("no cryptographic support found for randomDevice. consider polyfilling it if you want to use something insecure like Math.random(), e.g. put this in a --pre-js: var crypto = { getRandomValues: (array) => { for (var i = 0; i < array.length; i++) array[i] = (Math.random()*256)|0 } };")},Vi=i=>(Vi=ba())(i),tt={resolve:(...i)=>{for(var a="",l=!1,h=i.length-1;h>=-1&&!l;h--){var m=h>=0?i[h]:u.cwd();if(typeof m!="string")throw new TypeError("Arguments to path.resolve must be strings");if(!m)return"";a=m+"/"+a,l=re.isAbs(m)}return a=re.normalizeArray(a.split("/").filter(b=>!!b),!l).join("/"),(l?"/":"")+a||"."},relative:(i,a)=>{i=tt.resolve(i).substr(1),a=tt.resolve(a).substr(1);function l(V){for(var ee=0;ee<V.length&&V[ee]==="";ee++);for(var Z=V.length-1;Z>=0&&V[Z]==="";Z--);return ee>Z?[]:V.slice(ee,Z-ee+1)}for(var h=l(i.split("/")),m=l(a.split("/")),b=Math.min(h.length,m.length),k=b,y=0;y<b;y++)if(h[y]!==m[y]){k=y;break}for(var N=[],y=k;y<h.length;y++)N.push("..");return N=N.concat(m.slice(k)),N.join("/")}},fn=[];function Yi(i,a,l){var h=Pr(i)+1,m=new Array(h),b=cn(i,m,0,m.length);return m.length=b,m}var ka=()=>{if(!fn.length){var i=null;if(p){var a=256,l=Buffer.alloc(a),h=0,m=process.stdin.fd;try{h=O.readSync(m,l,0,a)}catch(b){if(b.toString().includes("EOF"))h=0;else throw b}h>0&&(i=l.slice(0,h).toString("utf-8"))}else typeof window<"u"&&typeof window.prompt=="function"&&(i=window.prompt("Input: "),i!==null&&(i+=`
`));if(!i)return null;fn=Yi(i)}return fn.shift()},pt={ttys:[],init(){},shutdown(){},register(i,a){pt.ttys[i]={input:[],output:[],ops:a},u.registerDevice(i,pt.stream_ops)},stream_ops:{open(i){var a=pt.ttys[i.node.rdev];if(!a)throw new u.ErrnoError(43);i.tty=a,i.seekable=!1},close(i){i.tty.ops.fsync(i.tty)},fsync(i){i.tty.ops.fsync(i.tty)},read(i,a,l,h,m){if(!i.tty||!i.tty.ops.get_char)throw new u.ErrnoError(60);for(var b=0,k=0;k<h;k++){var y;try{y=i.tty.ops.get_char(i.tty)}catch{throw new u.ErrnoError(29)}if(y===void 0&&b===0)throw new u.ErrnoError(6);if(y==null)break;b++,a[l+k]=y}return b&&(i.node.timestamp=Date.now()),b},write(i,a,l,h,m){if(!i.tty||!i.tty.ops.put_char)throw new u.ErrnoError(60);try{for(var b=0;b<h;b++)i.tty.ops.put_char(i.tty,a[l+b])}catch{throw new u.ErrnoError(29)}return h&&(i.node.timestamp=Date.now()),b}},default_tty_ops:{get_char(i){return ka()},put_char(i,a){a===null||a===10?(x(Pt(i.output)),i.output=[]):a!=0&&i.output.push(a)},fsync(i){i.output&&i.output.length>0&&(x(Pt(i.output)),i.output=[])},ioctl_tcgets(i){return{c_iflag:25856,c_oflag:5,c_cflag:191,c_lflag:35387,c_cc:[3,28,127,21,4,0,1,0,17,19,26,0,18,15,23,22,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]}},ioctl_tcsets(i,a,l){return 0},ioctl_tiocgwinsz(i){return[24,80]}},default_tty1_ops:{put_char(i,a){a===null||a===10?(U(Pt(i.output)),i.output=[]):a!=0&&i.output.push(a)},fsync(i){i.output&&i.output.length>0&&(U(Pt(i.output)),i.output=[])}}},Qi=i=>{se("internal error: mmapAlloc called but `emscripten_builtin_memalign` native symbol not exported")},j={ops_table:null,mount(i){return j.createNode(null,"/",16895,0)},createNode(i,a,l,h){if(u.isBlkdev(l)||u.isFIFO(l))throw new u.ErrnoError(63);j.ops_table||(j.ops_table={dir:{node:{getattr:j.node_ops.getattr,setattr:j.node_ops.setattr,lookup:j.node_ops.lookup,mknod:j.node_ops.mknod,rename:j.node_ops.rename,unlink:j.node_ops.unlink,rmdir:j.node_ops.rmdir,readdir:j.node_ops.readdir,symlink:j.node_ops.symlink},stream:{llseek:j.stream_ops.llseek}},file:{node:{getattr:j.node_ops.getattr,setattr:j.node_ops.setattr},stream:{llseek:j.stream_ops.llseek,read:j.stream_ops.read,write:j.stream_ops.write,allocate:j.stream_ops.allocate,mmap:j.stream_ops.mmap,msync:j.stream_ops.msync}},link:{node:{getattr:j.node_ops.getattr,setattr:j.node_ops.setattr,readlink:j.node_ops.readlink},stream:{}},chrdev:{node:{getattr:j.node_ops.getattr,setattr:j.node_ops.setattr},stream:u.chrdev_stream_ops}});var m=u.createNode(i,a,l,h);return u.isDir(m.mode)?(m.node_ops=j.ops_table.dir.node,m.stream_ops=j.ops_table.dir.stream,m.contents={}):u.isFile(m.mode)?(m.node_ops=j.ops_table.file.node,m.stream_ops=j.ops_table.file.stream,m.usedBytes=0,m.contents=null):u.isLink(m.mode)?(m.node_ops=j.ops_table.link.node,m.stream_ops=j.ops_table.link.stream):u.isChrdev(m.mode)&&(m.node_ops=j.ops_table.chrdev.node,m.stream_ops=j.ops_table.chrdev.stream),m.timestamp=Date.now(),i&&(i.contents[a]=m,i.timestamp=m.timestamp),m},getFileDataAsTypedArray(i){return i.contents?i.contents.subarray?i.contents.subarray(0,i.usedBytes):new Uint8Array(i.contents):new Uint8Array(0)},expandFileStorage(i,a){var l=i.contents?i.contents.length:0;if(!(l>=a)){var h=1024*1024;a=Math.max(a,l*(l<h?2:1.125)>>>0),l!=0&&(a=Math.max(a,256));var m=i.contents;i.contents=new Uint8Array(a),i.usedBytes>0&&i.contents.set(m.subarray(0,i.usedBytes),0)}},resizeFileStorage(i,a){if(i.usedBytes!=a)if(a==0)i.contents=null,i.usedBytes=0;else{var l=i.contents;i.contents=new Uint8Array(a),l&&i.contents.set(l.subarray(0,Math.min(a,i.usedBytes))),i.usedBytes=a}},node_ops:{getattr(i){var a={};return a.dev=u.isChrdev(i.mode)?i.id:1,a.ino=i.id,a.mode=i.mode,a.nlink=1,a.uid=0,a.gid=0,a.rdev=i.rdev,u.isDir(i.mode)?a.size=4096:u.isFile(i.mode)?a.size=i.usedBytes:u.isLink(i.mode)?a.size=i.link.length:a.size=0,a.atime=new Date(i.timestamp),a.mtime=new Date(i.timestamp),a.ctime=new Date(i.timestamp),a.blksize=4096,a.blocks=Math.ceil(a.size/a.blksize),a},setattr(i,a){a.mode!==void 0&&(i.mode=a.mode),a.timestamp!==void 0&&(i.timestamp=a.timestamp),a.size!==void 0&&j.resizeFileStorage(i,a.size)},lookup(i,a){throw new u.ErrnoError(44)},mknod(i,a,l,h){return j.createNode(i,a,l,h)},rename(i,a,l){if(u.isDir(i.mode)){var h;try{h=u.lookupNode(a,l)}catch{}if(h)for(var m in h.contents)throw new u.ErrnoError(55)}delete i.parent.contents[i.name],i.parent.timestamp=Date.now(),i.name=l,a.contents[l]=i,a.timestamp=i.parent.timestamp},unlink(i,a){delete i.contents[a],i.timestamp=Date.now()},rmdir(i,a){var l=u.lookupNode(i,a);for(var h in l.contents)throw new u.ErrnoError(55);delete i.contents[a],i.timestamp=Date.now()},readdir(i){var a=[".",".."];for(var l of Object.keys(i.contents))a.push(l);return a},symlink(i,a,l){var h=j.createNode(i,a,41471,0);return h.link=l,h},readlink(i){if(!u.isLink(i.mode))throw new u.ErrnoError(28);return i.link}},stream_ops:{read(i,a,l,h,m){var b=i.node.contents;if(m>=i.node.usedBytes)return 0;var k=Math.min(i.node.usedBytes-m,h);if(E(k>=0),k>8&&b.subarray)a.set(b.subarray(m,m+k),l);else for(var y=0;y<k;y++)a[l+y]=b[m+y];return k},write(i,a,l,h,m,b){if(E(!(a instanceof ArrayBuffer)),a.buffer===q.buffer&&(b=!1),!h)return 0;var k=i.node;if(k.timestamp=Date.now(),a.subarray&&(!k.contents||k.contents.subarray)){if(b)return E(m===0,"canOwn must imply no weird position inside the file"),k.contents=a.subarray(l,l+h),k.usedBytes=h,h;if(k.usedBytes===0&&m===0)return k.contents=a.slice(l,l+h),k.usedBytes=h,h;if(m+h<=k.usedBytes)return k.contents.set(a.subarray(l,l+h),m),h}if(j.expandFileStorage(k,m+h),k.contents.subarray&&a.subarray)k.contents.set(a.subarray(l,l+h),m);else for(var y=0;y<h;y++)k.contents[m+y]=a[l+y];return k.usedBytes=Math.max(k.usedBytes,m+h),h},llseek(i,a,l){var h=a;if(l===1?h+=i.position:l===2&&u.isFile(i.node.mode)&&(h+=i.node.usedBytes),h<0)throw new u.ErrnoError(28);return h},allocate(i,a,l){j.expandFileStorage(i.node,a+l),i.node.usedBytes=Math.max(i.node.usedBytes,a+l)},mmap(i,a,l,h,m){if(!u.isFile(i.node.mode))throw new u.ErrnoError(43);var b,k,y=i.node.contents;if(!(m&2)&&y&&y.buffer===q.buffer)k=!1,b=y.byteOffset;else{if(k=!0,b=Qi(),!b)throw new u.ErrnoError(48);y&&((l>0||l+a<y.length)&&(y.subarray?y=y.subarray(l,l+a):y=Array.prototype.slice.call(y,l,l+a)),q.set(y,b))}return{ptr:b,allocated:k}},msync(i,a,l,h,m){return j.stream_ops.write(i,a,0,h,l,!1),0}}},va=(i,a,l,h)=>{var m=Ui(`al ${i}`);B(i).then(b=>{E(b,`Loading data file "${i}" failed (no arrayBuffer).`),a(new Uint8Array(b)),m&&Cr(m)},b=>{if(l)l();else throw`Loading data file "${i}" failed.`}),m&&an(m)},ya=(i,a,l,h,m,b)=>{u.createDataFile(i,a,l,h,m,b)},_a=n.preloadPlugins||[],Ea=(i,a,l,h)=>{typeof Browser<"u"&&Browser.init();var m=!1;return _a.forEach(b=>{m||b.canHandle(a)&&(b.handle(i,a,l,h),m=!0)}),m},Sa=(i,a,l,h,m,b,k,y,N,V)=>{var ee=a?tt.resolve(re.join2(i,a)):i,Z=Ui(`cp ${ee}`);function ie(z){function J(ue){V==null||V(),y||ya(i,a,ue,h,m,N),b==null||b(),Cr(Z)}Ea(z,ee,J,()=>{k==null||k(),Cr(Z)})||J(z)}an(Z),typeof l=="string"?va(l,ie,k):ie(l)},Aa=i=>{var a={r:0,"r+":2,w:577,"w+":578,a:1089,"a+":1090},l=a[i];if(typeof l>"u")throw new Error(`Unknown file open mode: ${i}`);return l},hn=(i,a)=>{var l=0;return i&&(l|=365),a&&(l|=146),l},Ca=i=>Tt(Da(i)),Xi={EPERM:63,ENOENT:44,ESRCH:71,EINTR:27,EIO:29,ENXIO:60,E2BIG:1,ENOEXEC:45,EBADF:8,ECHILD:12,EAGAIN:6,EWOULDBLOCK:6,ENOMEM:48,EACCES:2,EFAULT:21,ENOTBLK:105,EBUSY:10,EEXIST:20,EXDEV:75,ENODEV:43,ENOTDIR:54,EISDIR:31,EINVAL:28,ENFILE:41,EMFILE:33,ENOTTY:59,ETXTBSY:74,EFBIG:22,ENOSPC:51,ESPIPE:70,EROFS:69,EMLINK:34,EPIPE:64,EDOM:18,ERANGE:68,ENOMSG:49,EIDRM:24,ECHRNG:106,EL2NSYNC:156,EL3HLT:107,EL3RST:108,ELNRNG:109,EUNATCH:110,ENOCSI:111,EL2HLT:112,EDEADLK:16,ENOLCK:46,EBADE:113,EBADR:114,EXFULL:115,ENOANO:104,EBADRQC:103,EBADSLT:102,EDEADLOCK:16,EBFONT:101,ENOSTR:100,ENODATA:116,ETIME:117,ENOSR:118,ENONET:119,ENOPKG:120,EREMOTE:121,ENOLINK:47,EADV:122,ESRMNT:123,ECOMM:124,EPROTO:65,EMULTIHOP:36,EDOTDOT:125,EBADMSG:9,ENOTUNIQ:126,EBADFD:127,EREMCHG:128,ELIBACC:129,ELIBBAD:130,ELIBSCN:131,ELIBMAX:132,ELIBEXEC:133,ENOSYS:52,ENOTEMPTY:55,ENAMETOOLONG:37,ELOOP:32,EOPNOTSUPP:138,EPFNOSUPPORT:139,ECONNRESET:15,ENOBUFS:42,EAFNOSUPPORT:5,EPROTOTYPE:67,ENOTSOCK:57,ENOPROTOOPT:50,ESHUTDOWN:140,ECONNREFUSED:14,EADDRINUSE:3,ECONNABORTED:13,ENETUNREACH:40,ENETDOWN:38,ETIMEDOUT:73,EHOSTDOWN:142,EHOSTUNREACH:23,EINPROGRESS:26,EALREADY:7,EDESTADDRREQ:17,EMSGSIZE:35,EPROTONOSUPPORT:66,ESOCKTNOSUPPORT:137,EADDRNOTAVAIL:4,ENETRESET:39,EISCONN:30,ENOTCONN:53,ETOOMANYREFS:141,EUSERS:136,EDQUOT:19,ESTALE:72,ENOTSUP:138,ENOMEDIUM:148,EILSEQ:25,EOVERFLOW:61,ECANCELED:11,ENOTRECOVERABLE:56,EOWNERDEAD:62,ESTRPIPE:135},u={root:null,mounts:[],devices:{},streams:[],nextInode:1,nameTable:null,currentPath:"/",initialized:!1,ignorePermissions:!0,ErrnoError:class extends Error{constructor(a){super(Ar?Ca(a):"");$(this,"name","ErrnoError");this.errno=a;for(var l in Xi)if(Xi[l]===a){this.code=l;break}}},filesystems:null,syncFSRequests:0,readFiles:{},FSStream:class{constructor(){$(this,"shared",{})}get object(){return this.node}set object(i){this.node=i}get isRead(){return(this.flags&2097155)!==1}get isWrite(){return(this.flags&2097155)!==0}get isAppend(){return this.flags&1024}get flags(){return this.shared.flags}set flags(i){this.shared.flags=i}get position(){return this.shared.position}set position(i){this.shared.position=i}},FSNode:class{constructor(i,a,l,h){$(this,"node_ops",{});$(this,"stream_ops",{});$(this,"readMode",365);$(this,"writeMode",146);$(this,"mounted",null);i||(i=this),this.parent=i,this.mount=i.mount,this.id=u.nextInode++,this.name=a,this.mode=l,this.rdev=h}get read(){return(this.mode&this.readMode)===this.readMode}set read(i){i?this.mode|=this.readMode:this.mode&=~this.readMode}get write(){return(this.mode&this.writeMode)===this.writeMode}set write(i){i?this.mode|=this.writeMode:this.mode&=~this.writeMode}get isFolder(){return u.isDir(this.mode)}get isDevice(){return u.isChrdev(this.mode)}},lookupPath(i,a={}){if(i=tt.resolve(i),!i)return{path:"",node:null};var l={follow_mount:!0,recurse_count:0};if(a=Object.assign(l,a),a.recurse_count>8)throw new u.ErrnoError(32);for(var h=i.split("/").filter(Z=>!!Z),m=u.root,b="/",k=0;k<h.length;k++){var y=k===h.length-1;if(y&&a.parent)break;if(m=u.lookupNode(m,h[k]),b=re.join2(b,h[k]),u.isMountpoint(m)&&(!y||y&&a.follow_mount)&&(m=m.mounted.root),!y||a.follow)for(var N=0;u.isLink(m.mode);){var V=u.readlink(b);b=tt.resolve(re.dirname(b),V);var ee=u.lookupPath(b,{recurse_count:a.recurse_count+1});if(m=ee.node,N++>40)throw new u.ErrnoError(32)}}return{path:b,node:m}},getPath(i){for(var a;;){if(u.isRoot(i)){var l=i.mount.mountpoint;return a?l[l.length-1]!=="/"?`${l}/${a}`:l+a:l}a=a?`${i.name}/${a}`:i.name,i=i.parent}},hashName(i,a){for(var l=0,h=0;h<a.length;h++)l=(l<<5)-l+a.charCodeAt(h)|0;return(i+l>>>0)%u.nameTable.length},hashAddNode(i){var a=u.hashName(i.parent.id,i.name);i.name_next=u.nameTable[a],u.nameTable[a]=i},hashRemoveNode(i){var a=u.hashName(i.parent.id,i.name);if(u.nameTable[a]===i)u.nameTable[a]=i.name_next;else for(var l=u.nameTable[a];l;){if(l.name_next===i){l.name_next=i.name_next;break}l=l.name_next}},lookupNode(i,a){var l=u.mayLookup(i);if(l)throw new u.ErrnoError(l);for(var h=u.hashName(i.id,a),m=u.nameTable[h];m;m=m.name_next){var b=m.name;if(m.parent.id===i.id&&b===a)return m}return u.lookup(i,a)},createNode(i,a,l,h){E(typeof i=="object");var m=new u.FSNode(i,a,l,h);return u.hashAddNode(m),m},destroyNode(i){u.hashRemoveNode(i)},isRoot(i){return i===i.parent},isMountpoint(i){return!!i.mounted},isFile(i){return(i&61440)===32768},isDir(i){return(i&61440)===16384},isLink(i){return(i&61440)===40960},isChrdev(i){return(i&61440)===8192},isBlkdev(i){return(i&61440)===24576},isFIFO(i){return(i&61440)===4096},isSocket(i){return(i&49152)===49152},flagsToPermissionString(i){var a=["r","w","rw"][i&3];return i&512&&(a+="w"),a},nodePermissions(i,a){return u.ignorePermissions?0:a.includes("r")&&!(i.mode&292)||a.includes("w")&&!(i.mode&146)||a.includes("x")&&!(i.mode&73)?2:0},mayLookup(i){if(!u.isDir(i.mode))return 54;var a=u.nodePermissions(i,"x");return a||(i.node_ops.lookup?0:2)},mayCreate(i,a){try{var l=u.lookupNode(i,a);return 20}catch{}return u.nodePermissions(i,"wx")},mayDelete(i,a,l){var h;try{h=u.lookupNode(i,a)}catch(b){return b.errno}var m=u.nodePermissions(i,"wx");if(m)return m;if(l){if(!u.isDir(h.mode))return 54;if(u.isRoot(h)||u.getPath(h)===u.cwd())return 10}else if(u.isDir(h.mode))return 31;return 0},mayOpen(i,a){return i?u.isLink(i.mode)?32:u.isDir(i.mode)&&(u.flagsToPermissionString(a)!=="r"||a&512)?31:u.nodePermissions(i,u.flagsToPermissionString(a)):44},MAX_OPEN_FDS:4096,nextfd(){for(var i=0;i<=u.MAX_OPEN_FDS;i++)if(!u.streams[i])return i;throw new u.ErrnoError(33)},getStreamChecked(i){var a=u.getStream(i);if(!a)throw new u.ErrnoError(8);return a},getStream:i=>u.streams[i],createStream(i,a=-1){return E(a>=-1),i=Object.assign(new u.FSStream,i),a==-1&&(a=u.nextfd()),i.fd=a,u.streams[a]=i,i},closeStream(i){u.streams[i]=null},dupStream(i,a=-1){var h,m;var l=u.createStream(i,a);return(m=(h=l.stream_ops)==null?void 0:h.dup)==null||m.call(h,l),l},chrdev_stream_ops:{open(i){var l,h;var a=u.getDevice(i.node.rdev);i.stream_ops=a.stream_ops,(h=(l=i.stream_ops).open)==null||h.call(l,i)},llseek(){throw new u.ErrnoError(70)}},major:i=>i>>8,minor:i=>i&255,makedev:(i,a)=>i<<8|a,registerDevice(i,a){u.devices[i]={stream_ops:a}},getDevice:i=>u.devices[i],getMounts(i){for(var a=[],l=[i];l.length;){var h=l.pop();a.push(h),l.push(...h.mounts)}return a},syncfs(i,a){typeof i=="function"&&(a=i,i=!1),u.syncFSRequests++,u.syncFSRequests>1&&U(`warning: ${u.syncFSRequests} FS.syncfs operations in flight at once, probably just doing extra work`);var l=u.getMounts(u.root.mount),h=0;function m(k){return E(u.syncFSRequests>0),u.syncFSRequests--,a(k)}function b(k){if(k)return b.errored?void 0:(b.errored=!0,m(k));++h>=l.length&&m(null)}l.forEach(k=>{if(!k.type.syncfs)return b(null);k.type.syncfs(k,i,b)})},mount(i,a,l){if(typeof i=="string")throw i;var h=l==="/",m=!l,b;if(h&&u.root)throw new u.ErrnoError(10);if(!h&&!m){var k=u.lookupPath(l,{follow_mount:!1});if(l=k.path,b=k.node,u.isMountpoint(b))throw new u.ErrnoError(10);if(!u.isDir(b.mode))throw new u.ErrnoError(54)}var y={type:i,opts:a,mountpoint:l,mounts:[]},N=i.mount(y);return N.mount=y,y.root=N,h?u.root=N:b&&(b.mounted=y,b.mount&&b.mount.mounts.push(y)),N},unmount(i){var a=u.lookupPath(i,{follow_mount:!1});if(!u.isMountpoint(a.node))throw new u.ErrnoError(28);var l=a.node,h=l.mounted,m=u.getMounts(h);Object.keys(u.nameTable).forEach(k=>{for(var y=u.nameTable[k];y;){var N=y.name_next;m.includes(y.mount)&&u.destroyNode(y),y=N}}),l.mounted=null;var b=l.mount.mounts.indexOf(h);E(b!==-1),l.mount.mounts.splice(b,1)},lookup(i,a){return i.node_ops.lookup(i,a)},mknod(i,a,l){var h=u.lookupPath(i,{parent:!0}),m=h.node,b=re.basename(i);if(!b||b==="."||b==="..")throw new u.ErrnoError(28);var k=u.mayCreate(m,b);if(k)throw new u.ErrnoError(k);if(!m.node_ops.mknod)throw new u.ErrnoError(63);return m.node_ops.mknod(m,b,a,l)},statfs(i){var a={bsize:4096,frsize:4096,blocks:1e6,bfree:5e5,bavail:5e5,files:u.nextInode,ffree:u.nextInode-1,fsid:42,flags:2,namelen:255},l=u.lookupPath(i,{follow:!0}).node;return l!=null&&l.node_ops.statfs&&Object.assign(a,l.node_ops.statfs(l.mount.opts.root)),a},create(i,a=438){return a&=4095,a|=32768,u.mknod(i,a,0)},mkdir(i,a=511){return a&=1023,a|=16384,u.mknod(i,a,0)},mkdirTree(i,a){for(var l=i.split("/"),h="",m=0;m<l.length;++m)if(l[m]){h+="/"+l[m];try{u.mkdir(h,a)}catch(b){if(b.errno!=20)throw b}}},mkdev(i,a,l){return typeof l>"u"&&(l=a,a=438),a|=8192,u.mknod(i,a,l)},symlink(i,a){if(!tt.resolve(i))throw new u.ErrnoError(44);var l=u.lookupPath(a,{parent:!0}),h=l.node;if(!h)throw new u.ErrnoError(44);var m=re.basename(a),b=u.mayCreate(h,m);if(b)throw new u.ErrnoError(b);if(!h.node_ops.symlink)throw new u.ErrnoError(63);return h.node_ops.symlink(h,m,i)},rename(i,a){var l=re.dirname(i),h=re.dirname(a),m=re.basename(i),b=re.basename(a),k,y,N;if(k=u.lookupPath(i,{parent:!0}),y=k.node,k=u.lookupPath(a,{parent:!0}),N=k.node,!y||!N)throw new u.ErrnoError(44);if(y.mount!==N.mount)throw new u.ErrnoError(75);var V=u.lookupNode(y,m),ee=tt.relative(i,h);if(ee.charAt(0)!==".")throw new u.ErrnoError(28);if(ee=tt.relative(a,l),ee.charAt(0)!==".")throw new u.ErrnoError(55);var Z;try{Z=u.lookupNode(N,b)}catch{}if(V!==Z){var ie=u.isDir(V.mode),z=u.mayDelete(y,m,ie);if(z)throw new u.ErrnoError(z);if(z=Z?u.mayDelete(N,b,ie):u.mayCreate(N,b),z)throw new u.ErrnoError(z);if(!y.node_ops.rename)throw new u.ErrnoError(63);if(u.isMountpoint(V)||Z&&u.isMountpoint(Z))throw new u.ErrnoError(10);if(N!==y&&(z=u.nodePermissions(y,"w"),z))throw new u.ErrnoError(z);u.hashRemoveNode(V);try{y.node_ops.rename(V,N,b),V.parent=N}catch(J){throw J}finally{u.hashAddNode(V)}}},rmdir(i){var a=u.lookupPath(i,{parent:!0}),l=a.node,h=re.basename(i),m=u.lookupNode(l,h),b=u.mayDelete(l,h,!0);if(b)throw new u.ErrnoError(b);if(!l.node_ops.rmdir)throw new u.ErrnoError(63);if(u.isMountpoint(m))throw new u.ErrnoError(10);l.node_ops.rmdir(l,h),u.destroyNode(m)},readdir(i){var a=u.lookupPath(i,{follow:!0}),l=a.node;if(!l.node_ops.readdir)throw new u.ErrnoError(54);return l.node_ops.readdir(l)},unlink(i){var a=u.lookupPath(i,{parent:!0}),l=a.node;if(!l)throw new u.ErrnoError(44);var h=re.basename(i),m=u.lookupNode(l,h),b=u.mayDelete(l,h,!1);if(b)throw new u.ErrnoError(b);if(!l.node_ops.unlink)throw new u.ErrnoError(63);if(u.isMountpoint(m))throw new u.ErrnoError(10);l.node_ops.unlink(l,h),u.destroyNode(m)},readlink(i){var a=u.lookupPath(i),l=a.node;if(!l)throw new u.ErrnoError(44);if(!l.node_ops.readlink)throw new u.ErrnoError(28);return l.node_ops.readlink(l)},stat(i,a){var l=u.lookupPath(i,{follow:!a}),h=l.node;if(!h)throw new u.ErrnoError(44);if(!h.node_ops.getattr)throw new u.ErrnoError(63);return h.node_ops.getattr(h)},lstat(i){return u.stat(i,!0)},chmod(i,a,l){var h;if(typeof i=="string"){var m=u.lookupPath(i,{follow:!l});h=m.node}else h=i;if(!h.node_ops.setattr)throw new u.ErrnoError(63);h.node_ops.setattr(h,{mode:a&4095|h.mode&-4096,timestamp:Date.now()})},lchmod(i,a){u.chmod(i,a,!0)},fchmod(i,a){var l=u.getStreamChecked(i);u.chmod(l.node,a)},chown(i,a,l,h){var m;if(typeof i=="string"){var b=u.lookupPath(i,{follow:!h});m=b.node}else m=i;if(!m.node_ops.setattr)throw new u.ErrnoError(63);m.node_ops.setattr(m,{timestamp:Date.now()})},lchown(i,a,l){u.chown(i,a,l,!0)},fchown(i,a,l){var h=u.getStreamChecked(i);u.chown(h.node,a,l)},truncate(i,a){if(a<0)throw new u.ErrnoError(28);var l;if(typeof i=="string"){var h=u.lookupPath(i,{follow:!0});l=h.node}else l=i;if(!l.node_ops.setattr)throw new u.ErrnoError(63);if(u.isDir(l.mode))throw new u.ErrnoError(31);if(!u.isFile(l.mode))throw new u.ErrnoError(28);var m=u.nodePermissions(l,"w");if(m)throw new u.ErrnoError(m);l.node_ops.setattr(l,{size:a,timestamp:Date.now()})},ftruncate(i,a){var l=u.getStreamChecked(i);if(!(l.flags&2097155))throw new u.ErrnoError(28);u.truncate(l.node,a)},utime(i,a,l){var h=u.lookupPath(i,{follow:!0}),m=h.node;m.node_ops.setattr(m,{timestamp:Math.max(a,l)})},open(i,a,l=438){if(i==="")throw new u.ErrnoError(44);a=typeof a=="string"?Aa(a):a,a&64?l=l&4095|32768:l=0;var h;if(typeof i=="object")h=i;else{i=re.normalize(i);try{var m=u.lookupPath(i,{follow:!(a&131072)});h=m.node}catch{}}var b=!1;if(a&64)if(h){if(a&128)throw new u.ErrnoError(20)}else h=u.mknod(i,l,0),b=!0;if(!h)throw new u.ErrnoError(44);if(u.isChrdev(h.mode)&&(a&=-513),a&65536&&!u.isDir(h.mode))throw new u.ErrnoError(54);if(!b){var k=u.mayOpen(h,a);if(k)throw new u.ErrnoError(k)}a&512&&!b&&u.truncate(h,0),a&=-131713;var y=u.createStream({node:h,path:u.getPath(h),flags:a,seekable:!0,position:0,stream_ops:h.stream_ops,ungotten:[],error:!1});return y.stream_ops.open&&y.stream_ops.open(y),n.logReadFiles&&!(a&1)&&(i in u.readFiles||(u.readFiles[i]=1)),y},close(i){if(u.isClosed(i))throw new u.ErrnoError(8);i.getdents&&(i.getdents=null);try{i.stream_ops.close&&i.stream_ops.close(i)}catch(a){throw a}finally{u.closeStream(i.fd)}i.fd=null},isClosed(i){return i.fd===null},llseek(i,a,l){if(u.isClosed(i))throw new u.ErrnoError(8);if(!i.seekable||!i.stream_ops.llseek)throw new u.ErrnoError(70);if(l!=0&&l!=1&&l!=2)throw new u.ErrnoError(28);return i.position=i.stream_ops.llseek(i,a,l),i.ungotten=[],i.position},read(i,a,l,h,m){if(E(l>=0),h<0||m<0)throw new u.ErrnoError(28);if(u.isClosed(i))throw new u.ErrnoError(8);if((i.flags&2097155)===1)throw new u.ErrnoError(8);if(u.isDir(i.node.mode))throw new u.ErrnoError(31);if(!i.stream_ops.read)throw new u.ErrnoError(28);var b=typeof m<"u";if(!b)m=i.position;else if(!i.seekable)throw new u.ErrnoError(70);var k=i.stream_ops.read(i,a,l,h,m);return b||(i.position+=k),k},write(i,a,l,h,m,b){if(E(l>=0),h<0||m<0)throw new u.ErrnoError(28);if(u.isClosed(i))throw new u.ErrnoError(8);if(!(i.flags&2097155))throw new u.ErrnoError(8);if(u.isDir(i.node.mode))throw new u.ErrnoError(31);if(!i.stream_ops.write)throw new u.ErrnoError(28);i.seekable&&i.flags&1024&&u.llseek(i,0,2);var k=typeof m<"u";if(!k)m=i.position;else if(!i.seekable)throw new u.ErrnoError(70);var y=i.stream_ops.write(i,a,l,h,m,b);return k||(i.position+=y),y},allocate(i,a,l){if(u.isClosed(i))throw new u.ErrnoError(8);if(a<0||l<=0)throw new u.ErrnoError(28);if(!(i.flags&2097155))throw new u.ErrnoError(8);if(!u.isFile(i.node.mode)&&!u.isDir(i.node.mode))throw new u.ErrnoError(43);if(!i.stream_ops.allocate)throw new u.ErrnoError(138);i.stream_ops.allocate(i,a,l)},mmap(i,a,l,h,m){if(h&2&&!(m&2)&&(i.flags&2097155)!==2)throw new u.ErrnoError(2);if((i.flags&2097155)===1)throw new u.ErrnoError(2);if(!i.stream_ops.mmap)throw new u.ErrnoError(43);if(!a)throw new u.ErrnoError(28);return i.stream_ops.mmap(i,a,l,h,m)},msync(i,a,l,h,m){return E(l>=0),i.stream_ops.msync?i.stream_ops.msync(i,a,l,h,m):0},ioctl(i,a,l){if(!i.stream_ops.ioctl)throw new u.ErrnoError(59);return i.stream_ops.ioctl(i,a,l)},readFile(i,a={}){if(a.flags=a.flags||0,a.encoding=a.encoding||"binary",a.encoding!=="utf8"&&a.encoding!=="binary")throw new Error(`Invalid encoding type "${a.encoding}"`);var l,h=u.open(i,a.flags),m=u.stat(i),b=m.size,k=new Uint8Array(b);return u.read(h,k,0,b,0),a.encoding==="utf8"?l=Pt(k):a.encoding==="binary"&&(l=k),u.close(h),l},writeFile(i,a,l={}){l.flags=l.flags||577;var h=u.open(i,l.flags,l.mode);if(typeof a=="string"){var m=new Uint8Array(Pr(a)+1),b=cn(a,m,0,m.length);u.write(h,m,0,b,void 0,l.canOwn)}else if(ArrayBuffer.isView(a))u.write(h,a,0,a.byteLength,void 0,l.canOwn);else throw new Error("Unsupported data type");u.close(h)},cwd:()=>u.currentPath,chdir(i){var a=u.lookupPath(i,{follow:!0});if(a.node===null)throw new u.ErrnoError(44);if(!u.isDir(a.node.mode))throw new u.ErrnoError(54);var l=u.nodePermissions(a.node,"x");if(l)throw new u.ErrnoError(l);u.currentPath=a.path},createDefaultDirectories(){u.mkdir("/tmp"),u.mkdir("/home"),u.mkdir("/home/web_user")},createDefaultDevices(){u.mkdir("/dev"),u.registerDevice(u.makedev(1,3),{read:()=>0,write:(h,m,b,k,y)=>k,llseek:()=>0}),u.mkdev("/dev/null",u.makedev(1,3)),pt.register(u.makedev(5,0),pt.default_tty_ops),pt.register(u.makedev(6,0),pt.default_tty1_ops),u.mkdev("/dev/tty",u.makedev(5,0)),u.mkdev("/dev/tty1",u.makedev(6,0));var i=new Uint8Array(1024),a=0,l=()=>(a===0&&(a=Vi(i).byteLength),i[--a]);u.createDevice("/dev","random",l),u.createDevice("/dev","urandom",l),u.mkdir("/dev/shm"),u.mkdir("/dev/shm/tmp")},createSpecialDirectories(){u.mkdir("/proc");var i=u.mkdir("/proc/self");u.mkdir("/proc/self/fd"),u.mount({mount(){var a=u.createNode(i,"fd",16895,73);return a.node_ops={lookup(l,h){var m=+h,b=u.getStreamChecked(m),k={parent:null,mount:{mountpoint:"fake"},node_ops:{readlink:()=>b.path}};return k.parent=k,k}},a}},{},"/proc/self/fd")},createStandardStreams(i,a,l){i?u.createDevice("/dev","stdin",i):u.symlink("/dev/tty","/dev/stdin"),a?u.createDevice("/dev","stdout",null,a):u.symlink("/dev/tty","/dev/stdout"),l?u.createDevice("/dev","stderr",null,l):u.symlink("/dev/tty1","/dev/stderr");var h=u.open("/dev/stdin",0),m=u.open("/dev/stdout",1),b=u.open("/dev/stderr",1);E(h.fd===0,`invalid handle for stdin (${h.fd})`),E(m.fd===1,`invalid handle for stdout (${m.fd})`),E(b.fd===2,`invalid handle for stderr (${b.fd})`)},staticInit(){u.nameTable=new Array(4096),u.mount(j,{},"/"),u.createDefaultDirectories(),u.createDefaultDevices(),u.createSpecialDirectories(),u.filesystems={MEMFS:j}},init(i,a,l){E(!u.initialized,"FS.init was previously called. If you want to initialize later with custom parameters, remove any earlier calls (note that one is automatically added to the generated code)"),u.initialized=!0,i??(i=n.stdin),a??(a=n.stdout),l??(l=n.stderr),u.createStandardStreams(i,a,l)},quit(){u.initialized=!1,xa(0);for(var i=0;i<u.streams.length;i++){var a=u.streams[i];a&&u.close(a)}},findObject(i,a){var l=u.analyzePath(i,a);return l.exists?l.object:null},analyzePath(i,a){try{var l=u.lookupPath(i,{follow:!a});i=l.path}catch{}var h={isRoot:!1,exists:!1,error:0,name:null,path:null,object:null,parentExists:!1,parentPath:null,parentObject:null};try{var l=u.lookupPath(i,{parent:!0});h.parentExists=!0,h.parentPath=l.path,h.parentObject=l.node,h.name=re.basename(i),l=u.lookupPath(i,{follow:!a}),h.exists=!0,h.path=l.path,h.object=l.node,h.name=l.node.name,h.isRoot=l.path==="/"}catch(m){h.error=m.errno}return h},createPath(i,a,l,h){i=typeof i=="string"?i:u.getPath(i);for(var m=a.split("/").reverse();m.length;){var b=m.pop();if(b){var k=re.join2(i,b);try{u.mkdir(k)}catch{}i=k}}return k},createFile(i,a,l,h,m){var b=re.join2(typeof i=="string"?i:u.getPath(i),a),k=hn(h,m);return u.create(b,k)},createDataFile(i,a,l,h,m,b){var k=a;i&&(i=typeof i=="string"?i:u.getPath(i),k=a?re.join2(i,a):i);var y=hn(h,m),N=u.create(k,y);if(l){if(typeof l=="string"){for(var V=new Array(l.length),ee=0,Z=l.length;ee<Z;++ee)V[ee]=l.charCodeAt(ee);l=V}u.chmod(N,y|146);var ie=u.open(N,577);u.write(ie,l,0,l.length,0,b),u.close(ie),u.chmod(N,y)}},createDevice(i,a,l,h){var y;var m=re.join2(typeof i=="string"?i:u.getPath(i),a),b=hn(!!l,!!h);(y=u.createDevice).major??(y.major=64);var k=u.makedev(u.createDevice.major++,0);return u.registerDevice(k,{open(N){N.seekable=!1},close(N){var V;(V=h==null?void 0:h.buffer)!=null&&V.length&&h(10)},read(N,V,ee,Z,ie){for(var z=0,J=0;J<Z;J++){var ue;try{ue=l()}catch{throw new u.ErrnoError(29)}if(ue===void 0&&z===0)throw new u.ErrnoError(6);if(ue==null)break;z++,V[ee+J]=ue}return z&&(N.node.timestamp=Date.now()),z},write(N,V,ee,Z,ie){for(var z=0;z<Z;z++)try{h(V[ee+z])}catch{throw new u.ErrnoError(29)}return Z&&(N.node.timestamp=Date.now()),z}}),u.mkdev(m,b,k)},forceLoadFile(i){if(i.isDevice||i.isFolder||i.link||i.contents)return!0;if(typeof XMLHttpRequest<"u")throw new Error("Lazy loading should have been performed (contents set) in createLazyFile, but it was not. Lazy loading only works in web workers. Use --embed-file or --preload-file in emcc on the main thread.");try{i.contents=P(i.url),i.usedBytes=i.contents.length}catch{throw new u.ErrnoError(29)}},createLazyFile(i,a,l,h,m){class b{constructor(){$(this,"lengthKnown",!1);$(this,"chunks",[])}get(z){if(!(z>this.length-1||z<0)){var J=z%this.chunkSize,ue=z/this.chunkSize|0;return this.getter(ue)[J]}}setDataGetter(z){this.getter=z}cacheLength(){var z=new XMLHttpRequest;if(z.open("HEAD",l,!1),z.send(null),!(z.status>=200&&z.status<300||z.status===304))throw new Error("Couldn't load "+l+". Status: "+z.status);var J=Number(z.getResponseHeader("Content-length")),ue,Ne=(ue=z.getResponseHeader("Accept-Ranges"))&&ue==="bytes",Re=(ue=z.getResponseHeader("Content-Encoding"))&&ue==="gzip",Fe=1024*1024;Ne||(Fe=J);var Ue=(je,Rt)=>{if(je>Rt)throw new Error("invalid range ("+je+", "+Rt+") or no bytes requested!");if(Rt>J-1)throw new Error("only "+J+" bytes available! programmer error!");var we=new XMLHttpRequest;if(we.open("GET",l,!1),J!==Fe&&we.setRequestHeader("Range","bytes="+je+"-"+Rt),we.responseType="arraybuffer",we.overrideMimeType&&we.overrideMimeType("text/plain; charset=x-user-defined"),we.send(null),!(we.status>=200&&we.status<300||we.status===304))throw new Error("Couldn't load "+l+". Status: "+we.status);return we.response!==void 0?new Uint8Array(we.response||[]):Yi(we.responseText||"")},sr=this;sr.setDataGetter(je=>{var Rt=je*Fe,we=(je+1)*Fe-1;if(we=Math.min(we,J-1),typeof sr.chunks[je]>"u"&&(sr.chunks[je]=Ue(Rt,we)),typeof sr.chunks[je]>"u")throw new Error("doXHR failed!");return sr.chunks[je]}),(Re||!J)&&(Fe=J=1,J=this.getter(0).length,Fe=J,x("LazyFiles on gzip forces download of the whole file when length is accessed")),this._length=J,this._chunkSize=Fe,this.lengthKnown=!0}get length(){return this.lengthKnown||this.cacheLength(),this._length}get chunkSize(){return this.lengthKnown||this.cacheLength(),this._chunkSize}}if(typeof XMLHttpRequest<"u"){if(!d)throw"Cannot do synchronous binary XHRs outside webworkers in modern browsers. Use --embed-file or --preload-file in emcc";var k=new b,y={isDevice:!1,contents:k}}else var y={isDevice:!1,url:l};var N=u.createFile(i,a,y,h,m);y.contents?N.contents=y.contents:y.url&&(N.contents=null,N.url=y.url),Object.defineProperties(N,{usedBytes:{get:function(){return this.contents.length}}});var V={},ee=Object.keys(N.stream_ops);ee.forEach(ie=>{var z=N.stream_ops[ie];V[ie]=(...J)=>(u.forceLoadFile(N),z(...J))});function Z(ie,z,J,ue,Ne){var Re=ie.node.contents;if(Ne>=Re.length)return 0;var Fe=Math.min(Re.length-Ne,ue);if(E(Fe>=0),Re.slice)for(var Ue=0;Ue<Fe;Ue++)z[J+Ue]=Re[Ne+Ue];else for(var Ue=0;Ue<Fe;Ue++)z[J+Ue]=Re.get(Ne+Ue);return Fe}return V.read=(ie,z,J,ue,Ne)=>(u.forceLoadFile(N),Z(ie,z,J,ue,Ne)),V.mmap=(ie,z,J,ue,Ne)=>{u.forceLoadFile(N);var Re=Qi();if(!Re)throw new u.ErrnoError(48);return Z(ie,q,Re,z,J),{ptr:Re,allocated:!0}},N.stream_ops=V,N},absolutePath(){se("FS.absolutePath has been removed; use PATH_FS.resolve instead")},createFolder(){se("FS.createFolder has been removed; use FS.mkdir instead")},createLink(){se("FS.createLink has been removed; use FS.symlink instead")},joinPath(){se("FS.joinPath has been removed; use PATH.join instead")},mmapAlloc(){se("FS.mmapAlloc has been replaced by the top level function mmapAlloc")},standardizePath(){se("FS.standardizePath has been removed; use PATH.normalize instead")}},or={DEFAULT_POLLMASK:5,calculateAt(i,a,l){if(re.isAbs(a))return a;var h;if(i===-100)h=u.cwd();else{var m=or.getStreamFromFD(i);h=m.path}if(a.length==0){if(!l)throw new u.ErrnoError(44);return h}return re.join2(h,a)},doStat(i,a,l){var h=i(a);oe[l>>2]=h.dev,oe[l+4>>2]=h.mode,W[l+8>>2]=h.nlink,oe[l+12>>2]=h.uid,oe[l+16>>2]=h.gid,oe[l+20>>2]=h.rdev,me=[h.size>>>0,(Q=h.size,+Math.abs(Q)>=1?Q>0?+Math.floor(Q/4294967296)>>>0:~~+Math.ceil((Q-+(~~Q>>>0))/4294967296)>>>0:0)],oe[l+24>>2]=me[0],oe[l+28>>2]=me[1],oe[l+32>>2]=4096,oe[l+36>>2]=h.blocks;var m=h.atime.getTime(),b=h.mtime.getTime(),k=h.ctime.getTime();return me=[Math.floor(m/1e3)>>>0,(Q=Math.floor(m/1e3),+Math.abs(Q)>=1?Q>0?+Math.floor(Q/4294967296)>>>0:~~+Math.ceil((Q-+(~~Q>>>0))/4294967296)>>>0:0)],oe[l+40>>2]=me[0],oe[l+44>>2]=me[1],W[l+48>>2]=m%1e3*1e3*1e3,me=[Math.floor(b/1e3)>>>0,(Q=Math.floor(b/1e3),+Math.abs(Q)>=1?Q>0?+Math.floor(Q/4294967296)>>>0:~~+Math.ceil((Q-+(~~Q>>>0))/4294967296)>>>0:0)],oe[l+56>>2]=me[0],oe[l+60>>2]=me[1],W[l+64>>2]=b%1e3*1e3*1e3,me=[Math.floor(k/1e3)>>>0,(Q=Math.floor(k/1e3),+Math.abs(Q)>=1?Q>0?+Math.floor(Q/4294967296)>>>0:~~+Math.ceil((Q-+(~~Q>>>0))/4294967296)>>>0:0)],oe[l+72>>2]=me[0],oe[l+76>>2]=me[1],W[l+80>>2]=k%1e3*1e3*1e3,me=[h.ino>>>0,(Q=h.ino,+Math.abs(Q)>=1?Q>0?+Math.floor(Q/4294967296)>>>0:~~+Math.ceil((Q-+(~~Q>>>0))/4294967296)>>>0:0)],oe[l+88>>2]=me[0],oe[l+92>>2]=me[1],0},doMsync(i,a,l,h,m){if(!u.isFile(a.node.mode))throw new u.ErrnoError(43);if(h&2)return 0;var b=Ie.slice(i,i+l);u.msync(a,b,m,l,h)},getStreamFromFD(i){var a=u.getStreamChecked(i);return a},varargs:void 0,getStr(i){var a=Tt(i);return a}};function Pa(i){try{var a=or.getStreamFromFD(i);return u.close(a),0}catch(l){if(typeof u>"u"||l.name!=="ErrnoError")throw l;return l.errno}}var Ta=(i,a,l,h)=>{for(var m=0,b=0;b<l;b++){var k=W[a>>2],y=W[a+4>>2];a+=8;var N=u.read(i,q,k,y,h);if(N<0)return-1;if(m+=N,N<y)break}return m};function Ra(i,a,l,h){try{var m=or.getStreamFromFD(i),b=Ta(m,a,l);return W[h>>2]=b,0}catch(k){if(typeof u>"u"||k.name!=="ErrnoError")throw k;return k.errno}}var Ma=(i,a)=>(E(i==i>>>0||i==(i|0)),E(a===(a|0)),a+2097152>>>0<4194305-!!i?(i>>>0)+a*4294967296:NaN);function Oa(i,a,l,h,m){var b=Ma(a,l);try{if(isNaN(b))return 61;var k=or.getStreamFromFD(i);return u.llseek(k,b,h),me=[k.position>>>0,(Q=k.position,+Math.abs(Q)>=1?Q>0?+Math.floor(Q/4294967296)>>>0:~~+Math.ceil((Q-+(~~Q>>>0))/4294967296)>>>0:0)],oe[m>>2]=me[0],oe[m+4>>2]=me[1],k.getdents&&b===0&&h===0&&(k.getdents=null),0}catch(y){if(typeof u>"u"||y.name!=="ErrnoError")throw y;return y.errno}}var Na=(i,a,l,h)=>{for(var m=0,b=0;b<l;b++){var k=W[a>>2],y=W[a+4>>2];a+=8;var N=u.write(i,q,k,y,h);if(N<0)return-1;if(m+=N,N<y)break}return m};function Fa(i,a,l,h){try{var m=or.getStreamFromFD(i),b=Na(m,a,l);return W[h>>2]=b,0}catch(k){if(typeof u>"u"||k.name!=="ErrnoError")throw k;return k.errno}}u.createPreloadedFile=Sa,u.staticInit();function $a(){ea("fetchSettings")}var Ji={__assert_fail:ia,__cxa_throw:sa,_abort_js:aa,_emscripten_memcpy_js:la,_tzset_js:ca,emscripten_resize_heap:da,environ_get:ga,environ_sizes_get:wa,fd_close:Pa,fd_read:Ra,fd_seek:Oa,fd_write:Fa},mt=Zs();n._create_position=ne("create_position",1),n._delete_position=ne("delete_position",1),n._make_move=ne("make_move",2),n._unmake_move=ne("unmake_move",2),n._get_legal_moves=ne("get_legal_moves",2),n._malloc=ne("malloc",1),n._free_legal_moves=ne("free_legal_moves",1),n._free=ne("free",1),n._pos_attacks_to=ne("pos_attacks_to",4),n._pos_attacks=ne("pos_attacks",3),n._get_pieces_bb=ne("get_pieces_bb",4),n._get_pieces_color_bb=ne("get_pieces_color_bb",3),n._get_occupied=ne("get_occupied",2),n._get_attacks=ne("get_attacks",6),n._get_turn=ne("get_turn",1),n._get_at=ne("get_at",2),n._get_fen=ne("get_fen",1),n._is_checkmate=ne("is_checkmate",1),n._init=ne("init",0);var xa=ne("fflush",1),Da=ne("strerror",1),Zi=()=>(Zi=mt.emscripten_stack_init)(),dn=()=>(dn=mt.emscripten_stack_get_end)();n.dynCall_viijii=ne("dynCall_viijii",7),n.dynCall_jiji=ne("dynCall_jiji",5),n.dynCall_iiiiij=ne("dynCall_iiiiij",7),n.dynCall_iiiiijj=ne("dynCall_iiiiijj",9),n.dynCall_iiiiiijj=ne("dynCall_iiiiiijj",10);var La=["writeI53ToI64","writeI53ToI64Clamped","writeI53ToI64Signaling","writeI53ToU64Clamped","writeI53ToU64Signaling","readI53FromI64","readI53FromU64","convertI32PairToI53","convertU32PairToI53","stackAlloc","getTempRet0","setTempRet0","exitJS","inetPton4","inetNtop4","inetPton6","inetNtop6","readSockaddr","writeSockaddr","emscriptenLog","readEmAsmArgs","jstoi_q","listenOnce","autoResumeAudioContext","dynCallLegacy","getDynCaller","dynCall","handleException","keepRuntimeAlive","runtimeKeepalivePush","runtimeKeepalivePop","callUserCallback","maybeExit","asmjsMangle","HandleAllocator","getNativeTypeSize","STACK_SIZE","STACK_ALIGN","POINTER_SIZE","ASSERTIONS","getCFunc","ccall","cwrap","uleb128Encode","sigToWasmTypes","generateFuncType","convertJsFunctionToWasm","getEmptyTableSlot","updateTableMap","getFunctionAddress","addFunction","removeFunction","reallyNegative","unSign","strLen","reSign","formatString","intArrayToString","AsciiToString","UTF16ToString","stringToUTF16","lengthBytesUTF16","UTF32ToString","stringToUTF32","lengthBytesUTF32","stringToNewUTF8","stringToUTF8OnStack","writeArrayToMemory","registerKeyEventCallback","maybeCStringToJsString","findEventTarget","getBoundingClientRect","fillMouseEventData","registerMouseEventCallback","registerWheelEventCallback","registerUiEventCallback","registerFocusEventCallback","fillDeviceOrientationEventData","registerDeviceOrientationEventCallback","fillDeviceMotionEventData","registerDeviceMotionEventCallback","screenOrientation","fillOrientationChangeEventData","registerOrientationChangeEventCallback","fillFullscreenChangeEventData","registerFullscreenChangeEventCallback","JSEvents_requestFullscreen","JSEvents_resizeCanvasForFullscreen","registerRestoreOldStyle","hideEverythingExceptGivenElement","restoreHiddenElements","setLetterbox","softFullscreenResizeWebGLRenderTarget","doRequestFullscreen","fillPointerlockChangeEventData","registerPointerlockChangeEventCallback","registerPointerlockErrorEventCallback","requestPointerLock","fillVisibilityChangeEventData","registerVisibilityChangeEventCallback","registerTouchEventCallback","fillGamepadEventData","registerGamepadEventCallback","registerBeforeUnloadEventCallback","fillBatteryEventData","battery","registerBatteryEventCallback","setCanvasElementSize","getCanvasElementSize","jsStackTrace","getCallstack","convertPCtoSourceLocation","checkWasiClock","wasiRightsToMuslOFlags","wasiOFlagsToMuslOFlags","safeSetTimeout","setImmediateWrapped","safeRequestAnimationFrame","clearImmediateWrapped","polyfillSetImmediate","registerPostMainLoop","registerPreMainLoop","getPromise","makePromise","idsToPromises","makePromiseCallback","findMatchingCatch","Browser_asyncPrepareDataCounter","isLeapYear","ydayFromDate","arraySum","addDays","getSocketFromFD","getSocketAddress","FS_unlink","FS_mkdirTree","_setNetworkCallback","heapObjectForWebGLType","toTypedArrayIndex","webgl_enable_ANGLE_instanced_arrays","webgl_enable_OES_vertex_array_object","webgl_enable_WEBGL_draw_buffers","webgl_enable_WEBGL_multi_draw","webgl_enable_EXT_polygon_offset_clamp","webgl_enable_EXT_clip_control","webgl_enable_WEBGL_polygon_mode","emscriptenWebGLGet","computeUnpackAlignedImageSize","colorChannelsInGlTextureFormat","emscriptenWebGLGetTexPixelData","emscriptenWebGLGetUniform","webglGetUniformLocation","webglPrepareUniformLocationsBeforeFirstUse","webglGetLeftBracePos","emscriptenWebGLGetVertexAttrib","__glGetActiveAttribOrUniform","writeGLArray","registerWebGlEventCallback","runAndAbortIfError","ALLOC_NORMAL","ALLOC_STACK","allocate","writeStringToMemory","writeAsciiToMemory","setErrNo","demangle","stackTrace"];La.forEach(ta);var Ia=["run","addOnPreRun","addOnInit","addOnPreMain","addOnExit","addOnPostRun","addRunDependency","removeRunDependency","out","err","callMain","abort","wasmMemory","wasmExports","writeStackCookie","checkStackCookie","convertI32PairToI53Checked","stackSave","stackRestore","ptrToString","zeroMemory","getHeapMax","growMemory","ENV","ERRNO_CODES","strError","DNS","Protocols","Sockets","timers","warnOnce","readEmAsmArgsArray","jstoi_s","getExecutableName","asyncLoad","alignMemory","mmapAlloc","wasmTable","noExitRuntime","freeTableIndexes","functionsInTableMap","setValue","getValue","PATH","PATH_FS","UTF8Decoder","UTF8ArrayToString","UTF8ToString","stringToUTF8Array","stringToUTF8","lengthBytesUTF8","intArrayFromString","stringToAscii","UTF16Decoder","JSEvents","specialHTMLTargets","findCanvasEventTarget","currentFullscreenStrategy","restoreOldWindowedStyle","UNWIND_CACHE","ExitStatus","getEnvStrings","doReadv","doWritev","initRandomFill","randomFill","promiseMap","uncaughtExceptionCount","exceptionLast","exceptionCaught","ExceptionInfo","Browser","getPreloadedImageData__data","wget","MONTH_DAYS_REGULAR","MONTH_DAYS_LEAP","MONTH_DAYS_REGULAR_CUMULATIVE","MONTH_DAYS_LEAP_CUMULATIVE","SYSCALLS","preloadPlugins","FS_createPreloadedFile","FS_modeStringToFlags","FS_getMode","FS_stdin_getChar_buffer","FS_stdin_getChar","FS_createPath","FS_createDevice","FS_readFile","FS","FS_createDataFile","FS_createLazyFile","MEMFS","TTY","PIPEFS","SOCKFS","tempFixedLengthArray","miniTempWebGLFloatBuffers","miniTempWebGLIntBuffers","GL","AL","GLUT","EGL","GLEW","IDBStore","SDL","SDL_gfx","allocateUTF8","allocateUTF8OnStack","print","printErr"];Ia.forEach(Gi);var Tr;Zt=function i(){Tr||eo(),Tr||(Zt=i)};function Ua(){Zi(),zs()}function eo(){if(ft>0||(Ua(),js(),ft>0))return;function i(){var a;Tr||(Tr=!0,n.calledRun=!0,!F&&(Ks(),o(n),(a=n.onRuntimeInitialized)==null||a.call(n),E(!n._main,'compiled without a main, but one is present. if you added it from JS, use Module["onRuntimeInitialized"]'),Ws()))}n.setStatus?(n.setStatus("Running..."),setTimeout(()=>{setTimeout(()=>n.setStatus(""),1),i()},1)):i(),sn()}if(n.preInit)for(typeof n.preInit=="function"&&(n.preInit=[n.preInit]);n.preInit.length>0;)n.preInit.pop()();eo(),r=c;for(const i of Object.keys(n))i in e||Object.defineProperty(e,i,{configurable:!0,get(){se(`Access to module property ('${i}') is no longer possible via the module constructor argument; Instead, use the result of the module constructor.`)}});return r}})();const Vn=0,_u=1,Ai=1,rn=2,Ci=3,Pi=4,Ti=5,Ri=6,Eu=0,yn=Ai,Ft=rn,$t=Ci,xt=Pi,Dt=Ti,_n=Ri,En=Ai+8,Lt=rn+8,It=Ci+8,Ut=Pi+8,Bt=Ti+8,Sn=Ri+8,Su=16384;function Au(t){return t===Vn?_u:Vn}function Cs(t){return t>>3}function Cu(t){return t&7}function Pu(t){switch(t){case Ai:return"pawn";case rn:return"knight";case Ci:return"bishop";case Pi:return"rook";case Ti:return"queen";case Ri:return"king"}throw"No Piece Type"}function Ye(t){let e=t&63,r=t>>6&63,o=(t&49152)===Su?Pu((t>>12&3)+rn):void 0;return{from:r,to:e,promotion:o}}class Mi{constructor(e){$(this,"m");this.m=e}static async make(e){let r=await yu({locateFile:e});return r._init(),new Mi(r)}create_position(e){return this.m._create_position(this.stringToWasm(e))}delete_position(e){this.m._delete_position(e)}unmake_move(e,r){this.m._unmake_move(e,r)}make_move(e,r){this.m._make_move(e,r)}pos_turn(e){return this.m._get_turn(e)===Vn?"white":"black"}get_legal_moves(e){const r=this.m._malloc(4);let n=this.m._get_legal_moves(e,r);const o=this.m.getValue(r,"i32");let s=[];for(let c=0;c<o;c++){const f=this.m.getValue(n+c*4,"i32");s.push(f)}return this.m._free(r),this.m._free(n),s}pos_occupied(e){const r=this.m._malloc(8);this.m._get_occupied(e,r);const n=this.m.getValue(r,"i32"),o=this.m.getValue(r+4,"i32");return this.m._free(r),new M(n,o)}attacks(e,r,n){const o=this.m._malloc(8);this.m._get_attacks(Cu(e),Cs(e),r,n.lo,n.hi,o);const s=this.m.getValue(o,"i32"),c=this.m.getValue(o+4,"i32");return this.m._free(o),new M(s,c)}pos_attacks(e,r){const n=this.m._malloc(8);this.m._pos_attacks(e,r,n);const o=this.m.getValue(n,"i32"),s=this.m.getValue(n+4,"i32");return this.m._free(n),new M(o,s)}pos_attacks_of_color(e,r){const n=this.m._malloc(8);this.m._pos_attacks_to(e,r,0,n);const o=this.m.getValue(n,"i32"),s=this.m.getValue(n+4,"i32");return this.m._free(n),new M(o,s)}get_pieces_color_bb(e,r){const n=this.m._malloc(8);this.m._get_pieces_color_bb(e,r,n);const o=this.m.getValue(n,"i32"),s=this.m.getValue(n+4,"i32");return this.m._free(n),new M(o,s)}get_pieces_bb(e,r){const n=this.m._malloc(8),o=this.m._malloc(4*r.length);for(let f=0;f<r.length;f++)this.m.setValue(o+f*4,r[f],"i32");this.m._get_pieces_bb(e,o,r.length,n);const s=this.m.getValue(n,"i32"),c=this.m.getValue(n+4,"i32");return this.m._free(n),this.m._free(o),new M(s,c)}get_at(e,r){let n=this.m._get_at(e,r);if(n!==Eu)return n}is_checkmate(e){return this.m._is_checkmate(e)}get_pos_read_fen(e){let r=this.wasmToStringAndFree(this.m._get_fen(e));return Si.fromSetup(Ei(r).unwrap()).unwrap()}make_san(e,r){let n=this.get_pos_read_fen(e);return As(n,Ye(r))}stringToWasm(e){let r=this.m;const n=e.length+1,o=r._malloc(n);return r.stringToUTF8(e,o,n),o}wasmToStringAndFree(e){return this.m.UTF8ToString(e)}}function Tu(t,e,r){var c;let n=Ps(t,e,r),o=(c=n.children[0])==null?void 0:c.m[0];if(!o&&(o=n.children[0].children[0].m[0],!o))return;let s=Si.fromSetup(Ei(t).unwrap()).unwrap();return Ts(o,s,!1)}function Yn(t){return!!t.match(/^([pqrnbkPQRNBKmjuaglMJUAGL]'?)$/)}function Po(t,e){let{from:r,to:n}=Ye(e),o={};for(let s of Object.keys(t))o[s]=t[s],Yn(s)&&(t[s]===r?o[s]=n:t[s]===n&&(o[s]=-o[s]));return o}function Fr(t,e,r,n,o,s){if(t.rule[0]==="E"){let w=n;r.length>0&&(s.make_move(e,r[r.length-1]),w=Po(n,r[r.length-1]));let g=t.rule.slice(1).trim(),_=!1;for(let C of s.get_legal_moves(e)){let v=[w];if(g){let P=To(g,w,e,C,o,s);if(P===void 0||P.length===0)continue;v=P}let B=v.length;for(let P of t.children){if(v.length===0)break;v=v.filter(R=>!Fr(P,e,[...r,C],R,o,s))}t.children.length===0&&v.length>0&&(t.m.push({ms:[...r,C],ctx:w}),_=!0),v.length<B&&(t.m.push({ms:[...r,C],ctx:w}),_=!0)}let S=[n];return _||(S=void 0),r.length>0&&s.unmake_move(e,r[r.length-1]),S}if(t.rule[0]==="A"){let w=n;r.length>0&&(s.make_move(e,r[r.length-1]),w=Po(n,r[r.length-1])),t.rule.slice(1).trim();let g=!0;for(let S of s.get_legal_moves(e)){let C=[w];for(let v of t.children){if(C.length===0)break;C=C.filter(B=>!Fr(v,e,[...r,S],B,o,s))}if(C.length>0){g=!1;break}}let _=[n];return g?t.m.push(..._.map(S=>({ms:r,ctx:S}))):_=void 0,r.length>0&&s.unmake_move(e,r[r.length-1]),_}let c=t.rule[0]==="\\"?t.rule.slice(1):t.rule,f=r[r.length-1],d=To(c,n,e,f,o,s);if(d===void 0||d.length===0)return;let p=d;if(t.children.length===0)return t.m.push({ms:r,ctx:n}),p;for(let w of t.children){if(p.length===0)break;p=p.filter(g=>!Fr(w,e,r,g,o,s))}if(p.length===0)return r.length>0&&t.m.push({ms:r,ctx:n}),[n]}function Ps(t,e,r){let n=r.create_position(t),o=Ru(e);return o.children.length===0||(Fr(o,n,[],{},r.pos_turn(n),r),r.delete_position(n)),o}function Ru(t){let e=t.trim().split(`
`),r={depth:-1,rule:".",children:[],p_m:[],m:[],n:[],long:!1,no_c:!1};const n=[r];for(let o=0;o<e.length;o++){let s=e[o],c=s.trim();if(!c)continue;const f=s.search(/\S/);let d=!1,p=!1;c[c.length-1]==="5"&&(p=!0,c=c.slice(0,-1).trim()),c[c.length-1]==="9"&&(d=!0,c=c.slice(0,-1).trim());let w={depth:f,rule:c,children:[],p_m:[],m:[],long:p,no_c:d};for(;n.length>f+1;)n.pop();n[n.length-1].children.push(w),n.push(w)}return r}function Ts(t,e,r){e=e.clone();let n=t.ms.map(s=>{let c=Ye(s),f=As(e,c);return e.play(c),f}),o=r?JSON.stringify(t.ctx):"";return n.join(" ")+o}function Rs(t,e){let r="",n=" ".repeat(t.depth+1),o=t.long?150:1,s=t.m,c=s.slice(0,o).map(f=>Ts(f,e,t.no_c)).join(", ");return s.length>1&&(c+=".."+s.length),r+=" "+t.rule+" <"+(c??"?")+`>
`,t.children.map((f,d)=>{d===t.children.length-1?r+=n+"└─":d===0?r+=n+"├─":r+=n+"│ ",r+=Rs(f,e)}).join(""),r}function Mu(t,e,r,n,o,s){if(t===".")return[e];let c=[],[f,...d]=t.split(" "),p=Nu(f,e,r,n,o,s);if(!p)return;let[w,g]=p;for(let _ of g){let S=d.reduce((C,v)=>C.flatMap(B=>Ou(v,w,B,r,n,o,s)??[]),[_]);!S||S.length===0||c.push(...S)}return c}function To(t,e,r,n,o,s){let c=[e],f=t.split(",");for(let d of f){let p=[];for(let w of c){let g=Mu(d.trim(),w,r,n,o,s);g!==void 0&&p.push(...g)}c=p}return c}function Ou(t,e,r,n,o,s,c){var I;let f=(I=t.match(/^"(\w*)$/))==null?void 0:I[1],d=t.match(/\=([a-h][1-8])$/),p=t.match(/\=([pqrnbkPQRNBKmjuaglMJUAGL]'?)$/),w=t.match(/\+([a-h][1-8])$/),g=t.match(/\+([pqrnbkPQRNBKmjuaglMJUAGL]'?)$/),_=t.match(/^([pqrnbkPQRNBKmjuaglMJUAGL]'?)\/([pqrnbkPQRNBKmjuaglMJUAGL]'?)$/),S=t.match(/^([pqrnbkPQRNBKmjuaglMJUAGL]'?)\+([pqrnbkPQRNBKmjuaglMJUAGL]'?)$/),C=t.match(/^([pqrnbkPQRNBKmjuaglMJUAGL]'?)\+([a-h][1-8])$/),v=t.match(/0\+/),B=t.match(/^([pqrnbkPQRNBKmjuaglMJUAGL]'?)\|([pqrnbkPQRNBKmjuaglMJUAGL]'?)$/);if(f)return o===void 0||f!==c.make_san(n,o)?void 0:[r];if(t.match(/#/)){o&&c.make_move(n,o);let O=c.is_checkmate(n);return o&&c.unmake_move(n,o),O?[r]:void 0}let P=[];if(r[e]===void 0||r[e]<0||Ms(r[e]))return;let R=c.get_at(n,r[e]);if(v){if(!o)return;let{from:O,to:T}=Ye(o);c.get_at(n,O),c.get_at(n,T),o&&c.make_move(n,o);let x=c.pos_attacks_of_color(n,Au(Cs(R))).has(T);return o&&c.unmake_move(n,o),x?void 0:[r]}if(C){let[O,T,x]=C,U=r[T]?M.fromSquare(r[T]):c.get_pieces_bb(n,$e(T,s)),D=r[x]?M.fromSquare(r[x]):M.full();for(let L of U){let F=c.pos_attacks(n,L).intersect(D).singleSquare();o&&c.make_move(n,o);let E=c.pos_attacks(n,L).intersect(D).singleSquare();F===void 0&&E!==void 0&&P.push({...r,[T]:L,[x]:E}),o&&c.unmake_move(n,o)}return P}if(S){let[O,T,x]=S,U=r[T]?M.fromSquare(r[T]):c.get_pieces_bb(n,$e(T,s)),D=r[x]?M.fromSquare(r[x]):c.get_pieces_bb(n,$e(x,s));for(let L of U){let F=c.pos_attacks(n,L).intersect(D).singleSquare();o&&c.make_move(n,o);let E=c.pos_attacks(n,L).intersect(D).singleSquare();F===void 0&&E!==void 0&&P.push({...r,[T]:L,[x]:E}),o&&c.unmake_move(n,o)}return P}if(B){let[O,T,x]=B;if(o!==void 0)return;let U=r[x]>=0?M.fromSquare(r[x]):c.get_pieces_bb(n,$e(x,s)),D=r[T]>=0?[c.get_at(n,r[T])]:$e(T,s),L=c.pos_occupied(n);for(let F of D){let E=c.get_pieces_bb(n,[F]);for(let q of E){let Ie=c.attacks(F,q,L).intersect(U).singleSquare(),Ge=c.attacks(F,q,L.without(r[e])).intersect(U).singleSquare();Ie===void 0&&Ge!==void 0&&P.push({...r,[T]:q,[x]:Ge})}}}if(_){let[O,T,x]=_,U=r[T]>=0?M.fromSquare(r[T]):c.get_pieces_bb(n,$e(T,s)),D=r[x]>=0?M.fromSquare(r[x]):c.get_pieces_bb(n,$e(x,s));for(let L of U){let F=c.pos_attacks(n,L).intersect(D).singleSquare();o&&c.make_move(n,o);let E=c.pos_attacks(n,L).intersect(D).singleSquare();F!==void 0&&E===void 0&&P.push({...r,[T]:L,[x]:F}),o&&c.unmake_move(n,o)}}if(p){let[O,T]=p;if(!o)return;let{from:x,to:U}=Ye(o);c.get_at(n,x);let D=c.get_at(n,U);if(!D)return;if(r[T]!==void 0)return r[T]!==U?void 0:[r];if(!$e(T,s).find(E=>E===D))return;let F={...r,[T]:U};P.push(F)}if(d){let[O,T]=d;if(!o)return;let{from:x,to:U}=Ye(o);if(c.get_at(n,x),c.get_at(n,U),r[T]!==void 0)return r[T]!==U?void 0:[r];let D={...r,[T]:U};P.push(D)}if(w){let[O,T]=w;o&&c.make_move(n,o);let x=r[e];if(o){let{from:D,to:L}=Ye(o);x===D&&(x=L)}let U=c.pos_attacks(n,x);if(r[T]!==void 0){if(!U.has(r[T])){o&&c.unmake_move(n,o);return}let D={...r};P.push(D)}else e:for(let D of U){for(let F of Object.keys(r))if(r[F]===D&&Yn(F))continue e;let L={...r,[T]:D};P.push(L)}o&&c.unmake_move(n,o)}if(g){let[O,T]=g;o&&c.make_move(n,o);let x=r[e];if(o){let{from:L,to:F}=Ye(o);x===L&&(x=F)}let U=c.pos_attacks(n,x);if(r[T]!==void 0){if(U.has(r[T]))return o&&c.unmake_move(n,o),[r];o&&c.unmake_move(n,o);return}let D=c.get_pieces_bb(n,$e(T,s));e:for(let L of U.intersect(D)){for(let E of Object.keys(r))if(r[E]===L&&Yn(E))continue e;let F={...r,[T]:L};P.push(F)}o&&c.unmake_move(n,o)}return P}function Nu(t,e,r,n,o,s){var S,C,v,B,P;let c=(S=t.match(/^"(\w*)$/))==null?void 0:S[1],f=(C=t.match(/^=([pqrnbkPQRNBKmjuaglMJUAGL]'?)$/))==null?void 0:C[1],d=(v=t.match(/^([pqrnbkPQRNBKmjuaglMJUAGL]'?)=$/))==null?void 0:v[1],p=(B=t.match(/^([pqrnbkPQRNBKmjuaglMJUAGL]'?)$/))==null?void 0:B[1],w=(P=t.match(/^=([a-h][1-8])$/))==null?void 0:P[1],g=[];const _=n?Ye(n):void 0;if(c)return n===void 0||c!==s.make_san(r,n)?void 0:[c,[e]];if(w){if(_===void 0)return;let{from:R,to:I}=_,O=w;if(e[O]!==void 0){if(e[O]===R||e[O]!==I)return;let x={...e};return delete x[O],[O,[x]]}let T={...e};return g.push(T),[O,g]}if(f){if(_===void 0)return;let{from:R,to:I}=_,O=f;if(e[O]!==void 0){if(e[O]===R||e[O]!==I)return;let U={...e};return delete U[O],[O,[U]]}if(!s.get_pieces_bb(r,$e(O,o)).has(I))return;let x={...e};return g.push(x),[O,g]}if(d){if(_===void 0)return;let{from:R,to:I}=_,O=d;if(e[O]!==void 0)return e[O]!==R?void 0:[O,[e]];if(!s.get_pieces_bb(r,$e(O,o)).has(R))return;let x={...e,[O]:R};return g.push(x),[O,g]}if(p){let R=p;if(e[R]!==void 0){if(_){let{from:O,to:T}=_;if(e[R]===O)return;if(e[R]===T)return}return e[R]<0||Ms(e[R])?void 0:[R,[e]]}let I=s.get_pieces_bb(r,$e(R,o));_&&(I.set(_.from,!1),I.set(_.to,!1));for(let O of I){let T={...e,[R]:O};g.push(T)}return[R,g]}}function $e(t,e){let r=t[0];switch(r.toLowerCase()===r==(e==="white")?r=r.toUpperCase():r=r.toLowerCase(),r[0]){case"Q":return[Dt];case"R":return[xt];case"B":return[$t];case"N":return[Ft];case"K":return[_n];case"P":return[yn];case"M":return[Ft,$t];case"J":return[xt,Dt];case"U":return[Ft,$t,xt,Dt];case"L":return[Dt,xt,$t,Ft,_n];case"G":return[Dt,xt,$t,Ft,yn];case"A":return[yn,_n,Dt,xt,$t,Ft];case"q":return[Bt];case"r":return[Ut];case"b":return[It];case"n":return[Lt];case"k":return[Sn];case"p":return[En];case"m":return[Lt,It];case"j":return[Ut,Bt];case"u":return[Lt,It,Ut,Bt];case"l":return[Bt,Ut,It,Lt,Sn];case"g":return[Bt,Ut,It,Lt,En];case"a":return[En,Sn,Bt,Ut,It,Lt];default:return[]}}function Ms(t){return t=Number(t),t===0&&1/t===-1/0}const Os=t=>{let e=Object.keys(t.has_tags).length,r={...t.has_tags};return e>0&&(r.has_tag=!0,e===1?r.single_tag=!0:r.many_tags=!0),r[`id_${t.id}`]=!0,r},Fu=t=>{let e={...t.tags,...Os(t)};if(t.rules){[...new Set(t.rules.flatMap($u))].forEach(s=>e[s]=!0);let n=[],o=t.rules.filter(s=>s.solve===void 0||s.solve>=0);if(o.length>0){let s=o[0];s.solve===void 0?(n.push("matched"),n.push(`matched_${s.rule.name}`)):n.push("unmatched")}n.forEach(s=>e[s]=!0),o.length===1&&(e.single_attempt=!0)}return e},$u=t=>t.solve===void 0?(t.rule.rule.includes("."),["solved",`solved_${t.rule.name}`]):t.solve>=0?["failed",`failed_${t.rule.name}`]:[""];class Ns{unwrap(e,r){const n=this._chain(o=>G.ok(e?e(o):o),o=>r?G.ok(r(o)):G.err(o));if(n.isErr)throw n.error;return n.value}map(e,r){return this._chain(n=>G.ok(e(n)),n=>G.err(r?r(n):n))}chain(e,r){return this._chain(e,r||(n=>G.err(n)))}}class xu extends Ns{constructor(e){super(),this.value=void 0,this.isOk=!0,this.isErr=!1,this.value=e}_chain(e,r){return e(this.value)}}class Du extends Ns{constructor(e){super(),this.error=void 0,this.isOk=!1,this.isErr=!0,this.error=e}_chain(e,r){return r(this.error)}}var G;(function(t){t.ok=function(e){return new xu(e)},t.err=function(e){return new Du(e||new Error)},t.all=function(e){if(Array.isArray(e)){const o=[];for(let s=0;s<e.length;s++){const c=e[s];if(c.isErr)return c;o.push(c.value)}return t.ok(o)}const r={},n=Object.keys(e);for(let o=0;o<n.length;o++){const s=e[n[o]];if(s.isErr)return s;r[n[o]]=s.value}return t.ok(r)}})(G||(G={}));const Ro=t=>(t=t-(t>>>1&1431655765),t=(t&858993459)+(t>>>2&858993459),Math.imul(t+(t>>>4)&252645135,16843009)>>24),Qn=t=>(t=t>>>8&16711935|(t&16711935)<<8,t>>>16&65535|(t&65535)<<16),Mo=t=>(t=t>>>1&1431655765|(t&1431655765)<<1,t=t>>>2&858993459|(t&858993459)<<2,t=t>>>4&252645135|(t&252645135)<<4,Qn(t));class A{constructor(e,r){this.lo=e|0,this.hi=r|0}static fromSquare(e){return e>=32?new A(0,1<<e-32):new A(1<<e,0)}static fromRank(e){return new A(255,0).shl64(8*e)}static fromFile(e){return new A(16843009<<e,16843009<<e)}static empty(){return new A(0,0)}static full(){return new A(4294967295,4294967295)}static corners(){return new A(129,2164260864)}static center(){return new A(402653184,24)}static backranks(){return new A(255,4278190080)}static backrank(e){return e==="white"?new A(255,0):new A(0,4278190080)}static lightSquares(){return new A(1437226410,1437226410)}static darkSquares(){return new A(2857740885,2857740885)}complement(){return new A(~this.lo,~this.hi)}xor(e){return new A(this.lo^e.lo,this.hi^e.hi)}union(e){return new A(this.lo|e.lo,this.hi|e.hi)}intersect(e){return new A(this.lo&e.lo,this.hi&e.hi)}diff(e){return new A(this.lo&~e.lo,this.hi&~e.hi)}intersects(e){return this.intersect(e).nonEmpty()}isDisjoint(e){return this.intersect(e).isEmpty()}supersetOf(e){return e.diff(this).isEmpty()}subsetOf(e){return this.diff(e).isEmpty()}shr64(e){return e>=64?A.empty():e>=32?new A(this.hi>>>e-32,0):e>0?new A(this.lo>>>e^this.hi<<32-e,this.hi>>>e):this}shl64(e){return e>=64?A.empty():e>=32?new A(0,this.lo<<e-32):e>0?new A(this.lo<<e,this.hi<<e^this.lo>>>32-e):this}bswap64(){return new A(Qn(this.hi),Qn(this.lo))}rbit64(){return new A(Mo(this.hi),Mo(this.lo))}minus64(e){const r=this.lo-e.lo,n=(r&e.lo&1)+(e.lo>>>1)+(r>>>1)>>>31;return new A(r,this.hi-(e.hi+n))}equals(e){return this.lo===e.lo&&this.hi===e.hi}size(){return Ro(this.lo)+Ro(this.hi)}isEmpty(){return this.lo===0&&this.hi===0}nonEmpty(){return this.lo!==0||this.hi!==0}has(e){return(e>=32?this.hi&1<<e-32:this.lo&1<<e)!==0}set(e,r){return r?this.with(e):this.without(e)}with(e){return e>=32?new A(this.lo,this.hi|1<<e-32):new A(this.lo|1<<e,this.hi)}without(e){return e>=32?new A(this.lo,this.hi&~(1<<e-32)):new A(this.lo&~(1<<e),this.hi)}toggle(e){return e>=32?new A(this.lo,this.hi^1<<e-32):new A(this.lo^1<<e,this.hi)}last(){if(this.hi!==0)return 63-Math.clz32(this.hi);if(this.lo!==0)return 31-Math.clz32(this.lo)}first(){if(this.lo!==0)return 31-Math.clz32(this.lo&-this.lo);if(this.hi!==0)return 63-Math.clz32(this.hi&-this.hi)}withoutFirst(){return this.lo!==0?new A(this.lo&this.lo-1,this.hi):new A(0,this.hi&this.hi-1)}moreThanOne(){return this.hi!==0&&this.lo!==0||(this.lo&this.lo-1)!==0||(this.hi&this.hi-1)!==0}singleSquare(){return this.moreThanOne()?void 0:this.last()}*[Symbol.iterator](){let e=this.lo,r=this.hi;for(;e!==0;){const n=31-Math.clz32(e&-e);e^=1<<n,yield n}for(;r!==0;){const n=31-Math.clz32(r&-r);r^=1<<n,yield 32+n}}*reversed(){let e=this.lo,r=this.hi;for(;r!==0;){const n=31-Math.clz32(r);r^=1<<n,yield 32+n}for(;e!==0;){const n=31-Math.clz32(e);e^=1<<n,yield n}}}const Vr=["a","b","c","d","e","f","g","h"],Fs=["1","2","3","4","5","6","7","8"],yt=["white","black"],Be=["pawn","knight","bishop","rook","queen","king"],Lu=["a","h"],Yr=t=>"role"in t;class Qt{constructor(){}static default(){const e=new Qt;return e.reset(),e}reset(){this.occupied=new A(65535,4294901760),this.promoted=A.empty(),this.white=new A(65535,0),this.black=new A(0,4294901760),this.pawn=new A(65280,16711680),this.knight=new A(66,1107296256),this.bishop=new A(36,603979776),this.rook=new A(129,2164260864),this.queen=new A(8,134217728),this.king=new A(16,268435456)}static empty(){const e=new Qt;return e.clear(),e}clear(){this.occupied=A.empty(),this.promoted=A.empty();for(const e of yt)this[e]=A.empty();for(const e of Be)this[e]=A.empty()}clone(){const e=new Qt;e.occupied=this.occupied,e.promoted=this.promoted;for(const r of yt)e[r]=this[r];for(const r of Be)e[r]=this[r];return e}getColor(e){if(this.white.has(e))return"white";if(this.black.has(e))return"black"}getRole(e){for(const r of Be)if(this[r].has(e))return r}get(e){const r=this.getColor(e);if(!r)return;const n=this.getRole(e),o=this.promoted.has(e);return{color:r,role:n,promoted:o}}take(e){const r=this.get(e);return r&&(this.occupied=this.occupied.without(e),this[r.color]=this[r.color].without(e),this[r.role]=this[r.role].without(e),r.promoted&&(this.promoted=this.promoted.without(e))),r}set(e,r){const n=this.take(e);return this.occupied=this.occupied.with(e),this[r.color]=this[r.color].with(e),this[r.role]=this[r.role].with(e),r.promoted&&(this.promoted=this.promoted.with(e)),n}has(e){return this.occupied.has(e)}*[Symbol.iterator](){for(const e of this.occupied)yield[e,this.get(e)]}pieces(e,r){return this[e].intersect(this[r])}rooksAndQueens(){return this.rook.union(this.queen)}bishopsAndQueens(){return this.bishop.union(this.queen)}kingOf(e){return this.pieces(e,"king").singleSquare()}}class He{constructor(){}static empty(){const e=new He;for(const r of Be)e[r]=0;return e}static fromBoard(e,r){const n=new He;for(const o of Be)n[o]=e.pieces(r,o).size();return n}clone(){const e=new He;for(const r of Be)e[r]=this[r];return e}equals(e){return Be.every(r=>this[r]===e[r])}add(e){const r=new He;for(const n of Be)r[n]=this[n]+e[n];return r}subtract(e){const r=new He;for(const n of Be)r[n]=this[n]-e[n];return r}nonEmpty(){return Be.some(e=>this[e]>0)}isEmpty(){return!this.nonEmpty()}hasPawns(){return this.pawn>0}hasNonPawns(){return this.knight>0||this.bishop>0||this.rook>0||this.queen>0||this.king>0}size(){return this.pawn+this.knight+this.bishop+this.rook+this.queen+this.king}}class wt{constructor(e,r){this.white=e,this.black=r}static empty(){return new wt(He.empty(),He.empty())}static fromBoard(e){return new wt(He.fromBoard(e,"white"),He.fromBoard(e,"black"))}clone(){return new wt(this.white.clone(),this.black.clone())}equals(e){return this.white.equals(e.white)&&this.black.equals(e.black)}add(e){return new wt(this.white.add(e.white),this.black.add(e.black))}subtract(e){return new wt(this.white.subtract(e.white),this.black.subtract(e.black))}count(e){return this.white[e]+this.black[e]}size(){return this.white.size()+this.black.size()}isEmpty(){return this.white.isEmpty()&&this.black.isEmpty()}nonEmpty(){return!this.isEmpty()}hasPawns(){return this.white.hasPawns()||this.black.hasPawns()}hasNonPawns(){return this.white.hasNonPawns()||this.black.hasNonPawns()}}class kr{constructor(e,r){this.white=e,this.black=r}static default(){return new kr(3,3)}clone(){return new kr(this.white,this.black)}equals(e){return this.white===e.white&&this.black===e.black}}const K=t=>t!==void 0,_e=t=>t==="white"?"black":"white",_t=t=>t>>3,Me=t=>t&7,Xn=(t,e)=>0<=t&&t<8&&0<=e&&e<8?t+8*e:void 0,hr=t=>{switch(t){case"pawn":return"p";case"knight":return"n";case"bishop":return"b";case"rook":return"r";case"queen":return"q";case"king":return"k"}};function Jn(t){switch(t.toLowerCase()){case"p":return"pawn";case"n":return"knight";case"b":return"bishop";case"r":return"rook";case"q":return"queen";case"k":return"king";default:return}}function dr(t){if(t.length===2)return Xn(t.charCodeAt(0)-97,t.charCodeAt(1)-49)}const vr=t=>Vr[Me(t)]+Fs[_t(t)],$s=t=>{if(t[1]==="@"&&t.length===4){const e=Jn(t[0]),r=dr(t.slice(2));if(e&&K(r))return{role:e,to:r}}else if(t.length===4||t.length===5){const e=dr(t.slice(0,2)),r=dr(t.slice(2,4));let n;if(t.length===5&&(n=Jn(t[4]),!n))return;if(K(e)&&K(r))return{from:e,to:r,promotion:n}}},Oi=(t,e)=>t==="white"?e==="a"?2:6:e==="a"?58:62,Ni=(t,e)=>t==="white"?e==="a"?3:5:e==="a"?59:61,Iu="rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR",Uu=Iu+" w KQkq -",xs=Uu+" 0 1";var de;(function(t){t.Fen="ERR_FEN",t.Board="ERR_BOARD",t.Pockets="ERR_POCKETS",t.Turn="ERR_TURN",t.Castling="ERR_CASTLING",t.EpSquare="ERR_EP_SQUARE",t.RemainingChecks="ERR_REMAINING_CHECKS",t.Halfmoves="ERR_HALFMOVES",t.Fullmoves="ERR_FULLMOVES"})(de||(de={}));class ke extends Error{}const Bu=(t,e,r)=>{let n=t.indexOf(e);for(;r-- >0&&n!==-1;)n=t.indexOf(e,n+e.length);return n},Gt=t=>/^\d{1,4}$/.test(t)?parseInt(t,10):void 0,Ds=t=>{const e=Jn(t);return e&&{role:e,color:t.toLowerCase()===t?"black":"white"}},An=t=>{const e=Qt.empty();let r=7,n=0;for(let o=0;o<t.length;o++){const s=t[o];if(s==="/"&&n===8)n=0,r--;else{const c=parseInt(s,10);if(c>0)n+=c;else{if(n>=8||r<0)return G.err(new ke(de.Board));const f=n+r*8,d=Ds(s);if(!d)return G.err(new ke(de.Board));t[o+1]==="~"&&(d.promoted=!0,o++),e.set(f,d),n++}}}return r!==0||n!==8?G.err(new ke(de.Board)):G.ok(e)},Oo=t=>{if(t.length>64)return G.err(new ke(de.Pockets));const e=wt.empty();for(const r of t){const n=Ds(r);if(!n)return G.err(new ke(de.Pockets));e[n.color][n.role]++}return G.ok(e)},zu=(t,e)=>{let r=A.empty();if(e==="-")return G.ok(r);for(const n of e){const o=n.toLowerCase(),s=n===o?"black":"white",c=s==="white"?0:7;if("a"<=o&&o<="h")r=r.with(Xn(o.charCodeAt(0)-97,c));else if(o==="k"||o==="q"){const f=t[s].intersect(A.backrank(s)).intersect(t.rook.union(t.king)),d=o==="k"?f.last():f.first();r=r.with(K(d)&&t.rook.has(d)?d:Xn(o==="k"?7:0,c))}else return G.err(new ke(de.Castling))}return yt.some(n=>A.backrank(n).intersect(r).size()>2)?G.err(new ke(de.Castling)):G.ok(r)},No=t=>{const e=t.split("+");if(e.length===3&&e[0]===""){const r=Gt(e[1]),n=Gt(e[2]);return!K(r)||r>3||!K(n)||n>3?G.err(new ke(de.RemainingChecks)):G.ok(new kr(3-r,3-n))}else if(e.length===2){const r=Gt(e[0]),n=Gt(e[1]);return!K(r)||r>3||!K(n)||n>3?G.err(new ke(de.RemainingChecks)):G.ok(new kr(r,n))}else return G.err(new ke(de.RemainingChecks))},Zn=t=>{const e=t.split(/[\s_]+/),r=e.shift();let n,o=G.ok(void 0);if(r.endsWith("]")){const f=r.indexOf("[");if(f===-1)return G.err(new ke(de.Fen));n=An(r.slice(0,f)),o=Oo(r.slice(f+1,-1))}else{const f=Bu(r,"/",7);f===-1?n=An(r):(n=An(r.slice(0,f)),o=Oo(r.slice(f+1)))}let s;const c=e.shift();if(!K(c)||c==="w")s="white";else if(c==="b")s="black";else return G.err(new ke(de.Turn));return n.chain(f=>{const d=e.shift(),p=K(d)?zu(f,d):G.ok(A.empty()),w=e.shift();let g;if(K(w)&&w!=="-"&&(g=dr(w),!K(g)))return G.err(new ke(de.EpSquare));let _=e.shift(),S;K(_)&&_.includes("+")&&(S=No(_),_=e.shift());const C=K(_)?Gt(_):0;if(!K(C))return G.err(new ke(de.Halfmoves));const v=e.shift(),B=K(v)?Gt(v):1;if(!K(B))return G.err(new ke(de.Fullmoves));const P=e.shift();let R=G.ok(void 0);if(K(P)){if(K(S))return G.err(new ke(de.RemainingChecks));R=No(P)}else K(S)&&(R=S);return e.length>0?G.err(new ke(de.Fen)):o.chain(I=>p.chain(O=>R.map(T=>({board:f,pockets:I,turn:s,castlingRights:O,remainingChecks:T,epSquare:g,halfmoves:C,fullmoves:Math.max(1,B)}))))})},ju=t=>{let e=hr(t.role);return t.color==="white"&&(e=e.toUpperCase()),t.promoted&&(e+="~"),e},Ku=t=>{let e="",r=0;for(let n=7;n>=0;n--)for(let o=0;o<8;o++){const s=o+n*8,c=t.get(s);c?(r>0&&(e+=r,r=0),e+=ju(c)):r++,o===7&&(r>0&&(e+=r,r=0),n!==0&&(e+="/"))}return e},Fo=t=>Be.map(e=>hr(e).repeat(t[e])).join(""),Wu=t=>Fo(t.white).toUpperCase()+Fo(t.black),Hu=(t,e)=>{let r="";for(const n of yt){const o=A.backrank(n);let s=t.kingOf(n);K(s)&&!o.has(s)&&(s=void 0);const c=t.pieces(n,"rook").intersect(o);for(const f of e.intersect(o).reversed())if(f===c.first()&&K(s)&&f<s)r+=n==="white"?"Q":"q";else if(f===c.last()&&K(s)&&s<f)r+=n==="white"?"K":"k";else{const d=Vr[Me(f)];r+=n==="white"?d.toUpperCase():d}}return r||"-"},Gu=t=>`${t.white}+${t.black}`,Ls=(t,e)=>[Ku(t.board)+(t.pockets?`[${Wu(t.pockets)}]`:""),t.turn[0],Hu(t.board,t.castlingRights),K(t.epSquare)?vr(t.epSquare):"-",...t.remainingChecks?[Gu(t.remainingChecks)]:[],Math.max(0,Math.min(t.halfmoves,9999)),Math.max(1,Math.min(t.fullmoves,9999))].join(" "),Qr=(t,e)=>{let r=A.empty();for(const n of e){const o=t+n;0<=o&&o<64&&Math.abs(Me(t)-Me(o))<=2&&(r=r.with(o))}return r},lt=t=>{const e=[];for(let r=0;r<64;r++)e[r]=t(r);return e},qu=lt(t=>Qr(t,[-9,-8,-7,-1,1,7,8,9])),Vu=lt(t=>Qr(t,[-17,-15,-10,-6,6,10,15,17])),Yu={white:lt(t=>Qr(t,[7,9])),black:lt(t=>Qr(t,[-7,-9]))},Fi=t=>qu[t],$i=t=>Vu[t],nn=(t,e)=>Yu[t][e],ei=lt(t=>A.fromFile(Me(t)).without(t)),ti=lt(t=>A.fromRank(_t(t)).without(t)),ri=lt(t=>{const e=new A(134480385,2151686160),r=8*(_t(t)-Me(t));return(r>=0?e.shl64(r):e.shr64(-r)).without(t)}),ni=lt(t=>{const e=new A(270549120,16909320),r=8*(_t(t)+Me(t)-7);return(r>=0?e.shl64(r):e.shr64(-r)).without(t)}),ii=(t,e,r)=>{let n=r.intersect(e),o=n.bswap64();return n=n.minus64(t),o=o.minus64(t.bswap64()),n.xor(o.bswap64()).intersect(e)},Qu=(t,e)=>ii(A.fromSquare(t),ei[t],e),Xu=(t,e)=>{const r=ti[t];let n=e.intersect(r),o=n.rbit64();return n=n.minus64(A.fromSquare(t)),o=o.minus64(A.fromSquare(63-t)),n.xor(o.rbit64()).intersect(r)},yr=(t,e)=>{const r=A.fromSquare(t);return ii(r,ri[t],e).xor(ii(r,ni[t],e))},_r=(t,e)=>Qu(t,e).xor(Xu(t,e)),Is=(t,e)=>yr(t,e).xor(_r(t,e)),Us=(t,e)=>{const r=A.fromSquare(e);return ti[t].intersects(r)?ti[t].with(t):ni[t].intersects(r)?ni[t].with(t):ri[t].intersects(r)?ri[t].with(t):ei[t].intersects(r)?ei[t].with(t):A.empty()},Er=(t,e)=>Us(t,e).intersect(A.full().shl64(t).xor(A.full().shl64(e))).withoutFirst();var ot;(function(t){t.Empty="ERR_EMPTY",t.OppositeCheck="ERR_OPPOSITE_CHECK",t.PawnsOnBackrank="ERR_PAWNS_ON_BACKRANK",t.Kings="ERR_KINGS",t.Variant="ERR_VARIANT"})(ot||(ot={}));class zt extends Error{}const Ju=(t,e,r,n)=>r[e].intersect(_r(t,n).intersect(r.rooksAndQueens()).union(yr(t,n).intersect(r.bishopsAndQueens())).union($i(t).intersect(r.knight)).union(Fi(t).intersect(r.king)).union(nn(_e(e),t).intersect(r.pawn)));class bt{constructor(){}static default(){const e=new bt;return e.castlingRights=A.corners(),e.rook={white:{a:0,h:7},black:{a:56,h:63}},e.path={white:{a:new A(14,0),h:new A(96,0)},black:{a:new A(0,234881024),h:new A(0,1610612736)}},e}static empty(){const e=new bt;return e.castlingRights=A.empty(),e.rook={white:{a:void 0,h:void 0},black:{a:void 0,h:void 0}},e.path={white:{a:A.empty(),h:A.empty()},black:{a:A.empty(),h:A.empty()}},e}clone(){const e=new bt;return e.castlingRights=this.castlingRights,e.rook={white:{a:this.rook.white.a,h:this.rook.white.h},black:{a:this.rook.black.a,h:this.rook.black.h}},e.path={white:{a:this.path.white.a,h:this.path.white.h},black:{a:this.path.black.a,h:this.path.black.h}},e}add(e,r,n,o){const s=Oi(e,r),c=Ni(e,r);this.castlingRights=this.castlingRights.with(o),this.rook[e][r]=o,this.path[e][r]=Er(o,c).with(c).union(Er(n,s).with(s)).without(n).without(o)}static fromSetup(e){const r=bt.empty(),n=e.castlingRights.intersect(e.board.rook);for(const o of yt){const s=A.backrank(o),c=e.board.kingOf(o);if(!K(c)||!s.has(c))continue;const f=n.intersect(e.board[o]).intersect(s),d=f.first();K(d)&&d<c&&r.add(o,"a",c,d);const p=f.last();K(p)&&c<p&&r.add(o,"h",c,p)}return r}discardRook(e){if(this.castlingRights.has(e)){this.castlingRights=this.castlingRights.without(e);for(const r of yt)for(const n of Lu)this.rook[r][n]===e&&(this.rook[r][n]=void 0)}}discardColor(e){this.castlingRights=this.castlingRights.diff(A.backrank(e)),this.rook[e].a=void 0,this.rook[e].h=void 0}}class Zu{constructor(e){this.rules=e}reset(){this.board=Qt.default(),this.pockets=void 0,this.turn="white",this.castles=bt.default(),this.epSquare=void 0,this.remainingChecks=void 0,this.halfmoves=0,this.fullmoves=1}setupUnchecked(e){this.board=e.board.clone(),this.board.promoted=A.empty(),this.pockets=void 0,this.turn=e.turn,this.castles=bt.fromSetup(e),this.epSquare=ef(this,e.epSquare),this.remainingChecks=void 0,this.halfmoves=e.halfmoves,this.fullmoves=e.fullmoves}kingAttackers(e,r,n){return Ju(e,r,this.board,n)}playCaptureAt(e,r){this.halfmoves=0,r.role==="rook"&&this.castles.discardRook(e),this.pockets&&this.pockets[_e(r.color)][r.promoted?"pawn":r.role]++}ctx(){const e=this.isVariantEnd(),r=this.board.kingOf(this.turn);if(!K(r))return{king:r,blockers:A.empty(),checkers:A.empty(),variantEnd:e,mustCapture:!1};const n=_r(r,A.empty()).intersect(this.board.rooksAndQueens()).union(yr(r,A.empty()).intersect(this.board.bishopsAndQueens())).intersect(this.board[_e(this.turn)]);let o=A.empty();for(const c of n){const f=Er(r,c).intersect(this.board.occupied);f.moreThanOne()||(o=o.union(f))}const s=this.kingAttackers(r,_e(this.turn),this.board.occupied);return{king:r,blockers:o,checkers:s,variantEnd:e,mustCapture:!1}}clone(){var e,r;const n=new this.constructor;return n.board=this.board.clone(),n.pockets=(e=this.pockets)===null||e===void 0?void 0:e.clone(),n.turn=this.turn,n.castles=this.castles.clone(),n.epSquare=this.epSquare,n.remainingChecks=(r=this.remainingChecks)===null||r===void 0?void 0:r.clone(),n.halfmoves=this.halfmoves,n.fullmoves=this.fullmoves,n}validate(){if(this.board.occupied.isEmpty())return G.err(new zt(ot.Empty));if(this.board.king.size()!==2)return G.err(new zt(ot.Kings));if(!K(this.board.kingOf(this.turn)))return G.err(new zt(ot.Kings));const e=this.board.kingOf(_e(this.turn));return K(e)?this.kingAttackers(e,this.turn,this.board.occupied).nonEmpty()?G.err(new zt(ot.OppositeCheck)):A.backranks().intersects(this.board.pawn)?G.err(new zt(ot.PawnsOnBackrank)):G.ok(void 0):G.err(new zt(ot.Kings))}dropDests(e){return A.empty()}dests(e,r){if(r=r||this.ctx(),r.variantEnd)return A.empty();const n=this.board.get(e);if(!n||n.color!==this.turn)return A.empty();let o,s;if(n.role==="pawn"){o=nn(this.turn,e).intersect(this.board[_e(this.turn)]);const c=this.turn==="white"?8:-8,f=e+c;if(0<=f&&f<64&&!this.board.occupied.has(f)){o=o.with(f);const d=this.turn==="white"?e<16:e>=48,p=f+c;d&&!this.board.occupied.has(p)&&(o=o.with(p))}K(this.epSquare)&&rf(this,e,r)&&(s=A.fromSquare(this.epSquare))}else n.role==="bishop"?o=yr(e,this.board.occupied):n.role==="knight"?o=$i(e):n.role==="rook"?o=_r(e,this.board.occupied):n.role==="queen"?o=Is(e,this.board.occupied):o=Fi(e);if(o=o.diff(this.board[this.turn]),K(r.king)){if(n.role==="king"){const c=this.board.occupied.without(e);for(const f of o)this.kingAttackers(f,_e(this.turn),c).nonEmpty()&&(o=o.without(f));return o.union($o(this,"a",r)).union($o(this,"h",r))}if(r.checkers.nonEmpty()){const c=r.checkers.singleSquare();if(!K(c))return A.empty();o=o.intersect(Er(c,r.king).with(c))}r.blockers.has(e)&&(o=o.intersect(Us(e,r.king)))}return s&&(o=o.union(s)),o}isVariantEnd(){return!1}variantOutcome(e){}hasInsufficientMaterial(e){return this.board[e].intersect(this.board.pawn.union(this.board.rooksAndQueens())).nonEmpty()?!1:this.board[e].intersects(this.board.knight)?this.board[e].size()<=2&&this.board[_e(e)].diff(this.board.king).diff(this.board.queen).isEmpty():this.board[e].intersects(this.board.bishop)?(!this.board.bishop.intersects(A.darkSquares())||!this.board.bishop.intersects(A.lightSquares()))&&this.board.pawn.isEmpty()&&this.board.knight.isEmpty():!0}toSetup(){var e,r;return{board:this.board.clone(),pockets:(e=this.pockets)===null||e===void 0?void 0:e.clone(),turn:this.turn,castlingRights:this.castles.castlingRights,epSquare:tf(this),remainingChecks:(r=this.remainingChecks)===null||r===void 0?void 0:r.clone(),halfmoves:Math.min(this.halfmoves,150),fullmoves:Math.min(Math.max(this.fullmoves,1),9999)}}isInsufficientMaterial(){return yt.every(e=>this.hasInsufficientMaterial(e))}hasDests(e){e=e||this.ctx();for(const r of this.board[this.turn])if(this.dests(r,e).nonEmpty())return!0;return this.dropDests(e).nonEmpty()}isLegal(e,r){if(Yr(e))return!this.pockets||this.pockets[this.turn][e.role]<=0||e.role==="pawn"&&A.backranks().has(e.to)?!1:this.dropDests(r).has(e.to);{if(e.promotion==="pawn"||e.promotion==="king"&&this.rules!=="antichess"||!!e.promotion!==(this.board.pawn.has(e.from)&&A.backranks().has(e.to)))return!1;const n=this.dests(e.from,r);return n.has(e.to)||n.has(nf(this,e).to)}}isCheck(){const e=this.board.kingOf(this.turn);return K(e)&&this.kingAttackers(e,_e(this.turn),this.board.occupied).nonEmpty()}isEnd(e){return(e?e.variantEnd:this.isVariantEnd())?!0:this.isInsufficientMaterial()||!this.hasDests(e)}isCheckmate(e){return e=e||this.ctx(),!e.variantEnd&&e.checkers.nonEmpty()&&!this.hasDests(e)}isStalemate(e){return e=e||this.ctx(),!e.variantEnd&&e.checkers.isEmpty()&&!this.hasDests(e)}outcome(e){const r=this.variantOutcome(e);return r||(e=e||this.ctx(),this.isCheckmate(e)?{winner:_e(this.turn)}:this.isInsufficientMaterial()||this.isStalemate(e)?{winner:void 0}:void 0)}allDests(e){e=e||this.ctx();const r=new Map;if(e.variantEnd)return r;for(const n of this.board[this.turn])r.set(n,this.dests(n,e));return r}play(e){const r=this.turn,n=this.epSquare,o=Bs(this,e);if(this.epSquare=void 0,this.halfmoves+=1,r==="black"&&(this.fullmoves+=1),this.turn=_e(r),Yr(e))this.board.set(e.to,{role:e.role,color:r}),this.pockets&&this.pockets[r][e.role]--,e.role==="pawn"&&(this.halfmoves=0);else{const s=this.board.take(e.from);if(!s)return;let c;if(s.role==="pawn"){this.halfmoves=0,e.to===n&&(c=this.board.take(e.to+(r==="white"?-8:8)));const f=e.from-e.to;Math.abs(f)===16&&8<=e.from&&e.from<=55&&(this.epSquare=e.from+e.to>>1),e.promotion&&(s.role=e.promotion,s.promoted=!!this.pockets)}else if(s.role==="rook")this.castles.discardRook(e.from);else if(s.role==="king"){if(o){const f=this.castles.rook[r][o];if(K(f)){const d=this.board.take(f);this.board.set(Oi(r,o),s),d&&this.board.set(Ni(r,o),d)}}this.castles.discardColor(r)}if(!o){const f=this.board.set(e.to,s)||c;f&&this.playCaptureAt(e.to,f)}}this.remainingChecks&&this.isCheck()&&(this.remainingChecks[r]=Math.max(this.remainingChecks[r]-1,0))}}class oi extends Zu{constructor(){super("chess")}static default(){const e=new this;return e.reset(),e}static fromSetup(e){const r=new this;return r.setupUnchecked(e),r.validate().map(n=>r)}clone(){return super.clone()}}const ef=(t,e)=>{if(!K(e))return;const r=t.turn==="white"?5:2,n=t.turn==="white"?8:-8;if(_t(e)!==r||t.board.occupied.has(e+n))return;const o=e-n;if(!(!t.board.pawn.has(o)||!t.board[_e(t.turn)].has(o)))return e},tf=t=>{if(!K(t.epSquare))return;const e=t.ctx(),n=t.board.pieces(t.turn,"pawn").intersect(nn(_e(t.turn),t.epSquare));for(const o of n)if(t.dests(o,e).has(t.epSquare))return t.epSquare},rf=(t,e,r)=>{if(!K(t.epSquare)||!nn(t.turn,e).has(t.epSquare))return!1;if(!K(r.king))return!0;const n=t.turn==="white"?8:-8,o=t.epSquare-n;return t.kingAttackers(r.king,_e(t.turn),t.board.occupied.toggle(e).toggle(o).with(t.epSquare)).without(o).isEmpty()},$o=(t,e,r)=>{if(!K(r.king)||r.checkers.nonEmpty())return A.empty();const n=t.castles.rook[t.turn][e];if(!K(n)||t.castles.path[t.turn][e].intersects(t.board.occupied))return A.empty();const o=Oi(t.turn,e),s=Er(r.king,o),c=t.board.occupied.without(r.king);for(const p of s)if(t.kingAttackers(p,_e(t.turn),c).nonEmpty())return A.empty();const f=Ni(t.turn,e),d=t.board.occupied.toggle(r.king).toggle(n).toggle(f);return t.kingAttackers(o,_e(t.turn),d).nonEmpty()?A.empty():A.fromSquare(n)},Bs=(t,e)=>{if(Yr(e))return;const r=e.to-e.from;if(!(Math.abs(r)!==2&&!t.board[t.turn].has(e.to))&&t.board.king.has(e.from))return r>0?"h":"a"},nf=(t,e)=>{const r=Bs(t,e);if(!r)return e;const n=t.castles.rook[t.turn][r];return{from:e.from,to:K(n)?n:e.to}},of=(t,e)=>{const r=new Map,n=t.ctx();for(const[o,s]of t.allDests(n))if(s.nonEmpty()){const c=Array.from(s,vr);o===n.king&&Me(o)===4&&(s.has(0)?c.push("c1"):s.has(56)&&c.push("c8"),s.has(7)?c.push("g1"):s.has(63)&&c.push("g8")),r.set(vr(o),c)}return r},sf=(t,e)=>{let r="";if(Yr(e))e.role!=="pawn"&&(r=hr(e.role).toUpperCase()),r+="@"+vr(e.to);else{const n=t.board.getRole(e.from);if(!n)return"--";if(n==="king"&&(t.board[t.turn].has(e.to)||Math.abs(e.to-e.from)===2))r=e.to>e.from?"O-O":"O-O-O";else{const o=t.board.occupied.has(e.to)||n==="pawn"&&Me(e.from)!==Me(e.to);if(n!=="pawn"){r=hr(n).toUpperCase();let s;if(n==="king"?s=Fi(e.to).intersect(t.board.king):n==="queen"?s=Is(e.to,t.board.occupied).intersect(t.board.queen):n==="rook"?s=_r(e.to,t.board.occupied).intersect(t.board.rook):n==="bishop"?s=yr(e.to,t.board.occupied).intersect(t.board.bishop):s=$i(e.to).intersect(t.board.knight),s=s.intersect(t.board[t.turn]).without(e.from),s.nonEmpty()){const c=t.ctx();for(const f of s)t.dests(f,c).has(e.to)||(s=s.without(f));if(s.nonEmpty()){let f=!1,d=s.intersects(A.fromRank(_t(e.from)));s.intersects(A.fromFile(Me(e.from)))?f=!0:d=!0,d&&(r+=Vr[Me(e.from)]),f&&(r+=Fs[_t(e.from)])}}}else o&&(r=Vr[Me(e.from)]);o&&(r+="x"),r+=vr(e.to),e.promotion&&(r+="="+hr(e.promotion).toUpperCase())}}return r},af=(t,e)=>{var r;const n=sf(t,e);return t.play(e),!((r=t.outcome())===null||r===void 0)&&r.winner?n+"#":t.isCheck()?n+"+":n},lf=(t,e)=>af(t.clone(),e);function cf(t,e){let r=Zn(t).unwrap(),n=oi.fromSetup(r).unwrap(),o=$s(e);return n.play(o),Ls(n.toSetup())}const Jr=class Jr{constructor(){$(this,"_add_uci");$(this,"_promotion");$(this,"_position");$(this,"m_fen");$(this,"m_dests");$(this,"m_color");$(this,"_last_move");$(this,"_on_wheel");$(this,"set_on_wheel",e=>{this._on_wheel[1](e)});$(this,"on_play_uci",e=>{let r=cf(this.fen,e);this.on_set_fen_uci(r,e)});$(this,"on_set_fen_uci",(e,r)=>{pr(()=>{this.add_uci=void 0,this.last_move=r,this.position=oi.fromSetup(Zn(e).unwrap()).unwrap()})});$(this,"reset_move_after",()=>{this.position=this.position});$(this,"on_move_after",(e,r)=>{let n=this.position.board.get(dr(e)),o=e+r;n.role==="pawn"&&(r[1]==="8"&&this.turnColor==="white"||r[1]==="1"&&this.turnColor==="black")&&(o+="q");let s=$s(o),c=lf(this.position,s);this.position.play(s),pr(()=>{this.last_move=o,this.position=this.position,o.length===5&&(this.promotion=r),this.add_uci=[o,c]})});this._on_wheel=ge(void 0,{equals:!1}),this._last_move=ge(void 0,{equals:!1}),this._add_uci=ge(void 0,{equals:!1}),this._promotion=ge(void 0,{equals:!1}),this._position=ge(oi.fromSetup(Zn(xs).unwrap()).unwrap(),{equals:!1}),this.m_dests=ve(()=>of(this.position)),this.m_fen=ve(()=>Ls(this.position.toSetup())),this.m_color=ve(()=>this.position.turn)}get position(){return this._position[0]()}set position(e){this._position[1](e)}get turnColor(){return this.m_color()}get promotion(){return this._promotion[0]()}set promotion(e){this._promotion[1](e)}get add_uci(){return this._add_uci[0]()}set add_uci(e){this._add_uci[1](e)}get last_move(){return this._last_move[0]()}set last_move(e){this._last_move[1](e)}get on_wheel(){return this._on_wheel[0]()}get fen_uci(){let e=this.fen,r=this.last_move;return[e,r]}get fen(){return this.m_fen()}get dests(){return this.m_dests()}};$(Jr,"init",()=>new Jr);let si=Jr;function uf(t){let e=0;return r=>{e+=r.deltaY*(r.deltaMode?40:1),Math.abs(e)>=4?(t(r,!0),e=0):t(r,!1)}}function ff(t){return new Worker(""+new URL("worker2-BDsQSkbY.js",import.meta.url).href,{type:"module",name:t==null?void 0:t.name})}const on=Xa(),hf=t=>{let e=new ff;const[r,n]=ge(),[o,s]=ge(),[c,f]=ge();e.onmessage=v=>{switch(v.data==="ready"&&(d=!0,g()),v.data.t){case"progress":n(v.data.d);break;case"puzzles":let{all:B,filtered:P}=v.data.d;pr(()=>{f(B),s(P)});break}};let d=!1,p,w=[];function g(){d&&e.postMessage({t:"filter",d:{filter:p,rules:w}})}let C={get progress(){return r()},get puzzles(){return o()},get all(){return c()},filter:v=>{p=v,g()},rules:v=>{w=v,g()}};return Ee(on.Provider,{value:C,get children(){return[" ",ve(()=>t.children)," "]}})};function df(t,e,r=!1){let n,o=0;return function(...s){const c=this;n&&clearTimeout(n),n=void 0;const f=performance.now()-o;o=performance.now(),r&&f>e?t.apply(c,s):n=setTimeout(()=>{n=void 0,t.apply(c,s)},e)}}var pf=Le("<div class=header>"),mf=Le("<div class=app-wrap><div class=board-wrap><div class=board></div><div class=tree></div></div><div class=editor-wrap></div><div class=puzzles-wrap>"),gf=Le("<div>"),wf=Le("<div class=progress> <!>/<!> "),bf=Le('<div class=puzzles><div class=filter><input type=text placeholder="Filter y_filter _!_ n_filter"><span>/10000 Positions</span></div><div class=list></div><div class=info><button>Toggle Solved</button><button>Toggle Id</button><button>Toggle Failed'),kf=Le("<div><span class=id><a target=_blank></a></span><span class=has-tags></span><span class=tags>"),xo=Le("<span class=tag>"),vf=Le("<div class=rule-list><div class=scroll-wrap></div><div class=tools><div class=rule>+ New rule</div><div class=rule>- Delete rule"),yf=Le("<div class=text-wrap><textarea class=editor-input title=rules rows=13 cols=21></textarea><div class=ascii><textarea>"),_f=Le("<div><span class=name></span><span class=stats>f <!> / s "),Ef=Le("<span>");function Sf(){return Ee(hf,{get children(){return Ee(Af,{})}})}function Af(){const[t,e]=ge(void 0),[r,n]=ge(0),o=ve(()=>{let f=t();return f?f.sans:[]});Qe(()=>{let f=t(),d=r();f?s.on_set_fen_uci(f.move_fens[d+1]):s.on_set_fen_uci(xs)}),Qe(Cn(t,()=>{n(-1)}));const s=new si,c=uf((f,d)=>{if(!d)return;const p=f.target;if(p.tagName!=="PIECE"&&p.tagName!=="SQUARE"&&p.tagName!=="CG-BOARD")return;f.preventDefault();let w=Math.sign(f.deltaY),g=t();w>0?g&&n(Math.min(g.move_fens.length-2,r()+1)):n(Math.max(-1,r()-1))});return[pf(),(()=>{var f=mf(),d=f.firstChild,p=d.firstChild,w=p.nextSibling,g=d.nextSibling,_=g.nextSibling;return fl(p,"wheel",c),le(p,Ee(Gc,{onShapes:()=>{},movable:!0,get doPromotion(){return s.promotion},get onMoveAfter(){return s.on_move_after},get fen_uci(){return s.fen_uci},get color(){return s.turnColor},get dests(){return s.dests}})),le(w,Ee(fr,{get each(){return o()},children:(S,C)=>(()=>{var v=gf();return v.$$click=()=>n(C),le(v,S),Ze(()=>ui(v,"san"+(r()===C()?" active":""))),v})()})),le(g,Ee(Tf,{get fen(){return s.fen_uci[0]}})),le(_,Ee(Pf,{on_selected_puzzle:e})),le(f,Ee(Cf,{}),null),f})()]}const Cf=()=>{const t=ai(on);return Ee(ci,{get when(){return t.progress},children:e=>(()=>{var r=wf(),n=r.firstChild,o=n.nextSibling,s=o.nextSibling,c=s.nextSibling;return c.nextSibling,le(r,()=>e()[0],o),le(r,()=>e()[1],c),r})()})},Zr=class Zr{constructor(e){$(this,"_has_tags");$(this,"_all_tags");this.puzzle=e}get id(){return this.puzzle.id}get fen(){return this.puzzle.fen}get tags(){return this.puzzle.tags}get has_tags(){return this._has_tags||(this._has_tags=Os(this.puzzle)),this._has_tags}get all_tags(){return this._all_tags||(this._all_tags=Fu(this.puzzle)),this._all_tags}};$(Zr,"create",e=>new Zr(e));let Xr=Zr;const Pf=t=>{let e=ai(on);const r=ve(li(()=>e.puzzles,Xr.create)),[n,o]=Bn(void 0,"filter"),[s,c]=Bn(void 0,"id_selected"),f=ve(()=>r().find(v=>v.id===s()));let d;const p=()=>{let v=n();if(!v)return;let B=f();B&&(d?(o(d),d=void 0):(d=v,o(`id_${B.id} `)))},w=()=>{let v=n();v&&(v.includes("solved")?v=v.replace("solved",""):v=v.trim()+" solved",o(v))};let g=n();const _=()=>{let v=n();v&&(v.includes("failed")?(v=g,g=void 0):(g=v,v="failed"),o(v))};Qe(Cn(f,v=>{var B;v?t.on_selected_puzzle(v.puzzle):(r()[0]&&c((B=r()[0])==null?void 0:B.id),t.on_selected_puzzle(void 0))})),Qe(Cn(n,v=>{e.filter(v)}));let S;const C=df(v=>{o(v)},1100);return(()=>{var v=bf(),B=v.firstChild,P=B.firstChild,R=P.nextSibling,I=R.firstChild,O=B.nextSibling,T=O.nextSibling,x=T.firstChild,U=x.nextSibling,D=U.nextSibling;return Ko(L=>S=L,P),P.$$input=()=>C(S.value),oo(P,"spellcheck",!1),le(R,()=>r().length,I),le(O,Ee(ci,{get when(){return r()},children:L=>Ee(fr,{get each(){return L().slice(0,1e3)},children:F=>(()=>{var E=kf(),q=E.firstChild,Ie=q.firstChild,Ge=q.nextSibling,oe=Ge.nextSibling;return E.$$click=()=>c(F.id),le(Ie,()=>F.id),le(Ge,Ee(fr,{get each(){return Object.keys(F.has_tags).filter(W=>!W.includes("id_"))},children:W=>(()=>{var Oe=xo();return le(Oe,W),Oe})()})),le(oe,Ee(fr,{get each(){return Object.keys(F.all_tags)},children:W=>(()=>{var Oe=xo();return le(Oe,W),Oe})()})),Ze(W=>{var Oe="puzzle"+(F.id===s()?" active":""),At=`https://lichess.org/training/${F.id}`;return Oe!==W.e&&ui(E,W.e=Oe),At!==W.t&&oo(Ie,"href",W.t=At),W},{e:void 0,t:void 0}),E})()})})),x.$$click=w,U.$$click=p,D.$$click=_,Ze(()=>P.value=n()),v})()};function Tf(t){let e=ai(on);const r=ve(li(()=>e.all,Xr.create)),n=P=>r().filter(R=>R.all_tags[`failed_${P}`]).length,o=P=>r().filter(R=>R.all_tags[`solved_${P}`]).length;function s(){let P=1,R=`rule${P}`,I=c();for(;I.find(O=>O.name===R);)R=`rule${P++}`;return{name:R,rule:"",z:I.length}}const[c,f]=Bn([{name:"rule1",rule:"",z:0}],"rule-list"),[d,p]=ge(0);e.rules(c());const w=ve(()=>c()[d()]),g=P=>{if(P.key==="Escape"){let R=P.target.value,I=w(),O={name:I.name,rule:R,z:I.z},T=c(),x=T.findIndex(U=>U.name===I.name);T.splice(x,1,O),f([...T]),e.rules([O])}},_=()=>{pr(()=>{f([s(),...c()]),p(0)})},S=()=>{let P=c();if(P.length===1)return;let R=P.splice(d(),1);pr(()=>{f([...P]),d()===P.length&&p(P.length-1)}),e.rules(R.map(I=>({name:I.name,rule:"",z:-1})))};let[C]=Va(()=>Mi.make(()=>dl)),v=ve(()=>{let P=C(),R=w().rule;if(t.fen&&P)try{return Tu(t.fen,R,P)}catch(I){return"Error"+I}});const B=ve(()=>{let P=w();if(!P||!t.fen)return;let R=C();if(!R)return;let I=Si.fromSetup(Ei(t.fen).unwrap()).unwrap();return Rs(Ps(t.fen,P.rule,R),I)});return[(()=>{var P=vf(),R=P.firstChild,I=R.nextSibling,O=I.firstChild,T=O.nextSibling;return le(R,Ee(fr,{get each(){return c()},children:(x,U)=>(()=>{var D=_f(),L=D.firstChild,F=L.nextSibling,E=F.firstChild,q=E.nextSibling;return q.nextSibling,D.$$click=()=>p(U()),le(L,()=>x.name),le(F,()=>n(x.name),q),le(F,()=>o(x.name),null),Ze(()=>ui(D,"rule"+(U()===d()?" active":""))),D})()})),O.$$click=_,T.$$click=S,P})(),(()=>{var P=yf(),R=P.firstChild,I=R.nextSibling,O=I.firstChild;return R.$$keydown=g,O.disabled=!0,le(O,B),le(I,Ee(ci,{get when(){return v()},children:T=>(()=>{var x=Ef();return le(x,T),x})()}),null),Ze(()=>{var T;return R.value=((T=w())==null?void 0:T.rule)??"Select a rule"}),P})()]}ul(["click","input","keydown"]);const Rf=document.getElementById("root");cl(()=>Ee(Sf,{}),Rf);const Mf=Object.freeze(Object.defineProperty({__proto__:null},Symbol.toStringTag,{value:"Module"}));
