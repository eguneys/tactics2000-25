var Da=Object.defineProperty;var Ia=(t,e,r)=>e in t?Da(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r;var F=(t,e,r)=>Ia(t,typeof e!="symbol"?e+"":e,r);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))n(o);new MutationObserver(o=>{for(const a of o)if(a.type==="childList")for(const c of a.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&n(c)}).observe(document,{childList:!0,subtree:!0});function r(o){const a={};return o.integrity&&(a.integrity=o.integrity),o.referrerPolicy&&(a.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?a.credentials="include":o.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function n(o){if(o.ep)return;o.ep=!0;const a=r(o);fetch(o.href,a)}})();const te={context:void 0,registry:void 0,effects:void 0,done:!1,getContextId(){return Zi(this.context.count)},getNextContextId(){return Zi(this.context.count++)}};function Zi(t){const e=String(t),r=e.length-1;return te.context.id+(r?String.fromCharCode(96+r):"")+e}function La(t){te.context=t}const Ua=(t,e)=>t===e,Ba=Symbol("solid-proxy"),za=Symbol("solid-track"),Nr={equals:Ua};let xo=Io;const Xe=1,xr=2,Fo={owned:null,cleanups:null,context:null,owner:null},pn={};var se=null;let mn=null,ja=null,fe=null,Se=null,Ye=null,Zr=0;function Rr(t,e){const r=fe,n=se,o=t.length===0,a=e===void 0?n:e,c=o?Fo:{owned:null,cleanups:null,context:a?a.context:null,owner:a},f=o?t:()=>t(()=>Ce(()=>dr(c)));se=c,fe=null;try{return nt(f,!0)}finally{fe=r,se=n}}function ge(t,e){e=e?Object.assign({},Nr,e):Nr;const r={value:t,observers:null,observerSlots:null,comparator:e.equals||void 0},n=o=>(typeof o=="function"&&(o=o(r.value)),Do(r,o));return[$o.bind(r),n]}function eo(t,e,r){const n=en(t,e,!0,Xe);Qt(n)}function Qe(t,e,r){const n=en(t,e,!1,Xe);Qt(n)}function Ve(t,e,r){xo=Ja;const n=en(t,e,!1,Xe);n.user=!0,Ye?Ye.push(n):Qt(n)}function ke(t,e,r){r=r?Object.assign({},Nr,r):Nr;const n=en(t,e,!0,0);return n.observers=null,n.observerSlots=null,n.comparator=r.equals||void 0,Qt(n),$o.bind(n)}function Wa(t){return t&&typeof t=="object"&&"then"in t}function Ha(t,e,r){let n,o,a;arguments.length===2&&typeof e=="object"||arguments.length===1?(n=!0,o=t,a={}):(n=t,o=e,a={});let c=null,f=pn,d=null,m=!1,w="initialValue"in a,g=typeof n=="function"&&ke(n);const E=new Set,[_,S]=(a.storage||ge)(a.initialValue),[k,x]=ge(void 0),[R,A]=ge(void 0,{equals:!1}),[P,$]=ge(w?"ready":"unresolved");te.context&&(d=te.getNextContextId(),a.ssrLoadFrom==="initial"?f=a.initialValue:te.load&&te.has(d)&&(f=te.load(d)));function M(G,I,T,X){return c===G&&(c=null,X!==void 0&&(w=!0),(G===f||I===f)&&a.onHydrated&&queueMicrotask(()=>a.onHydrated(X,{value:I})),f=pn,q(I,T)),I}function q(G,I){nt(()=>{I===void 0&&S(()=>G),$(I!==void 0?"errored":w?"ready":"unresolved"),x(I);for(const T of E.keys())T.decrement();E.clear()},!1)}function H(){const G=Ya,I=_(),T=k();if(T!==void 0&&!c)throw T;return fe&&!fe.user&&G&&eo(()=>{R(),c&&(G.resolved||E.has(G)||(G.increment(),E.add(G)))}),I}function K(G=!0){if(G!==!1&&m)return;m=!1;const I=g?g():n;if(I==null||I===!1){M(c,Ce(_));return}const T=f!==pn?f:Ce(()=>o(I,{value:_(),refetching:G}));return Wa(T)?(c=T,"value"in T?(T.status==="success"?M(c,T.value,void 0,I):M(c,void 0,Pn(T.value),I),T):(m=!0,queueMicrotask(()=>m=!1),nt(()=>{$(w?"refreshing":"pending"),A()},!1),T.then(X=>M(T,X,void 0,I),X=>M(T,void 0,Pn(X),I)))):(M(c,T,void 0,I),T)}return Object.defineProperties(H,{state:{get:()=>P()},error:{get:()=>k()},loading:{get(){const G=P();return G==="pending"||G==="refreshing"}},latest:{get(){if(!w)return H();const G=k();if(G&&!c)throw G;return _()}}}),g?eo(()=>K(!1)):K(!1),[H,{refetch:K,mutate:S}]}function Fr(t){return nt(t,!1)}function Ce(t){if(fe===null)return t();const e=fe;fe=null;try{return t()}finally{fe=e}}function Cn(t,e,r){const n=Array.isArray(t);let o;return a=>{let c;if(n){c=Array(t.length);for(let d=0;d<t.length;d++)c[d]=t[d]()}else c=t();const f=Ce(()=>e(c,o,a));return o=c,f}}function Ka(t){Ve(()=>Ce(t))}function Ga(t){return se===null||(se.cleanups===null?se.cleanups=[t]:se.cleanups.push(t)),t}function Va(t,e){const r=Symbol("context");return{id:r,Provider:Za(r),defaultValue:t}}function oi(t){let e;return se&&se.context&&(e=se.context[t.id])!==void 0?e:t.defaultValue}function qa(t){const e=ke(t),r=ke(()=>Tn(e()));return r.toArray=()=>{const n=r();return Array.isArray(n)?n:n!=null?[n]:[]},r}let Ya;function $o(){if(this.sources&&this.state)if(this.state===Xe)Qt(this);else{const t=Se;Se=null,nt(()=>Dr(this),!1),Se=t}if(fe){const t=this.observers?this.observers.length:0;fe.sources?(fe.sources.push(this),fe.sourceSlots.push(t)):(fe.sources=[this],fe.sourceSlots=[t]),this.observers?(this.observers.push(fe),this.observerSlots.push(fe.sources.length-1)):(this.observers=[fe],this.observerSlots=[fe.sources.length-1])}return this.value}function Do(t,e,r){let n=t.value;return(!t.comparator||!t.comparator(n,e))&&(t.value=e,t.observers&&t.observers.length&&nt(()=>{for(let o=0;o<t.observers.length;o+=1){const a=t.observers[o],c=mn&&mn.running;c&&mn.disposed.has(a),(c?!a.tState:!a.state)&&(a.pure?Se.push(a):Ye.push(a),a.observers&&Lo(a)),c||(a.state=Xe)}if(Se.length>1e6)throw Se=[],new Error},!1)),e}function Qt(t){if(!t.fn)return;dr(t);const e=Zr;Qa(t,t.value,e)}function Qa(t,e,r){let n;const o=se,a=fe;fe=se=t;try{n=t.fn(e)}catch(c){return t.pure&&(t.state=Xe,t.owned&&t.owned.forEach(dr),t.owned=null),t.updatedAt=r+1,Uo(c)}finally{fe=a,se=o}(!t.updatedAt||t.updatedAt<=r)&&(t.updatedAt!=null&&"observers"in t?Do(t,n):t.value=n,t.updatedAt=r)}function en(t,e,r,n=Xe,o){const a={fn:t,state:n,updatedAt:null,owned:null,sources:null,sourceSlots:null,cleanups:null,value:e,owner:se,context:se?se.context:null,pure:r};return se===null||se!==Fo&&(se.owned?se.owned.push(a):se.owned=[a]),a}function $r(t){if(t.state===0)return;if(t.state===xr)return Dr(t);if(t.suspense&&Ce(t.suspense.inFallback))return t.suspense.effects.push(t);const e=[t];for(;(t=t.owner)&&(!t.updatedAt||t.updatedAt<Zr);)t.state&&e.push(t);for(let r=e.length-1;r>=0;r--)if(t=e[r],t.state===Xe)Qt(t);else if(t.state===xr){const n=Se;Se=null,nt(()=>Dr(t,e[0]),!1),Se=n}}function nt(t,e){if(Se)return t();let r=!1;e||(Se=[]),Ye?r=!0:Ye=[],Zr++;try{const n=t();return Xa(r),n}catch(n){r||(Ye=null),Se=null,Uo(n)}}function Xa(t){if(Se&&(Io(Se),Se=null),t)return;const e=Ye;Ye=null,e.length&&nt(()=>xo(e),!1)}function Io(t){for(let e=0;e<t.length;e++)$r(t[e])}function Ja(t){let e,r=0;for(e=0;e<t.length;e++){const n=t[e];n.user?t[r++]=n:$r(n)}if(te.context){if(te.count){te.effects||(te.effects=[]),te.effects.push(...t.slice(0,r));return}La()}for(te.effects&&(te.done||!te.count)&&(t=[...te.effects,...t],r+=te.effects.length,delete te.effects),e=0;e<r;e++)$r(t[e])}function Dr(t,e){t.state=0;for(let r=0;r<t.sources.length;r+=1){const n=t.sources[r];if(n.sources){const o=n.state;o===Xe?n!==e&&(!n.updatedAt||n.updatedAt<Zr)&&$r(n):o===xr&&Dr(n,e)}}}function Lo(t){for(let e=0;e<t.observers.length;e+=1){const r=t.observers[e];r.state||(r.state=xr,r.pure?Se.push(r):Ye.push(r),r.observers&&Lo(r))}}function dr(t){let e;if(t.sources)for(;t.sources.length;){const r=t.sources.pop(),n=t.sourceSlots.pop(),o=r.observers;if(o&&o.length){const a=o.pop(),c=r.observerSlots.pop();n<o.length&&(a.sourceSlots[c]=n,o[n]=a,r.observerSlots[n]=c)}}if(t.tOwned){for(e=t.tOwned.length-1;e>=0;e--)dr(t.tOwned[e]);delete t.tOwned}if(t.owned){for(e=t.owned.length-1;e>=0;e--)dr(t.owned[e]);t.owned=null}if(t.cleanups){for(e=t.cleanups.length-1;e>=0;e--)t.cleanups[e]();t.cleanups=null}t.state=0}function Pn(t){return t instanceof Error?t:new Error(typeof t=="string"?t:"Unknown error",{cause:t})}function Uo(t,e=se){throw Pn(t)}function Tn(t){if(typeof t=="function"&&!t.length)return Tn(t());if(Array.isArray(t)){const e=[];for(let r=0;r<t.length;r++){const n=Tn(t[r]);Array.isArray(n)?e.push.apply(e,n):e.push(n)}return e}return t}function Za(t,e){return function(n){let o;return Qe(()=>o=Ce(()=>(se.context={...se.context,[t]:n.value},qa(()=>n.children))),void 0),o}}const el=Symbol("fallback");function to(t){for(let e=0;e<t.length;e++)t[e]()}function si(t,e,r={}){let n=[],o=[],a=[],c=0,f=e.length>1?[]:null;return Ga(()=>to(a)),()=>{let d=t()||[],m=d.length,w,g;return d[za],Ce(()=>{let _,S,k,x,R,A,P,$,M;if(m===0)c!==0&&(to(a),a=[],n=[],o=[],c=0,f&&(f=[])),r.fallback&&(n=[el],o[0]=Rr(q=>(a[0]=q,r.fallback())),c=1);else if(c===0){for(o=new Array(m),g=0;g<m;g++)n[g]=d[g],o[g]=Rr(E);c=m}else{for(k=new Array(m),x=new Array(m),f&&(R=new Array(m)),A=0,P=Math.min(c,m);A<P&&n[A]===d[A];A++);for(P=c-1,$=m-1;P>=A&&$>=A&&n[P]===d[$];P--,$--)k[$]=o[P],x[$]=a[P],f&&(R[$]=f[P]);for(_=new Map,S=new Array($+1),g=$;g>=A;g--)M=d[g],w=_.get(M),S[g]=w===void 0?-1:w,_.set(M,g);for(w=A;w<=P;w++)M=n[w],g=_.get(M),g!==void 0&&g!==-1?(k[g]=o[w],x[g]=a[w],f&&(R[g]=f[w]),g=S[g],_.set(M,g)):a[w]();for(g=A;g<m;g++)g in k?(o[g]=k[g],a[g]=x[g],f&&(f[g]=R[g],f[g](g))):o[g]=Rr(E);o=o.slice(0,c=m),n=d.slice(0)}return o});function E(_){if(a[g]=_,f){const[S,k]=ge(g);return f[g]=k,e(d[g],S)}return e(d[g])}}}function Ee(t,e){return Ce(()=>t(e||{}))}let tl=0;function rl(){return te.context?te.getNextContextId():`cl-${tl++}`}const nl=t=>`Stale read from <${t}>.`;function cr(t){const e="fallback"in t&&{fallback:()=>t.fallback};return ke(si(()=>t.each,t.children,e||void 0))}function ai(t){const e=t.keyed,r=ke(()=>t.when,void 0,{equals:(n,o)=>e?n===o:!n==!o});return ke(()=>{const n=r();if(n){const o=t.children;return typeof o=="function"&&o.length>0?Ce(()=>o(e?n:()=>{if(!Ce(r))throw nl("Show");return t.when})):o}return t.fallback},void 0,void 0)}function il(t,e,r){let n=r.length,o=e.length,a=n,c=0,f=0,d=e[o-1].nextSibling,m=null;for(;c<o||f<a;){if(e[c]===r[f]){c++,f++;continue}for(;e[o-1]===r[a-1];)o--,a--;if(o===c){const w=a<n?f?r[f-1].nextSibling:r[a-f]:d;for(;f<a;)t.insertBefore(r[f++],w)}else if(a===f)for(;c<o;)(!m||!m.has(e[c]))&&e[c].remove(),c++;else if(e[c]===r[a-1]&&r[f]===e[o-1]){const w=e[--o].nextSibling;t.insertBefore(r[f++],e[c++].nextSibling),t.insertBefore(r[--a],w),e[o]=r[a]}else{if(!m){m=new Map;let g=f;for(;g<a;)m.set(r[g],g++)}const w=m.get(e[c]);if(w!=null)if(f<w&&w<a){let g=c,E=1,_;for(;++g<o&&g<a&&!((_=m.get(e[g]))==null||_!==w+E);)E++;if(E>w-f){const S=e[c];for(;f<w;)t.insertBefore(r[f++],S)}else t.replaceChild(r[f++],e[c++])}else c++;else e[c++].remove()}}}const ro="_$DX_DELEGATE";function ol(t,e,r,n={}){let o;return Rr(a=>{o=a,e===document?t():ae(e,t(),e.firstChild?null:void 0,r)},n.owner),()=>{o(),e.textContent=""}}function De(t,e,r){let n;const o=()=>{const c=document.createElement("template");return c.innerHTML=t,c.content.firstChild},a=()=>(n||(n=o())).cloneNode(!0);return a.cloneNode=a,a}function sl(t,e=window.document){const r=e[ro]||(e[ro]=new Set);for(let n=0,o=t.length;n<o;n++){const a=t[n];r.has(a)||(r.add(a),e.addEventListener(a,ll))}}function no(t,e,r){ci(t)||(r==null?t.removeAttribute(e):t.setAttribute(e,r))}function li(t,e){ci(t)||(e==null?t.removeAttribute("class"):t.className=e)}function al(t,e,r,n){if(Array.isArray(r)){const o=r[0];t.addEventListener(e,r[0]=a=>o.call(t,r[1],a))}else t.addEventListener(e,r,typeof r!="function"&&r)}function Bo(t,e,r){return Ce(()=>t(e,r))}function ae(t,e,r,n){if(r!==void 0&&!n&&(n=[]),typeof e!="function")return Ir(t,e,n,r);Qe(o=>Ir(t,e(),o,r),n)}function ci(t){return!!te.context&&!te.done&&(!t||t.isConnected)}function ll(t){if(te.registry&&te.events&&te.events.find(([d,m])=>m===t))return;let e=t.target;const r=`$$${t.type}`,n=t.target,o=t.currentTarget,a=d=>Object.defineProperty(t,"target",{configurable:!0,value:d}),c=()=>{const d=e[r];if(d&&!e.disabled){const m=e[`${r}Data`];if(m!==void 0?d.call(e,m,t):d.call(e,t),t.cancelBubble)return}return e.host&&typeof e.host!="string"&&!e.host._$host&&e.contains(t.target)&&a(e.host),!0},f=()=>{for(;c()&&(e=e._$host||e.parentNode||e.host););};if(Object.defineProperty(t,"currentTarget",{configurable:!0,get(){return e||document}}),te.registry&&!te.done&&(te.done=_$HY.done=!0),t.composedPath){const d=t.composedPath();a(d[0]);for(let m=0;m<d.length-2&&(e=d[m],!!c());m++){if(e._$host){e=e._$host,f();break}if(e.parentNode===o)break}}else f();a(n)}function Ir(t,e,r,n,o){const a=ci(t);if(a){!r&&(r=[...t.childNodes]);let d=[];for(let m=0;m<r.length;m++){const w=r[m];w.nodeType===8&&w.data.slice(0,2)==="!$"?w.remove():d.push(w)}r=d}for(;typeof r=="function";)r=r();if(e===r)return r;const c=typeof e,f=n!==void 0;if(t=f&&r[0]&&r[0].parentNode||t,c==="string"||c==="number"){if(a||c==="number"&&(e=e.toString(),e===r))return r;if(f){let d=r[0];d&&d.nodeType===3?d.data!==e&&(d.data=e):d=document.createTextNode(e),r=Tt(t,r,n,d)}else r!==""&&typeof r=="string"?r=t.firstChild.data=e:r=t.textContent=e}else if(e==null||c==="boolean"){if(a)return r;r=Tt(t,r,n)}else{if(c==="function")return Qe(()=>{let d=e();for(;typeof d=="function";)d=d();r=Ir(t,d,r,n)}),()=>r;if(Array.isArray(e)){const d=[],m=r&&Array.isArray(r);if(Rn(d,e,r,o))return Qe(()=>r=Ir(t,d,r,n,!0)),()=>r;if(a){if(!d.length)return r;if(n===void 0)return r=[...t.childNodes];let w=d[0];if(w.parentNode!==t)return r;const g=[w];for(;(w=w.nextSibling)!==n;)g.push(w);return r=g}if(d.length===0){if(r=Tt(t,r,n),f)return r}else m?r.length===0?io(t,d,n):il(t,r,d):(r&&Tt(t),io(t,d));r=d}else if(e.nodeType){if(a&&e.parentNode)return r=f?[e]:e;if(Array.isArray(r)){if(f)return r=Tt(t,r,n,e);Tt(t,r,null,e)}else r==null||r===""||!t.firstChild?t.appendChild(e):t.replaceChild(e,t.firstChild);r=e}}return r}function Rn(t,e,r,n){let o=!1;for(let a=0,c=e.length;a<c;a++){let f=e[a],d=r&&r[t.length],m;if(!(f==null||f===!0||f===!1))if((m=typeof f)=="object"&&f.nodeType)t.push(f);else if(Array.isArray(f))o=Rn(t,f,d)||o;else if(m==="function")if(n){for(;typeof f=="function";)f=f();o=Rn(t,Array.isArray(f)?f:[f],Array.isArray(d)?d:[d])||o}else t.push(f),o=!0;else{const w=String(f);d&&d.nodeType===3&&d.data===w?t.push(d):t.push(document.createTextNode(w))}}return o}function io(t,e,r=null){for(let n=0,o=e.length;n<o;n++)t.insertBefore(e[n],r)}function Tt(t,e,r,n){if(r===void 0)return t.textContent="";const o=n||document.createTextNode("");if(e.length){let a=!1;for(let c=e.length-1;c>=0;c--){const f=e[c];if(o!==f){const d=f.parentNode===t;!a&&!c?d?t.replaceChild(o,f):t.insertBefore(o,r):d&&f.remove()}else a=!0}}else t.insertBefore(o,r);return[o]}const cl=""+new URL("hopefox-C_ibfsyU.wasm",import.meta.url).href,ul=["white","black"],Lr=["a","b","c","d","e","f","g","h"],Ur=["1","2","3","4","5","6","7","8"],fl=[...Ur].reverse(),ui=Array.prototype.concat(...Lr.map(t=>Ur.map(e=>t+e))),Fe=t=>ui[8*t[0]+t[1]],le=t=>[t.charCodeAt(0)-97,t.charCodeAt(1)-49],zo=ui.map(le);function hl(t){let e;const r=()=>(e===void 0&&(e=t()),e);return r.clear=()=>{e=void 0},r}const dl=()=>{let t;return{start(){t=performance.now()},cancel(){t=void 0},stop(){if(!t)return 0;const e=performance.now()-t;return t=void 0,e}}},fi=t=>t==="white"?"black":"white",pr=(t,e)=>{const r=t[0]-e[0],n=t[1]-e[1];return r*r+n*n},On=(t,e)=>t.role===e.role&&t.color===e.color,_r=t=>(e,r)=>[(r?e[0]:7-e[0])*t.width/8,(r?7-e[1]:e[1])*t.height/8],ze=(t,e)=>{t.style.transform=`translate(${e[0]}px,${e[1]}px)`},jo=(t,e,r=1)=>{t.style.transform=`translate(${e[0]}px,${e[1]}px) scale(${r})`},hi=(t,e)=>{t.style.visibility=e?"visible":"hidden"},kt=t=>{var e;if(t.clientX||t.clientX===0)return[t.clientX,t.clientY];if(!((e=t.targetTouches)===null||e===void 0)&&e[0])return[t.targetTouches[0].clientX,t.targetTouches[0].clientY]},Wo=t=>t.button===2,qe=(t,e)=>{const r=document.createElement(t);return e&&(r.className=e),r};function Ho(t,e,r){const n=le(t);return e||(n[0]=7-n[0],n[1]=7-n[1]),[r.left+r.width*n[0]/8+r.width/16,r.top+r.height*(7-n[1])/8+r.height/16]}const gt=(t,e)=>Math.abs(t-e),pl=t=>(e,r,n,o)=>gt(e,n)<2&&(t==="white"?o===r+1||r<=1&&o===r+2&&e===n:o===r-1||r>=6&&o===r-2&&e===n),Ko=(t,e,r,n)=>{const o=gt(t,r),a=gt(e,n);return o===1&&a===2||o===2&&a===1},Go=(t,e,r,n)=>gt(t,r)===gt(e,n),Vo=(t,e,r,n)=>t===r||e===n,qo=(t,e,r,n)=>Go(t,e,r,n)||Vo(t,e,r,n),ml=(t,e,r)=>(n,o,a,c)=>gt(n,a)<2&&gt(o,c)<2||r&&o===c&&o===(t==="white"?0:7)&&(n===4&&(a===2&&e.includes(0)||a===6&&e.includes(7))||e.includes(a));function gl(t,e){const r=e==="white"?"1":"8",n=[];for(const[o,a]of t)o[1]===r&&a.color===e&&a.role==="rook"&&n.push(le(o)[0]);return n}function Yo(t,e,r){const n=t.get(e);if(!n)return[];const o=le(e),a=n.role,c=a==="pawn"?pl(n.color):a==="knight"?Ko:a==="bishop"?Go:a==="rook"?Vo:a==="queen"?qo:ml(n.color,gl(t,n.color),r);return zo.filter(f=>(o[0]!==f[0]||o[1]!==f[1])&&c(o[0],o[1],f[0],f[1])).map(Fe)}function Pe(t,...e){t&&setTimeout(()=>t(...e),1)}function wl(t){t.orientation=fi(t.orientation),t.animation.current=t.draggable.current=t.selected=void 0}function bl(t,e){for(const[r,n]of e)n?t.pieces.set(r,n):t.pieces.delete(r)}function vl(t,e){if(t.check=void 0,e===!0&&(e=t.turnColor),e)for(const[r,n]of t.pieces)n.role==="king"&&n.color===e&&(t.check=r)}function kl(t,e,r,n){at(t),t.premovable.current=[e,r],Pe(t.premovable.events.set,e,r,n)}function st(t){t.premovable.current&&(t.premovable.current=void 0,Pe(t.premovable.events.unset))}function yl(t,e,r){st(t),t.predroppable.current={role:e,key:r},Pe(t.predroppable.events.set,e,r)}function at(t){const e=t.predroppable;e.current&&(e.current=void 0,Pe(e.events.unset))}function _l(t,e,r){if(!t.autoCastle)return!1;const n=t.pieces.get(e);if(!n||n.role!=="king")return!1;const o=le(e),a=le(r);if(o[1]!==0&&o[1]!==7||o[1]!==a[1])return!1;o[0]===4&&!t.pieces.has(r)&&(a[0]===6?r=Fe([7,a[1]]):a[0]===2&&(r=Fe([0,a[1]])));const c=t.pieces.get(r);return!c||c.color!==n.color||c.role!=="rook"?!1:(t.pieces.delete(e),t.pieces.delete(r),o[0]<a[0]?(t.pieces.set(Fe([6,a[1]]),n),t.pieces.set(Fe([5,a[1]]),c)):(t.pieces.set(Fe([2,a[1]]),n),t.pieces.set(Fe([3,a[1]]),c)),!0)}function Qo(t,e,r){const n=t.pieces.get(e),o=t.pieces.get(r);if(e===r||!n)return!1;const a=o&&o.color!==n.color?o:void 0;return r===t.selected&&$e(t),Pe(t.events.move,e,r,a),_l(t,e,r)||(t.pieces.set(r,n),t.pieces.delete(e)),t.lastMove=[e,r],t.check=void 0,Pe(t.events.change),a||!0}function di(t,e,r,n){if(t.pieces.has(r))if(n)t.pieces.delete(r);else return!1;return Pe(t.events.dropNewPiece,e,r),t.pieces.set(r,e),t.lastMove=[r],t.check=void 0,Pe(t.events.change),t.movable.dests=void 0,t.turnColor=fi(t.turnColor),!0}function Xo(t,e,r){const n=Qo(t,e,r);return n&&(t.movable.dests=void 0,t.turnColor=fi(t.turnColor),t.animation.current=void 0),n}function Jo(t,e,r){if(pi(t,e,r)){const n=Xo(t,e,r);if(n){const o=t.hold.stop();$e(t);const a={premove:!1,ctrlKey:t.stats.ctrlKey,holdTime:o};return n!==!0&&(a.captured=n),Pe(t.movable.events.after,e,r,a),!0}}else if(Sl(t,e,r))return kl(t,e,r,{ctrlKey:t.stats.ctrlKey}),$e(t),!0;return $e(t),!1}function Zo(t,e,r,n){const o=t.pieces.get(e);o&&(El(t,e,r)||n)?(t.pieces.delete(e),di(t,o,r,n),Pe(t.movable.events.afterNewPiece,o.role,r,{premove:!1,predrop:!1})):o&&Al(t,e,r)?yl(t,o.role,r):(st(t),at(t)),t.pieces.delete(e),$e(t)}function Mn(t,e,r){if(Pe(t.events.select,e),t.selected){if(t.selected===e&&!t.draggable.enabled){$e(t),t.hold.cancel();return}else if((t.selectable.enabled||r)&&t.selected!==e&&Jo(t,t.selected,e)){t.stats.dragged=!1;return}}(t.selectable.enabled||t.draggable.enabled)&&(ts(t,e)||mi(t,e))&&(es(t,e),t.hold.start())}function es(t,e){t.selected=e,mi(t,e)?t.premovable.customDests||(t.premovable.dests=Yo(t.pieces,e,t.premovable.castle)):t.premovable.dests=void 0}function $e(t){t.selected=void 0,t.premovable.dests=void 0,t.hold.cancel()}function ts(t,e){const r=t.pieces.get(e);return!!r&&(t.movable.color==="both"||t.movable.color===r.color&&t.turnColor===r.color)}const pi=(t,e,r)=>{var n,o;return e!==r&&ts(t,e)&&(t.movable.free||!!(!((o=(n=t.movable.dests)===null||n===void 0?void 0:n.get(e))===null||o===void 0)&&o.includes(r)))};function El(t,e,r){const n=t.pieces.get(e);return!!n&&(e===r||!t.pieces.has(r))&&(t.movable.color==="both"||t.movable.color===n.color&&t.turnColor===n.color)}function mi(t,e){const r=t.pieces.get(e);return!!r&&t.premovable.enabled&&t.movable.color===r.color&&t.turnColor!==r.color}function Sl(t,e,r){var n,o;const a=(o=(n=t.premovable.customDests)===null||n===void 0?void 0:n.get(e))!==null&&o!==void 0?o:Yo(t.pieces,e,t.premovable.castle);return e!==r&&mi(t,e)&&a.includes(r)}function Al(t,e,r){const n=t.pieces.get(e),o=t.pieces.get(r);return!!n&&(!o||o.color!==t.movable.color)&&t.predroppable.enabled&&(n.role!=="pawn"||r[1]!=="1"&&r[1]!=="8")&&t.movable.color===n.color&&t.turnColor!==n.color}function Cl(t,e){const r=t.pieces.get(e);return!!r&&t.draggable.enabled&&(t.movable.color==="both"||t.movable.color===r.color&&(t.turnColor===r.color||t.premovable.enabled))}function Pl(t){const e=t.premovable.current;if(!e)return!1;const r=e[0],n=e[1];let o=!1;if(pi(t,r,n)){const a=Xo(t,r,n);if(a){const c={premove:!0};a!==!0&&(c.captured=a),Pe(t.movable.events.after,r,n,c),o=!0}}return st(t),o}function Tl(t,e){const r=t.predroppable.current;let n=!1;if(!r)return!1;if(e(r)){const o={role:r.role,color:t.movable.color};di(t,o,r.key)&&(Pe(t.movable.events.afterNewPiece,r.role,r.key,{premove:!1,predrop:!0}),n=!0)}return at(t),n}function gi(t){st(t),at(t),$e(t)}function oo(t){t.movable.color=t.movable.dests=t.animation.current=void 0,gi(t)}function yt(t,e,r){let n=Math.floor(8*(t[0]-r.left)/r.width);e||(n=7-n);let o=7-Math.floor(8*(t[1]-r.top)/r.height);return e||(o=7-o),n>=0&&n<8&&o>=0&&o<8?Fe([n,o]):void 0}function Rl(t,e,r,n){const o=le(t),a=zo.filter(m=>qo(o[0],o[1],m[0],m[1])||Ko(o[0],o[1],m[0],m[1])),f=a.map(m=>Ho(Fe(m),r,n)).map(m=>pr(e,m)),[,d]=f.reduce((m,w,g)=>m[0]<w?m:[w,g],[f[0],0]);return Fe(a[d])}const Te=t=>t.orientation==="white",rs="rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR",Ol={p:"pawn",r:"rook",n:"knight",b:"bishop",q:"queen",k:"king"},Ml={pawn:"p",rook:"r",knight:"n",bishop:"b",queen:"q",king:"k"};function ns(t){t==="start"&&(t=rs);const e=new Map;let r=7,n=0;for(const o of t)switch(o){case" ":case"[":return e;case"/":if(--r,r<0)return e;n=0;break;case"~":{const a=e.get(Fe([n-1,r]));a&&(a.promoted=!0);break}default:{const a=o.charCodeAt(0);if(a<57)n+=a-48;else{const c=o.toLowerCase();e.set(Fe([n,r]),{role:Ol[c],color:o===c?"black":"white"}),++n}}}return e}function Nl(t){return fl.map(e=>Lr.map(r=>{const n=t.get(r+e);if(n){let o=Ml[n.role];return n.color==="white"&&(o=o.toUpperCase()),n.promoted&&(o+="~"),o}else return"1"}).join("")).join("/").replace(/1{2,}/g,e=>e.length.toString())}function is(t,e){e.animation&&(wi(t.animation,e.animation),(t.animation.duration||0)<70&&(t.animation.enabled=!1))}function os(t,e){var r,n,o;if(!((r=e.movable)===null||r===void 0)&&r.dests&&(t.movable.dests=void 0),!((n=e.drawable)===null||n===void 0)&&n.autoShapes&&(t.drawable.autoShapes=[]),wi(t,e),e.fen&&(t.pieces=ns(e.fen),t.drawable.shapes=((o=e.drawable)===null||o===void 0?void 0:o.shapes)||[]),"check"in e&&vl(t,e.check||!1),"lastMove"in e&&!e.lastMove?t.lastMove=void 0:e.lastMove&&(t.lastMove=e.lastMove),t.selected&&es(t,t.selected),is(t,e),!t.movable.rookCastle&&t.movable.dests){const a=t.movable.color==="white"?"1":"8",c="e"+a,f=t.movable.dests.get(c),d=t.pieces.get(c);if(!f||!d||d.role!=="king")return;t.movable.dests.set(c,f.filter(m=>!(m==="a"+a&&f.includes("c"+a))&&!(m==="h"+a&&f.includes("g"+a))))}}function wi(t,e){for(const r in e)Object.prototype.hasOwnProperty.call(e,r)&&(Object.prototype.hasOwnProperty.call(t,r)&&so(t[r])&&so(e[r])?wi(t[r],e[r]):t[r]=e[r])}function so(t){if(typeof t!="object"||t===null)return!1;const e=Object.getPrototypeOf(t);return e===Object.prototype||e===null}const dt=(t,e)=>e.animation.enabled?$l(t,e):et(t,e);function et(t,e){const r=t(e);return e.dom.redraw(),r}const gn=(t,e)=>({key:t,pos:le(t),piece:e}),xl=(t,e)=>e.sort((r,n)=>pr(t.pos,r.pos)-pr(t.pos,n.pos))[0];function Fl(t,e){const r=new Map,n=[],o=new Map,a=[],c=[],f=new Map;let d,m,w;for(const[g,E]of t)f.set(g,gn(g,E));for(const g of ui)d=e.pieces.get(g),m=f.get(g),d?m?On(d,m.piece)||(a.push(m),c.push(gn(g,d))):c.push(gn(g,d)):m&&a.push(m);for(const g of c)m=xl(g,a.filter(E=>On(g.piece,E.piece))),m&&(w=[m.pos[0]-g.pos[0],m.pos[1]-g.pos[1]],r.set(g.key,w.concat(w)),n.push(m.key));for(const g of a)n.includes(g.key)||o.set(g.key,g.piece);return{anims:r,fadings:o}}function ss(t,e){const r=t.animation.current;if(r===void 0){t.dom.destroyed||t.dom.redrawNow();return}const n=1-(e-r.start)*r.frequency;if(n<=0)t.animation.current=void 0,t.dom.redrawNow();else{const o=Dl(n);for(const a of r.plan.anims.values())a[2]=a[0]*o,a[3]=a[1]*o;t.dom.redrawNow(!0),requestAnimationFrame((a=performance.now())=>ss(t,a))}}function $l(t,e){const r=new Map(e.pieces),n=t(e),o=Fl(r,e);if(o.anims.size||o.fadings.size){const a=e.animation.current&&e.animation.current.start;e.animation.current={start:performance.now(),frequency:1/e.animation.duration,plan:o},a||ss(e,performance.now())}else e.dom.redraw();return n}const Dl=t=>t<.5?4*t*t*t:(t-1)*(2*t-2)*(2*t-2)+1,Il=["green","red","blue","yellow"];function Ll(t,e){if(e.touches&&e.touches.length>1)return;e.stopPropagation(),e.preventDefault(),e.ctrlKey?$e(t):gi(t);const r=kt(e),n=yt(r,Te(t),t.dom.bounds());n&&(t.drawable.current={orig:n,pos:r,brush:jl(e),snapToValidMove:t.drawable.defaultSnapToValidMove},as(t))}function as(t){requestAnimationFrame(()=>{const e=t.drawable.current;if(e){const r=yt(e.pos,Te(t),t.dom.bounds());r||(e.snapToValidMove=!1);const n=e.snapToValidMove?Rl(e.orig,e.pos,Te(t),t.dom.bounds()):r;n!==e.mouseSq&&(e.mouseSq=n,e.dest=n!==e.orig?n:void 0,t.dom.redrawNow()),as(t)}})}function Ul(t,e){t.drawable.current&&(t.drawable.current.pos=kt(e))}function Bl(t){const e=t.drawable.current;e&&(e.mouseSq&&Wl(t.drawable,e),ls(t))}function ls(t){t.drawable.current&&(t.drawable.current=void 0,t.dom.redraw())}function zl(t){t.drawable.shapes.length&&(t.drawable.shapes=[],t.dom.redraw(),cs(t.drawable))}function jl(t){var e;const r=(t.shiftKey||t.ctrlKey)&&Wo(t),n=t.altKey||t.metaKey||((e=t.getModifierState)===null||e===void 0?void 0:e.call(t,"AltGraph"));return Il[(r?1:0)+(n?2:0)]}function Wl(t,e){const r=o=>o.orig===e.orig&&o.dest===e.dest,n=t.shapes.find(r);n&&(t.shapes=t.shapes.filter(o=>!r(o))),(!n||n.brush!==e.brush)&&t.shapes.push({orig:e.orig,dest:e.dest,brush:e.brush}),cs(t)}function cs(t){t.onChange&&t.onChange(t.shapes)}function Hl(t,e){if(!(t.trustAllEvents||e.isTrusted)||e.buttons!==void 0&&e.buttons>1||e.touches&&e.touches.length>1)return;const r=t.dom.bounds(),n=kt(e),o=yt(n,Te(t),r);if(!o)return;const a=t.pieces.get(o),c=t.selected;if(!c&&t.drawable.enabled&&(t.drawable.eraseOnClick||!a||a.color!==t.turnColor)&&zl(t),e.cancelable!==!1&&(!e.touches||t.blockTouchScroll||a||c||Kl(t,n)))e.preventDefault();else if(e.touches)return;const f=!!t.premovable.current,d=!!t.predroppable.current;t.stats.ctrlKey=e.ctrlKey,t.selected&&pi(t,t.selected,o)?dt(g=>Mn(g,o),t):Mn(t,o);const m=t.selected===o,w=fs(t,o);if(a&&w&&m&&Cl(t,o)){t.draggable.current={orig:o,piece:a,origPos:n,pos:n,started:t.draggable.autoDistance&&t.stats.dragged,element:w,previouslySelected:c,originTarget:e.target,keyHasChanged:!1},w.cgDragging=!0,w.classList.add("dragging");const g=t.dom.elements.ghost;g&&(g.className=`ghost ${a.color} ${a.role}`,ze(g,_r(r)(le(o),Te(t))),hi(g,!0)),bi(t)}else f&&st(t),d&&at(t);t.dom.redraw()}function Kl(t,e){const r=Te(t),n=t.dom.bounds(),o=Math.pow(n.width/8,2);for(const a of t.pieces.keys()){const c=Ho(a,r,n);if(pr(c,e)<=o)return!0}return!1}function Gl(t,e,r,n){const o="a0";t.pieces.set(o,e),t.dom.redraw();const a=kt(r);t.draggable.current={orig:o,piece:e,origPos:a,pos:a,started:!0,element:()=>fs(t,o),originTarget:r.target,newPiece:!0,force:!!n,keyHasChanged:!1},bi(t)}function bi(t){requestAnimationFrame(()=>{var e;const r=t.draggable.current;if(!r)return;!((e=t.animation.current)===null||e===void 0)&&e.plan.anims.has(r.orig)&&(t.animation.current=void 0);const n=t.pieces.get(r.orig);if(!n||!On(n,r.piece))Br(t);else if(!r.started&&pr(r.pos,r.origPos)>=Math.pow(t.draggable.distance,2)&&(r.started=!0),r.started){if(typeof r.element=="function"){const a=r.element();if(!a)return;a.cgDragging=!0,a.classList.add("dragging"),r.element=a}const o=t.dom.bounds();ze(r.element,[r.pos[0]-o.left-o.width/16,r.pos[1]-o.top-o.height/16]),r.keyHasChanged||(r.keyHasChanged=r.orig!==yt(r.pos,Te(t),o))}bi(t)})}function Vl(t,e){t.draggable.current&&(!e.touches||e.touches.length<2)&&(t.draggable.current.pos=kt(e))}function ql(t,e){const r=t.draggable.current;if(!r)return;if(e.type==="touchend"&&e.cancelable!==!1&&e.preventDefault(),e.type==="touchend"&&r.originTarget!==e.target&&!r.newPiece){t.draggable.current=void 0;return}st(t),at(t);const n=kt(e)||r.pos,o=yt(n,Te(t),t.dom.bounds());o&&r.started&&r.orig!==o?r.newPiece?Zo(t,r.orig,o,r.force):(t.stats.ctrlKey=e.ctrlKey,Jo(t,r.orig,o)&&(t.stats.dragged=!0)):r.newPiece?t.pieces.delete(r.orig):t.draggable.deleteOnDropOff&&!o&&(t.pieces.delete(r.orig),Pe(t.events.change)),(r.orig===r.previouslySelected||r.keyHasChanged)&&(r.orig===o||!o)?$e(t):t.selectable.enabled||$e(t),us(t),t.draggable.current=void 0,t.dom.redraw()}function Br(t){const e=t.draggable.current;e&&(e.newPiece&&t.pieces.delete(e.orig),t.draggable.current=void 0,$e(t),us(t),t.dom.redraw())}function us(t){const e=t.dom.elements;e.ghost&&hi(e.ghost,!1)}function fs(t,e){let r=t.dom.elements.board.firstChild;for(;r;){if(r.cgKey===e&&r.tagName==="PIECE")return r;r=r.nextSibling}}function Yl(t,e){t.exploding={stage:1,keys:e},t.dom.redraw(),setTimeout(()=>{ao(t,2),setTimeout(()=>ao(t,void 0),120)},120)}function ao(t,e){t.exploding&&(e?t.exploding.stage=e:t.exploding=void 0,t.dom.redraw())}function Ql(t,e){function r(){wl(t),e()}return{set(n){n.orientation&&n.orientation!==t.orientation&&r(),is(t,n),(n.fen?dt:et)(o=>os(o,n),t)},state:t,getFen:()=>Nl(t.pieces),toggleOrientation:r,setPieces(n){dt(o=>bl(o,n),t)},selectSquare(n,o){n?dt(a=>Mn(a,n,o),t):t.selected&&($e(t),t.dom.redraw())},move(n,o){dt(a=>Qo(a,n,o),t)},newPiece(n,o){dt(a=>di(a,n,o),t)},playPremove(){if(t.premovable.current){if(dt(Pl,t))return!0;t.dom.redraw()}return!1},playPredrop(n){if(t.predroppable.current){const o=Tl(t,n);return t.dom.redraw(),o}return!1},cancelPremove(){et(st,t)},cancelPredrop(){et(at,t)},cancelMove(){et(n=>{gi(n),Br(n)},t)},stop(){et(n=>{oo(n),Br(n)},t)},explode(n){Yl(t,n)},setAutoShapes(n){et(o=>o.drawable.autoShapes=n,t)},setShapes(n){et(o=>o.drawable.shapes=n,t)},getKeyAtDomPos(n){return yt(n,Te(t),t.dom.bounds())},redrawAll:e,dragNewPiece(n,o,a){Gl(t,n,o,a)},destroy(){oo(t),t.dom.unbind&&t.dom.unbind(),t.dom.destroyed=!0}}}function Xl(){return{pieces:ns(rs),orientation:"white",turnColor:"white",coordinates:!0,coordinatesOnSquares:!1,ranksPosition:"right",autoCastle:!0,viewOnly:!1,disableContextMenu:!1,addPieceZIndex:!1,blockTouchScroll:!1,pieceKey:!1,trustAllEvents:!1,highlight:{lastMove:!0,check:!0},animation:{enabled:!0,duration:200},movable:{free:!0,color:"both",showDests:!0,events:{},rookCastle:!0},premovable:{enabled:!0,showDests:!0,castle:!0,events:{}},predroppable:{enabled:!1,events:{}},draggable:{enabled:!0,distance:3,autoDistance:!0,showGhost:!0,deleteOnDropOff:!1},dropmode:{active:!1},selectable:{enabled:!0},stats:{dragged:!("ontouchstart"in window)},events:{},drawable:{enabled:!0,visible:!0,defaultSnapToValidMove:!0,eraseOnClick:!0,shapes:[],autoShapes:[],brushes:{green:{key:"g",color:"#15781B",opacity:1,lineWidth:10},red:{key:"r",color:"#882020",opacity:1,lineWidth:10},blue:{key:"b",color:"#003088",opacity:1,lineWidth:10},yellow:{key:"y",color:"#e68f00",opacity:1,lineWidth:10},paleBlue:{key:"pb",color:"#003088",opacity:.4,lineWidth:15},paleGreen:{key:"pg",color:"#15781B",opacity:.4,lineWidth:15},paleRed:{key:"pr",color:"#882020",opacity:.4,lineWidth:15},paleGrey:{key:"pgr",color:"#4a4a4a",opacity:.35,lineWidth:15},purple:{key:"purple",color:"#68217a",opacity:.65,lineWidth:10},pink:{key:"pink",color:"#ee2080",opacity:.5,lineWidth:10},white:{key:"white",color:"white",opacity:1,lineWidth:10}},prevSvgHash:""},hold:dl()}}const lo={hilitePrimary:{key:"hilitePrimary",color:"#3291ff",opacity:1,lineWidth:1},hiliteWhite:{key:"hiliteWhite",color:"#ffffff",opacity:1,lineWidth:1}};function Jl(){const t=pe("defs"),e=Ae(pe("filter"),{id:"cg-filter-blur"});return e.appendChild(Ae(pe("feGaussianBlur"),{stdDeviation:"0.019"})),t.appendChild(e),t}function Zl(t,e,r){var n;const o=t.drawable,a=o.current,c=a&&a.mouseSq?a:void 0,f=new Map,d=t.dom.bounds(),m=o.autoShapes.filter(_=>!_.piece);for(const _ of o.shapes.concat(m).concat(c?[c]:[])){if(!_.dest)continue;const S=(n=f.get(_.dest))!==null&&n!==void 0?n:new Set,k=Wr(jr(le(_.orig),t.orientation),d),x=Wr(jr(le(_.dest),t.orientation),d);S.add(xn(k,x)),f.set(_.dest,S)}const w=o.shapes.concat(m).map(_=>({shape:_,current:!1,hash:co(_,Nn(_.dest,f),!1,d)}));c&&w.push({shape:c,current:!0,hash:co(c,Nn(c.dest,f),!0,d)});const g=w.map(_=>_.hash).join(";");if(g===t.drawable.prevSvgHash)return;t.drawable.prevSvgHash=g;const E=e.querySelector("defs");ec(o,w,E),tc(w,e.querySelector("g"),r.querySelector("g"),_=>ic(t,_,o.brushes,f,d))}function ec(t,e,r){var n;const o=new Map;let a;for(const d of e.filter(m=>m.shape.dest&&m.shape.brush))a=hs(t.brushes[d.shape.brush],d.shape.modifiers),!((n=d.shape.modifiers)===null||n===void 0)&&n.hilite&&o.set(zr(a).key,zr(a)),o.set(a.key,a);const c=new Set;let f=r.firstElementChild;for(;f;)c.add(f.getAttribute("cgKey")),f=f.nextElementSibling;for(const[d,m]of o.entries())c.has(d)||r.appendChild(ac(m))}function tc(t,e,r,n){const o=new Map;for(const a of t)o.set(a.hash,!1);for(const a of[e,r]){const c=[];let f=a.firstElementChild,d;for(;f;)d=f.getAttribute("cgHash"),o.has(d)?o.set(d,!0):c.push(f),f=f.nextElementSibling;for(const m of c)a.removeChild(m)}for(const a of t.filter(c=>!o.get(c.hash)))for(const c of n(a))c.isCustom?r.appendChild(c.el):e.appendChild(c.el)}function co({orig:t,dest:e,brush:r,piece:n,modifiers:o,customSvg:a,label:c},f,d,m){var w,g;return[m.width,m.height,d,t,e,r,f&&"-",n&&rc(n),o&&nc(o),a&&`custom-${uo(a.html)},${(g=(w=a.center)===null||w===void 0?void 0:w[0])!==null&&g!==void 0?g:"o"}`,c&&`label-${uo(c.text)}`].filter(E=>E).join(",")}function rc(t){return[t.color,t.role,t.scale].filter(e=>e).join(",")}function nc(t){return[t.lineWidth,t.hilite&&"*"].filter(e=>e).join(",")}function uo(t){let e=0;for(let r=0;r<t.length;r++)e=(e<<5)-e+t.charCodeAt(r)>>>0;return e.toString()}function ic(t,{shape:e,current:r,hash:n},o,a,c){var f,d;const m=Wr(jr(le(e.orig),t.orientation),c),w=e.dest?Wr(jr(le(e.dest),t.orientation),c):m,g=e.brush&&hs(o[e.brush],e.modifiers),E=a.get(e.dest),_=[];if(g){const S=Ae(pe("g"),{cgHash:n});_.push({el:S}),m[0]!==w[0]||m[1]!==w[1]?S.appendChild(sc(e,g,m,w,r,Nn(e.dest,a))):S.appendChild(oc(o[e.brush],m,r,c))}if(e.label){const S=e.label;(f=S.fill)!==null&&f!==void 0||(S.fill=e.brush&&o[e.brush].color);const k=e.brush?void 0:"tr";_.push({el:lc(S,n,m,w,E,k),isCustom:!0})}if(e.customSvg){const S=(d=e.customSvg.center)!==null&&d!==void 0?d:"orig",[k,x]=S==="label"?ps(m,w,E).map(A=>A-.5):S==="dest"?w:m,R=Ae(pe("g"),{transform:`translate(${k},${x})`,cgHash:n});R.innerHTML=`<svg width="1" height="1" viewBox="0 0 100 100">${e.customSvg.html}</svg>`,_.push({el:R,isCustom:!0})}return _}function oc(t,e,r,n){const o=cc(),a=(n.width+n.height)/(4*Math.max(n.width,n.height));return Ae(pe("circle"),{stroke:t.color,"stroke-width":o[r?0:1],fill:"none",opacity:ds(t,r),cx:e[0],cy:e[1],r:a-o[1]/2})}function zr(t){return["#ffffff","#fff","white"].includes(t.color)?lo.hilitePrimary:lo.hiliteWhite}function sc(t,e,r,n,o,a){var c;function f(w){var g;const E=fc(a&&!o),_=n[0]-r[0],S=n[1]-r[1],k=Math.atan2(S,_),x=Math.cos(k)*E,R=Math.sin(k)*E;return Ae(pe("line"),{stroke:w?zr(e).color:e.color,"stroke-width":uc(e,o)+(w?.04:0),"stroke-linecap":"round","marker-end":`url(#arrowhead-${w?zr(e).key:e.key})`,opacity:!((g=t.modifiers)===null||g===void 0)&&g.hilite?1:ds(e,o),x1:r[0],y1:r[1],x2:n[0]-x,y2:n[1]-R})}if(!(!((c=t.modifiers)===null||c===void 0)&&c.hilite))return f(!1);const d=pe("g"),m=Ae(pe("g"),{filter:"url(#cg-filter-blur)"});return m.appendChild(hc(r,n)),m.appendChild(f(!0)),d.appendChild(m),d.appendChild(f(!1)),d}function ac(t){const e=Ae(pe("marker"),{id:"arrowhead-"+t.key,orient:"auto",overflow:"visible",markerWidth:4,markerHeight:4,refX:t.key.startsWith("hilite")?1.86:2.05,refY:2});return e.appendChild(Ae(pe("path"),{d:"M0,0 V4 L3,2 Z",fill:t.color})),e.setAttribute("cgKey",t.key),e}function lc(t,e,r,n,o,a){var c;const d=.4*.75**t.text.length,m=ps(r,n,o),w=a==="tr"?.4:0,g=Ae(pe("g"),{transform:`translate(${m[0]+w},${m[1]-w})`,cgHash:e});g.appendChild(Ae(pe("circle"),{r:.4/2,"fill-opacity":a?1:.8,"stroke-opacity":a?1:.7,"stroke-width":.03,fill:(c=t.fill)!==null&&c!==void 0?c:"#666",stroke:"white"}));const E=Ae(pe("text"),{"font-size":d,"font-family":"Noto Sans","text-anchor":"middle",fill:"white",y:.13*.75**t.text.length});return E.innerHTML=t.text,g.appendChild(E),g}function jr(t,e){return e==="white"?t:[7-t[0],7-t[1]]}function Nn(t,e){return(t&&e.has(t)&&e.get(t).size>1)===!0}function pe(t){return document.createElementNS("http://www.w3.org/2000/svg",t)}function Ae(t,e){for(const r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.setAttribute(r,e[r]);return t}function hs(t,e){return e?{color:t.color,opacity:Math.round(t.opacity*10)/10,lineWidth:Math.round(e.lineWidth||t.lineWidth),key:[t.key,e.lineWidth].filter(r=>r).join("")}:t}function cc(){return[3/64,4/64]}function uc(t,e){return(t.lineWidth||10)*(e?.85:1)/64}function ds(t,e){return(t.opacity||1)*(e?.9:1)}function fc(t){return(t?20:10)/64}function Wr(t,e){const r=Math.min(1,e.width/e.height),n=Math.min(1,e.height/e.width);return[(t[0]-3.5)*r,(3.5-t[1])*n]}function hc(t,e){const r={from:[Math.floor(Math.min(t[0],e[0])),Math.floor(Math.min(t[1],e[1]))],to:[Math.ceil(Math.max(t[0],e[0])),Math.ceil(Math.max(t[1],e[1]))]};return Ae(pe("rect"),{x:r.from[0],y:r.from[1],width:r.to[0]-r.from[0],height:r.to[1]-r.from[1],fill:"none",stroke:"none"})}function xn(t,e,r=!0){const n=Math.atan2(e[1]-t[1],e[0]-t[0])+Math.PI;return r?(Math.round(n*8/Math.PI)+16)%16:n}function dc(t,e){return Math.sqrt([t[0]-e[0],t[1]-e[1]].reduce((r,n)=>r+n*n,0))}function ps(t,e,r){let n=dc(t,e);const o=xn(t,e,!1);if(r&&(n-=33/64,r.size>1)){n-=10/64;const a=xn(t,e);(r.has((a+1)%16)||r.has((a+15)%16))&&a&1&&(n-=.4)}return[t[0]-Math.cos(o)*n,t[1]-Math.sin(o)*n].map(a=>a+.5)}function pc(t,e){t.innerHTML="",t.classList.add("cg-wrap");for(const d of ul)t.classList.toggle("orientation-"+d,e.orientation===d);t.classList.toggle("manipulable",!e.viewOnly);const r=qe("cg-container");t.appendChild(r);const n=qe("cg-board");r.appendChild(n);let o,a,c;if(e.drawable.visible&&(o=Ae(pe("svg"),{class:"cg-shapes",viewBox:"-4 -4 8 8",preserveAspectRatio:"xMidYMid slice"}),o.appendChild(Jl()),o.appendChild(pe("g")),a=Ae(pe("svg"),{class:"cg-custom-svgs",viewBox:"-3.5 -3.5 8 8",preserveAspectRatio:"xMidYMid slice"}),a.appendChild(pe("g")),c=qe("cg-auto-pieces"),r.appendChild(o),r.appendChild(a),r.appendChild(c)),e.coordinates){const d=e.orientation==="black"?" black":"",m=e.ranksPosition==="left"?" left":"";if(e.coordinatesOnSquares){const w=e.orientation==="white"?g=>g+1:g=>8-g;Lr.forEach((g,E)=>r.appendChild(wn(Ur.map(_=>g+_),"squares rank"+w(E)+d+m)))}else r.appendChild(wn(Ur,"ranks"+d+m)),r.appendChild(wn(Lr,"files"+d))}let f;return e.draggable.enabled&&e.draggable.showGhost&&(f=qe("piece","ghost"),hi(f,!1),r.appendChild(f)),{board:n,container:r,wrap:t,ghost:f,svg:o,customSvg:a,autoPieces:c}}function wn(t,e){const r=qe("coords",e);let n;for(const o of t)n=qe("coord"),n.textContent=o,r.appendChild(n);return r}function mc(t,e){if(!t.dropmode.active)return;st(t),at(t);const r=t.dropmode.piece;if(r){t.pieces.set("a0",r);const n=kt(e),o=n&&yt(n,Te(t),t.dom.bounds());o&&Zo(t,"a0",o)}t.dom.redraw()}function gc(t,e){const r=t.dom.elements.board;if("ResizeObserver"in window&&new ResizeObserver(e).observe(t.dom.elements.wrap),(t.disableContextMenu||t.drawable.enabled)&&r.addEventListener("contextmenu",o=>o.preventDefault()),t.viewOnly)return;const n=bc(t);r.addEventListener("touchstart",n,{passive:!1}),r.addEventListener("mousedown",n,{passive:!1})}function wc(t,e){const r=[];if("ResizeObserver"in window||r.push(or(document.body,"chessground.resize",e)),!t.viewOnly){const n=fo(t,Vl,Ul),o=fo(t,ql,Bl);for(const c of["touchmove","mousemove"])r.push(or(document,c,n));for(const c of["touchend","mouseup"])r.push(or(document,c,o));const a=()=>t.dom.bounds.clear();r.push(or(document,"scroll",a,{capture:!0,passive:!0})),r.push(or(window,"resize",a,{passive:!0}))}return()=>r.forEach(n=>n())}function or(t,e,r,n){return t.addEventListener(e,r,n),()=>t.removeEventListener(e,r,n)}const bc=t=>e=>{t.draggable.current?Br(t):t.drawable.current?ls(t):e.shiftKey||Wo(e)?t.drawable.enabled&&Ll(t,e):t.viewOnly||(t.dropmode.active?mc(t,e):Hl(t,e))},fo=(t,e,r)=>n=>{t.drawable.current?t.drawable.enabled&&r(t,n):t.viewOnly||e(t,n)};function vc(t){const e=Te(t),r=_r(t.dom.bounds()),n=t.dom.elements.board,o=t.pieces,a=t.animation.current,c=a?a.plan.anims:new Map,f=a?a.plan.fadings:new Map,d=t.draggable.current,m=yc(t),w=new Set,g=new Set,E=new Map,_=new Map;let S,k,x,R,A,P,$,M,q,H;for(k=n.firstChild;k;){if(S=k.cgKey,ms(k))if(x=o.get(S),A=c.get(S),P=f.get(S),R=k.cgPiece,k.cgDragging&&(!d||d.orig!==S)&&(k.classList.remove("dragging"),ze(k,r(le(S),e)),k.cgDragging=!1),!P&&k.cgFading&&(k.cgFading=!1,k.classList.remove("fading")),x){if(A&&k.cgAnimating&&R===sr(x)){const K=le(S);K[0]+=A[2],K[1]+=A[3],k.classList.add("anim"),ze(k,r(K,e))}else k.cgAnimating&&(k.cgAnimating=!1,k.classList.remove("anim"),ze(k,r(le(S),e)),t.addPieceZIndex&&(k.style.zIndex=bn(le(S),e)));R===sr(x)&&(!P||!k.cgFading)?w.add(S):P&&R===sr(P)?(k.classList.add("fading"),k.cgFading=!0):vn(E,R,k)}else vn(E,R,k);else if(gs(k)){const K=k.className;m.get(S)===K?g.add(S):vn(_,K,k)}k=k.nextSibling}for(const[K,G]of m)if(!g.has(K)){q=_.get(G),H=q&&q.pop();const I=r(le(K),e);if(H)H.cgKey=K,ze(H,I);else{const T=qe("square",G);T.cgKey=K,ze(T,I),n.insertBefore(T,n.firstChild)}}for(const[K,G]of o)if(A=c.get(K),!w.has(K))if($=E.get(sr(G)),M=$&&$.pop(),M){M.cgKey=K,M.cgFading&&(M.classList.remove("fading"),M.cgFading=!1);const I=le(K);t.addPieceZIndex&&(M.style.zIndex=bn(I,e)),A&&(M.cgAnimating=!0,M.classList.add("anim"),I[0]+=A[2],I[1]+=A[3]),ze(M,r(I,e))}else{const I=sr(G),T=qe("piece",I),X=le(K);T.cgPiece=I,T.cgKey=K,A&&(T.cgAnimating=!0,X[0]+=A[2],X[1]+=A[3]),ze(T,r(X,e)),t.addPieceZIndex&&(T.style.zIndex=bn(X,e)),n.appendChild(T)}for(const K of E.values())po(t,K);for(const K of _.values())po(t,K)}function kc(t){const e=Te(t),r=_r(t.dom.bounds());let n=t.dom.elements.board.firstChild;for(;n;)(ms(n)&&!n.cgAnimating||gs(n))&&ze(n,r(le(n.cgKey),e)),n=n.nextSibling}function ho(t){var e,r;const n=t.dom.elements.wrap.getBoundingClientRect(),o=t.dom.elements.container,a=n.height/n.width,c=Math.floor(n.width*window.devicePixelRatio/8)*8/window.devicePixelRatio,f=c*a;o.style.width=c+"px",o.style.height=f+"px",t.dom.bounds.clear(),(e=t.addDimensionsCssVarsTo)===null||e===void 0||e.style.setProperty("---cg-width",c+"px"),(r=t.addDimensionsCssVarsTo)===null||r===void 0||r.style.setProperty("---cg-height",f+"px")}const ms=t=>t.tagName==="PIECE",gs=t=>t.tagName==="SQUARE";function po(t,e){for(const r of e)t.dom.elements.board.removeChild(r)}function bn(t,e){const n=t[1];return`${e?10-n:3+n}`}const sr=t=>`${t.color} ${t.role}`;function yc(t){var e,r,n;const o=new Map;if(t.lastMove&&t.highlight.lastMove)for(const f of t.lastMove)Ge(o,f,"last-move");if(t.check&&t.highlight.check&&Ge(o,t.check,"check"),t.selected&&(Ge(o,t.selected,"selected"),t.movable.showDests)){const f=(e=t.movable.dests)===null||e===void 0?void 0:e.get(t.selected);if(f)for(const m of f)Ge(o,m,"move-dest"+(t.pieces.has(m)?" oc":""));const d=(n=(r=t.premovable.customDests)===null||r===void 0?void 0:r.get(t.selected))!==null&&n!==void 0?n:t.premovable.dests;if(d)for(const m of d)Ge(o,m,"premove-dest"+(t.pieces.has(m)?" oc":""))}const a=t.premovable.current;if(a)for(const f of a)Ge(o,f,"current-premove");else t.predroppable.current&&Ge(o,t.predroppable.current.key,"current-premove");const c=t.exploding;if(c)for(const f of c.keys)Ge(o,f,"exploding"+c.stage);return t.highlight.custom&&t.highlight.custom.forEach((f,d)=>{Ge(o,d,f)}),o}function Ge(t,e,r){const n=t.get(e);n?t.set(e,`${n} ${r}`):t.set(e,r)}function vn(t,e,r){const n=t.get(e);n?n.push(r):t.set(e,[r])}function _c(t,e,r){const n=new Map,o=[];for(const f of t)n.set(f.hash,!1);let a=e.firstElementChild,c;for(;a;)c=a.getAttribute("cgHash"),n.has(c)?n.set(c,!0):o.push(a),a=a.nextElementSibling;for(const f of o)e.removeChild(f);for(const f of t)n.get(f.hash)||e.appendChild(r(f))}function Ec(t,e){const n=t.drawable.autoShapes.filter(o=>o.piece).map(o=>({shape:o,hash:Cc(o),current:!1}));_c(n,e,o=>Ac(t,o,t.dom.bounds()))}function Sc(t){var e;const r=Te(t),n=_r(t.dom.bounds());let o=(e=t.dom.elements.autoPieces)===null||e===void 0?void 0:e.firstChild;for(;o;)jo(o,n(le(o.cgKey),r),o.cgScale),o=o.nextSibling}function Ac(t,{shape:e,hash:r},n){var o,a,c;const f=e.orig,d=(o=e.piece)===null||o===void 0?void 0:o.role,m=(a=e.piece)===null||a===void 0?void 0:a.color,w=(c=e.piece)===null||c===void 0?void 0:c.scale,g=qe("piece",`${d} ${m}`);return g.setAttribute("cgHash",r),g.cgKey=f,g.cgScale=w,jo(g,_r(n)(le(f),Te(t)),w),g}const Cc=t=>{var e,r,n;return[t.orig,(e=t.piece)===null||e===void 0?void 0:e.role,(r=t.piece)===null||r===void 0?void 0:r.color,(n=t.piece)===null||n===void 0?void 0:n.scale].join(",")};function Pc(t,e){const r=Xl();os(r,e||{});function n(){const o="dom"in r?r.dom.unbind:void 0,a=pc(t,r),c=hl(()=>a.board.getBoundingClientRect()),f=w=>{vc(m),a.autoPieces&&Ec(m,a.autoPieces),!w&&a.svg&&Zl(m,a.svg,a.customSvg)},d=()=>{ho(m),kc(m),a.autoPieces&&Sc(m)},m=r;return m.dom={elements:a,bounds:c,redraw:Tc(f),redrawNow:f,unbind:o},m.drawable.prevSvgHash="",ho(m),f(!1),gc(m,d),o||(m.dom.unbind=wc(m,d)),m.events.insert&&m.events.insert(a),m}return Ql(n(),n)}function Tc(t){let e=!1;return()=>{e||(e=!0,requestAnimationFrame(()=>{t(),e=!1}))}}let ws=class{unwrap(e,r){const n=this._chain(o=>z.ok(e?e(o):o),o=>r?z.ok(r(o)):z.err(o));if(n.isErr)throw n.error;return n.value}map(e,r){return this._chain(n=>z.ok(e(n)),n=>z.err(r?r(n):n))}chain(e,r){return this._chain(e,r||(n=>z.err(n)))}},Rc=class extends ws{constructor(e){super(),this.value=void 0,this.isOk=!0,this.isErr=!1,this.value=e}_chain(e,r){return e(this.value)}},Oc=class extends ws{constructor(e){super(),this.error=void 0,this.isOk=!1,this.isErr=!0,this.error=e}_chain(e,r){return r(this.error)}};var z;(function(t){t.ok=function(e){return new Rc(e)},t.err=function(e){return new Oc(e||new Error)},t.all=function(e){if(Array.isArray(e)){const o=[];for(let a=0;a<e.length;a++){const c=e[a];if(c.isErr)return c;o.push(c.value)}return t.ok(o)}const r={},n=Object.keys(e);for(let o=0;o<n.length;o++){const a=e[n[o]];if(a.isErr)return a;r[n[o]]=a.value}return t.ok(r)}})(z||(z={}));const mo=t=>(t=t-(t>>>1&1431655765),t=(t&858993459)+(t>>>2&858993459),Math.imul(t+(t>>>4)&252645135,16843009)>>24),Fn=t=>(t=t>>>8&16711935|(t&16711935)<<8,t>>>16&65535|(t&65535)<<16),go=t=>(t=t>>>1&1431655765|(t&1431655765)<<1,t=t>>>2&858993459|(t&858993459)<<2,t=t>>>4&252645135|(t&252645135)<<4,Fn(t));let O=class Q{constructor(e,r){F(this,"lo");F(this,"hi");this.lo=e|0,this.hi=r|0}static fromSquare(e){return e>=32?new Q(0,1<<e-32):new Q(1<<e,0)}static fromRank(e){return new Q(255,0).shl64(8*e)}static fromFile(e){return new Q(16843009<<e,16843009<<e)}static empty(){return new Q(0,0)}static full(){return new Q(4294967295,4294967295)}static corners(){return new Q(129,2164260864)}static center(){return new Q(402653184,24)}static backranks(){return new Q(255,4278190080)}static backrank(e){return e==="white"?new Q(255,0):new Q(0,4278190080)}static lightSquares(){return new Q(1437226410,1437226410)}static darkSquares(){return new Q(2857740885,2857740885)}complement(){return new Q(~this.lo,~this.hi)}xor(e){return new Q(this.lo^e.lo,this.hi^e.hi)}union(e){return new Q(this.lo|e.lo,this.hi|e.hi)}intersect(e){return new Q(this.lo&e.lo,this.hi&e.hi)}diff(e){return new Q(this.lo&~e.lo,this.hi&~e.hi)}intersects(e){return this.intersect(e).nonEmpty()}isDisjoint(e){return this.intersect(e).isEmpty()}supersetOf(e){return e.diff(this).isEmpty()}subsetOf(e){return this.diff(e).isEmpty()}shr64(e){return e>=64?Q.empty():e>=32?new Q(this.hi>>>e-32,0):e>0?new Q(this.lo>>>e^this.hi<<32-e,this.hi>>>e):this}shl64(e){return e>=64?Q.empty():e>=32?new Q(0,this.lo<<e-32):e>0?new Q(this.lo<<e,this.hi<<e^this.lo>>>32-e):this}bswap64(){return new Q(Fn(this.hi),Fn(this.lo))}rbit64(){return new Q(go(this.hi),go(this.lo))}minus64(e){const r=this.lo-e.lo,n=(r&e.lo&1)+(e.lo>>>1)+(r>>>1)>>>31;return new Q(r,this.hi-(e.hi+n))}equals(e){return this.lo===e.lo&&this.hi===e.hi}size(){return mo(this.lo)+mo(this.hi)}isEmpty(){return this.lo===0&&this.hi===0}nonEmpty(){return this.lo!==0||this.hi!==0}has(e){return(e>=32?this.hi&1<<e-32:this.lo&1<<e)!==0}set(e,r){return r?this.with(e):this.without(e)}with(e){return e>=32?new Q(this.lo,this.hi|1<<e-32):new Q(this.lo|1<<e,this.hi)}without(e){return e>=32?new Q(this.lo,this.hi&~(1<<e-32)):new Q(this.lo&~(1<<e),this.hi)}toggle(e){return e>=32?new Q(this.lo,this.hi^1<<e-32):new Q(this.lo^1<<e,this.hi)}last(){if(this.hi!==0)return 63-Math.clz32(this.hi);if(this.lo!==0)return 31-Math.clz32(this.lo)}first(){if(this.lo!==0)return 31-Math.clz32(this.lo&-this.lo);if(this.hi!==0)return 63-Math.clz32(this.hi&-this.hi)}withoutFirst(){return this.lo!==0?new Q(this.lo&this.lo-1,this.hi):new Q(0,this.hi&this.hi-1)}moreThanOne(){return this.hi!==0&&this.lo!==0||(this.lo&this.lo-1)!==0||(this.hi&this.hi-1)!==0}singleSquare(){return this.moreThanOne()?void 0:this.last()}*[Symbol.iterator](){let e=this.lo,r=this.hi;for(;e!==0;){const n=31-Math.clz32(e&-e);e^=1<<n,yield n}for(;r!==0;){const n=31-Math.clz32(r&-r);r^=1<<n,yield 32+n}}*reversed(){let e=this.lo,r=this.hi;for(;r!==0;){const n=31-Math.clz32(r);r^=1<<n,yield 32+n}for(;e!==0;){const n=31-Math.clz32(e);e^=1<<n,yield n}}};const $n=["a","b","c","d","e","f","g","h"],bs=["1","2","3","4","5","6","7","8"],Yt=["white","black"],je=["pawn","knight","bishop","rook","queen","king"],Mc=["a","h"];let vs=class Or{constructor(){F(this,"occupied");F(this,"promoted");F(this,"white");F(this,"black");F(this,"pawn");F(this,"knight");F(this,"bishop");F(this,"rook");F(this,"queen");F(this,"king")}static default(){const e=new Or;return e.reset(),e}reset(){this.occupied=new O(65535,4294901760),this.promoted=O.empty(),this.white=new O(65535,0),this.black=new O(0,4294901760),this.pawn=new O(65280,16711680),this.knight=new O(66,1107296256),this.bishop=new O(36,603979776),this.rook=new O(129,2164260864),this.queen=new O(8,134217728),this.king=new O(16,268435456)}static empty(){const e=new Or;return e.clear(),e}clear(){this.occupied=O.empty(),this.promoted=O.empty();for(const e of Yt)this[e]=O.empty();for(const e of je)this[e]=O.empty()}clone(){const e=new Or;e.occupied=this.occupied,e.promoted=this.promoted;for(const r of Yt)e[r]=this[r];for(const r of je)e[r]=this[r];return e}getColor(e){if(this.white.has(e))return"white";if(this.black.has(e))return"black"}getRole(e){for(const r of je)if(this[r].has(e))return r}get(e){const r=this.getColor(e);if(!r)return;const n=this.getRole(e),o=this.promoted.has(e);return{color:r,role:n,promoted:o}}take(e){const r=this.get(e);return r&&(this.occupied=this.occupied.without(e),this[r.color]=this[r.color].without(e),this[r.role]=this[r.role].without(e),r.promoted&&(this.promoted=this.promoted.without(e))),r}set(e,r){const n=this.take(e);return this.occupied=this.occupied.with(e),this[r.color]=this[r.color].with(e),this[r.role]=this[r.role].with(e),r.promoted&&(this.promoted=this.promoted.with(e)),n}has(e){return this.occupied.has(e)}*[Symbol.iterator](){for(const e of this.occupied)yield[e,this.get(e)]}pieces(e,r){return this[e].intersect(this[r])}rooksAndQueens(){return this.rook.union(this.queen)}bishopsAndQueens(){return this.bishop.union(this.queen)}kingOf(e){return this.pieces(e,"king").singleSquare()}},Pr=class Bt{constructor(){F(this,"pawn");F(this,"knight");F(this,"bishop");F(this,"rook");F(this,"queen");F(this,"king")}static empty(){const e=new Bt;for(const r of je)e[r]=0;return e}static fromBoard(e,r){const n=new Bt;for(const o of je)n[o]=e.pieces(r,o).size();return n}clone(){const e=new Bt;for(const r of je)e[r]=this[r];return e}equals(e){return je.every(r=>this[r]===e[r])}add(e){const r=new Bt;for(const n of je)r[n]=this[n]+e[n];return r}subtract(e){const r=new Bt;for(const n of je)r[n]=this[n]-e[n];return r}nonEmpty(){return je.some(e=>this[e]>0)}isEmpty(){return!this.nonEmpty()}hasPawns(){return this.pawn>0}hasNonPawns(){return this.knight>0||this.bishop>0||this.rook>0||this.queen>0||this.king>0}size(){return this.pawn+this.knight+this.bishop+this.rook+this.queen+this.king}},Nc=class zt{constructor(e,r){F(this,"white");F(this,"black");this.white=e,this.black=r}static empty(){return new zt(Pr.empty(),Pr.empty())}static fromBoard(e){return new zt(Pr.fromBoard(e,"white"),Pr.fromBoard(e,"black"))}clone(){return new zt(this.white.clone(),this.black.clone())}equals(e){return this.white.equals(e.white)&&this.black.equals(e.black)}add(e){return new zt(this.white.add(e.white),this.black.add(e.black))}subtract(e){return new zt(this.white.subtract(e.white),this.black.subtract(e.black))}count(e){return this.white[e]+this.black[e]}size(){return this.white.size()+this.black.size()}isEmpty(){return this.white.isEmpty()&&this.black.isEmpty()}nonEmpty(){return!this.isEmpty()}hasPawns(){return this.white.hasPawns()||this.black.hasPawns()}hasNonPawns(){return this.white.hasNonPawns()||this.black.hasNonPawns()}},wo=class Dn{constructor(e,r){F(this,"white");F(this,"black");this.white=e,this.black=r}static default(){return new Dn(3,3)}clone(){return new Dn(this.white,this.black)}equals(e){return this.white===e.white&&this.black===e.black}};const V=t=>t!==void 0,ye=t=>t==="white"?"black":"white",wt=t=>t>>3,Ue=t=>t&7,In=(t,e)=>0<=t&&t<8&&0<=e&&e<8?t+8*e:void 0,bo=t=>{switch(t){case"pawn":return"p";case"knight":return"n";case"bishop":return"b";case"rook":return"r";case"queen":return"q";case"king":return"k"}};function xc(t){switch(t.toLowerCase()){case"p":return"pawn";case"n":return"knight";case"b":return"bishop";case"r":return"rook";case"q":return"queen";case"k":return"king";default:return}}function Fc(t){if(t.length===2)return In(t.charCodeAt(0)-97,t.charCodeAt(1)-49)}const $c=t=>$n[Ue(t)]+bs[wt(t)],vi=(t,e)=>t==="white"?e==="a"?2:6:e==="a"?58:62,ki=(t,e)=>t==="white"?e==="a"?3:5:e==="a"?59:61,Dc="rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR",Ic=Dc+" w KQkq -",Lc=Ic+" 0 1";var he;(function(t){t.Fen="ERR_FEN",t.Board="ERR_BOARD",t.Pockets="ERR_POCKETS",t.Turn="ERR_TURN",t.Castling="ERR_CASTLING",t.EpSquare="ERR_EP_SQUARE",t.RemainingChecks="ERR_REMAINING_CHECKS",t.Halfmoves="ERR_HALFMOVES",t.Fullmoves="ERR_FULLMOVES"})(he||(he={}));let be=class extends Error{};const Uc=(t,e,r)=>{let n=t.indexOf(e);for(;r-- >0&&n!==-1;)n=t.indexOf(e,n+e.length);return n},Wt=t=>/^\d{1,4}$/.test(t)?parseInt(t,10):void 0,ks=t=>{const e=xc(t);return e&&{role:e,color:t.toLowerCase()===t?"black":"white"}},kn=t=>{const e=vs.empty();let r=7,n=0;for(let o=0;o<t.length;o++){const a=t[o];if(a==="/"&&n===8)n=0,r--;else{const c=parseInt(a,10);if(c>0)n+=c;else{if(n>=8||r<0)return z.err(new be(he.Board));const f=n+r*8,d=ks(a);if(!d)return z.err(new be(he.Board));t[o+1]==="~"&&(d.promoted=!0,o++),e.set(f,d),n++}}}return r!==0||n!==8?z.err(new be(he.Board)):z.ok(e)},vo=t=>{if(t.length>64)return z.err(new be(he.Pockets));const e=Nc.empty();for(const r of t){const n=ks(r);if(!n)return z.err(new be(he.Pockets));e[n.color][n.role]++}return z.ok(e)},Bc=(t,e)=>{let r=O.empty();if(e==="-")return z.ok(r);for(const n of e){const o=n.toLowerCase(),a=n===o?"black":"white",c=a==="white"?0:7;if("a"<=o&&o<="h")r=r.with(In(o.charCodeAt(0)-97,c));else if(o==="k"||o==="q"){const f=t[a].intersect(O.backrank(a)).intersect(t.rook.union(t.king)),d=o==="k"?f.last():f.first();r=r.with(V(d)&&t.rook.has(d)?d:In(o==="k"?7:0,c))}else return z.err(new be(he.Castling))}return Yt.some(n=>O.backrank(n).intersect(r).size()>2)?z.err(new be(he.Castling)):z.ok(r)},ko=t=>{const e=t.split("+");if(e.length===3&&e[0]===""){const r=Wt(e[1]),n=Wt(e[2]);return!V(r)||r>3||!V(n)||n>3?z.err(new be(he.RemainingChecks)):z.ok(new wo(3-r,3-n))}else if(e.length===2){const r=Wt(e[0]),n=Wt(e[1]);return!V(r)||r>3||!V(n)||n>3?z.err(new be(he.RemainingChecks)):z.ok(new wo(r,n))}else return z.err(new be(he.RemainingChecks))},yi=t=>{const e=t.split(/[\s_]+/),r=e.shift();let n,o=z.ok(void 0);if(r.endsWith("]")){const f=r.indexOf("[");if(f===-1)return z.err(new be(he.Fen));n=kn(r.slice(0,f)),o=vo(r.slice(f+1,-1))}else{const f=Uc(r,"/",7);f===-1?n=kn(r):(n=kn(r.slice(0,f)),o=vo(r.slice(f+1)))}let a;const c=e.shift();if(!V(c)||c==="w")a="white";else if(c==="b")a="black";else return z.err(new be(he.Turn));return n.chain(f=>{const d=e.shift(),m=V(d)?Bc(f,d):z.ok(O.empty()),w=e.shift();let g;if(V(w)&&w!=="-"&&(g=Fc(w),!V(g)))return z.err(new be(he.EpSquare));let E=e.shift(),_;V(E)&&E.includes("+")&&(_=ko(E),E=e.shift());const S=V(E)?Wt(E):0;if(!V(S))return z.err(new be(he.Halfmoves));const k=e.shift(),x=V(k)?Wt(k):1;if(!V(x))return z.err(new be(he.Fullmoves));const R=e.shift();let A=z.ok(void 0);if(V(R)){if(V(_))return z.err(new be(he.RemainingChecks));A=ko(R)}else V(_)&&(A=_);return e.length>0?z.err(new be(he.Fen)):o.chain(P=>m.chain($=>A.map(M=>({board:f,pockets:P,turn:a,castlingRights:$,remainingChecks:M,epSquare:g,halfmoves:S,fullmoves:Math.max(1,x)}))))})};var zc=De('<div class="is2d chessboard">');const jc=t=>{let e,r;return Ka(()=>{let n=t.color,o=t.dests,a={premovable:{enabled:!1},movable:{color:n,free:!1,dests:o,events:{after:t.onMoveAfter}},drawable:{onChange:t.onShapes}};r=Pc(e,a)}),Ve(()=>{let n,o;t.fen_uci?[n,o]=t.fen_uci:n=Lc;let a=[];o&&(a.push(o.slice(0,2)),a.push(o.slice(2,4)));let c=t.movable?t.color:void 0;r.set({fen:n,lastMove:a,turnColor:t.color,movable:{color:c,dests:t.dests}})}),Ve(()=>{let n=t.orientation??"white";r.set({orientation:n})}),Ve(()=>{let n=t.doPromotion;if(n){let o=r.state.pieces.get(n);r.setPieces(new Map([[n,{color:o.color,role:"queen",promoted:!0}]]))}}),Ve(()=>{t.shapes&&r.setAutoShapes(t.shapes)}),(()=>{var n=zc();return Bo(o=>e=o,n),n})()},Wc=Symbol("store-raw"),Hc=Symbol("store-node"),Rt=Symbol("store-has"),Kc=Symbol("store-self");function mr(t){let e;return t!=null&&typeof t=="object"&&(t[Ba]||!(e=Object.getPrototypeOf(t))||e===Object.prototype||Array.isArray(t))}function Ln(t,e=new Set){let r,n,o,a;if(r=t!=null&&t[Wc])return r;if(!mr(t)||e.has(t))return t;if(Array.isArray(t)){Object.isFrozen(t)?t=t.slice(0):e.add(t);for(let c=0,f=t.length;c<f;c++)o=t[c],(n=Ln(o,e))!==o&&(t[c]=n)}else{Object.isFrozen(t)?t=Object.assign({},t):e.add(t);const c=Object.keys(t),f=Object.getOwnPropertyDescriptors(t);for(let d=0,m=c.length;d<m;d++)a=c[d],!f[a].get&&(o=t[a],(n=Ln(o,e))!==o&&(t[a]=n))}return t}function Gc(t,e){let r=t[e];return r||Object.defineProperty(t,e,{value:r=Object.create(null)}),r}function yo(t,e,r){if(t[e])return t[e];const[n,o]=ge(r,{equals:!1,internal:!0});return n.$=o,t[e]=n}function Ze(t,e,r,n=!1){if(!n&&t[e]===r)return;const o=t[e],a=t.length;r===void 0?(delete t[e],t[Rt]&&t[Rt][e]&&o!==void 0&&t[Rt][e].$()):(t[e]=r,t[Rt]&&t[Rt][e]&&o===void 0&&t[Rt][e].$());let c=Gc(t,Hc),f;if((f=yo(c,e,o))&&f.$(()=>r),Array.isArray(t)&&t.length!==a){for(let d=t.length;d<a;d++)(f=c[d])&&f.$();(f=yo(c,"length",a))&&f.$(t.length)}(f=c[Kc])&&f.$()}const Un=Symbol("store-root");function jt(t,e,r,n,o){const a=e[r];if(t===a)return;const c=Array.isArray(t);if(r!==Un&&(!mr(t)||!mr(a)||c!==Array.isArray(a)||o&&t[o]!==a[o])){Ze(e,r,t);return}if(c){if(t.length&&a.length&&(!n||o&&t[0]&&t[0][o]!=null)){let m,w,g,E,_,S,k,x;for(g=0,E=Math.min(a.length,t.length);g<E&&(a[g]===t[g]||o&&a[g]&&t[g]&&a[g][o]===t[g][o]);g++)jt(t[g],a,g,n,o);const R=new Array(t.length),A=new Map;for(E=a.length-1,_=t.length-1;E>=g&&_>=g&&(a[E]===t[_]||o&&a[g]&&t[g]&&a[E][o]===t[_][o]);E--,_--)R[_]=a[E];if(g>_||g>E){for(w=g;w<=_;w++)Ze(a,w,t[w]);for(;w<t.length;w++)Ze(a,w,R[w]),jt(t[w],a,w,n,o);a.length>t.length&&Ze(a,"length",t.length);return}for(k=new Array(_+1),w=_;w>=g;w--)S=t[w],x=o&&S?S[o]:S,m=A.get(x),k[w]=m===void 0?-1:m,A.set(x,w);for(m=g;m<=E;m++)S=a[m],x=o&&S?S[o]:S,w=A.get(x),w!==void 0&&w!==-1&&(R[w]=a[m],w=k[w],A.set(x,w));for(w=g;w<t.length;w++)w in R?(Ze(a,w,R[w]),jt(t[w],a,w,n,o)):Ze(a,w,t[w])}else for(let m=0,w=t.length;m<w;m++)jt(t[m],a,m,n,o);a.length>t.length&&Ze(a,"length",t.length);return}const f=Object.keys(t);for(let m=0,w=f.length;m<w;m++)jt(t[f[m]],a,f[m],n,o);const d=Object.keys(a);for(let m=0,w=d.length;m<w;m++)t[d[m]]===void 0&&Ze(a,d[m],void 0)}function Vc(t,e={}){const{merge:r,key:n="id"}=e,o=Ln(t);return a=>{if(!mr(a)||!mr(o))return o;const c=jt(o,{[Un]:a},Un,r,n);return c===void 0?a:c}}var qc=t=>(typeof t.clear=="function"||(t.clear=()=>{let e;for(;e=t.key(0);)t.removeItem(e)}),t),Yc=["clear","getItem","getAll","setItem","removeItem","key","getLength"],Qc=t=>(t.withOptions=e=>Yc.reduce((r,n)=>(typeof t[n]=="function"&&(r[n]=(...o)=>(o[t[n].length-1]=e,t[n](...o))),r),{get length(){return t.length},withOptions:r=>t.withOptions(r)}),t),Xc={domain:"Domain",expires:"Expires",path:"Path",secure:"Secure",httpOnly:"HttpOnly",maxAge:"Max-Age",sameSite:"SameSite"};function Jc(t){if(!t)return"";const e=Object.entries(t).map(([r,n])=>{const o=Xc[r];if(o)return n instanceof Date?`${o}=${n.toUTCString()}`:typeof n=="boolean"?n?`${o}`:void 0:`${o}=${n}`}).filter(r=>!!r);return e.length!=0?`; ${e.join("; ")}`:""}function Zc(t,e){var n;const r=(n=t.match(`(^|;)\\s*${e}\\s*=\\s*([^;]+)`))==null?void 0:n.pop();return r!=null?decodeURIComponent(r):null}var ar=Qc(qc({_read:()=>document.cookie,_write:(t,e,r)=>{document.cookie=`${t}=${e}${Jc(r)}`},getItem:(t,e)=>Zc(ar._read(e),t),setItem:(t,e,r)=>{ar._write(t,e.replace(/[\u00c0-\uffff\&;]/g,n=>encodeURIComponent(n)),r)},removeItem:(t,e)=>{ar._write(t,"deleted",{...e,expires:new Date(0)})},key:(t,e)=>{let r=null,n=0;return ar._read(e).replace(/(?:^|;)\s*(.+?)\s*=\s*[^;]+/g,(o,a)=>(!r&&a&&n++===t&&(r=a),"")),r},getLength:t=>{let e=0;return ar._read(t).replace(/(?:^|;)\s*.+?\s*=\s*[^;]+/g,r=>(e+=r?1:0,"")),e},get length(){return this.getLength()}}));function eu(t,e={}){var w;const r=e.storage||globalThis.localStorage,n=e.name||`storage-${rl()}`;if(!r)return[t[0],t[1],null];const o=e.storageOptions,a=e.serialize||JSON.stringify.bind(JSON),c=e.deserialize||JSON.parse.bind(JSON),f=r.getItem(n,o),d=typeof t[0]=="function"?g=>{try{const E=c(g);t[1](()=>E)}catch{}}:g=>{try{const E=c(g);t[1](Vc(E))}catch{}};let m=!0;if(f instanceof Promise?f.then(g=>m&&g&&d(g)):f&&d(f),typeof((w=e.sync)==null?void 0:w[0])=="function"){const g=typeof t[0]=="function"?t[0]:()=>t[0];e.sync[0](E=>{E.key!==n||(E.url||globalThis.location.href)!==globalThis.location.href||E.newValue===a(Ce(g))||d(E.newValue)})}return[t[0],typeof t[0]=="function"?g=>{var S;const E=t[1](g),_=g!=null?a(E):g;return(S=e.sync)==null||S[1](n,_),_!=null?r.setItem(n,_,o):r.removeItem(n,o),m=!1,E}:(...g)=>{var _;t[1](...g);const E=a(Ce(()=>t[0]));(_=e.sync)==null||_[1](n,E),r.setItem(n,E,o),m=!1},f]}const Bn=(t,e,r)=>eu(ge(t),{name:`.hopefox2000.v0.${e}`}),Hr=(t,e)=>{let r=O.empty();for(const n of e){const o=t+n;0<=o&&o<64&&Math.abs(Ue(t)-Ue(o))<=2&&(r=r.with(o))}return r},it=t=>{const e=[];for(let r=0;r<64;r++)e[r]=t(r);return e},tu=it(t=>Hr(t,[-9,-8,-7,-1,1,7,8,9])),ru=it(t=>Hr(t,[-17,-15,-10,-6,6,10,15,17])),nu={white:it(t=>Hr(t,[7,9])),black:it(t=>Hr(t,[-7,-9]))},Kr=t=>tu[t],Gr=t=>ru[t],gr=(t,e)=>nu[t][e],zn=it(t=>O.fromFile(Ue(t)).without(t)),jn=it(t=>O.fromRank(wt(t)).without(t)),Wn=it(t=>{const e=new O(134480385,2151686160),r=8*(wt(t)-Ue(t));return(r>=0?e.shl64(r):e.shr64(-r)).without(t)}),Hn=it(t=>{const e=new O(270549120,16909320),r=8*(wt(t)+Ue(t)-7);return(r>=0?e.shl64(r):e.shr64(-r)).without(t)}),Kn=(t,e,r)=>{let n=r.intersect(e),o=n.bswap64();return n=n.minus64(t),o=o.minus64(t.bswap64()),n.xor(o.bswap64()).intersect(e)},iu=(t,e)=>Kn(O.fromSquare(t),zn[t],e),ou=(t,e)=>{const r=jn[t];let n=e.intersect(r),o=n.rbit64();return n=n.minus64(O.fromSquare(t)),o=o.minus64(O.fromSquare(63-t)),n.xor(o.rbit64()).intersect(r)},Kt=(t,e)=>{const r=O.fromSquare(t);return Kn(r,Wn[t],e).xor(Kn(r,Hn[t],e))},Gt=(t,e)=>iu(t,e).xor(ou(t,e)),Gn=(t,e)=>Kt(t,e).xor(Gt(t,e)),Vn=(t,e)=>{const r=O.fromSquare(e);return jn[t].intersects(r)?jn[t].with(t):Hn[t].intersects(r)?Hn[t].with(t):Wn[t].intersects(r)?Wn[t].with(t):zn[t].intersects(r)?zn[t].with(t):O.empty()},Vt=(t,e)=>Vn(t,e).intersect(O.full().shl64(t).xor(O.full().shl64(e))).withoutFirst();class su{constructor(e){F(this,"capacity");F(this,"cache");this.capacity=e,this.capacity=e,this.cache=new Map}get(e){if(!this.cache.has(e))return;const r=this.cache.get(e);return this.cache.delete(e),this.cache.set(e,r),r}put(e,r){if(this.cache.has(e))this.cache.delete(e);else if(this.cache.size>=this.capacity){const n=this.cache.keys().next().value;this.cache.delete(n)}this.cache.set(e,r)}}var tt;(function(t){t.Empty="ERR_EMPTY",t.OppositeCheck="ERR_OPPOSITE_CHECK",t.PawnsOnBackrank="ERR_PAWNS_ON_BACKRANK",t.Kings="ERR_KINGS",t.Variant="ERR_VARIANT"})(tt||(tt={}));let Ot=class extends Error{};const au=(t,e,r,n)=>r[e].intersect(Gt(t,n).intersect(r.rooksAndQueens()).union(Kt(t,n).intersect(r.bishopsAndQueens())).union(Gr(t).intersect(r.knight)).union(Kr(t).intersect(r.king)).union(gr(ye(e),t).intersect(r.pawn)));let _o=class lr{constructor(){F(this,"castlingRights");F(this,"rook");F(this,"path")}static default(){const e=new lr;return e.castlingRights=O.corners(),e.rook={white:{a:0,h:7},black:{a:56,h:63}},e.path={white:{a:new O(14,0),h:new O(96,0)},black:{a:new O(0,234881024),h:new O(0,1610612736)}},e}static empty(){const e=new lr;return e.castlingRights=O.empty(),e.rook={white:{a:void 0,h:void 0},black:{a:void 0,h:void 0}},e.path={white:{a:O.empty(),h:O.empty()},black:{a:O.empty(),h:O.empty()}},e}clone(){const e=new lr;return e.castlingRights=this.castlingRights,e.rook={white:{a:this.rook.white.a,h:this.rook.white.h},black:{a:this.rook.black.a,h:this.rook.black.h}},e.path={white:{a:this.path.white.a,h:this.path.white.h},black:{a:this.path.black.a,h:this.path.black.h}},e}add(e,r,n,o){const a=vi(e,r),c=ki(e,r);this.castlingRights=this.castlingRights.with(o),this.rook[e][r]=o,this.path[e][r]=Vt(o,c).with(c).union(Vt(n,a).with(a)).without(n).without(o)}static fromSetup(e){const r=lr.empty(),n=e.castlingRights.intersect(e.board.rook);for(const o of Yt){const a=O.backrank(o),c=e.board.kingOf(o);if(!V(c)||!a.has(c))continue;const f=n.intersect(e.board[o]).intersect(a),d=f.first();V(d)&&d<c&&r.add(o,"a",c,d);const m=f.last();V(m)&&c<m&&r.add(o,"h",c,m)}return r}discardRook(e){if(this.castlingRights.has(e)){this.castlingRights=this.castlingRights.without(e);for(const r of Yt)for(const n of Mc)this.rook[r][n]===e&&(this.rook[r][n]=void 0)}}discardColor(e){this.castlingRights=this.castlingRights.diff(O.backrank(e)),this.rook[e].a=void 0,this.rook[e].h=void 0}},lu=class{constructor(e){F(this,"rules");F(this,"board");F(this,"pockets");F(this,"turn");F(this,"castles");F(this,"epSquare");F(this,"remainingChecks");F(this,"halfmoves");F(this,"fullmoves");F(this,"c_cache",new su(64));this.rules=e}reset(){this.board=vs.default(),this.pockets=void 0,this.turn="white",this.castles=_o.default(),this.epSquare=void 0,this.remainingChecks=void 0,this.halfmoves=0,this.fullmoves=1}setupUnchecked(e){this.board=e.board.clone(),this.board.promoted=O.empty(),this.pockets=void 0,this.turn=e.turn,this.castles=_o.fromSetup(e),this.epSquare=cu(this,e.epSquare),this.remainingChecks=void 0,this.halfmoves=e.halfmoves,this.fullmoves=e.fullmoves}kingAttackers(e,r,n){return au(e,r,this.board,n)}playCaptureAt(e,r){this.halfmoves=0,r.role==="rook"&&this.castles.discardRook(e),this.pockets&&this.pockets[ye(r.color)][r.promoted?"pawn":r.role]++}ctx(){const e=this.isVariantEnd(),r=this.board.kingOf(this.turn);if(!V(r))return{king:r,blockers:O.empty(),checkers:O.empty(),variantEnd:e,mustCapture:!1};const n=Gt(r,O.empty()).intersect(this.board.rooksAndQueens()).union(Kt(r,O.empty()).intersect(this.board.bishopsAndQueens())).intersect(this.board[ye(this.turn)]);let o=O.empty();for(const c of n){const f=Vt(r,c).intersect(this.board.occupied);f.moreThanOne()||(o=o.union(f))}const a=this.kingAttackers(r,ye(this.turn),this.board.occupied);return{king:r,blockers:o,checkers:a,variantEnd:e,mustCapture:!1}}clone(){var r,n;const e=new this.constructor;return e.board=this.board.clone(),e.pockets=(r=this.pockets)==null?void 0:r.clone(),e.turn=this.turn,e.castles=this.castles.clone(),e.epSquare=this.epSquare,e.remainingChecks=(n=this.remainingChecks)==null?void 0:n.clone(),e.halfmoves=this.halfmoves,e.fullmoves=this.fullmoves,e}validate(){if(this.board.occupied.isEmpty())return z.err(new Ot(tt.Empty));if(this.board.king.size()!==2)return z.err(new Ot(tt.Kings));if(!V(this.board.kingOf(this.turn)))return z.err(new Ot(tt.Kings));const e=this.board.kingOf(ye(this.turn));return V(e)?this.kingAttackers(e,this.turn,this.board.occupied).nonEmpty()?z.err(new Ot(tt.OppositeCheck)):O.backranks().intersects(this.board.pawn)?z.err(new Ot(tt.PawnsOnBackrank)):z.ok(void 0):z.err(new Ot(tt.Kings))}dropDests(e){return O.empty()}dests(e,r){let n=this.c_cache.get(e+"");if(n)return n;if(r=r||this.ctx(),r.variantEnd)return O.empty();const o=this.board.get(e);if(!o||o.color!==this.turn)return O.empty();let a,c;if(o.role==="pawn"){a=gr(this.turn,e).intersect(this.board[ye(this.turn)]);const f=this.turn==="white"?8:-8,d=e+f;if(0<=d&&d<64&&!this.board.occupied.has(d)){a=a.with(d);const m=this.turn==="white"?e<16:e>=48,w=d+f;m&&!this.board.occupied.has(w)&&(a=a.with(w))}V(this.epSquare)&&Eo(this,e,r)&&(c=O.fromSquare(this.epSquare))}else o.role==="bishop"?a=Kt(e,this.board.occupied):o.role==="knight"?a=Gr(e):o.role==="rook"?a=Gt(e,this.board.occupied):o.role==="queen"?a=Gn(e,this.board.occupied):a=Kr(e);if(a=a.diff(this.board[this.turn]),V(r.king)){if(o.role==="king"){const f=this.board.occupied.without(e);for(const d of a)this.kingAttackers(d,ye(this.turn),f).nonEmpty()&&(a=a.without(d));return a.union(Tr(this,"a",r)).union(Tr(this,"h",r))}if(r.checkers.nonEmpty()){const f=r.checkers.singleSquare();if(!V(f))return O.empty();a=a.intersect(Vt(f,r.king).with(f))}r.blockers.has(e)&&(a=a.intersect(Vn(e,r.king)))}return c&&(a=a.union(c)),this.c_cache.put(e+"",a),a}pseudo_dests(e,r){if(r=r||this.ctx(),r.variantEnd)return O.empty();const n=this.board.get(e);if(!n||n.color!==this.turn)return O.empty();let o,a;if(n.role==="pawn"){o=gr(this.turn,e);const c=this.turn==="white"?8:-8,f=e+c;if(0<=f&&f<64&&!this.board.occupied.has(f)){o=o.with(f);const d=this.turn==="white"?e<16:e>=48,m=f+c;d&&!this.board.occupied.has(m)&&(o=o.with(m))}V(this.epSquare)&&Eo(this,e,r)&&(a=O.fromSquare(this.epSquare))}else n.role==="bishop"?o=Kt(e,this.board.occupied):n.role==="knight"?o=Gr(e):n.role==="rook"?o=Gt(e,this.board.occupied):n.role==="queen"?o=Gn(e,this.board.occupied):o=Kr(e);if(V(r.king)){if(n.role==="king"){this.board.occupied.without(e);for(const c of o);return o.union(Tr(this,"a",r)).union(Tr(this,"h",r))}if(r.checkers.nonEmpty()){const c=r.checkers.singleSquare();if(!V(c))return O.empty();o=o.intersect(Vt(c,r.king).with(c))}r.blockers.has(e)&&(o=o.intersect(Vn(e,r.king)))}return a&&(o=o.union(a)),o}isVariantEnd(){return!1}variantOutcome(e){}hasInsufficientMaterial(e){return this.board[e].intersect(this.board.pawn.union(this.board.rooksAndQueens())).nonEmpty()?!1:this.board[e].intersects(this.board.knight)?this.board[e].size()<=2&&this.board[ye(e)].diff(this.board.king).diff(this.board.queen).isEmpty():this.board[e].intersects(this.board.bishop)?(!this.board.bishop.intersects(O.darkSquares())||!this.board.bishop.intersects(O.lightSquares()))&&this.board.pawn.isEmpty()&&this.board.knight.isEmpty():!0}toSetup(){var e,r;return{board:this.board.clone(),pockets:(e=this.pockets)==null?void 0:e.clone(),turn:this.turn,castlingRights:this.castles.castlingRights,epSquare:uu(this),remainingChecks:(r=this.remainingChecks)==null?void 0:r.clone(),halfmoves:Math.min(this.halfmoves,150),fullmoves:Math.min(Math.max(this.fullmoves,1),9999)}}isInsufficientMaterial(){return Yt.every(e=>this.hasInsufficientMaterial(e))}hasDests(e){e=e||this.ctx();for(const r of this.board[this.turn])if(this.dests(r,e).nonEmpty())return!0;return this.dropDests(e).nonEmpty()}isLegal(e,r){{if(e.promotion==="pawn"||e.promotion==="king"&&this.rules!=="antichess"||!!e.promotion!==(this.board.pawn.has(e.from)&&O.backranks().has(e.to)))return!1;const n=this.dests(e.from,r);return n.has(e.to)||n.has(fu(this,e).to)}}isCheck(){const e=this.board.kingOf(this.turn);return V(e)&&this.kingAttackers(e,ye(this.turn),this.board.occupied).nonEmpty()}isEnd(e){return(e?e.variantEnd:this.isVariantEnd())?!0:this.isInsufficientMaterial()||!this.hasDests(e)}isCheckmate(e){return e=e||this.ctx(),!e.variantEnd&&e.checkers.nonEmpty()&&!this.hasDests(e)}isStalemate(e){return e=e||this.ctx(),!e.variantEnd&&e.checkers.isEmpty()&&!this.hasDests(e)}outcome(e){const r=this.variantOutcome(e);return r||(e=e||this.ctx(),this.isCheckmate(e)?{winner:ye(this.turn)}:this.isInsufficientMaterial()||this.isStalemate(e)?{winner:void 0}:void 0)}allDests(e){e=e||this.ctx();const r=new Map;if(e.variantEnd)return r;for(const n of this.board[this.turn])r.set(n,this.dests(n,e));return r}play(e){const r=this.turn,n=this.epSquare,o=ys(this,e);this.epSquare=void 0,this.halfmoves+=1,r==="black"&&(this.fullmoves+=1),this.turn=ye(r);{const a=this.board.take(e.from);if(!a)return;let c;if(a.role==="pawn"){this.halfmoves=0,e.to===n&&(c=this.board.take(e.to+(r==="white"?-8:8)));const f=e.from-e.to;Math.abs(f)===16&&8<=e.from&&e.from<=55&&(this.epSquare=e.from+e.to>>1),e.promotion&&(a.role=e.promotion,a.promoted=!!this.pockets)}else if(a.role==="rook")this.castles.discardRook(e.from);else if(a.role==="king"){if(o){const f=this.castles.rook[r][o];if(V(f)){const d=this.board.take(f);this.board.set(vi(r,o),a),d&&this.board.set(ki(r,o),d)}}this.castles.discardColor(r)}if(!o){const f=this.board.set(e.to,a)||c;f&&this.playCaptureAt(e.to,f)}}this.remainingChecks&&this.isCheck()&&(this.remainingChecks[r]=Math.max(this.remainingChecks[r]-1,0))}},_i=class extends lu{constructor(){super("chess")}static default(){const e=new this;return e.reset(),e}static fromSetup(e){const r=new this;return r.setupUnchecked(e),r.validate().map(n=>r)}clone(){return super.clone()}};const cu=(t,e)=>{if(!V(e))return;const r=t.turn==="white"?5:2,n=t.turn==="white"?8:-8;if(wt(e)!==r||t.board.occupied.has(e+n))return;const o=e-n;if(!(!t.board.pawn.has(o)||!t.board[ye(t.turn)].has(o)))return e},uu=t=>{if(!V(t.epSquare))return;const e=t.ctx(),n=t.board.pieces(t.turn,"pawn").intersect(gr(ye(t.turn),t.epSquare));for(const o of n)if(t.dests(o,e).has(t.epSquare))return t.epSquare},Eo=(t,e,r)=>{if(!V(t.epSquare)||!gr(t.turn,e).has(t.epSquare))return!1;if(!V(r.king))return!0;const n=t.turn==="white"?8:-8,o=t.epSquare-n;return t.kingAttackers(r.king,ye(t.turn),t.board.occupied.toggle(e).toggle(o).with(t.epSquare)).without(o).isEmpty()},Tr=(t,e,r)=>{if(!V(r.king)||r.checkers.nonEmpty())return O.empty();const n=t.castles.rook[t.turn][e];if(!V(n)||t.castles.path[t.turn][e].intersects(t.board.occupied))return O.empty();const o=vi(t.turn,e),a=Vt(r.king,o),c=t.board.occupied.without(r.king);for(const m of a)if(t.kingAttackers(m,ye(t.turn),c).nonEmpty())return O.empty();const f=ki(t.turn,e),d=t.board.occupied.toggle(r.king).toggle(n).toggle(f);return t.kingAttackers(o,ye(t.turn),d).nonEmpty()?O.empty():O.fromSquare(n)},ys=(t,e)=>{const r=e.to-e.from;if(!(Math.abs(r)!==2&&!t.board[t.turn].has(e.to))&&t.board.king.has(e.from))return r>0?"h":"a"},fu=(t,e)=>{const r=ys(t,e);if(!r)return e;const n=t.castles.rook[t.turn][r];return{from:e.from,to:V(n)?n:e.to}},hu=(t,e)=>{let r="";{const n=t.board.getRole(e.from);if(!n)return"--";if(n==="king"&&(t.board[t.turn].has(e.to)||Math.abs(e.to-e.from)===2))r=e.to>e.from?"O-O":"O-O-O";else{const o=t.board.occupied.has(e.to)||n==="pawn"&&Ue(e.from)!==Ue(e.to);if(n!=="pawn"){r=bo(n).toUpperCase();let a;if(n==="king"?a=Kr(e.to).intersect(t.board.king):n==="queen"?a=Gn(e.to,t.board.occupied).intersect(t.board.queen):n==="rook"?a=Gt(e.to,t.board.occupied).intersect(t.board.rook):n==="bishop"?a=Kt(e.to,t.board.occupied).intersect(t.board.bishop):a=Gr(e.to).intersect(t.board.knight),a=a.intersect(t.board[t.turn]).without(e.from),a.nonEmpty()){const c=t.ctx();for(const f of a)t.dests(f,c).has(e.to)||(a=a.without(f));if(a.nonEmpty()){let f=!1,d=a.intersects(O.fromRank(wt(e.from)));a.intersects(O.fromFile(Ue(e.from)))?f=!0:d=!0,d&&(r+=$n[Ue(e.from)]),f&&(r+=bs[wt(e.from)])}}}else o&&(r=$n[Ue(e.from)]);o&&(r+="x"),r+=$c(e.to),e.promotion&&(r+="="+bo(e.promotion).toUpperCase())}}return r},du=(t,e)=>{var n;const r=hu(t,e);return t.play(e),(n=t.outcome())!=null&&n.winner?r+"#":t.isCheck()?r+"+":r},_s=(t,e)=>du(t.clone(),e),pu="modulepreload",mu=function(t,e){return new URL(t,e).href},So={},gu=function(e,r,n){let o=Promise.resolve();if(r&&r.length>0){const c=document.getElementsByTagName("link"),f=document.querySelector("meta[property=csp-nonce]"),d=(f==null?void 0:f.nonce)||(f==null?void 0:f.getAttribute("nonce"));o=Promise.allSettled(r.map(m=>{if(m=mu(m,n),m in So)return;So[m]=!0;const w=m.endsWith(".css"),g=w?'[rel="stylesheet"]':"";if(!!n)for(let S=c.length-1;S>=0;S--){const k=c[S];if(k.href===m&&(!w||k.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${m}"]${g}`))return;const _=document.createElement("link");if(_.rel=w?"stylesheet":pu,w||(_.as="script"),_.crossOrigin="",_.href=m,d&&_.setAttribute("nonce",d),document.head.appendChild(_),w)return new Promise((S,k)=>{_.addEventListener("load",S),_.addEventListener("error",()=>k(new Error(`Unable to preload CSS for ${m}`)))})}))}function a(c){const f=new Event("vite:preloadError",{cancelable:!0});if(f.payload=c,window.dispatchEvent(f),!f.defaultPrevented)throw c}return o.then(c=>{for(const f of c||[])f.status==="rejected"&&a(f.reason);return e().catch(a)})};var wu=(()=>{var t=import.meta.url;return async function(e={}){var r,n=e,o,a,c=new Promise((i,s)=>{o=i,a=s});["_get_fen","_get_pieces_bb","_get_turn","_is_checkmate","_pos_attacks","_get_at","_create_position","_delete_position","_make_move","_unmake_move","_get_legal_moves","_free_legal_moves","_init","_malloc","_free","setValue","getValue","stringToUTF8","UTF8ToString","_memory","___indirect_function_table","onRuntimeInitialized"].forEach(i=>{Object.getOwnPropertyDescriptor(c,i)||Object.defineProperty(c,i,{get:()=>oe("You are getting "+i+" on the Promise object, instead of the instance. Use .then() to get called back with the instance, see the MODULARIZE docs in src/settings.js"),set:()=>oe("You are setting "+i+" on the Promise object, instead of the instance. Use .then() to get called back with the instance, see the MODULARIZE docs in src/settings.js")})});var f=typeof window=="object",d=typeof WorkerGlobalScope<"u",m=typeof process=="object"&&typeof process.versions=="object"&&typeof process.versions.node=="string"&&process.type!="renderer",w=!f&&!m&&!d;if(m){const{createRequire:i}=await gu(async()=>{const{createRequire:l}=await Promise.resolve().then(()=>Ef);return{createRequire:l}},void 0,import.meta.url);let s=import.meta.url;s.startsWith("data:")&&(s="/");var g=i(s)}var E=Object.assign({},n),_="./this.program",S="";function k(i){return n.locateFile?n.locateFile(i,S):S+i}var x,R;if(m){if(typeof process>"u"||!process.release||process.release.name!=="node")throw new Error("not compiled for this environment (did you build to HTML and try to run it not on the web, or set ENVIRONMENT to something - like node - and run it someplace else - like on the web?)");var A=process.versions.node,P=A.split(".").slice(0,3);if(P=P[0]*1e4+P[1]*100+P[2].split("-")[0]*1,P<16e4)throw new Error("This emscripten-generated code requires node v16.0.0 (detected v"+A+")");var $=g("fs"),M=g("path");import.meta.url.startsWith("data:")||(S=M.dirname(g("url").fileURLToPath(import.meta.url))+"/"),R=i=>{i=Jt(i)?new URL(i):M.normalize(i);var s=$.readFileSync(i);return T(s.buffer),s},x=(i,s=!0)=>(i=Jt(i)?new URL(i):M.normalize(i),new Promise((l,h)=>{$.readFile(i,s?void 0:"utf8",(p,b)=>{p?h(p):l(s?b.buffer:b)})})),!n.thisProgram&&process.argv.length>1&&(_=process.argv[1].replace(/\\/g,"/")),process.argv.slice(2)}else if(w){if(typeof process=="object"&&typeof g=="function"||typeof window=="object"||typeof WorkerGlobalScope<"u")throw new Error("not compiled for this environment (did you build to HTML and try to run it not on the web, or set ENVIRONMENT to something - like node - and run it someplace else - like on the web?)")}else if(f||d){if(d?S=self.location.href:typeof document<"u"&&document.currentScript&&(S=document.currentScript.src),t&&(S=t),S.startsWith("blob:")?S="":S=S.substr(0,S.replace(/[?#].*/,"").lastIndexOf("/")+1),!(typeof window=="object"||typeof WorkerGlobalScope<"u"))throw new Error("not compiled for this environment (did you build to HTML and try to run it not on the web, or set ENVIRONMENT to something - like node - and run it someplace else - like on the web?)");d&&(R=i=>{var s=new XMLHttpRequest;return s.open("GET",i,!1),s.responseType="arraybuffer",s.send(null),new Uint8Array(s.response)}),x=i=>Jt(i)?new Promise((s,l)=>{var h=new XMLHttpRequest;h.open("GET",i,!0),h.responseType="arraybuffer",h.onload=()=>{if(h.status==200||h.status==0&&h.response){s(h.response);return}l(h.status)},h.onerror=l,h.send(null)}):fetch(i,{credentials:"same-origin"}).then(s=>s.ok?s.arrayBuffer():Promise.reject(new Error(s.status+" : "+s.url)))}else throw new Error("environment detection error");var q=n.print||console.log.bind(console),H=n.printErr||console.error.bind(console);Object.assign(n,E),E=null,Oa(),n.arguments&&n.arguments,ut("arguments","arguments_"),n.thisProgram&&(_=n.thisProgram),ut("thisProgram","thisProgram"),T(typeof n.memoryInitializerPrefixURL>"u","Module.memoryInitializerPrefixURL option was removed, use Module.locateFile instead"),T(typeof n.pthreadMainPrefixURL>"u","Module.pthreadMainPrefixURL option was removed, use Module.locateFile instead"),T(typeof n.cdInitializerPrefixURL>"u","Module.cdInitializerPrefixURL option was removed, use Module.locateFile instead"),T(typeof n.filePackagePrefixURL>"u","Module.filePackagePrefixURL option was removed, use Module.locateFile instead"),T(typeof n.read>"u","Module.read option was removed"),T(typeof n.readAsync>"u","Module.readAsync option was removed (modify readAsync in JS)"),T(typeof n.readBinary>"u","Module.readBinary option was removed (modify readBinary in JS)"),T(typeof n.setWindowTitle>"u","Module.setWindowTitle option was removed (modify emscripten_set_window_title in JS)"),T(typeof n.TOTAL_MEMORY>"u","Module.TOTAL_MEMORY has been renamed Module.INITIAL_MEMORY"),ut("asm","wasmExports"),ut("readAsync","readAsync"),ut("readBinary","readBinary"),ut("setWindowTitle","setWindowTitle"),T(!w,"shell environment detected but not enabled at build time.  Add `shell` to `-sENVIRONMENT` to enable.");var K=n.wasmBinary;ut("wasmBinary","wasmBinary"),typeof WebAssembly!="object"&&H("no native wasm support detected");var G,I=!1;function T(i,s){i||oe("Assertion failed"+(s?": "+s:""))}var X,He,_t,ie,B,Me,Et;function xi(){var i=G.buffer;n.HEAP8=X=new Int8Array(i),n.HEAP16=_t=new Int16Array(i),n.HEAPU8=He=new Uint8Array(i),n.HEAPU16=new Uint16Array(i),n.HEAP32=ie=new Int32Array(i),n.HEAPU32=B=new Uint32Array(i),n.HEAPF32=Me=new Float32Array(i),n.HEAPF64=Et=new Float64Array(i)}T(!n.STACK_SIZE,"STACK_SIZE can no longer be set at runtime.  Use -sSTACK_SIZE at link time"),T(typeof Int32Array<"u"&&typeof Float64Array<"u"&&Int32Array.prototype.subarray!=null&&Int32Array.prototype.set!=null,"JS engine does not provide full typed array support"),T(!n.wasmMemory,"Use of `wasmMemory` detected.  Use -sIMPORTED_MEMORY to define wasmMemory externally"),T(!n.INITIAL_MEMORY,"Detected runtime INITIAL_MEMORY setting.  Use -sIMPORTED_MEMORY to define wasmMemory dynamically");function Is(){var i=dn();T((i&3)==0),i==0&&(i+=4),B[i>>2]=34821223,B[i+4>>2]=2310721022,B[0]=1668509029}function sn(){if(!I){var i=dn();i==0&&(i+=4);var s=B[i>>2],l=B[i+4>>2];(s!=34821223||l!=2310721022)&&oe(`Stack overflow! Stack cookie has been overwritten at ${er(i)}, expected hex dwords 0x89BACDFE and 0x2135467, but received ${er(l)} ${er(s)}`),B[0]!=1668509029&&oe("Runtime error: The application has corrupted its heap memory area (address zero)!")}}var Fi=[],$i=[],Di=[],Er=!1;function Ls(){if(n.preRun)for(typeof n.preRun=="function"&&(n.preRun=[n.preRun]);n.preRun.length;)zs(n.preRun.shift());ln(Fi)}function Us(){T(!Er),Er=!0,sn(),!n.noFSInit&&!u.initialized&&u.init(),u.ignorePermissions=!1,ln($i)}function Bs(){if(sn(),n.postRun)for(typeof n.postRun=="function"&&(n.postRun=[n.postRun]);n.postRun.length;)Ws(n.postRun.shift());ln(Di)}function zs(i){Fi.unshift(i)}function js(i){$i.unshift(i)}function Ws(i){Di.unshift(i)}T(Math.imul,"This browser does not support Math.imul(), build with LEGACY_VM_SUPPORT or POLYFILL_OLD_MATH_FUNCTIONS to add in a polyfill"),T(Math.fround,"This browser does not support Math.fround(), build with LEGACY_VM_SUPPORT or POLYFILL_OLD_MATH_FUNCTIONS to add in a polyfill"),T(Math.clz32,"This browser does not support Math.clz32(), build with LEGACY_VM_SUPPORT or POLYFILL_OLD_MATH_FUNCTIONS to add in a polyfill"),T(Math.trunc,"This browser does not support Math.trunc(), build with LEGACY_VM_SUPPORT or POLYFILL_OLD_MATH_FUNCTIONS to add in a polyfill");var lt=0,ct=null,Xt=null,St={};function Ii(i){for(var s=i;;){if(!St[i])return i;i=s+Math.random()}}function an(i){var s;lt++,(s=n.monitorRunDependencies)==null||s.call(n,lt),i?(T(!St[i]),St[i]=1,ct===null&&typeof setInterval<"u"&&(ct=setInterval(()=>{if(I){clearInterval(ct),ct=null;return}var l=!1;for(var h in St)l||(l=!0,H("still waiting on run dependencies:")),H(`dependency: ${h}`);l&&H("(end of list)")},1e4))):H("warning: run dependency added without ID")}function Sr(i){var l;if(lt--,(l=n.monitorRunDependencies)==null||l.call(n,lt),i?(T(St[i]),delete St[i]):H("warning: run dependency removed without ID"),lt==0&&(ct!==null&&(clearInterval(ct),ct=null),Xt)){var s=Xt;Xt=null,s()}}function oe(i){var l;(l=n.onAbort)==null||l.call(n,i),i="Aborted("+i+")",H(i),I=!0;var s=new WebAssembly.RuntimeError(i);throw a(s),s}var Hs="data:application/octet-stream;base64,",Li=i=>i.startsWith(Hs),Jt=i=>i.startsWith("file://");function ce(i,s){return(...l)=>{T(Er,`native function \`${i}\` called before runtime initialization`);var h=ht[i];return T(h,`exported native function \`${i}\` not found`),T(l.length<=s,`native function \`${i}\` called with ${l.length} args but expects ${s}`),h(...l)}}function Ks(){if(n.locateFile){var i="hopefox.wasm";return Li(i)?i:k(i)}return new URL("hopefox.wasm",import.meta.url).href}var Zt;function Ui(i){if(i==Zt&&K)return new Uint8Array(K);if(R)return R(i);throw"both async and sync fetching of the wasm failed"}function Gs(i){return K?Promise.resolve().then(()=>Ui(i)):x(i).then(s=>new Uint8Array(s),()=>Ui(i))}function Bi(i,s,l){return Gs(i).then(h=>WebAssembly.instantiate(h,s)).then(l,h=>{H(`failed to asynchronously prepare wasm: ${h}`),Jt(Zt)&&H(`warning: Loading from a file URI (${Zt}) is not supported in most browsers. See https://emscripten.org/docs/getting_started/FAQ.html#how-do-i-run-a-local-webserver-for-testing-why-does-my-program-stall-in-downloading-or-preparing`),oe(h)})}function Vs(i,s,l,h){return!i&&typeof WebAssembly.instantiateStreaming=="function"&&!Li(s)&&!Jt(s)&&!m&&typeof fetch=="function"?fetch(s,{credentials:"same-origin"}).then(p=>{var b=WebAssembly.instantiateStreaming(p,l);return b.then(h,function(v){return H(`wasm streaming compile failed: ${v}`),H("falling back to ArrayBuffer instantiation"),Bi(s,l,h)})}):Bi(s,l,h)}function qs(){return{env:Qi,wasi_snapshot_preview1:Qi}}function Ys(){function i(p,b){return ht=p.exports,G=ht.memory,T(G,"memory not found in wasm exports"),xi(),js(ht.__wasm_call_ctors),Sr("wasm-instantiate"),ht}an("wasm-instantiate");var s=n;function l(p){T(n===s,"the Module object should not be replaced during async compilation - perhaps the order of HTML elements is wrong?"),s=null,i(p.instance)}var h=qs();if(n.instantiateWasm)try{return n.instantiateWasm(h,i)}catch(p){H(`Module.instantiateWasm callback failed with error: ${p}`),a(p)}return Zt??(Zt=Ks()),Vs(K,Zt,h,l).catch(a),{}}var Y,me;if((()=>{var i=new Int16Array(1),s=new Int8Array(i.buffer);if(i[0]=25459,s[0]!==115||s[1]!==99)throw"Runtime error: expected the system to be little-endian! (Run with -sSUPPORT_BIG_ENDIAN to bypass)"})(),n.ENVIRONMENT)throw new Error("Module.ENVIRONMENT has been deprecated. To force the environment, use the ENVIRONMENT compile-time option (for example, -sENVIRONMENT=web or -sENVIRONMENT=node)");function ut(i,s,l=!0){Object.getOwnPropertyDescriptor(n,i)||Object.defineProperty(n,i,{configurable:!0,get(){let h=l?" (the initial value can be provided on Module, but after startup the value is only looked for on a local variable of that name)":"";oe(`\`Module.${i}\` has been replaced by \`${s}\``+h)}})}function Qs(i){Object.getOwnPropertyDescriptor(n,i)&&oe(`\`Module.${i}\` was supplied but \`${i}\` not included in INCOMING_MODULE_JS_API`)}function zi(i){return i==="FS_createPath"||i==="FS_createDataFile"||i==="FS_createPreloadedFile"||i==="FS_unlink"||i==="addRunDependency"||i==="FS_createLazyFile"||i==="FS_createDevice"||i==="removeRunDependency"}function ji(i,s){typeof globalThis<"u"&&!Object.getOwnPropertyDescriptor(globalThis,i)&&Object.defineProperty(globalThis,i,{configurable:!0,get(){s()}})}function Wi(i,s){ji(i,()=>{Ke(`\`${i}\` is not longer defined by emscripten. ${s}`)})}Wi("buffer","Please use HEAP8.buffer or wasmMemory.buffer"),Wi("asm","Please use wasmExports instead");function Xs(i){ji(i,()=>{var s=`\`${i}\` is a library symbol and not included by default; add it to your library.js __deps or to DEFAULT_LIBRARY_FUNCS_TO_INCLUDE on the command line`,l=i;l.startsWith("_")||(l="$"+i),s+=` (e.g. -sDEFAULT_LIBRARY_FUNCS_TO_INCLUDE='${l}')`,zi(i)&&(s+=". Alternatively, forcing filesystem support (-sFORCE_FILESYSTEM) can export this for you"),Ke(s)}),Hi(i)}function Hi(i){Object.getOwnPropertyDescriptor(n,i)||Object.defineProperty(n,i,{configurable:!0,get(){var s=`'${i}' was not exported. add it to EXPORTED_RUNTIME_METHODS (see the Emscripten FAQ)`;zi(i)&&(s+=". Alternatively, forcing filesystem support (-sFORCE_FILESYSTEM) can export this for you"),oe(s)}})}var ln=i=>{for(;i.length>0;)i.shift()(n)};function Js(i,s="i8"){switch(s.endsWith("*")&&(s="*"),s){case"i1":return X[i];case"i8":return X[i];case"i16":return _t[i>>1];case"i32":return ie[i>>2];case"i64":oe("to do getValue(i64) use WASM_BIGINT");case"float":return Me[i>>2];case"double":return Et[i>>3];case"*":return B[i>>2];default:oe(`invalid type for getValue: ${s}`)}}n.getValue=Js,n.noExitRuntime;var er=i=>(T(typeof i=="number"),i>>>=0,"0x"+i.toString(16).padStart(8,"0"));function Zs(i,s,l="i8"){switch(l.endsWith("*")&&(l="*"),l){case"i1":X[i]=s;break;case"i8":X[i]=s;break;case"i16":_t[i>>1]=s;break;case"i32":ie[i>>2]=s;break;case"i64":oe("to do setValue(i64) use WASM_BIGINT");case"float":Me[i>>2]=s;break;case"double":Et[i>>3]=s;break;case"*":B[i>>2]=s;break;default:oe(`invalid type for setValue: ${l}`)}}n.setValue=Zs;var Ke=i=>{Ke.shown||(Ke.shown={}),Ke.shown[i]||(Ke.shown[i]=1,m&&(i="warning: "+i),H(i))},Ki=typeof TextDecoder<"u"?new TextDecoder:void 0,At=(i,s=0,l=NaN)=>{for(var h=s+l,p=s;i[p]&&!(p>=h);)++p;if(p-s>16&&i.buffer&&Ki)return Ki.decode(i.subarray(s,p));for(var b="";s<p;){var v=i[s++];if(!(v&128)){b+=String.fromCharCode(v);continue}var y=i[s++]&63;if((v&224)==192){b+=String.fromCharCode((v&31)<<6|y);continue}var N=i[s++]&63;if((v&240)==224?v=(v&15)<<12|y<<6|N:((v&248)!=240&&Ke("Invalid UTF-8 leading byte "+er(v)+" encountered when deserializing a UTF-8 string in wasm memory to a JS string!"),v=(v&7)<<18|y<<12|N<<6|i[s++]&63),v<65536)b+=String.fromCharCode(v);else{var W=v-65536;b+=String.fromCharCode(55296|W>>10,56320|W&1023)}}return b},Ct=(i,s)=>(T(typeof i=="number",`UTF8ToString expects a number (got ${typeof i})`),i?At(He,i,s):"");n.UTF8ToString=Ct;var ea=(i,s,l,h)=>oe(`Assertion failed: ${Ct(i)}, at: `+[s?Ct(s):"unknown filename",l,h?Ct(h):"unknown function"]);class ta{constructor(s){this.excPtr=s,this.ptr=s-24}set_type(s){B[this.ptr+4>>2]=s}get_type(){return B[this.ptr+4>>2]}set_destructor(s){B[this.ptr+8>>2]=s}get_destructor(){return B[this.ptr+8>>2]}set_caught(s){s=s?1:0,X[this.ptr+12]=s}get_caught(){return X[this.ptr+12]!=0}set_rethrown(s){s=s?1:0,X[this.ptr+13]=s}get_rethrown(){return X[this.ptr+13]!=0}init(s,l){this.set_adjusted_ptr(0),this.set_type(s),this.set_destructor(l)}set_adjusted_ptr(s){B[this.ptr+16>>2]=s}get_adjusted_ptr(){return B[this.ptr+16>>2]}}var ra=(i,s,l)=>{var h=new ta(i);h.init(s,l),T(!1,"Exception thrown, but exception catching is not enabled. Compile with -sNO_DISABLE_EXCEPTION_CATCHING or -sEXCEPTION_CATCHING_ALLOWED=[..] to catch.")},na=()=>oe("native code called abort()"),ia=(i,s,l)=>He.copyWithin(i,s,s+l),cn=(i,s,l,h)=>{if(T(typeof i=="string",`stringToUTF8Array expects a string (got ${typeof i})`),!(h>0))return 0;for(var p=l,b=l+h-1,v=0;v<i.length;++v){var y=i.charCodeAt(v);if(y>=55296&&y<=57343){var N=i.charCodeAt(++v);y=65536+((y&1023)<<10)|N&1023}if(y<=127){if(l>=b)break;s[l++]=y}else if(y<=2047){if(l+1>=b)break;s[l++]=192|y>>6,s[l++]=128|y&63}else if(y<=65535){if(l+2>=b)break;s[l++]=224|y>>12,s[l++]=128|y>>6&63,s[l++]=128|y&63}else{if(l+3>=b)break;y>1114111&&Ke("Invalid Unicode code point "+er(y)+" encountered when serializing a JS string to a UTF-8 string in wasm memory! (Valid unicode code points should be in range 0-0x10FFFF)."),s[l++]=240|y>>18,s[l++]=128|y>>12&63,s[l++]=128|y>>6&63,s[l++]=128|y&63}}return s[l]=0,l-p},tr=(i,s,l)=>(T(typeof l=="number","stringToUTF8(str, outPtr, maxBytesToWrite) is missing the third parameter that specifies the length of the output buffer!"),cn(i,He,s,l));n.stringToUTF8=tr;var Ar=i=>{for(var s=0,l=0;l<i.length;++l){var h=i.charCodeAt(l);h<=127?s++:h<=2047?s+=2:h>=55296&&h<=57343?(s+=4,++l):s+=3}return s},oa=(i,s,l,h)=>{var p=new Date().getFullYear(),b=new Date(p,0,1),v=new Date(p,6,1),y=b.getTimezoneOffset(),N=v.getTimezoneOffset(),W=Math.max(y,N);B[i>>2]=W*60,ie[s>>2]=+(y!=N);var ee=D=>{var J=D>=0?"-":"+",ue=Math.abs(D),Ne=String(Math.floor(ue/60)).padStart(2,"0"),Re=String(ue%60).padStart(2,"0");return`UTC${J}${Ne}${Re}`},Z=ee(y),ne=ee(N);T(Z),T(ne),T(Ar(Z)<=16,`timezone name truncated to fit in TZNAME_MAX (${Z})`),T(Ar(ne)<=16,`timezone name truncated to fit in TZNAME_MAX (${ne})`),N<y?(tr(Z,l,17),tr(ne,h,17)):(tr(Z,h,17),tr(ne,l,17))},sa=()=>2147483648,aa=(i,s)=>(T(s,"alignment argument is required"),Math.ceil(i/s)*s),la=i=>{var s=G.buffer,l=(i-s.byteLength+65535)/65536|0;try{return G.grow(l),xi(),1}catch(h){H(`growMemory: Attempted to grow heap from ${s.byteLength} bytes to ${i} bytes, but got error: ${h}`)}},ca=i=>{var s=He.length;i>>>=0,T(i>s);var l=sa();if(i>l)return H(`Cannot enlarge memory, requested ${i} bytes, but the limit is ${l} bytes!`),!1;for(var h=1;h<=4;h*=2){var p=s*(1+.2/h);p=Math.min(p,i+100663296);var b=Math.min(l,aa(Math.max(i,p),65536)),v=la(b);if(v)return!0}return H(`Failed to grow the heap from ${s} bytes to ${b} bytes, not enough memory!`),!1},un={},ua=()=>_||"./this.program",rr=()=>{if(!rr.strings){var i=(typeof navigator=="object"&&navigator.languages&&navigator.languages[0]||"C").replace("-","_")+".UTF-8",s={USER:"web_user",LOGNAME:"web_user",PATH:"/",PWD:"/",HOME:"/home/web_user",LANG:i,_:ua()};for(var l in un)un[l]===void 0?delete s[l]:s[l]=un[l];var h=[];for(var l in s)h.push(`${l}=${s[l]}`);rr.strings=h}return rr.strings},fa=(i,s)=>{for(var l=0;l<i.length;++l)T(i.charCodeAt(l)===(i.charCodeAt(l)&255)),X[s++]=i.charCodeAt(l);X[s]=0},ha=(i,s)=>{var l=0;return rr().forEach((h,p)=>{var b=s+l;B[i+p*4>>2]=b,fa(h,b),l+=h.length+1}),0},da=(i,s)=>{var l=rr();B[i>>2]=l.length;var h=0;return l.forEach(p=>h+=p.length+1),B[s>>2]=h,0},re={isAbs:i=>i.charAt(0)==="/",splitPath:i=>{var s=/^(\/?|)([\s\S]*?)((?:\.{1,2}|[^\/]+?|)(\.[^.\/]*|))(?:[\/]*)$/;return s.exec(i).slice(1)},normalizeArray:(i,s)=>{for(var l=0,h=i.length-1;h>=0;h--){var p=i[h];p==="."?i.splice(h,1):p===".."?(i.splice(h,1),l++):l&&(i.splice(h,1),l--)}if(s)for(;l;l--)i.unshift("..");return i},normalize:i=>{var s=re.isAbs(i),l=i.substr(-1)==="/";return i=re.normalizeArray(i.split("/").filter(h=>!!h),!s).join("/"),!i&&!s&&(i="."),i&&l&&(i+="/"),(s?"/":"")+i},dirname:i=>{var s=re.splitPath(i),l=s[0],h=s[1];return!l&&!h?".":(h&&(h=h.substr(0,h.length-1)),l+h)},basename:i=>{if(i==="/")return"/";i=re.normalize(i),i=i.replace(/\/$/,"");var s=i.lastIndexOf("/");return s===-1?i:i.substr(s+1)},join:(...i)=>re.normalize(i.join("/")),join2:(i,s)=>re.normalize(i+"/"+s)},pa=()=>{if(typeof crypto=="object"&&typeof crypto.getRandomValues=="function")return h=>crypto.getRandomValues(h);if(m)try{var i=g("crypto"),s=i.randomFillSync;if(s)return h=>i.randomFillSync(h);var l=i.randomBytes;return h=>(h.set(l(h.byteLength)),h)}catch{}oe("no cryptographic support found for randomDevice. consider polyfilling it if you want to use something insecure like Math.random(), e.g. put this in a --pre-js: var crypto = { getRandomValues: (array) => { for (var i = 0; i < array.length; i++) array[i] = (Math.random()*256)|0 } };")},Gi=i=>(Gi=pa())(i),Je={resolve:(...i)=>{for(var s="",l=!1,h=i.length-1;h>=-1&&!l;h--){var p=h>=0?i[h]:u.cwd();if(typeof p!="string")throw new TypeError("Arguments to path.resolve must be strings");if(!p)return"";s=p+"/"+s,l=re.isAbs(p)}return s=re.normalizeArray(s.split("/").filter(b=>!!b),!l).join("/"),(l?"/":"")+s||"."},relative:(i,s)=>{i=Je.resolve(i).substr(1),s=Je.resolve(s).substr(1);function l(W){for(var ee=0;ee<W.length&&W[ee]==="";ee++);for(var Z=W.length-1;Z>=0&&W[Z]==="";Z--);return ee>Z?[]:W.slice(ee,Z-ee+1)}for(var h=l(i.split("/")),p=l(s.split("/")),b=Math.min(h.length,p.length),v=b,y=0;y<b;y++)if(h[y]!==p[y]){v=y;break}for(var N=[],y=v;y<h.length;y++)N.push("..");return N=N.concat(p.slice(v)),N.join("/")}},fn=[];function Vi(i,s,l){var h=Ar(i)+1,p=new Array(h),b=cn(i,p,0,p.length);return p.length=b,p}var ma=()=>{if(!fn.length){var i=null;if(m){var s=256,l=Buffer.alloc(s),h=0,p=process.stdin.fd;try{h=$.readSync(p,l,0,s)}catch(b){if(b.toString().includes("EOF"))h=0;else throw b}h>0&&(i=l.slice(0,h).toString("utf-8"))}else typeof window<"u"&&typeof window.prompt=="function"&&(i=window.prompt("Input: "),i!==null&&(i+=`
`));if(!i)return null;fn=Vi(i)}return fn.shift()},ft={ttys:[],init(){},shutdown(){},register(i,s){ft.ttys[i]={input:[],output:[],ops:s},u.registerDevice(i,ft.stream_ops)},stream_ops:{open(i){var s=ft.ttys[i.node.rdev];if(!s)throw new u.ErrnoError(43);i.tty=s,i.seekable=!1},close(i){i.tty.ops.fsync(i.tty)},fsync(i){i.tty.ops.fsync(i.tty)},read(i,s,l,h,p){if(!i.tty||!i.tty.ops.get_char)throw new u.ErrnoError(60);for(var b=0,v=0;v<h;v++){var y;try{y=i.tty.ops.get_char(i.tty)}catch{throw new u.ErrnoError(29)}if(y===void 0&&b===0)throw new u.ErrnoError(6);if(y==null)break;b++,s[l+v]=y}return b&&(i.node.timestamp=Date.now()),b},write(i,s,l,h,p){if(!i.tty||!i.tty.ops.put_char)throw new u.ErrnoError(60);try{for(var b=0;b<h;b++)i.tty.ops.put_char(i.tty,s[l+b])}catch{throw new u.ErrnoError(29)}return h&&(i.node.timestamp=Date.now()),b}},default_tty_ops:{get_char(i){return ma()},put_char(i,s){s===null||s===10?(q(At(i.output)),i.output=[]):s!=0&&i.output.push(s)},fsync(i){i.output&&i.output.length>0&&(q(At(i.output)),i.output=[])},ioctl_tcgets(i){return{c_iflag:25856,c_oflag:5,c_cflag:191,c_lflag:35387,c_cc:[3,28,127,21,4,0,1,0,17,19,26,0,18,15,23,22,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]}},ioctl_tcsets(i,s,l){return 0},ioctl_tiocgwinsz(i){return[24,80]}},default_tty1_ops:{put_char(i,s){s===null||s===10?(H(At(i.output)),i.output=[]):s!=0&&i.output.push(s)},fsync(i){i.output&&i.output.length>0&&(H(At(i.output)),i.output=[])}}},qi=i=>{oe("internal error: mmapAlloc called but `emscripten_builtin_memalign` native symbol not exported")},L={ops_table:null,mount(i){return L.createNode(null,"/",16895,0)},createNode(i,s,l,h){if(u.isBlkdev(l)||u.isFIFO(l))throw new u.ErrnoError(63);L.ops_table||(L.ops_table={dir:{node:{getattr:L.node_ops.getattr,setattr:L.node_ops.setattr,lookup:L.node_ops.lookup,mknod:L.node_ops.mknod,rename:L.node_ops.rename,unlink:L.node_ops.unlink,rmdir:L.node_ops.rmdir,readdir:L.node_ops.readdir,symlink:L.node_ops.symlink},stream:{llseek:L.stream_ops.llseek}},file:{node:{getattr:L.node_ops.getattr,setattr:L.node_ops.setattr},stream:{llseek:L.stream_ops.llseek,read:L.stream_ops.read,write:L.stream_ops.write,allocate:L.stream_ops.allocate,mmap:L.stream_ops.mmap,msync:L.stream_ops.msync}},link:{node:{getattr:L.node_ops.getattr,setattr:L.node_ops.setattr,readlink:L.node_ops.readlink},stream:{}},chrdev:{node:{getattr:L.node_ops.getattr,setattr:L.node_ops.setattr},stream:u.chrdev_stream_ops}});var p=u.createNode(i,s,l,h);return u.isDir(p.mode)?(p.node_ops=L.ops_table.dir.node,p.stream_ops=L.ops_table.dir.stream,p.contents={}):u.isFile(p.mode)?(p.node_ops=L.ops_table.file.node,p.stream_ops=L.ops_table.file.stream,p.usedBytes=0,p.contents=null):u.isLink(p.mode)?(p.node_ops=L.ops_table.link.node,p.stream_ops=L.ops_table.link.stream):u.isChrdev(p.mode)&&(p.node_ops=L.ops_table.chrdev.node,p.stream_ops=L.ops_table.chrdev.stream),p.timestamp=Date.now(),i&&(i.contents[s]=p,i.timestamp=p.timestamp),p},getFileDataAsTypedArray(i){return i.contents?i.contents.subarray?i.contents.subarray(0,i.usedBytes):new Uint8Array(i.contents):new Uint8Array(0)},expandFileStorage(i,s){var l=i.contents?i.contents.length:0;if(!(l>=s)){var h=1024*1024;s=Math.max(s,l*(l<h?2:1.125)>>>0),l!=0&&(s=Math.max(s,256));var p=i.contents;i.contents=new Uint8Array(s),i.usedBytes>0&&i.contents.set(p.subarray(0,i.usedBytes),0)}},resizeFileStorage(i,s){if(i.usedBytes!=s)if(s==0)i.contents=null,i.usedBytes=0;else{var l=i.contents;i.contents=new Uint8Array(s),l&&i.contents.set(l.subarray(0,Math.min(s,i.usedBytes))),i.usedBytes=s}},node_ops:{getattr(i){var s={};return s.dev=u.isChrdev(i.mode)?i.id:1,s.ino=i.id,s.mode=i.mode,s.nlink=1,s.uid=0,s.gid=0,s.rdev=i.rdev,u.isDir(i.mode)?s.size=4096:u.isFile(i.mode)?s.size=i.usedBytes:u.isLink(i.mode)?s.size=i.link.length:s.size=0,s.atime=new Date(i.timestamp),s.mtime=new Date(i.timestamp),s.ctime=new Date(i.timestamp),s.blksize=4096,s.blocks=Math.ceil(s.size/s.blksize),s},setattr(i,s){s.mode!==void 0&&(i.mode=s.mode),s.timestamp!==void 0&&(i.timestamp=s.timestamp),s.size!==void 0&&L.resizeFileStorage(i,s.size)},lookup(i,s){throw new u.ErrnoError(44)},mknod(i,s,l,h){return L.createNode(i,s,l,h)},rename(i,s,l){if(u.isDir(i.mode)){var h;try{h=u.lookupNode(s,l)}catch{}if(h)for(var p in h.contents)throw new u.ErrnoError(55)}delete i.parent.contents[i.name],i.parent.timestamp=Date.now(),i.name=l,s.contents[l]=i,s.timestamp=i.parent.timestamp},unlink(i,s){delete i.contents[s],i.timestamp=Date.now()},rmdir(i,s){var l=u.lookupNode(i,s);for(var h in l.contents)throw new u.ErrnoError(55);delete i.contents[s],i.timestamp=Date.now()},readdir(i){var s=[".",".."];for(var l of Object.keys(i.contents))s.push(l);return s},symlink(i,s,l){var h=L.createNode(i,s,41471,0);return h.link=l,h},readlink(i){if(!u.isLink(i.mode))throw new u.ErrnoError(28);return i.link}},stream_ops:{read(i,s,l,h,p){var b=i.node.contents;if(p>=i.node.usedBytes)return 0;var v=Math.min(i.node.usedBytes-p,h);if(T(v>=0),v>8&&b.subarray)s.set(b.subarray(p,p+v),l);else for(var y=0;y<v;y++)s[l+y]=b[p+y];return v},write(i,s,l,h,p,b){if(T(!(s instanceof ArrayBuffer)),s.buffer===X.buffer&&(b=!1),!h)return 0;var v=i.node;if(v.timestamp=Date.now(),s.subarray&&(!v.contents||v.contents.subarray)){if(b)return T(p===0,"canOwn must imply no weird position inside the file"),v.contents=s.subarray(l,l+h),v.usedBytes=h,h;if(v.usedBytes===0&&p===0)return v.contents=s.slice(l,l+h),v.usedBytes=h,h;if(p+h<=v.usedBytes)return v.contents.set(s.subarray(l,l+h),p),h}if(L.expandFileStorage(v,p+h),v.contents.subarray&&s.subarray)v.contents.set(s.subarray(l,l+h),p);else for(var y=0;y<h;y++)v.contents[p+y]=s[l+y];return v.usedBytes=Math.max(v.usedBytes,p+h),h},llseek(i,s,l){var h=s;if(l===1?h+=i.position:l===2&&u.isFile(i.node.mode)&&(h+=i.node.usedBytes),h<0)throw new u.ErrnoError(28);return h},allocate(i,s,l){L.expandFileStorage(i.node,s+l),i.node.usedBytes=Math.max(i.node.usedBytes,s+l)},mmap(i,s,l,h,p){if(!u.isFile(i.node.mode))throw new u.ErrnoError(43);var b,v,y=i.node.contents;if(!(p&2)&&y&&y.buffer===X.buffer)v=!1,b=y.byteOffset;else{if(v=!0,b=qi(),!b)throw new u.ErrnoError(48);y&&((l>0||l+s<y.length)&&(y.subarray?y=y.subarray(l,l+s):y=Array.prototype.slice.call(y,l,l+s)),X.set(y,b))}return{ptr:b,allocated:v}},msync(i,s,l,h,p){return L.stream_ops.write(i,s,0,h,l,!1),0}}},ga=(i,s,l,h)=>{var p=Ii(`al ${i}`);x(i).then(b=>{T(b,`Loading data file "${i}" failed (no arrayBuffer).`),s(new Uint8Array(b)),p&&Sr(p)},b=>{if(l)l();else throw`Loading data file "${i}" failed.`}),p&&an(p)},wa=(i,s,l,h,p,b)=>{u.createDataFile(i,s,l,h,p,b)},ba=n.preloadPlugins||[],va=(i,s,l,h)=>{typeof Browser<"u"&&Browser.init();var p=!1;return ba.forEach(b=>{p||b.canHandle(s)&&(b.handle(i,s,l,h),p=!0)}),p},ka=(i,s,l,h,p,b,v,y,N,W)=>{var ee=s?Je.resolve(re.join2(i,s)):i,Z=Ii(`cp ${ee}`);function ne(D){function J(ue){W==null||W(),y||wa(i,s,ue,h,p,N),b==null||b(),Sr(Z)}va(D,ee,J,()=>{v==null||v(),Sr(Z)})||J(D)}an(Z),typeof l=="string"?ga(l,ne,v):ne(l)},ya=i=>{var s={r:0,"r+":2,w:577,"w+":578,a:1089,"a+":1090},l=s[i];if(typeof l>"u")throw new Error(`Unknown file open mode: ${i}`);return l},hn=(i,s)=>{var l=0;return i&&(l|=365),s&&(l|=146),l},_a=i=>Ct(Na(i)),Yi={EPERM:63,ENOENT:44,ESRCH:71,EINTR:27,EIO:29,ENXIO:60,E2BIG:1,ENOEXEC:45,EBADF:8,ECHILD:12,EAGAIN:6,EWOULDBLOCK:6,ENOMEM:48,EACCES:2,EFAULT:21,ENOTBLK:105,EBUSY:10,EEXIST:20,EXDEV:75,ENODEV:43,ENOTDIR:54,EISDIR:31,EINVAL:28,ENFILE:41,EMFILE:33,ENOTTY:59,ETXTBSY:74,EFBIG:22,ENOSPC:51,ESPIPE:70,EROFS:69,EMLINK:34,EPIPE:64,EDOM:18,ERANGE:68,ENOMSG:49,EIDRM:24,ECHRNG:106,EL2NSYNC:156,EL3HLT:107,EL3RST:108,ELNRNG:109,EUNATCH:110,ENOCSI:111,EL2HLT:112,EDEADLK:16,ENOLCK:46,EBADE:113,EBADR:114,EXFULL:115,ENOANO:104,EBADRQC:103,EBADSLT:102,EDEADLOCK:16,EBFONT:101,ENOSTR:100,ENODATA:116,ETIME:117,ENOSR:118,ENONET:119,ENOPKG:120,EREMOTE:121,ENOLINK:47,EADV:122,ESRMNT:123,ECOMM:124,EPROTO:65,EMULTIHOP:36,EDOTDOT:125,EBADMSG:9,ENOTUNIQ:126,EBADFD:127,EREMCHG:128,ELIBACC:129,ELIBBAD:130,ELIBSCN:131,ELIBMAX:132,ELIBEXEC:133,ENOSYS:52,ENOTEMPTY:55,ENAMETOOLONG:37,ELOOP:32,EOPNOTSUPP:138,EPFNOSUPPORT:139,ECONNRESET:15,ENOBUFS:42,EAFNOSUPPORT:5,EPROTOTYPE:67,ENOTSOCK:57,ENOPROTOOPT:50,ESHUTDOWN:140,ECONNREFUSED:14,EADDRINUSE:3,ECONNABORTED:13,ENETUNREACH:40,ENETDOWN:38,ETIMEDOUT:73,EHOSTDOWN:142,EHOSTUNREACH:23,EINPROGRESS:26,EALREADY:7,EDESTADDRREQ:17,EMSGSIZE:35,EPROTONOSUPPORT:66,ESOCKTNOSUPPORT:137,EADDRNOTAVAIL:4,ENETRESET:39,EISCONN:30,ENOTCONN:53,ETOOMANYREFS:141,EUSERS:136,EDQUOT:19,ESTALE:72,ENOTSUP:138,ENOMEDIUM:148,EILSEQ:25,EOVERFLOW:61,ECANCELED:11,ENOTRECOVERABLE:56,EOWNERDEAD:62,ESTRPIPE:135},u={root:null,mounts:[],devices:{},streams:[],nextInode:1,nameTable:null,currentPath:"/",initialized:!1,ignorePermissions:!0,ErrnoError:class extends Error{constructor(s){super(Er?_a(s):"");F(this,"name","ErrnoError");this.errno=s;for(var l in Yi)if(Yi[l]===s){this.code=l;break}}},filesystems:null,syncFSRequests:0,readFiles:{},FSStream:class{constructor(){F(this,"shared",{})}get object(){return this.node}set object(i){this.node=i}get isRead(){return(this.flags&2097155)!==1}get isWrite(){return(this.flags&2097155)!==0}get isAppend(){return this.flags&1024}get flags(){return this.shared.flags}set flags(i){this.shared.flags=i}get position(){return this.shared.position}set position(i){this.shared.position=i}},FSNode:class{constructor(i,s,l,h){F(this,"node_ops",{});F(this,"stream_ops",{});F(this,"readMode",365);F(this,"writeMode",146);F(this,"mounted",null);i||(i=this),this.parent=i,this.mount=i.mount,this.id=u.nextInode++,this.name=s,this.mode=l,this.rdev=h}get read(){return(this.mode&this.readMode)===this.readMode}set read(i){i?this.mode|=this.readMode:this.mode&=~this.readMode}get write(){return(this.mode&this.writeMode)===this.writeMode}set write(i){i?this.mode|=this.writeMode:this.mode&=~this.writeMode}get isFolder(){return u.isDir(this.mode)}get isDevice(){return u.isChrdev(this.mode)}},lookupPath(i,s={}){if(i=Je.resolve(i),!i)return{path:"",node:null};var l={follow_mount:!0,recurse_count:0};if(s=Object.assign(l,s),s.recurse_count>8)throw new u.ErrnoError(32);for(var h=i.split("/").filter(Z=>!!Z),p=u.root,b="/",v=0;v<h.length;v++){var y=v===h.length-1;if(y&&s.parent)break;if(p=u.lookupNode(p,h[v]),b=re.join2(b,h[v]),u.isMountpoint(p)&&(!y||y&&s.follow_mount)&&(p=p.mounted.root),!y||s.follow)for(var N=0;u.isLink(p.mode);){var W=u.readlink(b);b=Je.resolve(re.dirname(b),W);var ee=u.lookupPath(b,{recurse_count:s.recurse_count+1});if(p=ee.node,N++>40)throw new u.ErrnoError(32)}}return{path:b,node:p}},getPath(i){for(var s;;){if(u.isRoot(i)){var l=i.mount.mountpoint;return s?l[l.length-1]!=="/"?`${l}/${s}`:l+s:l}s=s?`${i.name}/${s}`:i.name,i=i.parent}},hashName(i,s){for(var l=0,h=0;h<s.length;h++)l=(l<<5)-l+s.charCodeAt(h)|0;return(i+l>>>0)%u.nameTable.length},hashAddNode(i){var s=u.hashName(i.parent.id,i.name);i.name_next=u.nameTable[s],u.nameTable[s]=i},hashRemoveNode(i){var s=u.hashName(i.parent.id,i.name);if(u.nameTable[s]===i)u.nameTable[s]=i.name_next;else for(var l=u.nameTable[s];l;){if(l.name_next===i){l.name_next=i.name_next;break}l=l.name_next}},lookupNode(i,s){var l=u.mayLookup(i);if(l)throw new u.ErrnoError(l);for(var h=u.hashName(i.id,s),p=u.nameTable[h];p;p=p.name_next){var b=p.name;if(p.parent.id===i.id&&b===s)return p}return u.lookup(i,s)},createNode(i,s,l,h){T(typeof i=="object");var p=new u.FSNode(i,s,l,h);return u.hashAddNode(p),p},destroyNode(i){u.hashRemoveNode(i)},isRoot(i){return i===i.parent},isMountpoint(i){return!!i.mounted},isFile(i){return(i&61440)===32768},isDir(i){return(i&61440)===16384},isLink(i){return(i&61440)===40960},isChrdev(i){return(i&61440)===8192},isBlkdev(i){return(i&61440)===24576},isFIFO(i){return(i&61440)===4096},isSocket(i){return(i&49152)===49152},flagsToPermissionString(i){var s=["r","w","rw"][i&3];return i&512&&(s+="w"),s},nodePermissions(i,s){return u.ignorePermissions?0:s.includes("r")&&!(i.mode&292)||s.includes("w")&&!(i.mode&146)||s.includes("x")&&!(i.mode&73)?2:0},mayLookup(i){if(!u.isDir(i.mode))return 54;var s=u.nodePermissions(i,"x");return s||(i.node_ops.lookup?0:2)},mayCreate(i,s){try{var l=u.lookupNode(i,s);return 20}catch{}return u.nodePermissions(i,"wx")},mayDelete(i,s,l){var h;try{h=u.lookupNode(i,s)}catch(b){return b.errno}var p=u.nodePermissions(i,"wx");if(p)return p;if(l){if(!u.isDir(h.mode))return 54;if(u.isRoot(h)||u.getPath(h)===u.cwd())return 10}else if(u.isDir(h.mode))return 31;return 0},mayOpen(i,s){return i?u.isLink(i.mode)?32:u.isDir(i.mode)&&(u.flagsToPermissionString(s)!=="r"||s&512)?31:u.nodePermissions(i,u.flagsToPermissionString(s)):44},MAX_OPEN_FDS:4096,nextfd(){for(var i=0;i<=u.MAX_OPEN_FDS;i++)if(!u.streams[i])return i;throw new u.ErrnoError(33)},getStreamChecked(i){var s=u.getStream(i);if(!s)throw new u.ErrnoError(8);return s},getStream:i=>u.streams[i],createStream(i,s=-1){return T(s>=-1),i=Object.assign(new u.FSStream,i),s==-1&&(s=u.nextfd()),i.fd=s,u.streams[s]=i,i},closeStream(i){u.streams[i]=null},dupStream(i,s=-1){var h,p;var l=u.createStream(i,s);return(p=(h=l.stream_ops)==null?void 0:h.dup)==null||p.call(h,l),l},chrdev_stream_ops:{open(i){var l,h;var s=u.getDevice(i.node.rdev);i.stream_ops=s.stream_ops,(h=(l=i.stream_ops).open)==null||h.call(l,i)},llseek(){throw new u.ErrnoError(70)}},major:i=>i>>8,minor:i=>i&255,makedev:(i,s)=>i<<8|s,registerDevice(i,s){u.devices[i]={stream_ops:s}},getDevice:i=>u.devices[i],getMounts(i){for(var s=[],l=[i];l.length;){var h=l.pop();s.push(h),l.push(...h.mounts)}return s},syncfs(i,s){typeof i=="function"&&(s=i,i=!1),u.syncFSRequests++,u.syncFSRequests>1&&H(`warning: ${u.syncFSRequests} FS.syncfs operations in flight at once, probably just doing extra work`);var l=u.getMounts(u.root.mount),h=0;function p(v){return T(u.syncFSRequests>0),u.syncFSRequests--,s(v)}function b(v){if(v)return b.errored?void 0:(b.errored=!0,p(v));++h>=l.length&&p(null)}l.forEach(v=>{if(!v.type.syncfs)return b(null);v.type.syncfs(v,i,b)})},mount(i,s,l){if(typeof i=="string")throw i;var h=l==="/",p=!l,b;if(h&&u.root)throw new u.ErrnoError(10);if(!h&&!p){var v=u.lookupPath(l,{follow_mount:!1});if(l=v.path,b=v.node,u.isMountpoint(b))throw new u.ErrnoError(10);if(!u.isDir(b.mode))throw new u.ErrnoError(54)}var y={type:i,opts:s,mountpoint:l,mounts:[]},N=i.mount(y);return N.mount=y,y.root=N,h?u.root=N:b&&(b.mounted=y,b.mount&&b.mount.mounts.push(y)),N},unmount(i){var s=u.lookupPath(i,{follow_mount:!1});if(!u.isMountpoint(s.node))throw new u.ErrnoError(28);var l=s.node,h=l.mounted,p=u.getMounts(h);Object.keys(u.nameTable).forEach(v=>{for(var y=u.nameTable[v];y;){var N=y.name_next;p.includes(y.mount)&&u.destroyNode(y),y=N}}),l.mounted=null;var b=l.mount.mounts.indexOf(h);T(b!==-1),l.mount.mounts.splice(b,1)},lookup(i,s){return i.node_ops.lookup(i,s)},mknod(i,s,l){var h=u.lookupPath(i,{parent:!0}),p=h.node,b=re.basename(i);if(!b||b==="."||b==="..")throw new u.ErrnoError(28);var v=u.mayCreate(p,b);if(v)throw new u.ErrnoError(v);if(!p.node_ops.mknod)throw new u.ErrnoError(63);return p.node_ops.mknod(p,b,s,l)},statfs(i){var s={bsize:4096,frsize:4096,blocks:1e6,bfree:5e5,bavail:5e5,files:u.nextInode,ffree:u.nextInode-1,fsid:42,flags:2,namelen:255},l=u.lookupPath(i,{follow:!0}).node;return l!=null&&l.node_ops.statfs&&Object.assign(s,l.node_ops.statfs(l.mount.opts.root)),s},create(i,s=438){return s&=4095,s|=32768,u.mknod(i,s,0)},mkdir(i,s=511){return s&=1023,s|=16384,u.mknod(i,s,0)},mkdirTree(i,s){for(var l=i.split("/"),h="",p=0;p<l.length;++p)if(l[p]){h+="/"+l[p];try{u.mkdir(h,s)}catch(b){if(b.errno!=20)throw b}}},mkdev(i,s,l){return typeof l>"u"&&(l=s,s=438),s|=8192,u.mknod(i,s,l)},symlink(i,s){if(!Je.resolve(i))throw new u.ErrnoError(44);var l=u.lookupPath(s,{parent:!0}),h=l.node;if(!h)throw new u.ErrnoError(44);var p=re.basename(s),b=u.mayCreate(h,p);if(b)throw new u.ErrnoError(b);if(!h.node_ops.symlink)throw new u.ErrnoError(63);return h.node_ops.symlink(h,p,i)},rename(i,s){var l=re.dirname(i),h=re.dirname(s),p=re.basename(i),b=re.basename(s),v,y,N;if(v=u.lookupPath(i,{parent:!0}),y=v.node,v=u.lookupPath(s,{parent:!0}),N=v.node,!y||!N)throw new u.ErrnoError(44);if(y.mount!==N.mount)throw new u.ErrnoError(75);var W=u.lookupNode(y,p),ee=Je.relative(i,h);if(ee.charAt(0)!==".")throw new u.ErrnoError(28);if(ee=Je.relative(s,l),ee.charAt(0)!==".")throw new u.ErrnoError(55);var Z;try{Z=u.lookupNode(N,b)}catch{}if(W!==Z){var ne=u.isDir(W.mode),D=u.mayDelete(y,p,ne);if(D)throw new u.ErrnoError(D);if(D=Z?u.mayDelete(N,b,ne):u.mayCreate(N,b),D)throw new u.ErrnoError(D);if(!y.node_ops.rename)throw new u.ErrnoError(63);if(u.isMountpoint(W)||Z&&u.isMountpoint(Z))throw new u.ErrnoError(10);if(N!==y&&(D=u.nodePermissions(y,"w"),D))throw new u.ErrnoError(D);u.hashRemoveNode(W);try{y.node_ops.rename(W,N,b),W.parent=N}catch(J){throw J}finally{u.hashAddNode(W)}}},rmdir(i){var s=u.lookupPath(i,{parent:!0}),l=s.node,h=re.basename(i),p=u.lookupNode(l,h),b=u.mayDelete(l,h,!0);if(b)throw new u.ErrnoError(b);if(!l.node_ops.rmdir)throw new u.ErrnoError(63);if(u.isMountpoint(p))throw new u.ErrnoError(10);l.node_ops.rmdir(l,h),u.destroyNode(p)},readdir(i){var s=u.lookupPath(i,{follow:!0}),l=s.node;if(!l.node_ops.readdir)throw new u.ErrnoError(54);return l.node_ops.readdir(l)},unlink(i){var s=u.lookupPath(i,{parent:!0}),l=s.node;if(!l)throw new u.ErrnoError(44);var h=re.basename(i),p=u.lookupNode(l,h),b=u.mayDelete(l,h,!1);if(b)throw new u.ErrnoError(b);if(!l.node_ops.unlink)throw new u.ErrnoError(63);if(u.isMountpoint(p))throw new u.ErrnoError(10);l.node_ops.unlink(l,h),u.destroyNode(p)},readlink(i){var s=u.lookupPath(i),l=s.node;if(!l)throw new u.ErrnoError(44);if(!l.node_ops.readlink)throw new u.ErrnoError(28);return l.node_ops.readlink(l)},stat(i,s){var l=u.lookupPath(i,{follow:!s}),h=l.node;if(!h)throw new u.ErrnoError(44);if(!h.node_ops.getattr)throw new u.ErrnoError(63);return h.node_ops.getattr(h)},lstat(i){return u.stat(i,!0)},chmod(i,s,l){var h;if(typeof i=="string"){var p=u.lookupPath(i,{follow:!l});h=p.node}else h=i;if(!h.node_ops.setattr)throw new u.ErrnoError(63);h.node_ops.setattr(h,{mode:s&4095|h.mode&-4096,timestamp:Date.now()})},lchmod(i,s){u.chmod(i,s,!0)},fchmod(i,s){var l=u.getStreamChecked(i);u.chmod(l.node,s)},chown(i,s,l,h){var p;if(typeof i=="string"){var b=u.lookupPath(i,{follow:!h});p=b.node}else p=i;if(!p.node_ops.setattr)throw new u.ErrnoError(63);p.node_ops.setattr(p,{timestamp:Date.now()})},lchown(i,s,l){u.chown(i,s,l,!0)},fchown(i,s,l){var h=u.getStreamChecked(i);u.chown(h.node,s,l)},truncate(i,s){if(s<0)throw new u.ErrnoError(28);var l;if(typeof i=="string"){var h=u.lookupPath(i,{follow:!0});l=h.node}else l=i;if(!l.node_ops.setattr)throw new u.ErrnoError(63);if(u.isDir(l.mode))throw new u.ErrnoError(31);if(!u.isFile(l.mode))throw new u.ErrnoError(28);var p=u.nodePermissions(l,"w");if(p)throw new u.ErrnoError(p);l.node_ops.setattr(l,{size:s,timestamp:Date.now()})},ftruncate(i,s){var l=u.getStreamChecked(i);if(!(l.flags&2097155))throw new u.ErrnoError(28);u.truncate(l.node,s)},utime(i,s,l){var h=u.lookupPath(i,{follow:!0}),p=h.node;p.node_ops.setattr(p,{timestamp:Math.max(s,l)})},open(i,s,l=438){if(i==="")throw new u.ErrnoError(44);s=typeof s=="string"?ya(s):s,s&64?l=l&4095|32768:l=0;var h;if(typeof i=="object")h=i;else{i=re.normalize(i);try{var p=u.lookupPath(i,{follow:!(s&131072)});h=p.node}catch{}}var b=!1;if(s&64)if(h){if(s&128)throw new u.ErrnoError(20)}else h=u.mknod(i,l,0),b=!0;if(!h)throw new u.ErrnoError(44);if(u.isChrdev(h.mode)&&(s&=-513),s&65536&&!u.isDir(h.mode))throw new u.ErrnoError(54);if(!b){var v=u.mayOpen(h,s);if(v)throw new u.ErrnoError(v)}s&512&&!b&&u.truncate(h,0),s&=-131713;var y=u.createStream({node:h,path:u.getPath(h),flags:s,seekable:!0,position:0,stream_ops:h.stream_ops,ungotten:[],error:!1});return y.stream_ops.open&&y.stream_ops.open(y),n.logReadFiles&&!(s&1)&&(i in u.readFiles||(u.readFiles[i]=1)),y},close(i){if(u.isClosed(i))throw new u.ErrnoError(8);i.getdents&&(i.getdents=null);try{i.stream_ops.close&&i.stream_ops.close(i)}catch(s){throw s}finally{u.closeStream(i.fd)}i.fd=null},isClosed(i){return i.fd===null},llseek(i,s,l){if(u.isClosed(i))throw new u.ErrnoError(8);if(!i.seekable||!i.stream_ops.llseek)throw new u.ErrnoError(70);if(l!=0&&l!=1&&l!=2)throw new u.ErrnoError(28);return i.position=i.stream_ops.llseek(i,s,l),i.ungotten=[],i.position},read(i,s,l,h,p){if(T(l>=0),h<0||p<0)throw new u.ErrnoError(28);if(u.isClosed(i))throw new u.ErrnoError(8);if((i.flags&2097155)===1)throw new u.ErrnoError(8);if(u.isDir(i.node.mode))throw new u.ErrnoError(31);if(!i.stream_ops.read)throw new u.ErrnoError(28);var b=typeof p<"u";if(!b)p=i.position;else if(!i.seekable)throw new u.ErrnoError(70);var v=i.stream_ops.read(i,s,l,h,p);return b||(i.position+=v),v},write(i,s,l,h,p,b){if(T(l>=0),h<0||p<0)throw new u.ErrnoError(28);if(u.isClosed(i))throw new u.ErrnoError(8);if(!(i.flags&2097155))throw new u.ErrnoError(8);if(u.isDir(i.node.mode))throw new u.ErrnoError(31);if(!i.stream_ops.write)throw new u.ErrnoError(28);i.seekable&&i.flags&1024&&u.llseek(i,0,2);var v=typeof p<"u";if(!v)p=i.position;else if(!i.seekable)throw new u.ErrnoError(70);var y=i.stream_ops.write(i,s,l,h,p,b);return v||(i.position+=y),y},allocate(i,s,l){if(u.isClosed(i))throw new u.ErrnoError(8);if(s<0||l<=0)throw new u.ErrnoError(28);if(!(i.flags&2097155))throw new u.ErrnoError(8);if(!u.isFile(i.node.mode)&&!u.isDir(i.node.mode))throw new u.ErrnoError(43);if(!i.stream_ops.allocate)throw new u.ErrnoError(138);i.stream_ops.allocate(i,s,l)},mmap(i,s,l,h,p){if(h&2&&!(p&2)&&(i.flags&2097155)!==2)throw new u.ErrnoError(2);if((i.flags&2097155)===1)throw new u.ErrnoError(2);if(!i.stream_ops.mmap)throw new u.ErrnoError(43);if(!s)throw new u.ErrnoError(28);return i.stream_ops.mmap(i,s,l,h,p)},msync(i,s,l,h,p){return T(l>=0),i.stream_ops.msync?i.stream_ops.msync(i,s,l,h,p):0},ioctl(i,s,l){if(!i.stream_ops.ioctl)throw new u.ErrnoError(59);return i.stream_ops.ioctl(i,s,l)},readFile(i,s={}){if(s.flags=s.flags||0,s.encoding=s.encoding||"binary",s.encoding!=="utf8"&&s.encoding!=="binary")throw new Error(`Invalid encoding type "${s.encoding}"`);var l,h=u.open(i,s.flags),p=u.stat(i),b=p.size,v=new Uint8Array(b);return u.read(h,v,0,b,0),s.encoding==="utf8"?l=At(v):s.encoding==="binary"&&(l=v),u.close(h),l},writeFile(i,s,l={}){l.flags=l.flags||577;var h=u.open(i,l.flags,l.mode);if(typeof s=="string"){var p=new Uint8Array(Ar(s)+1),b=cn(s,p,0,p.length);u.write(h,p,0,b,void 0,l.canOwn)}else if(ArrayBuffer.isView(s))u.write(h,s,0,s.byteLength,void 0,l.canOwn);else throw new Error("Unsupported data type");u.close(h)},cwd:()=>u.currentPath,chdir(i){var s=u.lookupPath(i,{follow:!0});if(s.node===null)throw new u.ErrnoError(44);if(!u.isDir(s.node.mode))throw new u.ErrnoError(54);var l=u.nodePermissions(s.node,"x");if(l)throw new u.ErrnoError(l);u.currentPath=s.path},createDefaultDirectories(){u.mkdir("/tmp"),u.mkdir("/home"),u.mkdir("/home/web_user")},createDefaultDevices(){u.mkdir("/dev"),u.registerDevice(u.makedev(1,3),{read:()=>0,write:(h,p,b,v,y)=>v,llseek:()=>0}),u.mkdev("/dev/null",u.makedev(1,3)),ft.register(u.makedev(5,0),ft.default_tty_ops),ft.register(u.makedev(6,0),ft.default_tty1_ops),u.mkdev("/dev/tty",u.makedev(5,0)),u.mkdev("/dev/tty1",u.makedev(6,0));var i=new Uint8Array(1024),s=0,l=()=>(s===0&&(s=Gi(i).byteLength),i[--s]);u.createDevice("/dev","random",l),u.createDevice("/dev","urandom",l),u.mkdir("/dev/shm"),u.mkdir("/dev/shm/tmp")},createSpecialDirectories(){u.mkdir("/proc");var i=u.mkdir("/proc/self");u.mkdir("/proc/self/fd"),u.mount({mount(){var s=u.createNode(i,"fd",16895,73);return s.node_ops={lookup(l,h){var p=+h,b=u.getStreamChecked(p),v={parent:null,mount:{mountpoint:"fake"},node_ops:{readlink:()=>b.path}};return v.parent=v,v}},s}},{},"/proc/self/fd")},createStandardStreams(i,s,l){i?u.createDevice("/dev","stdin",i):u.symlink("/dev/tty","/dev/stdin"),s?u.createDevice("/dev","stdout",null,s):u.symlink("/dev/tty","/dev/stdout"),l?u.createDevice("/dev","stderr",null,l):u.symlink("/dev/tty1","/dev/stderr");var h=u.open("/dev/stdin",0),p=u.open("/dev/stdout",1),b=u.open("/dev/stderr",1);T(h.fd===0,`invalid handle for stdin (${h.fd})`),T(p.fd===1,`invalid handle for stdout (${p.fd})`),T(b.fd===2,`invalid handle for stderr (${b.fd})`)},staticInit(){u.nameTable=new Array(4096),u.mount(L,{},"/"),u.createDefaultDirectories(),u.createDefaultDevices(),u.createSpecialDirectories(),u.filesystems={MEMFS:L}},init(i,s,l){T(!u.initialized,"FS.init was previously called. If you want to initialize later with custom parameters, remove any earlier calls (note that one is automatically added to the generated code)"),u.initialized=!0,i??(i=n.stdin),s??(s=n.stdout),l??(l=n.stderr),u.createStandardStreams(i,s,l)},quit(){u.initialized=!1,Ma(0);for(var i=0;i<u.streams.length;i++){var s=u.streams[i];s&&u.close(s)}},findObject(i,s){var l=u.analyzePath(i,s);return l.exists?l.object:null},analyzePath(i,s){try{var l=u.lookupPath(i,{follow:!s});i=l.path}catch{}var h={isRoot:!1,exists:!1,error:0,name:null,path:null,object:null,parentExists:!1,parentPath:null,parentObject:null};try{var l=u.lookupPath(i,{parent:!0});h.parentExists=!0,h.parentPath=l.path,h.parentObject=l.node,h.name=re.basename(i),l=u.lookupPath(i,{follow:!s}),h.exists=!0,h.path=l.path,h.object=l.node,h.name=l.node.name,h.isRoot=l.path==="/"}catch(p){h.error=p.errno}return h},createPath(i,s,l,h){i=typeof i=="string"?i:u.getPath(i);for(var p=s.split("/").reverse();p.length;){var b=p.pop();if(b){var v=re.join2(i,b);try{u.mkdir(v)}catch{}i=v}}return v},createFile(i,s,l,h,p){var b=re.join2(typeof i=="string"?i:u.getPath(i),s),v=hn(h,p);return u.create(b,v)},createDataFile(i,s,l,h,p,b){var v=s;i&&(i=typeof i=="string"?i:u.getPath(i),v=s?re.join2(i,s):i);var y=hn(h,p),N=u.create(v,y);if(l){if(typeof l=="string"){for(var W=new Array(l.length),ee=0,Z=l.length;ee<Z;++ee)W[ee]=l.charCodeAt(ee);l=W}u.chmod(N,y|146);var ne=u.open(N,577);u.write(ne,l,0,l.length,0,b),u.close(ne),u.chmod(N,y)}},createDevice(i,s,l,h){var y;var p=re.join2(typeof i=="string"?i:u.getPath(i),s),b=hn(!!l,!!h);(y=u.createDevice).major??(y.major=64);var v=u.makedev(u.createDevice.major++,0);return u.registerDevice(v,{open(N){N.seekable=!1},close(N){var W;(W=h==null?void 0:h.buffer)!=null&&W.length&&h(10)},read(N,W,ee,Z,ne){for(var D=0,J=0;J<Z;J++){var ue;try{ue=l()}catch{throw new u.ErrnoError(29)}if(ue===void 0&&D===0)throw new u.ErrnoError(6);if(ue==null)break;D++,W[ee+J]=ue}return D&&(N.node.timestamp=Date.now()),D},write(N,W,ee,Z,ne){for(var D=0;D<Z;D++)try{h(W[ee+D])}catch{throw new u.ErrnoError(29)}return Z&&(N.node.timestamp=Date.now()),D}}),u.mkdev(p,b,v)},forceLoadFile(i){if(i.isDevice||i.isFolder||i.link||i.contents)return!0;if(typeof XMLHttpRequest<"u")throw new Error("Lazy loading should have been performed (contents set) in createLazyFile, but it was not. Lazy loading only works in web workers. Use --embed-file or --preload-file in emcc on the main thread.");try{i.contents=R(i.url),i.usedBytes=i.contents.length}catch{throw new u.ErrnoError(29)}},createLazyFile(i,s,l,h,p){class b{constructor(){F(this,"lengthKnown",!1);F(this,"chunks",[])}get(D){if(!(D>this.length-1||D<0)){var J=D%this.chunkSize,ue=D/this.chunkSize|0;return this.getter(ue)[J]}}setDataGetter(D){this.getter=D}cacheLength(){var D=new XMLHttpRequest;if(D.open("HEAD",l,!1),D.send(null),!(D.status>=200&&D.status<300||D.status===304))throw new Error("Couldn't load "+l+". Status: "+D.status);var J=Number(D.getResponseHeader("Content-length")),ue,Ne=(ue=D.getResponseHeader("Accept-Ranges"))&&ue==="bytes",Re=(ue=D.getResponseHeader("Content-Encoding"))&&ue==="gzip",xe=1024*1024;Ne||(xe=J);var Ie=(Be,Pt)=>{if(Be>Pt)throw new Error("invalid range ("+Be+", "+Pt+") or no bytes requested!");if(Pt>J-1)throw new Error("only "+J+" bytes available! programmer error!");var we=new XMLHttpRequest;if(we.open("GET",l,!1),J!==xe&&we.setRequestHeader("Range","bytes="+Be+"-"+Pt),we.responseType="arraybuffer",we.overrideMimeType&&we.overrideMimeType("text/plain; charset=x-user-defined"),we.send(null),!(we.status>=200&&we.status<300||we.status===304))throw new Error("Couldn't load "+l+". Status: "+we.status);return we.response!==void 0?new Uint8Array(we.response||[]):Vi(we.responseText||"")},ir=this;ir.setDataGetter(Be=>{var Pt=Be*xe,we=(Be+1)*xe-1;if(we=Math.min(we,J-1),typeof ir.chunks[Be]>"u"&&(ir.chunks[Be]=Ie(Pt,we)),typeof ir.chunks[Be]>"u")throw new Error("doXHR failed!");return ir.chunks[Be]}),(Re||!J)&&(xe=J=1,J=this.getter(0).length,xe=J,q("LazyFiles on gzip forces download of the whole file when length is accessed")),this._length=J,this._chunkSize=xe,this.lengthKnown=!0}get length(){return this.lengthKnown||this.cacheLength(),this._length}get chunkSize(){return this.lengthKnown||this.cacheLength(),this._chunkSize}}if(typeof XMLHttpRequest<"u"){if(!d)throw"Cannot do synchronous binary XHRs outside webworkers in modern browsers. Use --embed-file or --preload-file in emcc";var v=new b,y={isDevice:!1,contents:v}}else var y={isDevice:!1,url:l};var N=u.createFile(i,s,y,h,p);y.contents?N.contents=y.contents:y.url&&(N.contents=null,N.url=y.url),Object.defineProperties(N,{usedBytes:{get:function(){return this.contents.length}}});var W={},ee=Object.keys(N.stream_ops);ee.forEach(ne=>{var D=N.stream_ops[ne];W[ne]=(...J)=>(u.forceLoadFile(N),D(...J))});function Z(ne,D,J,ue,Ne){var Re=ne.node.contents;if(Ne>=Re.length)return 0;var xe=Math.min(Re.length-Ne,ue);if(T(xe>=0),Re.slice)for(var Ie=0;Ie<xe;Ie++)D[J+Ie]=Re[Ne+Ie];else for(var Ie=0;Ie<xe;Ie++)D[J+Ie]=Re.get(Ne+Ie);return xe}return W.read=(ne,D,J,ue,Ne)=>(u.forceLoadFile(N),Z(ne,D,J,ue,Ne)),W.mmap=(ne,D,J,ue,Ne)=>{u.forceLoadFile(N);var Re=qi();if(!Re)throw new u.ErrnoError(48);return Z(ne,X,Re,D,J),{ptr:Re,allocated:!0}},N.stream_ops=W,N},absolutePath(){oe("FS.absolutePath has been removed; use PATH_FS.resolve instead")},createFolder(){oe("FS.createFolder has been removed; use FS.mkdir instead")},createLink(){oe("FS.createLink has been removed; use FS.symlink instead")},joinPath(){oe("FS.joinPath has been removed; use PATH.join instead")},mmapAlloc(){oe("FS.mmapAlloc has been replaced by the top level function mmapAlloc")},standardizePath(){oe("FS.standardizePath has been removed; use PATH.normalize instead")}},nr={DEFAULT_POLLMASK:5,calculateAt(i,s,l){if(re.isAbs(s))return s;var h;if(i===-100)h=u.cwd();else{var p=nr.getStreamFromFD(i);h=p.path}if(s.length==0){if(!l)throw new u.ErrnoError(44);return h}return re.join2(h,s)},doStat(i,s,l){var h=i(s);ie[l>>2]=h.dev,ie[l+4>>2]=h.mode,B[l+8>>2]=h.nlink,ie[l+12>>2]=h.uid,ie[l+16>>2]=h.gid,ie[l+20>>2]=h.rdev,me=[h.size>>>0,(Y=h.size,+Math.abs(Y)>=1?Y>0?+Math.floor(Y/4294967296)>>>0:~~+Math.ceil((Y-+(~~Y>>>0))/4294967296)>>>0:0)],ie[l+24>>2]=me[0],ie[l+28>>2]=me[1],ie[l+32>>2]=4096,ie[l+36>>2]=h.blocks;var p=h.atime.getTime(),b=h.mtime.getTime(),v=h.ctime.getTime();return me=[Math.floor(p/1e3)>>>0,(Y=Math.floor(p/1e3),+Math.abs(Y)>=1?Y>0?+Math.floor(Y/4294967296)>>>0:~~+Math.ceil((Y-+(~~Y>>>0))/4294967296)>>>0:0)],ie[l+40>>2]=me[0],ie[l+44>>2]=me[1],B[l+48>>2]=p%1e3*1e3*1e3,me=[Math.floor(b/1e3)>>>0,(Y=Math.floor(b/1e3),+Math.abs(Y)>=1?Y>0?+Math.floor(Y/4294967296)>>>0:~~+Math.ceil((Y-+(~~Y>>>0))/4294967296)>>>0:0)],ie[l+56>>2]=me[0],ie[l+60>>2]=me[1],B[l+64>>2]=b%1e3*1e3*1e3,me=[Math.floor(v/1e3)>>>0,(Y=Math.floor(v/1e3),+Math.abs(Y)>=1?Y>0?+Math.floor(Y/4294967296)>>>0:~~+Math.ceil((Y-+(~~Y>>>0))/4294967296)>>>0:0)],ie[l+72>>2]=me[0],ie[l+76>>2]=me[1],B[l+80>>2]=v%1e3*1e3*1e3,me=[h.ino>>>0,(Y=h.ino,+Math.abs(Y)>=1?Y>0?+Math.floor(Y/4294967296)>>>0:~~+Math.ceil((Y-+(~~Y>>>0))/4294967296)>>>0:0)],ie[l+88>>2]=me[0],ie[l+92>>2]=me[1],0},doMsync(i,s,l,h,p){if(!u.isFile(s.node.mode))throw new u.ErrnoError(43);if(h&2)return 0;var b=He.slice(i,i+l);u.msync(s,b,p,l,h)},getStreamFromFD(i){var s=u.getStreamChecked(i);return s},varargs:void 0,getStr(i){var s=Ct(i);return s}};function Ea(i){try{var s=nr.getStreamFromFD(i);return u.close(s),0}catch(l){if(typeof u>"u"||l.name!=="ErrnoError")throw l;return l.errno}}var Sa=(i,s,l,h)=>{for(var p=0,b=0;b<l;b++){var v=B[s>>2],y=B[s+4>>2];s+=8;var N=u.read(i,X,v,y,h);if(N<0)return-1;if(p+=N,N<y)break}return p};function Aa(i,s,l,h){try{var p=nr.getStreamFromFD(i),b=Sa(p,s,l);return B[h>>2]=b,0}catch(v){if(typeof u>"u"||v.name!=="ErrnoError")throw v;return v.errno}}var Ca=(i,s)=>(T(i==i>>>0||i==(i|0)),T(s===(s|0)),s+2097152>>>0<4194305-!!i?(i>>>0)+s*4294967296:NaN);function Pa(i,s,l,h,p){var b=Ca(s,l);try{if(isNaN(b))return 61;var v=nr.getStreamFromFD(i);return u.llseek(v,b,h),me=[v.position>>>0,(Y=v.position,+Math.abs(Y)>=1?Y>0?+Math.floor(Y/4294967296)>>>0:~~+Math.ceil((Y-+(~~Y>>>0))/4294967296)>>>0:0)],ie[p>>2]=me[0],ie[p+4>>2]=me[1],v.getdents&&b===0&&h===0&&(v.getdents=null),0}catch(y){if(typeof u>"u"||y.name!=="ErrnoError")throw y;return y.errno}}var Ta=(i,s,l,h)=>{for(var p=0,b=0;b<l;b++){var v=B[s>>2],y=B[s+4>>2];s+=8;var N=u.write(i,X,v,y,h);if(N<0)return-1;if(p+=N,N<y)break}return p};function Ra(i,s,l,h){try{var p=nr.getStreamFromFD(i),b=Ta(p,s,l);return B[h>>2]=b,0}catch(v){if(typeof u>"u"||v.name!=="ErrnoError")throw v;return v.errno}}u.createPreloadedFile=ka,u.staticInit();function Oa(){Qs("fetchSettings")}var Qi={__assert_fail:ea,__cxa_throw:ra,_abort_js:na,_emscripten_memcpy_js:ia,_tzset_js:oa,emscripten_resize_heap:ca,environ_get:ha,environ_sizes_get:da,fd_close:Ea,fd_read:Aa,fd_seek:Pa,fd_write:Ra},ht=Ys();n._create_position=ce("create_position",1),n._delete_position=ce("delete_position",1),n._make_move=ce("make_move",2),n._unmake_move=ce("unmake_move",2),n._get_legal_moves=ce("get_legal_moves",2),n._malloc=ce("malloc",1),n._free_legal_moves=ce("free_legal_moves",1),n._free=ce("free",1),n._pos_attacks=ce("pos_attacks",3),n._get_pieces_bb=ce("get_pieces_bb",4),n._get_turn=ce("get_turn",1),n._get_at=ce("get_at",2),n._get_fen=ce("get_fen",1),n._is_checkmate=ce("is_checkmate",1),n._init=ce("init",0);var Ma=ce("fflush",1),Na=ce("strerror",1),Xi=()=>(Xi=ht.emscripten_stack_init)(),dn=()=>(dn=ht.emscripten_stack_get_end)();n.dynCall_viijii=ce("dynCall_viijii",7),n.dynCall_jiji=ce("dynCall_jiji",5),n.dynCall_iiiiij=ce("dynCall_iiiiij",7),n.dynCall_iiiiijj=ce("dynCall_iiiiijj",9),n.dynCall_iiiiiijj=ce("dynCall_iiiiiijj",10);var xa=["writeI53ToI64","writeI53ToI64Clamped","writeI53ToI64Signaling","writeI53ToU64Clamped","writeI53ToU64Signaling","readI53FromI64","readI53FromU64","convertI32PairToI53","convertU32PairToI53","stackAlloc","getTempRet0","setTempRet0","exitJS","inetPton4","inetNtop4","inetPton6","inetNtop6","readSockaddr","writeSockaddr","emscriptenLog","readEmAsmArgs","jstoi_q","listenOnce","autoResumeAudioContext","dynCallLegacy","getDynCaller","dynCall","handleException","keepRuntimeAlive","runtimeKeepalivePush","runtimeKeepalivePop","callUserCallback","maybeExit","asmjsMangle","HandleAllocator","getNativeTypeSize","STACK_SIZE","STACK_ALIGN","POINTER_SIZE","ASSERTIONS","getCFunc","ccall","cwrap","uleb128Encode","sigToWasmTypes","generateFuncType","convertJsFunctionToWasm","getEmptyTableSlot","updateTableMap","getFunctionAddress","addFunction","removeFunction","reallyNegative","unSign","strLen","reSign","formatString","intArrayToString","AsciiToString","UTF16ToString","stringToUTF16","lengthBytesUTF16","UTF32ToString","stringToUTF32","lengthBytesUTF32","stringToNewUTF8","stringToUTF8OnStack","writeArrayToMemory","registerKeyEventCallback","maybeCStringToJsString","findEventTarget","getBoundingClientRect","fillMouseEventData","registerMouseEventCallback","registerWheelEventCallback","registerUiEventCallback","registerFocusEventCallback","fillDeviceOrientationEventData","registerDeviceOrientationEventCallback","fillDeviceMotionEventData","registerDeviceMotionEventCallback","screenOrientation","fillOrientationChangeEventData","registerOrientationChangeEventCallback","fillFullscreenChangeEventData","registerFullscreenChangeEventCallback","JSEvents_requestFullscreen","JSEvents_resizeCanvasForFullscreen","registerRestoreOldStyle","hideEverythingExceptGivenElement","restoreHiddenElements","setLetterbox","softFullscreenResizeWebGLRenderTarget","doRequestFullscreen","fillPointerlockChangeEventData","registerPointerlockChangeEventCallback","registerPointerlockErrorEventCallback","requestPointerLock","fillVisibilityChangeEventData","registerVisibilityChangeEventCallback","registerTouchEventCallback","fillGamepadEventData","registerGamepadEventCallback","registerBeforeUnloadEventCallback","fillBatteryEventData","battery","registerBatteryEventCallback","setCanvasElementSize","getCanvasElementSize","jsStackTrace","getCallstack","convertPCtoSourceLocation","checkWasiClock","wasiRightsToMuslOFlags","wasiOFlagsToMuslOFlags","safeSetTimeout","setImmediateWrapped","safeRequestAnimationFrame","clearImmediateWrapped","polyfillSetImmediate","registerPostMainLoop","registerPreMainLoop","getPromise","makePromise","idsToPromises","makePromiseCallback","findMatchingCatch","Browser_asyncPrepareDataCounter","isLeapYear","ydayFromDate","arraySum","addDays","getSocketFromFD","getSocketAddress","FS_unlink","FS_mkdirTree","_setNetworkCallback","heapObjectForWebGLType","toTypedArrayIndex","webgl_enable_ANGLE_instanced_arrays","webgl_enable_OES_vertex_array_object","webgl_enable_WEBGL_draw_buffers","webgl_enable_WEBGL_multi_draw","webgl_enable_EXT_polygon_offset_clamp","webgl_enable_EXT_clip_control","webgl_enable_WEBGL_polygon_mode","emscriptenWebGLGet","computeUnpackAlignedImageSize","colorChannelsInGlTextureFormat","emscriptenWebGLGetTexPixelData","emscriptenWebGLGetUniform","webglGetUniformLocation","webglPrepareUniformLocationsBeforeFirstUse","webglGetLeftBracePos","emscriptenWebGLGetVertexAttrib","__glGetActiveAttribOrUniform","writeGLArray","registerWebGlEventCallback","runAndAbortIfError","ALLOC_NORMAL","ALLOC_STACK","allocate","writeStringToMemory","writeAsciiToMemory","setErrNo","demangle","stackTrace"];xa.forEach(Xs);var Fa=["run","addOnPreRun","addOnInit","addOnPreMain","addOnExit","addOnPostRun","addRunDependency","removeRunDependency","out","err","callMain","abort","wasmMemory","wasmExports","writeStackCookie","checkStackCookie","convertI32PairToI53Checked","stackSave","stackRestore","ptrToString","zeroMemory","getHeapMax","growMemory","ENV","ERRNO_CODES","strError","DNS","Protocols","Sockets","timers","warnOnce","readEmAsmArgsArray","jstoi_s","getExecutableName","asyncLoad","alignMemory","mmapAlloc","wasmTable","noExitRuntime","freeTableIndexes","functionsInTableMap","setValue","getValue","PATH","PATH_FS","UTF8Decoder","UTF8ArrayToString","UTF8ToString","stringToUTF8Array","stringToUTF8","lengthBytesUTF8","intArrayFromString","stringToAscii","UTF16Decoder","JSEvents","specialHTMLTargets","findCanvasEventTarget","currentFullscreenStrategy","restoreOldWindowedStyle","UNWIND_CACHE","ExitStatus","getEnvStrings","doReadv","doWritev","initRandomFill","randomFill","promiseMap","uncaughtExceptionCount","exceptionLast","exceptionCaught","ExceptionInfo","Browser","getPreloadedImageData__data","wget","MONTH_DAYS_REGULAR","MONTH_DAYS_LEAP","MONTH_DAYS_REGULAR_CUMULATIVE","MONTH_DAYS_LEAP_CUMULATIVE","SYSCALLS","preloadPlugins","FS_createPreloadedFile","FS_modeStringToFlags","FS_getMode","FS_stdin_getChar_buffer","FS_stdin_getChar","FS_createPath","FS_createDevice","FS_readFile","FS","FS_createDataFile","FS_createLazyFile","MEMFS","TTY","PIPEFS","SOCKFS","tempFixedLengthArray","miniTempWebGLFloatBuffers","miniTempWebGLIntBuffers","GL","AL","GLUT","EGL","GLEW","IDBStore","SDL","SDL_gfx","allocateUTF8","allocateUTF8OnStack","print","printErr"];Fa.forEach(Hi);var Cr;Xt=function i(){Cr||Ji(),Cr||(Xt=i)};function $a(){Xi(),Is()}function Ji(){if(lt>0||($a(),Ls(),lt>0))return;function i(){var s;Cr||(Cr=!0,n.calledRun=!0,!I&&(Us(),o(n),(s=n.onRuntimeInitialized)==null||s.call(n),T(!n._main,'compiled without a main, but one is present. if you added it from JS, use Module["onRuntimeInitialized"]'),Bs()))}n.setStatus?(n.setStatus("Running..."),setTimeout(()=>{setTimeout(()=>n.setStatus(""),1),i()},1)):i(),sn()}if(n.preInit)for(typeof n.preInit=="function"&&(n.preInit=[n.preInit]);n.preInit.length>0;)n.preInit.pop()();Ji(),r=c;for(const i of Object.keys(n))i in e||Object.defineProperty(e,i,{configurable:!0,get(){oe(`Access to module property ('${i}') is no longer possible via the module constructor argument; Instead, use the result of the module constructor.`)}});return r}})();const bu=0,Ei=1,tn=2,Si=3,Ai=4,Ci=5,Pi=6,vu=0,yn=Ei,Mt=tn,Nt=Si,xt=Ai,Ft=Ci,_n=Pi,En=Ei+8,$t=tn+8,Dt=Si+8,It=Ai+8,Lt=Ci+8,Sn=Pi+8,ku=16384;function yu(t){switch(t){case Ei:return"pawn";case tn:return"knight";case Si:return"bishop";case Ai:return"rook";case Ci:return"queen";case Pi:return"king"}throw"No Piece Type"}function rn(t){let e=t&63,r=t>>6&63,o=(t&49152)===ku?yu((t>>12&3)+tn):void 0;return{from:r,to:e,promotion:o}}class Ti{constructor(e){F(this,"m");this.m=e}static async make(e){let r=await wu({locateFile:e});return r._init(),new Ti(r)}create_position(e){return this.m._create_position(this.stringToWasm(e))}delete_position(e){this.m._delete_position(e)}unmake_move(e,r){this.m._unmake_move(e,r)}make_move(e,r){this.m._make_move(e,r)}pos_turn(e){return this.m._get_turn(e)===bu?"white":"black"}get_legal_moves(e){const r=this.m._malloc(4);let n=this.m._get_legal_moves(e,r);const o=this.m.getValue(r,"i32");let a=[];for(let c=0;c<o;c++){const f=this.m.getValue(n+c*4,"i32");a.push(f)}return this.m._free(r),this.m._free(n),a}attacks(e,r,n){const o=this.m._malloc(8);this.m._attacks(e,r,n.lo,n.hi,o);const a=this.m.getValue(o,"i32"),c=this.m.getValue(o+4,"i32");return this.m._free(o),new O(a,c)}pos_attacks(e,r){const n=this.m._malloc(8);this.m._pos_attacks(e,r,n);const o=this.m.getValue(n,"i32"),a=this.m.getValue(n+4,"i32");return this.m._free(n),new O(o,a)}get_pieces_bb(e,r){const n=this.m._malloc(8),o=this.m._malloc(4*r.length);for(let f=0;f<r.length;f++)this.m.setValue(o+f*4,r[f],"i32");this.m._get_pieces_bb(e,o,r.length,n);const a=this.m.getValue(n,"i32"),c=this.m.getValue(n+4,"i32");return this.m._free(n),this.m._free(o),new O(a,c)}get_at(e,r){let n=this.m._get_at(e,r);if(n!==vu)return n}is_checkmate(e){return this.m._is_checkmate(e)}get_pos_read_fen(e){let r=this.wasmToStringAndFree(this.m._get_fen(e));return _i.fromSetup(yi(r).unwrap()).unwrap()}make_san(e,r){let n=this.get_pos_read_fen(e);return _s(n,rn(r))}stringToWasm(e){let r=this.m;const n=e.length+1,o=r._malloc(n);return r.stringToUTF8(e,o,n),o}wasmToStringAndFree(e){return this.m.UTF8ToString(e)}}function _u(t,e,r){var c;let o=(c=Es(t,e,r).children[0])==null?void 0:c.m[0];if(!o)return;let a=_i.fromSetup(yi(t).unwrap()).unwrap();return Ss(o,a)}function Mr(t,e,r,n,o,a){if(t.rule[0]==="E"){r.length>0&&a.make_move(e,r[r.length-1]);let _=[],S=[],k=t.rule.slice(1).trim(),x=!1;for(let R of a.get_legal_moves(e)){let A=n,P=[];if(k){let[$,M]=Ao(k,A,e,R,o,a);A=$,P.push(...M)}for(let $ of t.children){if(A.length===0)break;let[M,q]=Mr($,e,[...r,R],A,o,a);A=M,P.push(...q)}A.length>0&&(t.m.push({ms:[...r,R],ctx:A[0]}),x=!0)}return x?_.push(...n):S.push(...n),r.length>0&&a.unmake_move(e,r[r.length-1]),[_,S]}if(t.rule[0]==="A"){r.length>0&&a.make_move(e,r[r.length-1]);let _=[],S=[];t.rule.slice(1).trim();let k=!0;for(let x of a.get_legal_moves(e)){let R=[],A=n;for(let P of t.children){let[$,M]=Mr(P,e,[...r,x],A,o,a);if(A=M,R.push(...$),A.length===0)break}if(A.length>0){k=!1;break}}return k?(_.push(...n),t.m.push(...n.map(x=>({ms:r,ctx:x})))):S.push(...n),r.length>0&&a.unmake_move(e,r[r.length-1]),[_,S]}let c=[],f=[],d=t.rule[0]==="\\"?t.rule.slice(1):t.rule,m=r[r.length-1],[w,g]=Ao(d,n,e,m,o,a);c=w,f.push(...g);let E=[];t.children.length===0&&(E=c);for(let _ of t.children){let[S,k]=Mr(_,e,r,c,o,a);c=k,E.push(...S)}return E.length>0&&r.length>0&&t.m.push(...E.map(_=>({ms:r,ctx:_}))),t.children.length>0&&f.push(...c),[E,f]}function Es(t,e,r){let n=r.create_position(t),o=Eu(e);return o.children.length===0||(Mr(o,n,[],[{}],r.pos_turn(n),r),r.delete_position(n)),o}function Eu(t){let e=t.trim().split(`
`),r={depth:-1,rule:".",children:[],p_m:[],m:[],n:[],long:!1,no_c:!1};const n=[r];for(let o=0;o<e.length;o++){let a=e[o],c=a.trim();if(!c)continue;const f=a.search(/\S/);let d=!1,m=!1;c[c.length-1]==="5"&&(m=!0,c=c.slice(0,-1).trim()),c[c.length-1]==="P"&&(d=!0,c=c.slice(0,-1).trim());let w={depth:f,rule:c,children:[],p_m:[],m:[],long:m,no_c:d};for(;n.length>f+1;)n.pop();n[n.length-1].children.push(w),n.push(w)}return r}function Ss(t,e){return e=e.clone(),t.ms.map(n=>{let o=rn(n),a=_s(e,o);return e.play(o),a}).join(" ")}function As(t,e){let r="",n=" ".repeat(t.depth+1),o=t.long?150:1,a=t.no_c?t.p_m:t.m,c=a.slice(0,o).map(f=>Ss(f,e)).join(", ");return a.length>1&&(c+=".."+a.length),r+=" "+t.rule+" <"+(c??"?")+`>
`,t.children.map((f,d)=>{d===t.children.length-1?r+=n+"└─":d===0?r+=n+"├─":r+=n+"│ ",r+=As(f,e)}).join(""),r}function Cs(t,e,r,n,o,a){if(t===".")return[e,[]];if(t[0]==="!"){let[w,g]=Cs(t.slice(1),e,r,n,o,a);return[g,w]}let[c,...f]=t.split(" "),d=[],m=[];for(let w of e){let g=Au(c,w,r,n,o,a);if(!g){m.push(w);continue}let[E,_]=g,S=!1;for(let k of _){let x=f.reduce((R,A)=>R.flatMap(P=>Su(A,E,P,r,n,o,a)??[]),[k]);!x||x.length===0||(S=!0,d.push(...x))}S||m.push(w)}return[d,m]}function Ao(t,e,r,n,o,a){return t.split(",").reduce((c,f)=>Cs(f.trim(),c[0],r,n,o,a),[e,[]])}function Su(t,e,r,n,o,a,c){var x;let f=(x=t.match(/^"(\w*)$/))==null?void 0:x[1],d=t.match(/\=([a-h][1-8])$/),m=t.match(/\=([pqrnbkPQRNBKmjuaglMJUAGL]'?)$/),w=t.match(/\+([a-h][1-8])$/),g=t.match(/\+([pqrnbkPQRNBKmjuaglMJUAGL]'?)$/);if(f)return f!==c.make_san(n,o)?void 0:[r];if(t.match(/#/)){c.make_move(n,o);let R=c.is_checkmate(n);return c.unmake_move(n,o),R?[r]:void 0}let E=[];c.get_at(n,r[e]);let{from:_,to:S}=rn(o);c.get_at(n,_);let k=c.get_at(n,S);if(m){let[R,A]=m;if(!k)return;if(r[A]!==void 0)return r[A]!==S?void 0:[r];if(!ur(A,a).find(M=>M===k))return;let $={...r,[A]:S};E.push($)}if(d){let[R,A]=d;if(r[A]!==void 0)return r[A]!==S?void 0:[r];let P={...r,[A]:S};E.push(P)}if(w){let[R,A]=w;c.make_move(n,o);let P=r[e];P===_&&(P=S);let $=c.pos_attacks(n,P);if(r[A]!==void 0){if(!$.has(r[A])){c.unmake_move(n,o);return}let M={...r};E.push(M)}else for(let M of $){let q={...r,[A]:M};E.push(q)}c.unmake_move(n,o)}if(g){let[R,A]=g;c.make_move(n,o);let P=r[e];P===_&&(P=S);let $=c.pos_attacks(n,P);if(r[A]!==void 0&&!$.has(r[A])){c.unmake_move(n,o);return}let M=c.get_pieces_bb(n,ur(A,a));for(let q of $.intersect(M)){let H={...r,[A]:q};E.push(H)}c.unmake_move(n,o)}return E}function Au(t,e,r,n,o,a){var S,k,x,R,A;let c=(S=t.match(/^"(\w*)$/))==null?void 0:S[1],f=(k=t.match(/^=([pqrnbkPQRNBKmjuaglMJUAGL]'?)$/))==null?void 0:k[1],d=(x=t.match(/^([pqrnbkPQRNBKmjuaglMJUAGL]'?)=$/))==null?void 0:x[1],m=(R=t.match(/^([pqrnbkPQRNBKmjuaglMJUAGL]'?)$/))==null?void 0:R[1],w=(A=t.match(/^=([a-h][1-8])$/))==null?void 0:A[1],g=[],{from:E,to:_}=rn(n);if(c)return c!==a.make_san(r,n)?void 0:[c,[e]];if(w){let P=w;if(e[P]!==void 0){if(e[P]===E||e[P]!==_)return;let M={...e};return delete M[P],[P,[M]]}let $={...e};return g.push($),[P,g]}if(f){let P=f;if(e[P]!==void 0){if(e[P]===E||e[P]!==_)return;let q={...e};return delete q[P],[P,[q]]}if(!a.get_pieces_bb(r,ur(P,o)).has(_))return;let M={...e};return g.push(M),[P,g]}if(d){let P=d;if(e[P]!==void 0){if(!(e[P]===E||e[P]===_))return;let q={...e,[P]:_};return[P,[q]]}if(!a.get_pieces_bb(r,ur(P,o)).has(E))return;let M={...e,[P]:E};return g.push(M),[P,g]}if(m){let P=m;if(e[P]!==void 0)return e[P]===E||e[P]===_?void 0:[P,[e]];let $=a.get_pieces_bb(r,ur(P,o));$.set(E,!1),$.set(_,!1);for(let M of $){let q={...e,[P]:M};g.push(q)}return[P,g]}}function ur(t,e){let r=t[0];switch(r.toLowerCase()===r==(e==="white")?r=r.toUpperCase():r=r.toLowerCase(),r[0]){case"Q":return[Ft];case"R":return[xt];case"B":return[Nt];case"N":return[Mt];case"K":return[_n];case"P":return[yn];case"M":return[Mt,Nt];case"J":return[xt,Ft];case"U":return[Mt,Nt,xt,Ft];case"L":return[Ft,xt,Nt,Mt,_n];case"G":return[Ft,xt,Nt,Mt,yn];case"A":return[yn,_n,Ft,xt,Nt,Mt];case"q":return[Lt];case"r":return[It];case"b":return[Dt];case"n":return[$t];case"k":return[Sn];case"p":return[En];case"m":return[$t,Dt];case"j":return[It,Lt];case"u":return[$t,Dt,It,Lt];case"l":return[Lt,It,Dt,$t,Sn];case"g":return[Lt,It,Dt,$t,En];case"a":return[En,Sn,Lt,It,Dt,$t];default:return[]}}const Ps=t=>{let e=Object.keys(t.has_tags).length,r={...t.has_tags};return e>0&&(r.has_tag=!0,e===1?r.single_tag=!0:r.many_tags=!0),r[`id_${t.id}`]=!0,r},Cu=t=>{let e={...t.tags,...Ps(t)};return t.rules&&[...new Set(t.rules.flatMap(Pu))].forEach(n=>e[n]=!0),e},Pu=t=>t.solve===void 0?(t.rule.rule.includes("."),["solved",`solved_${t.rule.name}`]):t.solve>=0?["failed",`failed_${t.rule.name}`]:[""];class Ts{unwrap(e,r){const n=this._chain(o=>j.ok(e?e(o):o),o=>r?j.ok(r(o)):j.err(o));if(n.isErr)throw n.error;return n.value}map(e,r){return this._chain(n=>j.ok(e(n)),n=>j.err(r?r(n):n))}chain(e,r){return this._chain(e,r||(n=>j.err(n)))}}class Tu extends Ts{constructor(e){super(),this.value=void 0,this.isOk=!0,this.isErr=!1,this.value=e}_chain(e,r){return e(this.value)}}class Ru extends Ts{constructor(e){super(),this.error=void 0,this.isOk=!1,this.isErr=!0,this.error=e}_chain(e,r){return r(this.error)}}var j;(function(t){t.ok=function(e){return new Tu(e)},t.err=function(e){return new Ru(e||new Error)},t.all=function(e){if(Array.isArray(e)){const o=[];for(let a=0;a<e.length;a++){const c=e[a];if(c.isErr)return c;o.push(c.value)}return t.ok(o)}const r={},n=Object.keys(e);for(let o=0;o<n.length;o++){const a=e[n[o]];if(a.isErr)return a;r[n[o]]=a.value}return t.ok(r)}})(j||(j={}));const Co=t=>(t=t-(t>>>1&1431655765),t=(t&858993459)+(t>>>2&858993459),Math.imul(t+(t>>>4)&252645135,16843009)>>24),qn=t=>(t=t>>>8&16711935|(t&16711935)<<8,t>>>16&65535|(t&65535)<<16),Po=t=>(t=t>>>1&1431655765|(t&1431655765)<<1,t=t>>>2&858993459|(t&858993459)<<2,t=t>>>4&252645135|(t&252645135)<<4,qn(t));class C{constructor(e,r){this.lo=e|0,this.hi=r|0}static fromSquare(e){return e>=32?new C(0,1<<e-32):new C(1<<e,0)}static fromRank(e){return new C(255,0).shl64(8*e)}static fromFile(e){return new C(16843009<<e,16843009<<e)}static empty(){return new C(0,0)}static full(){return new C(4294967295,4294967295)}static corners(){return new C(129,2164260864)}static center(){return new C(402653184,24)}static backranks(){return new C(255,4278190080)}static backrank(e){return e==="white"?new C(255,0):new C(0,4278190080)}static lightSquares(){return new C(1437226410,1437226410)}static darkSquares(){return new C(2857740885,2857740885)}complement(){return new C(~this.lo,~this.hi)}xor(e){return new C(this.lo^e.lo,this.hi^e.hi)}union(e){return new C(this.lo|e.lo,this.hi|e.hi)}intersect(e){return new C(this.lo&e.lo,this.hi&e.hi)}diff(e){return new C(this.lo&~e.lo,this.hi&~e.hi)}intersects(e){return this.intersect(e).nonEmpty()}isDisjoint(e){return this.intersect(e).isEmpty()}supersetOf(e){return e.diff(this).isEmpty()}subsetOf(e){return this.diff(e).isEmpty()}shr64(e){return e>=64?C.empty():e>=32?new C(this.hi>>>e-32,0):e>0?new C(this.lo>>>e^this.hi<<32-e,this.hi>>>e):this}shl64(e){return e>=64?C.empty():e>=32?new C(0,this.lo<<e-32):e>0?new C(this.lo<<e,this.hi<<e^this.lo>>>32-e):this}bswap64(){return new C(qn(this.hi),qn(this.lo))}rbit64(){return new C(Po(this.hi),Po(this.lo))}minus64(e){const r=this.lo-e.lo,n=(r&e.lo&1)+(e.lo>>>1)+(r>>>1)>>>31;return new C(r,this.hi-(e.hi+n))}equals(e){return this.lo===e.lo&&this.hi===e.hi}size(){return Co(this.lo)+Co(this.hi)}isEmpty(){return this.lo===0&&this.hi===0}nonEmpty(){return this.lo!==0||this.hi!==0}has(e){return(e>=32?this.hi&1<<e-32:this.lo&1<<e)!==0}set(e,r){return r?this.with(e):this.without(e)}with(e){return e>=32?new C(this.lo,this.hi|1<<e-32):new C(this.lo|1<<e,this.hi)}without(e){return e>=32?new C(this.lo,this.hi&~(1<<e-32)):new C(this.lo&~(1<<e),this.hi)}toggle(e){return e>=32?new C(this.lo,this.hi^1<<e-32):new C(this.lo^1<<e,this.hi)}last(){if(this.hi!==0)return 63-Math.clz32(this.hi);if(this.lo!==0)return 31-Math.clz32(this.lo)}first(){if(this.lo!==0)return 31-Math.clz32(this.lo&-this.lo);if(this.hi!==0)return 63-Math.clz32(this.hi&-this.hi)}withoutFirst(){return this.lo!==0?new C(this.lo&this.lo-1,this.hi):new C(0,this.hi&this.hi-1)}moreThanOne(){return this.hi!==0&&this.lo!==0||(this.lo&this.lo-1)!==0||(this.hi&this.hi-1)!==0}singleSquare(){return this.moreThanOne()?void 0:this.last()}*[Symbol.iterator](){let e=this.lo,r=this.hi;for(;e!==0;){const n=31-Math.clz32(e&-e);e^=1<<n,yield n}for(;r!==0;){const n=31-Math.clz32(r&-r);r^=1<<n,yield 32+n}}*reversed(){let e=this.lo,r=this.hi;for(;r!==0;){const n=31-Math.clz32(r);r^=1<<n,yield 32+n}for(;e!==0;){const n=31-Math.clz32(e);e^=1<<n,yield n}}}const Vr=["a","b","c","d","e","f","g","h"],Rs=["1","2","3","4","5","6","7","8"],bt=["white","black"],Le=["pawn","knight","bishop","rook","queen","king"],Ou=["a","h"],qr=t=>"role"in t;class qt{constructor(){}static default(){const e=new qt;return e.reset(),e}reset(){this.occupied=new C(65535,4294901760),this.promoted=C.empty(),this.white=new C(65535,0),this.black=new C(0,4294901760),this.pawn=new C(65280,16711680),this.knight=new C(66,1107296256),this.bishop=new C(36,603979776),this.rook=new C(129,2164260864),this.queen=new C(8,134217728),this.king=new C(16,268435456)}static empty(){const e=new qt;return e.clear(),e}clear(){this.occupied=C.empty(),this.promoted=C.empty();for(const e of bt)this[e]=C.empty();for(const e of Le)this[e]=C.empty()}clone(){const e=new qt;e.occupied=this.occupied,e.promoted=this.promoted;for(const r of bt)e[r]=this[r];for(const r of Le)e[r]=this[r];return e}getColor(e){if(this.white.has(e))return"white";if(this.black.has(e))return"black"}getRole(e){for(const r of Le)if(this[r].has(e))return r}get(e){const r=this.getColor(e);if(!r)return;const n=this.getRole(e),o=this.promoted.has(e);return{color:r,role:n,promoted:o}}take(e){const r=this.get(e);return r&&(this.occupied=this.occupied.without(e),this[r.color]=this[r.color].without(e),this[r.role]=this[r.role].without(e),r.promoted&&(this.promoted=this.promoted.without(e))),r}set(e,r){const n=this.take(e);return this.occupied=this.occupied.with(e),this[r.color]=this[r.color].with(e),this[r.role]=this[r.role].with(e),r.promoted&&(this.promoted=this.promoted.with(e)),n}has(e){return this.occupied.has(e)}*[Symbol.iterator](){for(const e of this.occupied)yield[e,this.get(e)]}pieces(e,r){return this[e].intersect(this[r])}rooksAndQueens(){return this.rook.union(this.queen)}bishopsAndQueens(){return this.bishop.union(this.queen)}kingOf(e){return this.pieces(e,"king").singleSquare()}}class We{constructor(){}static empty(){const e=new We;for(const r of Le)e[r]=0;return e}static fromBoard(e,r){const n=new We;for(const o of Le)n[o]=e.pieces(r,o).size();return n}clone(){const e=new We;for(const r of Le)e[r]=this[r];return e}equals(e){return Le.every(r=>this[r]===e[r])}add(e){const r=new We;for(const n of Le)r[n]=this[n]+e[n];return r}subtract(e){const r=new We;for(const n of Le)r[n]=this[n]-e[n];return r}nonEmpty(){return Le.some(e=>this[e]>0)}isEmpty(){return!this.nonEmpty()}hasPawns(){return this.pawn>0}hasNonPawns(){return this.knight>0||this.bishop>0||this.rook>0||this.queen>0||this.king>0}size(){return this.pawn+this.knight+this.bishop+this.rook+this.queen+this.king}}class pt{constructor(e,r){this.white=e,this.black=r}static empty(){return new pt(We.empty(),We.empty())}static fromBoard(e){return new pt(We.fromBoard(e,"white"),We.fromBoard(e,"black"))}clone(){return new pt(this.white.clone(),this.black.clone())}equals(e){return this.white.equals(e.white)&&this.black.equals(e.black)}add(e){return new pt(this.white.add(e.white),this.black.add(e.black))}subtract(e){return new pt(this.white.subtract(e.white),this.black.subtract(e.black))}count(e){return this.white[e]+this.black[e]}size(){return this.white.size()+this.black.size()}isEmpty(){return this.white.isEmpty()&&this.black.isEmpty()}nonEmpty(){return!this.isEmpty()}hasPawns(){return this.white.hasPawns()||this.black.hasPawns()}hasNonPawns(){return this.white.hasNonPawns()||this.black.hasNonPawns()}}class wr{constructor(e,r){this.white=e,this.black=r}static default(){return new wr(3,3)}clone(){return new wr(this.white,this.black)}equals(e){return this.white===e.white&&this.black===e.black}}const U=t=>t!==void 0,_e=t=>t==="white"?"black":"white",vt=t=>t>>3,Oe=t=>t&7,Yn=(t,e)=>0<=t&&t<8&&0<=e&&e<8?t+8*e:void 0,fr=t=>{switch(t){case"pawn":return"p";case"knight":return"n";case"bishop":return"b";case"rook":return"r";case"queen":return"q";case"king":return"k"}};function Qn(t){switch(t.toLowerCase()){case"p":return"pawn";case"n":return"knight";case"b":return"bishop";case"r":return"rook";case"q":return"queen";case"k":return"king";default:return}}function hr(t){if(t.length===2)return Yn(t.charCodeAt(0)-97,t.charCodeAt(1)-49)}const br=t=>Vr[Oe(t)]+Rs[vt(t)],Os=t=>{if(t[1]==="@"&&t.length===4){const e=Qn(t[0]),r=hr(t.slice(2));if(e&&U(r))return{role:e,to:r}}else if(t.length===4||t.length===5){const e=hr(t.slice(0,2)),r=hr(t.slice(2,4));let n;if(t.length===5&&(n=Qn(t[4]),!n))return;if(U(e)&&U(r))return{from:e,to:r,promotion:n}}},Ri=(t,e)=>t==="white"?e==="a"?2:6:e==="a"?58:62,Oi=(t,e)=>t==="white"?e==="a"?3:5:e==="a"?59:61,Mu="rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR",Nu=Mu+" w KQkq -",Ms=Nu+" 0 1";var de;(function(t){t.Fen="ERR_FEN",t.Board="ERR_BOARD",t.Pockets="ERR_POCKETS",t.Turn="ERR_TURN",t.Castling="ERR_CASTLING",t.EpSquare="ERR_EP_SQUARE",t.RemainingChecks="ERR_REMAINING_CHECKS",t.Halfmoves="ERR_HALFMOVES",t.Fullmoves="ERR_FULLMOVES"})(de||(de={}));class ve extends Error{}const xu=(t,e,r)=>{let n=t.indexOf(e);for(;r-- >0&&n!==-1;)n=t.indexOf(e,n+e.length);return n},Ht=t=>/^\d{1,4}$/.test(t)?parseInt(t,10):void 0,Ns=t=>{const e=Qn(t);return e&&{role:e,color:t.toLowerCase()===t?"black":"white"}},An=t=>{const e=qt.empty();let r=7,n=0;for(let o=0;o<t.length;o++){const a=t[o];if(a==="/"&&n===8)n=0,r--;else{const c=parseInt(a,10);if(c>0)n+=c;else{if(n>=8||r<0)return j.err(new ve(de.Board));const f=n+r*8,d=Ns(a);if(!d)return j.err(new ve(de.Board));t[o+1]==="~"&&(d.promoted=!0,o++),e.set(f,d),n++}}}return r!==0||n!==8?j.err(new ve(de.Board)):j.ok(e)},To=t=>{if(t.length>64)return j.err(new ve(de.Pockets));const e=pt.empty();for(const r of t){const n=Ns(r);if(!n)return j.err(new ve(de.Pockets));e[n.color][n.role]++}return j.ok(e)},Fu=(t,e)=>{let r=C.empty();if(e==="-")return j.ok(r);for(const n of e){const o=n.toLowerCase(),a=n===o?"black":"white",c=a==="white"?0:7;if("a"<=o&&o<="h")r=r.with(Yn(o.charCodeAt(0)-97,c));else if(o==="k"||o==="q"){const f=t[a].intersect(C.backrank(a)).intersect(t.rook.union(t.king)),d=o==="k"?f.last():f.first();r=r.with(U(d)&&t.rook.has(d)?d:Yn(o==="k"?7:0,c))}else return j.err(new ve(de.Castling))}return bt.some(n=>C.backrank(n).intersect(r).size()>2)?j.err(new ve(de.Castling)):j.ok(r)},Ro=t=>{const e=t.split("+");if(e.length===3&&e[0]===""){const r=Ht(e[1]),n=Ht(e[2]);return!U(r)||r>3||!U(n)||n>3?j.err(new ve(de.RemainingChecks)):j.ok(new wr(3-r,3-n))}else if(e.length===2){const r=Ht(e[0]),n=Ht(e[1]);return!U(r)||r>3||!U(n)||n>3?j.err(new ve(de.RemainingChecks)):j.ok(new wr(r,n))}else return j.err(new ve(de.RemainingChecks))},Xn=t=>{const e=t.split(/[\s_]+/),r=e.shift();let n,o=j.ok(void 0);if(r.endsWith("]")){const f=r.indexOf("[");if(f===-1)return j.err(new ve(de.Fen));n=An(r.slice(0,f)),o=To(r.slice(f+1,-1))}else{const f=xu(r,"/",7);f===-1?n=An(r):(n=An(r.slice(0,f)),o=To(r.slice(f+1)))}let a;const c=e.shift();if(!U(c)||c==="w")a="white";else if(c==="b")a="black";else return j.err(new ve(de.Turn));return n.chain(f=>{const d=e.shift(),m=U(d)?Fu(f,d):j.ok(C.empty()),w=e.shift();let g;if(U(w)&&w!=="-"&&(g=hr(w),!U(g)))return j.err(new ve(de.EpSquare));let E=e.shift(),_;U(E)&&E.includes("+")&&(_=Ro(E),E=e.shift());const S=U(E)?Ht(E):0;if(!U(S))return j.err(new ve(de.Halfmoves));const k=e.shift(),x=U(k)?Ht(k):1;if(!U(x))return j.err(new ve(de.Fullmoves));const R=e.shift();let A=j.ok(void 0);if(U(R)){if(U(_))return j.err(new ve(de.RemainingChecks));A=Ro(R)}else U(_)&&(A=_);return e.length>0?j.err(new ve(de.Fen)):o.chain(P=>m.chain($=>A.map(M=>({board:f,pockets:P,turn:a,castlingRights:$,remainingChecks:M,epSquare:g,halfmoves:S,fullmoves:Math.max(1,x)}))))})},$u=t=>{let e=fr(t.role);return t.color==="white"&&(e=e.toUpperCase()),t.promoted&&(e+="~"),e},Du=t=>{let e="",r=0;for(let n=7;n>=0;n--)for(let o=0;o<8;o++){const a=o+n*8,c=t.get(a);c?(r>0&&(e+=r,r=0),e+=$u(c)):r++,o===7&&(r>0&&(e+=r,r=0),n!==0&&(e+="/"))}return e},Oo=t=>Le.map(e=>fr(e).repeat(t[e])).join(""),Iu=t=>Oo(t.white).toUpperCase()+Oo(t.black),Lu=(t,e)=>{let r="";for(const n of bt){const o=C.backrank(n);let a=t.kingOf(n);U(a)&&!o.has(a)&&(a=void 0);const c=t.pieces(n,"rook").intersect(o);for(const f of e.intersect(o).reversed())if(f===c.first()&&U(a)&&f<a)r+=n==="white"?"Q":"q";else if(f===c.last()&&U(a)&&a<f)r+=n==="white"?"K":"k";else{const d=Vr[Oe(f)];r+=n==="white"?d.toUpperCase():d}}return r||"-"},Uu=t=>`${t.white}+${t.black}`,xs=(t,e)=>[Du(t.board)+(t.pockets?`[${Iu(t.pockets)}]`:""),t.turn[0],Lu(t.board,t.castlingRights),U(t.epSquare)?br(t.epSquare):"-",...t.remainingChecks?[Uu(t.remainingChecks)]:[],Math.max(0,Math.min(t.halfmoves,9999)),Math.max(1,Math.min(t.fullmoves,9999))].join(" "),Yr=(t,e)=>{let r=C.empty();for(const n of e){const o=t+n;0<=o&&o<64&&Math.abs(Oe(t)-Oe(o))<=2&&(r=r.with(o))}return r},ot=t=>{const e=[];for(let r=0;r<64;r++)e[r]=t(r);return e},Bu=ot(t=>Yr(t,[-9,-8,-7,-1,1,7,8,9])),zu=ot(t=>Yr(t,[-17,-15,-10,-6,6,10,15,17])),ju={white:ot(t=>Yr(t,[7,9])),black:ot(t=>Yr(t,[-7,-9]))},Mi=t=>Bu[t],Ni=t=>zu[t],nn=(t,e)=>ju[t][e],Jn=ot(t=>C.fromFile(Oe(t)).without(t)),Zn=ot(t=>C.fromRank(vt(t)).without(t)),ei=ot(t=>{const e=new C(134480385,2151686160),r=8*(vt(t)-Oe(t));return(r>=0?e.shl64(r):e.shr64(-r)).without(t)}),ti=ot(t=>{const e=new C(270549120,16909320),r=8*(vt(t)+Oe(t)-7);return(r>=0?e.shl64(r):e.shr64(-r)).without(t)}),ri=(t,e,r)=>{let n=r.intersect(e),o=n.bswap64();return n=n.minus64(t),o=o.minus64(t.bswap64()),n.xor(o.bswap64()).intersect(e)},Wu=(t,e)=>ri(C.fromSquare(t),Jn[t],e),Hu=(t,e)=>{const r=Zn[t];let n=e.intersect(r),o=n.rbit64();return n=n.minus64(C.fromSquare(t)),o=o.minus64(C.fromSquare(63-t)),n.xor(o.rbit64()).intersect(r)},vr=(t,e)=>{const r=C.fromSquare(t);return ri(r,ei[t],e).xor(ri(r,ti[t],e))},kr=(t,e)=>Wu(t,e).xor(Hu(t,e)),Fs=(t,e)=>vr(t,e).xor(kr(t,e)),$s=(t,e)=>{const r=C.fromSquare(e);return Zn[t].intersects(r)?Zn[t].with(t):ti[t].intersects(r)?ti[t].with(t):ei[t].intersects(r)?ei[t].with(t):Jn[t].intersects(r)?Jn[t].with(t):C.empty()},yr=(t,e)=>$s(t,e).intersect(C.full().shl64(t).xor(C.full().shl64(e))).withoutFirst();var rt;(function(t){t.Empty="ERR_EMPTY",t.OppositeCheck="ERR_OPPOSITE_CHECK",t.PawnsOnBackrank="ERR_PAWNS_ON_BACKRANK",t.Kings="ERR_KINGS",t.Variant="ERR_VARIANT"})(rt||(rt={}));class Ut extends Error{}const Ku=(t,e,r,n)=>r[e].intersect(kr(t,n).intersect(r.rooksAndQueens()).union(vr(t,n).intersect(r.bishopsAndQueens())).union(Ni(t).intersect(r.knight)).union(Mi(t).intersect(r.king)).union(nn(_e(e),t).intersect(r.pawn)));class mt{constructor(){}static default(){const e=new mt;return e.castlingRights=C.corners(),e.rook={white:{a:0,h:7},black:{a:56,h:63}},e.path={white:{a:new C(14,0),h:new C(96,0)},black:{a:new C(0,234881024),h:new C(0,1610612736)}},e}static empty(){const e=new mt;return e.castlingRights=C.empty(),e.rook={white:{a:void 0,h:void 0},black:{a:void 0,h:void 0}},e.path={white:{a:C.empty(),h:C.empty()},black:{a:C.empty(),h:C.empty()}},e}clone(){const e=new mt;return e.castlingRights=this.castlingRights,e.rook={white:{a:this.rook.white.a,h:this.rook.white.h},black:{a:this.rook.black.a,h:this.rook.black.h}},e.path={white:{a:this.path.white.a,h:this.path.white.h},black:{a:this.path.black.a,h:this.path.black.h}},e}add(e,r,n,o){const a=Ri(e,r),c=Oi(e,r);this.castlingRights=this.castlingRights.with(o),this.rook[e][r]=o,this.path[e][r]=yr(o,c).with(c).union(yr(n,a).with(a)).without(n).without(o)}static fromSetup(e){const r=mt.empty(),n=e.castlingRights.intersect(e.board.rook);for(const o of bt){const a=C.backrank(o),c=e.board.kingOf(o);if(!U(c)||!a.has(c))continue;const f=n.intersect(e.board[o]).intersect(a),d=f.first();U(d)&&d<c&&r.add(o,"a",c,d);const m=f.last();U(m)&&c<m&&r.add(o,"h",c,m)}return r}discardRook(e){if(this.castlingRights.has(e)){this.castlingRights=this.castlingRights.without(e);for(const r of bt)for(const n of Ou)this.rook[r][n]===e&&(this.rook[r][n]=void 0)}}discardColor(e){this.castlingRights=this.castlingRights.diff(C.backrank(e)),this.rook[e].a=void 0,this.rook[e].h=void 0}}class Gu{constructor(e){this.rules=e}reset(){this.board=qt.default(),this.pockets=void 0,this.turn="white",this.castles=mt.default(),this.epSquare=void 0,this.remainingChecks=void 0,this.halfmoves=0,this.fullmoves=1}setupUnchecked(e){this.board=e.board.clone(),this.board.promoted=C.empty(),this.pockets=void 0,this.turn=e.turn,this.castles=mt.fromSetup(e),this.epSquare=Vu(this,e.epSquare),this.remainingChecks=void 0,this.halfmoves=e.halfmoves,this.fullmoves=e.fullmoves}kingAttackers(e,r,n){return Ku(e,r,this.board,n)}playCaptureAt(e,r){this.halfmoves=0,r.role==="rook"&&this.castles.discardRook(e),this.pockets&&this.pockets[_e(r.color)][r.promoted?"pawn":r.role]++}ctx(){const e=this.isVariantEnd(),r=this.board.kingOf(this.turn);if(!U(r))return{king:r,blockers:C.empty(),checkers:C.empty(),variantEnd:e,mustCapture:!1};const n=kr(r,C.empty()).intersect(this.board.rooksAndQueens()).union(vr(r,C.empty()).intersect(this.board.bishopsAndQueens())).intersect(this.board[_e(this.turn)]);let o=C.empty();for(const c of n){const f=yr(r,c).intersect(this.board.occupied);f.moreThanOne()||(o=o.union(f))}const a=this.kingAttackers(r,_e(this.turn),this.board.occupied);return{king:r,blockers:o,checkers:a,variantEnd:e,mustCapture:!1}}clone(){var e,r;const n=new this.constructor;return n.board=this.board.clone(),n.pockets=(e=this.pockets)===null||e===void 0?void 0:e.clone(),n.turn=this.turn,n.castles=this.castles.clone(),n.epSquare=this.epSquare,n.remainingChecks=(r=this.remainingChecks)===null||r===void 0?void 0:r.clone(),n.halfmoves=this.halfmoves,n.fullmoves=this.fullmoves,n}validate(){if(this.board.occupied.isEmpty())return j.err(new Ut(rt.Empty));if(this.board.king.size()!==2)return j.err(new Ut(rt.Kings));if(!U(this.board.kingOf(this.turn)))return j.err(new Ut(rt.Kings));const e=this.board.kingOf(_e(this.turn));return U(e)?this.kingAttackers(e,this.turn,this.board.occupied).nonEmpty()?j.err(new Ut(rt.OppositeCheck)):C.backranks().intersects(this.board.pawn)?j.err(new Ut(rt.PawnsOnBackrank)):j.ok(void 0):j.err(new Ut(rt.Kings))}dropDests(e){return C.empty()}dests(e,r){if(r=r||this.ctx(),r.variantEnd)return C.empty();const n=this.board.get(e);if(!n||n.color!==this.turn)return C.empty();let o,a;if(n.role==="pawn"){o=nn(this.turn,e).intersect(this.board[_e(this.turn)]);const c=this.turn==="white"?8:-8,f=e+c;if(0<=f&&f<64&&!this.board.occupied.has(f)){o=o.with(f);const d=this.turn==="white"?e<16:e>=48,m=f+c;d&&!this.board.occupied.has(m)&&(o=o.with(m))}U(this.epSquare)&&Yu(this,e,r)&&(a=C.fromSquare(this.epSquare))}else n.role==="bishop"?o=vr(e,this.board.occupied):n.role==="knight"?o=Ni(e):n.role==="rook"?o=kr(e,this.board.occupied):n.role==="queen"?o=Fs(e,this.board.occupied):o=Mi(e);if(o=o.diff(this.board[this.turn]),U(r.king)){if(n.role==="king"){const c=this.board.occupied.without(e);for(const f of o)this.kingAttackers(f,_e(this.turn),c).nonEmpty()&&(o=o.without(f));return o.union(Mo(this,"a",r)).union(Mo(this,"h",r))}if(r.checkers.nonEmpty()){const c=r.checkers.singleSquare();if(!U(c))return C.empty();o=o.intersect(yr(c,r.king).with(c))}r.blockers.has(e)&&(o=o.intersect($s(e,r.king)))}return a&&(o=o.union(a)),o}isVariantEnd(){return!1}variantOutcome(e){}hasInsufficientMaterial(e){return this.board[e].intersect(this.board.pawn.union(this.board.rooksAndQueens())).nonEmpty()?!1:this.board[e].intersects(this.board.knight)?this.board[e].size()<=2&&this.board[_e(e)].diff(this.board.king).diff(this.board.queen).isEmpty():this.board[e].intersects(this.board.bishop)?(!this.board.bishop.intersects(C.darkSquares())||!this.board.bishop.intersects(C.lightSquares()))&&this.board.pawn.isEmpty()&&this.board.knight.isEmpty():!0}toSetup(){var e,r;return{board:this.board.clone(),pockets:(e=this.pockets)===null||e===void 0?void 0:e.clone(),turn:this.turn,castlingRights:this.castles.castlingRights,epSquare:qu(this),remainingChecks:(r=this.remainingChecks)===null||r===void 0?void 0:r.clone(),halfmoves:Math.min(this.halfmoves,150),fullmoves:Math.min(Math.max(this.fullmoves,1),9999)}}isInsufficientMaterial(){return bt.every(e=>this.hasInsufficientMaterial(e))}hasDests(e){e=e||this.ctx();for(const r of this.board[this.turn])if(this.dests(r,e).nonEmpty())return!0;return this.dropDests(e).nonEmpty()}isLegal(e,r){if(qr(e))return!this.pockets||this.pockets[this.turn][e.role]<=0||e.role==="pawn"&&C.backranks().has(e.to)?!1:this.dropDests(r).has(e.to);{if(e.promotion==="pawn"||e.promotion==="king"&&this.rules!=="antichess"||!!e.promotion!==(this.board.pawn.has(e.from)&&C.backranks().has(e.to)))return!1;const n=this.dests(e.from,r);return n.has(e.to)||n.has(Qu(this,e).to)}}isCheck(){const e=this.board.kingOf(this.turn);return U(e)&&this.kingAttackers(e,_e(this.turn),this.board.occupied).nonEmpty()}isEnd(e){return(e?e.variantEnd:this.isVariantEnd())?!0:this.isInsufficientMaterial()||!this.hasDests(e)}isCheckmate(e){return e=e||this.ctx(),!e.variantEnd&&e.checkers.nonEmpty()&&!this.hasDests(e)}isStalemate(e){return e=e||this.ctx(),!e.variantEnd&&e.checkers.isEmpty()&&!this.hasDests(e)}outcome(e){const r=this.variantOutcome(e);return r||(e=e||this.ctx(),this.isCheckmate(e)?{winner:_e(this.turn)}:this.isInsufficientMaterial()||this.isStalemate(e)?{winner:void 0}:void 0)}allDests(e){e=e||this.ctx();const r=new Map;if(e.variantEnd)return r;for(const n of this.board[this.turn])r.set(n,this.dests(n,e));return r}play(e){const r=this.turn,n=this.epSquare,o=Ds(this,e);if(this.epSquare=void 0,this.halfmoves+=1,r==="black"&&(this.fullmoves+=1),this.turn=_e(r),qr(e))this.board.set(e.to,{role:e.role,color:r}),this.pockets&&this.pockets[r][e.role]--,e.role==="pawn"&&(this.halfmoves=0);else{const a=this.board.take(e.from);if(!a)return;let c;if(a.role==="pawn"){this.halfmoves=0,e.to===n&&(c=this.board.take(e.to+(r==="white"?-8:8)));const f=e.from-e.to;Math.abs(f)===16&&8<=e.from&&e.from<=55&&(this.epSquare=e.from+e.to>>1),e.promotion&&(a.role=e.promotion,a.promoted=!!this.pockets)}else if(a.role==="rook")this.castles.discardRook(e.from);else if(a.role==="king"){if(o){const f=this.castles.rook[r][o];if(U(f)){const d=this.board.take(f);this.board.set(Ri(r,o),a),d&&this.board.set(Oi(r,o),d)}}this.castles.discardColor(r)}if(!o){const f=this.board.set(e.to,a)||c;f&&this.playCaptureAt(e.to,f)}}this.remainingChecks&&this.isCheck()&&(this.remainingChecks[r]=Math.max(this.remainingChecks[r]-1,0))}}class ni extends Gu{constructor(){super("chess")}static default(){const e=new this;return e.reset(),e}static fromSetup(e){const r=new this;return r.setupUnchecked(e),r.validate().map(n=>r)}clone(){return super.clone()}}const Vu=(t,e)=>{if(!U(e))return;const r=t.turn==="white"?5:2,n=t.turn==="white"?8:-8;if(vt(e)!==r||t.board.occupied.has(e+n))return;const o=e-n;if(!(!t.board.pawn.has(o)||!t.board[_e(t.turn)].has(o)))return e},qu=t=>{if(!U(t.epSquare))return;const e=t.ctx(),n=t.board.pieces(t.turn,"pawn").intersect(nn(_e(t.turn),t.epSquare));for(const o of n)if(t.dests(o,e).has(t.epSquare))return t.epSquare},Yu=(t,e,r)=>{if(!U(t.epSquare)||!nn(t.turn,e).has(t.epSquare))return!1;if(!U(r.king))return!0;const n=t.turn==="white"?8:-8,o=t.epSquare-n;return t.kingAttackers(r.king,_e(t.turn),t.board.occupied.toggle(e).toggle(o).with(t.epSquare)).without(o).isEmpty()},Mo=(t,e,r)=>{if(!U(r.king)||r.checkers.nonEmpty())return C.empty();const n=t.castles.rook[t.turn][e];if(!U(n)||t.castles.path[t.turn][e].intersects(t.board.occupied))return C.empty();const o=Ri(t.turn,e),a=yr(r.king,o),c=t.board.occupied.without(r.king);for(const m of a)if(t.kingAttackers(m,_e(t.turn),c).nonEmpty())return C.empty();const f=Oi(t.turn,e),d=t.board.occupied.toggle(r.king).toggle(n).toggle(f);return t.kingAttackers(o,_e(t.turn),d).nonEmpty()?C.empty():C.fromSquare(n)},Ds=(t,e)=>{if(qr(e))return;const r=e.to-e.from;if(!(Math.abs(r)!==2&&!t.board[t.turn].has(e.to))&&t.board.king.has(e.from))return r>0?"h":"a"},Qu=(t,e)=>{const r=Ds(t,e);if(!r)return e;const n=t.castles.rook[t.turn][r];return{from:e.from,to:U(n)?n:e.to}},Xu=(t,e)=>{const r=new Map,n=t.ctx();for(const[o,a]of t.allDests(n))if(a.nonEmpty()){const c=Array.from(a,br);o===n.king&&Oe(o)===4&&(a.has(0)?c.push("c1"):a.has(56)&&c.push("c8"),a.has(7)?c.push("g1"):a.has(63)&&c.push("g8")),r.set(br(o),c)}return r},Ju=(t,e)=>{let r="";if(qr(e))e.role!=="pawn"&&(r=fr(e.role).toUpperCase()),r+="@"+br(e.to);else{const n=t.board.getRole(e.from);if(!n)return"--";if(n==="king"&&(t.board[t.turn].has(e.to)||Math.abs(e.to-e.from)===2))r=e.to>e.from?"O-O":"O-O-O";else{const o=t.board.occupied.has(e.to)||n==="pawn"&&Oe(e.from)!==Oe(e.to);if(n!=="pawn"){r=fr(n).toUpperCase();let a;if(n==="king"?a=Mi(e.to).intersect(t.board.king):n==="queen"?a=Fs(e.to,t.board.occupied).intersect(t.board.queen):n==="rook"?a=kr(e.to,t.board.occupied).intersect(t.board.rook):n==="bishop"?a=vr(e.to,t.board.occupied).intersect(t.board.bishop):a=Ni(e.to).intersect(t.board.knight),a=a.intersect(t.board[t.turn]).without(e.from),a.nonEmpty()){const c=t.ctx();for(const f of a)t.dests(f,c).has(e.to)||(a=a.without(f));if(a.nonEmpty()){let f=!1,d=a.intersects(C.fromRank(vt(e.from)));a.intersects(C.fromFile(Oe(e.from)))?f=!0:d=!0,d&&(r+=Vr[Oe(e.from)]),f&&(r+=Rs[vt(e.from)])}}}else o&&(r=Vr[Oe(e.from)]);o&&(r+="x"),r+=br(e.to),e.promotion&&(r+="="+fr(e.promotion).toUpperCase())}}return r},Zu=(t,e)=>{var r;const n=Ju(t,e);return t.play(e),!((r=t.outcome())===null||r===void 0)&&r.winner?n+"#":t.isCheck()?n+"+":n},ef=(t,e)=>Zu(t.clone(),e);function tf(t,e){let r=Xn(t).unwrap(),n=ni.fromSetup(r).unwrap(),o=Os(e);return n.play(o),xs(n.toSetup())}const Xr=class Xr{constructor(){F(this,"_add_uci");F(this,"_promotion");F(this,"_position");F(this,"m_fen");F(this,"m_dests");F(this,"m_color");F(this,"_last_move");F(this,"_on_wheel");F(this,"set_on_wheel",e=>{this._on_wheel[1](e)});F(this,"on_play_uci",e=>{let r=tf(this.fen,e);this.on_set_fen_uci(r,e)});F(this,"on_set_fen_uci",(e,r)=>{Fr(()=>{this.add_uci=void 0,this.last_move=r,this.position=ni.fromSetup(Xn(e).unwrap()).unwrap()})});F(this,"reset_move_after",()=>{this.position=this.position});F(this,"on_move_after",(e,r)=>{let n=this.position.board.get(hr(e)),o=e+r;n.role==="pawn"&&(r[1]==="8"&&this.turnColor==="white"||r[1]==="1"&&this.turnColor==="black")&&(o+="q");let a=Os(o),c=ef(this.position,a);this.position.play(a),Fr(()=>{this.last_move=o,this.position=this.position,o.length===5&&(this.promotion=r),this.add_uci=[o,c]})});this._on_wheel=ge(void 0,{equals:!1}),this._last_move=ge(void 0,{equals:!1}),this._add_uci=ge(void 0,{equals:!1}),this._promotion=ge(void 0,{equals:!1}),this._position=ge(ni.fromSetup(Xn(Ms).unwrap()).unwrap(),{equals:!1}),this.m_dests=ke(()=>Xu(this.position)),this.m_fen=ke(()=>xs(this.position.toSetup())),this.m_color=ke(()=>this.position.turn)}get position(){return this._position[0]()}set position(e){this._position[1](e)}get turnColor(){return this.m_color()}get promotion(){return this._promotion[0]()}set promotion(e){this._promotion[1](e)}get add_uci(){return this._add_uci[0]()}set add_uci(e){this._add_uci[1](e)}get last_move(){return this._last_move[0]()}set last_move(e){this._last_move[1](e)}get on_wheel(){return this._on_wheel[0]()}get fen_uci(){let e=this.fen,r=this.last_move;return[e,r]}get fen(){return this.m_fen()}get dests(){return this.m_dests()}};F(Xr,"init",()=>new Xr);let ii=Xr;function rf(t){let e=0;return r=>{e+=r.deltaY*(r.deltaMode?40:1),Math.abs(e)>=4?(t(r,!0),e=0):t(r,!1)}}function nf(t){return new Worker(""+new URL("worker2-039GGfcq.js",import.meta.url).href,{type:"module",name:t==null?void 0:t.name})}const on=Va(),of=t=>{let e=new nf;const[r,n]=ge(),[o,a]=ge(),[c,f]=ge();e.onmessage=k=>{switch(k.data==="ready"&&(d=!0,g()),k.data.t){case"progress":n(k.data.d);break;case"puzzles":let{all:x,filtered:R}=k.data.d;Fr(()=>{f(x),a(R)});break}};let d=!1,m,w=[];function g(){d&&e.postMessage({t:"filter",d:{filter:m,rules:w}})}let S={get progress(){return r()},get puzzles(){return o()},get all(){return c()},filter:k=>{m=k,g()},rules:k=>{w=k,g()}};return Ee(on.Provider,{value:S,get children(){return[" ",ke(()=>t.children)," "]}})};function sf(t,e,r=!1){let n,o=0;return function(...a){const c=this;n&&clearTimeout(n),n=void 0;const f=performance.now()-o;o=performance.now(),r&&f>e?t.apply(c,a):n=setTimeout(()=>{n=void 0,t.apply(c,a)},e)}}var af=De("<div class=header>"),lf=De("<div class=app-wrap><div class=board-wrap><div class=board></div><div class=tree></div></div><div class=editor-wrap></div><div class=puzzles-wrap>"),cf=De("<div>"),uf=De("<div class=progress> <!>/<!> "),ff=De('<div class=puzzles><div class=filter><input type=text placeholder="Filter y_filter _!_ n_filter"><span>/10000 Positions</span></div><div class=list></div><div class=info><button>Toggle Solved</button><button>Toggle Id</button><button>Toggle Failed'),hf=De("<div><span class=id><a target=_blank></a></span><span class=has-tags></span><span class=tags>"),No=De("<span class=tag>"),df=De("<div class=rule-list><div class=scroll-wrap></div><div class=tools><div class=rule>+ New rule</div><div class=rule>- Delete rule"),pf=De("<div class=text-wrap><textarea class=editor-input title=rules rows=13 cols=21></textarea><div class=ascii><textarea>"),mf=De("<div><span class=name></span><span class=stats>f <!> / s "),gf=De("<span>");function wf(){return Ee(of,{get children(){return Ee(bf,{})}})}function bf(){const[t,e]=ge(void 0),[r,n]=ge(0),o=ke(()=>{let f=t();return f?f.sans:[]});Ve(()=>{let f=t(),d=r();f?a.on_set_fen_uci(f.move_fens[d+1]):a.on_set_fen_uci(Ms)}),Ve(Cn(t,()=>{n(-1)}));const a=new ii,c=rf((f,d)=>{if(!d)return;const m=f.target;if(m.tagName!=="PIECE"&&m.tagName!=="SQUARE"&&m.tagName!=="CG-BOARD")return;f.preventDefault();let w=Math.sign(f.deltaY),g=t();w>0?g&&n(Math.min(g.move_fens.length-2,r()+1)):n(Math.max(-1,r()-1))});return[af(),(()=>{var f=lf(),d=f.firstChild,m=d.firstChild,w=m.nextSibling,g=d.nextSibling,E=g.nextSibling;return al(m,"wheel",c),ae(m,Ee(jc,{onShapes:()=>{},movable:!0,get doPromotion(){return a.promotion},get onMoveAfter(){return a.on_move_after},get fen_uci(){return a.fen_uci},get color(){return a.turnColor},get dests(){return a.dests}})),ae(w,Ee(cr,{get each(){return o()},children:(_,S)=>(()=>{var k=cf();return k.$$click=()=>n(S),ae(k,_),Qe(()=>li(k,"san"+(r()===S()?" active":""))),k})()})),ae(g,Ee(yf,{get fen(){return a.fen_uci[0]}})),ae(E,Ee(kf,{on_selected_puzzle:e})),ae(f,Ee(vf,{}),null),f})()]}const vf=()=>{const t=oi(on);return Ee(ai,{get when(){return t.progress},children:e=>(()=>{var r=uf(),n=r.firstChild,o=n.nextSibling,a=o.nextSibling,c=a.nextSibling;return c.nextSibling,ae(r,()=>e()[0],o),ae(r,()=>e()[1],c),r})()})},Jr=class Jr{constructor(e){this.puzzle=e}get id(){return this.puzzle.id}get fen(){return this.puzzle.fen}get tags(){return this.puzzle.tags}get has_tags(){return Ps(this.puzzle)}get all_tags(){return Cu(this.puzzle)}};F(Jr,"create",e=>new Jr(e));let Qr=Jr;const kf=t=>{let e=oi(on);const r=ke(si(()=>e.puzzles,Qr.create)),[n,o]=Bn(void 0,"filter"),[a,c]=Bn(void 0,"id_selected"),f=ke(()=>r().find(k=>k.id===a()));let d=n();const m=()=>{let k=n();if(!k)return;let x=f();x&&(d?(o(d),d=void 0):(d=k,o(`id_${x.id} `)))},w=()=>{let k=n();k&&(k.includes("solved")?k=k.replace("solved",""):k=k.trim()+" solved",o(k))};let g=n();const E=()=>{let k=n();k&&(k.includes("failed")?(k=g,g=void 0):(g=k,k="failed"),o(k))};Ve(Cn(f,k=>{var x;k?t.on_selected_puzzle(k.puzzle):(r()[0]&&c((x=r()[0])==null?void 0:x.id),t.on_selected_puzzle(void 0))})),Ve(Cn(n,k=>{e.filter(k)}));let _;const S=sf(k=>{o(k)},1100);return(()=>{var k=ff(),x=k.firstChild,R=x.firstChild,A=R.nextSibling,P=A.firstChild,$=x.nextSibling,M=$.nextSibling,q=M.firstChild,H=q.nextSibling,K=H.nextSibling;return Bo(G=>_=G,R),R.$$input=()=>S(_.value),no(R,"spellcheck",!1),ae(A,()=>r().length,P),ae($,Ee(ai,{get when(){return r()},children:G=>Ee(cr,{get each(){return G().slice(0,1e3)},children:I=>(()=>{var T=hf(),X=T.firstChild,He=X.firstChild,_t=X.nextSibling,ie=_t.nextSibling;return T.$$click=()=>c(I.id),ae(He,()=>I.id),ae(_t,Ee(cr,{get each(){return Object.keys(I.has_tags).filter(B=>!B.includes("id_"))},children:B=>(()=>{var Me=No();return ae(Me,B),Me})()})),ae(ie,Ee(cr,{get each(){return Object.keys(I.all_tags)},children:B=>(()=>{var Me=No();return ae(Me,B),Me})()})),Qe(B=>{var Me="puzzle"+(I.id===a()?" active":""),Et=`https://lichess.org/training/${I.id}`;return Me!==B.e&&li(T,B.e=Me),Et!==B.t&&no(He,"href",B.t=Et),B},{e:void 0,t:void 0}),T})()})})),q.$$click=w,H.$$click=m,K.$$click=E,Qe(()=>R.value=n()),k})()};function yf(t){let e=oi(on);const r=ke(si(()=>e.all,Qr.create)),n=R=>r().filter(A=>A.all_tags[`failed_${R}`]).length,o=R=>r().filter(A=>A.all_tags[`solved_${R}`]).length;function a(){let R=1,A=`rule${R}`,P=c();for(;P.find($=>$.name===A);)A=`rule${R++}`;return{name:A,rule:""}}const[c,f]=Bn([{name:"rule1",rule:""}],"rule-list"),[d,m]=ge(0);e.rules(c());const w=ke(()=>c()[d()]),g=R=>{if(R.key==="Escape"){let A=R.target.value,P=w(),$={name:P.name,rule:A},M=c(),q=M.findIndex(H=>H.name===P.name);M.splice(q,1,$),f([...M]),e.rules([$])}},E=()=>{Fr(()=>{f([a(),...c()]),m(0)})},_=()=>{let R=c();if(R.length===1)return;let A=R.splice(d(),1);f([...R]),e.rules(A.map(P=>({name:P.name,rule:""})))};let[S]=Ha(()=>Ti.make(()=>cl)),k=ke(()=>{let R=S(),A=w().rule;if(t.fen&&R)try{return _u(t.fen,A,R)}catch(P){return"Error"+P}});const x=ke(()=>{let R=w();if(!R||!t.fen)return;let A=S();if(!A)return;let P=_i.fromSetup(yi(t.fen).unwrap()).unwrap();return As(Es(t.fen,R.rule,A),P)});return[(()=>{var R=df(),A=R.firstChild,P=A.nextSibling,$=P.firstChild,M=$.nextSibling;return ae(A,Ee(cr,{get each(){return c()},children:(q,H)=>(()=>{var K=mf(),G=K.firstChild,I=G.nextSibling,T=I.firstChild,X=T.nextSibling;return X.nextSibling,K.$$click=()=>m(H()),ae(G,()=>q.name),ae(I,()=>n(q.name),X),ae(I,()=>o(q.name),null),Qe(()=>li(K,"rule"+(H()===d()?" active":""))),K})()})),$.$$click=E,M.$$click=_,R})(),(()=>{var R=pf(),A=R.firstChild,P=A.nextSibling,$=P.firstChild;return A.$$keydown=g,$.disabled=!0,ae($,x),ae(P,Ee(ai,{get when(){return k()},children:M=>(()=>{var q=gf();return ae(q,M),q})()}),null),Qe(()=>{var M;return A.value=((M=w())==null?void 0:M.rule)??"Select a rule"}),R})()]}sl(["click","input","keydown"]);const _f=document.getElementById("root");ol(()=>Ee(wf,{}),_f);const Ef=Object.freeze(Object.defineProperty({__proto__:null},Symbol.toStringTag,{value:"Module"}));
